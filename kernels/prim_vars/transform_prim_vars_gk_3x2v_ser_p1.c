#include <gkyl_dg_prim_vars_kernels.h> 
#include <gkyl_binop_mul_ser.h> 
#include <gkyl_basis_ser_3x_p1_inv.h> 
GKYL_CU_DH void transform_prim_vars_gk_3x2v_ser_p1(const double *b_i, const double *moms, double* prim_vars) 
{ 
  // moms: Input moments. 
  // b_i:  Contravariant components of field-aligned unit vector. 
  // prim_vars: upar = udrift . bhat, vtSq = 1/vdim(m2/m0 - upar^2) (last component). 
 
  const double *m0 = &moms[0]; 
  const double *m1x = &moms[8]; 
  const double *m2 = &moms[16]; 
 
  const double *b_x = &b_i[0]; 
  double *upar = &prim_vars[0]; 
  double *vtSq = &prim_vars[8]; 
 
  double m0_inv[8] = {0.0}; 

  double ux[8] = {0.0}; 
  double uparSq[8] = {0.0}; 

  ser_3x_p1_inv(m0, m0_inv); 
  binop_mul_3d_ser_p1(m1x, m0_inv, ux); 

  upar[0] = 0.3535533905932737*b_x[7]*ux[7]+0.3535533905932737*b_x[6]*ux[6]+0.3535533905932737*b_x[5]*ux[5]+0.3535533905932737*b_x[4]*ux[4]+0.3535533905932737*b_x[3]*ux[3]+0.3535533905932737*b_x[2]*ux[2]+0.3535533905932737*b_x[1]*ux[1]+0.3535533905932737*b_x[0]*ux[0]; 
  upar[1] = 0.3535533905932737*b_x[6]*ux[7]+0.3535533905932737*ux[6]*b_x[7]+0.3535533905932737*b_x[3]*ux[5]+0.3535533905932737*ux[3]*b_x[5]+0.3535533905932737*b_x[2]*ux[4]+0.3535533905932737*ux[2]*b_x[4]+0.3535533905932737*b_x[0]*ux[1]+0.3535533905932737*ux[0]*b_x[1]; 
  upar[2] = 0.3535533905932737*b_x[5]*ux[7]+0.3535533905932737*ux[5]*b_x[7]+0.3535533905932737*b_x[3]*ux[6]+0.3535533905932737*ux[3]*b_x[6]+0.3535533905932737*b_x[1]*ux[4]+0.3535533905932737*ux[1]*b_x[4]+0.3535533905932737*b_x[0]*ux[2]+0.3535533905932737*ux[0]*b_x[2]; 
  upar[3] = 0.3535533905932737*b_x[4]*ux[7]+0.3535533905932737*ux[4]*b_x[7]+0.3535533905932737*b_x[2]*ux[6]+0.3535533905932737*ux[2]*b_x[6]+0.3535533905932737*b_x[1]*ux[5]+0.3535533905932737*ux[1]*b_x[5]+0.3535533905932737*b_x[0]*ux[3]+0.3535533905932737*ux[0]*b_x[3]; 
  upar[4] = 0.3535533905932737*b_x[3]*ux[7]+0.3535533905932737*ux[3]*b_x[7]+0.3535533905932737*b_x[5]*ux[6]+0.3535533905932737*ux[5]*b_x[6]+0.3535533905932737*b_x[0]*ux[4]+0.3535533905932737*ux[0]*b_x[4]+0.3535533905932737*b_x[1]*ux[2]+0.3535533905932737*ux[1]*b_x[2]; 
  upar[5] = 0.3535533905932737*b_x[2]*ux[7]+0.3535533905932737*ux[2]*b_x[7]+0.3535533905932737*b_x[4]*ux[6]+0.3535533905932737*ux[4]*b_x[6]+0.3535533905932737*b_x[0]*ux[5]+0.3535533905932737*ux[0]*b_x[5]+0.3535533905932737*b_x[1]*ux[3]+0.3535533905932737*ux[1]*b_x[3]; 
  upar[6] = 0.3535533905932737*b_x[1]*ux[7]+0.3535533905932737*ux[1]*b_x[7]+0.3535533905932737*b_x[0]*ux[6]+0.3535533905932737*ux[0]*b_x[6]+0.3535533905932737*b_x[4]*ux[5]+0.3535533905932737*ux[4]*b_x[5]+0.3535533905932737*b_x[2]*ux[3]+0.3535533905932737*ux[2]*b_x[3]; 
  upar[7] = 0.3535533905932737*b_x[0]*ux[7]+0.3535533905932737*ux[0]*b_x[7]+0.3535533905932737*b_x[1]*ux[6]+0.3535533905932737*ux[1]*b_x[6]+0.3535533905932737*b_x[2]*ux[5]+0.3535533905932737*ux[2]*b_x[5]+0.3535533905932737*b_x[3]*ux[4]+0.3535533905932737*ux[3]*b_x[4]; 

  binop_mul_3d_ser_p1(upar, upar, uparSq); 
  vtSq[0] = 0.3535533905932737*m0_inv[7]*m2[7]+0.3535533905932737*m0_inv[6]*m2[6]+0.3535533905932737*m0_inv[5]*m2[5]+0.3535533905932737*m0_inv[4]*m2[4]+0.3535533905932737*m0_inv[3]*m2[3]+0.3535533905932737*m0_inv[2]*m2[2]+0.3535533905932737*m0_inv[1]*m2[1]-1.0*uparSq[0]+0.3535533905932737*m0_inv[0]*m2[0]; 
  vtSq[1] = 0.3535533905932737*m0_inv[6]*m2[7]+0.3535533905932737*m2[6]*m0_inv[7]+0.3535533905932737*m0_inv[3]*m2[5]+0.3535533905932737*m2[3]*m0_inv[5]+0.3535533905932737*m0_inv[2]*m2[4]+0.3535533905932737*m2[2]*m0_inv[4]-1.0*uparSq[1]+0.3535533905932737*m0_inv[0]*m2[1]+0.3535533905932737*m2[0]*m0_inv[1]; 
  vtSq[2] = 0.3535533905932737*m0_inv[5]*m2[7]+0.3535533905932737*m2[5]*m0_inv[7]+0.3535533905932737*m0_inv[3]*m2[6]+0.3535533905932737*m2[3]*m0_inv[6]+0.3535533905932737*m0_inv[1]*m2[4]+0.3535533905932737*m2[1]*m0_inv[4]-1.0*uparSq[2]+0.3535533905932737*m0_inv[0]*m2[2]+0.3535533905932737*m2[0]*m0_inv[2]; 
  vtSq[3] = 0.3535533905932737*m0_inv[4]*m2[7]+0.3535533905932737*m2[4]*m0_inv[7]+0.3535533905932737*m0_inv[2]*m2[6]+0.3535533905932737*m2[2]*m0_inv[6]+0.3535533905932737*m0_inv[1]*m2[5]+0.3535533905932737*m2[1]*m0_inv[5]-1.0*uparSq[3]+0.3535533905932737*m0_inv[0]*m2[3]+0.3535533905932737*m2[0]*m0_inv[3]; 
  vtSq[4] = 0.3535533905932737*m0_inv[3]*m2[7]+0.3535533905932737*m2[3]*m0_inv[7]+0.3535533905932737*m0_inv[5]*m2[6]+0.3535533905932737*m2[5]*m0_inv[6]-1.0*uparSq[4]+0.3535533905932737*m0_inv[0]*m2[4]+0.3535533905932737*m2[0]*m0_inv[4]+0.3535533905932737*m0_inv[1]*m2[2]+0.3535533905932737*m2[1]*m0_inv[2]; 
  vtSq[5] = 0.3535533905932737*m0_inv[2]*m2[7]+0.3535533905932737*m2[2]*m0_inv[7]+0.3535533905932737*m0_inv[4]*m2[6]+0.3535533905932737*m2[4]*m0_inv[6]-1.0*uparSq[5]+0.3535533905932737*m0_inv[0]*m2[5]+0.3535533905932737*m2[0]*m0_inv[5]+0.3535533905932737*m0_inv[1]*m2[3]+0.3535533905932737*m2[1]*m0_inv[3]; 
  vtSq[6] = 0.3535533905932737*m0_inv[1]*m2[7]+0.3535533905932737*m2[1]*m0_inv[7]-1.0*uparSq[6]+0.3535533905932737*m0_inv[0]*m2[6]+0.3535533905932737*m2[0]*m0_inv[6]+0.3535533905932737*m0_inv[4]*m2[5]+0.3535533905932737*m2[4]*m0_inv[5]+0.3535533905932737*m0_inv[2]*m2[3]+0.3535533905932737*m2[2]*m0_inv[3]; 
  vtSq[7] = -(1.0*uparSq[7])+0.3535533905932737*m0_inv[0]*m2[7]+0.3535533905932737*m2[0]*m0_inv[7]+0.3535533905932737*m0_inv[1]*m2[6]+0.3535533905932737*m2[1]*m0_inv[6]+0.3535533905932737*m0_inv[2]*m2[5]+0.3535533905932737*m2[2]*m0_inv[5]+0.3535533905932737*m0_inv[3]*m2[4]+0.3535533905932737*m2[3]*m0_inv[4]; 

} 
 
