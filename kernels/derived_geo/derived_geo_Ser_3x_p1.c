#include "gkyl_calc_derived_geo_kernels.h"

GKYL_CU_DH void derived_geo_3x_Ser_p1(const double *gij, double *J, double *grij) 
{ 
const double *g11  = &gij[0 * 8];
const double *g12  = &gij[1 * 8];
const double *g13  = &gij[2 * 8];
const double *g22  = &gij[3 * 8];
const double *g23  = &gij[4 * 8];
const double *g33  = &gij[5 * 8];
double *gr11  = &grij[0 * 8];
double *gr12  = &grij[1 * 8];
double *gr13  = &grij[2 * 8];
double *gr22  = &grij[3 * 8];
double *gr23  = &grij[4 * 8];
double *gr33  = &grij[5 * 8];
double g11_n[8]; 
double gr11_n[8]; 
double g12_n[8]; 
double gr12_n[8]; 
double g13_n[8]; 
double gr13_n[8]; 
double g22_n[8]; 
double gr22_n[8]; 
double g23_n[8]; 
double gr23_n[8]; 
double g33_n[8]; 
double gr33_n[8]; 
double Jsq_n[8]; 
double J_n[8]; 
double *g21_n = g12_n; 
double *g31_n = g13_n; 
double *g32_n = g23_n; 
// Calculate g_ij at nodes 
 g11_n[0] = (-1.837117307087383*g11[7])+1.060660171779821*g11[6]+1.060660171779821*g11[5]+1.060660171779821*g11[4]-0.6123724356957944*g11[3]-0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[1] = 1.837117307087383*g11[7]+1.060660171779821*g11[6]-1.060660171779821*g11[5]-1.060660171779821*g11[4]-0.6123724356957944*g11[3]-0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[2] = 1.837117307087383*g11[7]-1.060660171779821*g11[6]+1.060660171779821*g11[5]-1.060660171779821*g11[4]-0.6123724356957944*g11[3]+0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[3] = (-1.837117307087383*g11[7])-1.060660171779821*g11[6]-1.060660171779821*g11[5]+1.060660171779821*g11[4]-0.6123724356957944*g11[3]+0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[4] = 1.837117307087383*g11[7]-1.060660171779821*g11[6]-1.060660171779821*g11[5]+1.060660171779821*g11[4]+0.6123724356957944*g11[3]-0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[5] = (-1.837117307087383*g11[7])-1.060660171779821*g11[6]+1.060660171779821*g11[5]-1.060660171779821*g11[4]+0.6123724356957944*g11[3]-0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[6] = (-1.837117307087383*g11[7])+1.060660171779821*g11[6]-1.060660171779821*g11[5]-1.060660171779821*g11[4]+0.6123724356957944*g11[3]+0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[7] = 1.837117307087383*g11[7]+1.060660171779821*g11[6]+1.060660171779821*g11[5]+1.060660171779821*g11[4]+0.6123724356957944*g11[3]+0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g12_n[0] = (-1.837117307087383*g12[7])+1.060660171779821*g12[6]+1.060660171779821*g12[5]+1.060660171779821*g12[4]-0.6123724356957944*g12[3]-0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[1] = 1.837117307087383*g12[7]+1.060660171779821*g12[6]-1.060660171779821*g12[5]-1.060660171779821*g12[4]-0.6123724356957944*g12[3]-0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[2] = 1.837117307087383*g12[7]-1.060660171779821*g12[6]+1.060660171779821*g12[5]-1.060660171779821*g12[4]-0.6123724356957944*g12[3]+0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[3] = (-1.837117307087383*g12[7])-1.060660171779821*g12[6]-1.060660171779821*g12[5]+1.060660171779821*g12[4]-0.6123724356957944*g12[3]+0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[4] = 1.837117307087383*g12[7]-1.060660171779821*g12[6]-1.060660171779821*g12[5]+1.060660171779821*g12[4]+0.6123724356957944*g12[3]-0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[5] = (-1.837117307087383*g12[7])-1.060660171779821*g12[6]+1.060660171779821*g12[5]-1.060660171779821*g12[4]+0.6123724356957944*g12[3]-0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[6] = (-1.837117307087383*g12[7])+1.060660171779821*g12[6]-1.060660171779821*g12[5]-1.060660171779821*g12[4]+0.6123724356957944*g12[3]+0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[7] = 1.837117307087383*g12[7]+1.060660171779821*g12[6]+1.060660171779821*g12[5]+1.060660171779821*g12[4]+0.6123724356957944*g12[3]+0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g13_n[0] = (-1.837117307087383*g13[7])+1.060660171779821*g13[6]+1.060660171779821*g13[5]+1.060660171779821*g13[4]-0.6123724356957944*g13[3]-0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[1] = 1.837117307087383*g13[7]+1.060660171779821*g13[6]-1.060660171779821*g13[5]-1.060660171779821*g13[4]-0.6123724356957944*g13[3]-0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[2] = 1.837117307087383*g13[7]-1.060660171779821*g13[6]+1.060660171779821*g13[5]-1.060660171779821*g13[4]-0.6123724356957944*g13[3]+0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[3] = (-1.837117307087383*g13[7])-1.060660171779821*g13[6]-1.060660171779821*g13[5]+1.060660171779821*g13[4]-0.6123724356957944*g13[3]+0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[4] = 1.837117307087383*g13[7]-1.060660171779821*g13[6]-1.060660171779821*g13[5]+1.060660171779821*g13[4]+0.6123724356957944*g13[3]-0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[5] = (-1.837117307087383*g13[7])-1.060660171779821*g13[6]+1.060660171779821*g13[5]-1.060660171779821*g13[4]+0.6123724356957944*g13[3]-0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[6] = (-1.837117307087383*g13[7])+1.060660171779821*g13[6]-1.060660171779821*g13[5]-1.060660171779821*g13[4]+0.6123724356957944*g13[3]+0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[7] = 1.837117307087383*g13[7]+1.060660171779821*g13[6]+1.060660171779821*g13[5]+1.060660171779821*g13[4]+0.6123724356957944*g13[3]+0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g22_n[0] = (-1.837117307087383*g22[7])+1.060660171779821*g22[6]+1.060660171779821*g22[5]+1.060660171779821*g22[4]-0.6123724356957944*g22[3]-0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[1] = 1.837117307087383*g22[7]+1.060660171779821*g22[6]-1.060660171779821*g22[5]-1.060660171779821*g22[4]-0.6123724356957944*g22[3]-0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[2] = 1.837117307087383*g22[7]-1.060660171779821*g22[6]+1.060660171779821*g22[5]-1.060660171779821*g22[4]-0.6123724356957944*g22[3]+0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[3] = (-1.837117307087383*g22[7])-1.060660171779821*g22[6]-1.060660171779821*g22[5]+1.060660171779821*g22[4]-0.6123724356957944*g22[3]+0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[4] = 1.837117307087383*g22[7]-1.060660171779821*g22[6]-1.060660171779821*g22[5]+1.060660171779821*g22[4]+0.6123724356957944*g22[3]-0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[5] = (-1.837117307087383*g22[7])-1.060660171779821*g22[6]+1.060660171779821*g22[5]-1.060660171779821*g22[4]+0.6123724356957944*g22[3]-0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[6] = (-1.837117307087383*g22[7])+1.060660171779821*g22[6]-1.060660171779821*g22[5]-1.060660171779821*g22[4]+0.6123724356957944*g22[3]+0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[7] = 1.837117307087383*g22[7]+1.060660171779821*g22[6]+1.060660171779821*g22[5]+1.060660171779821*g22[4]+0.6123724356957944*g22[3]+0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g23_n[0] = (-1.837117307087383*g23[7])+1.060660171779821*g23[6]+1.060660171779821*g23[5]+1.060660171779821*g23[4]-0.6123724356957944*g23[3]-0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[1] = 1.837117307087383*g23[7]+1.060660171779821*g23[6]-1.060660171779821*g23[5]-1.060660171779821*g23[4]-0.6123724356957944*g23[3]-0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[2] = 1.837117307087383*g23[7]-1.060660171779821*g23[6]+1.060660171779821*g23[5]-1.060660171779821*g23[4]-0.6123724356957944*g23[3]+0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[3] = (-1.837117307087383*g23[7])-1.060660171779821*g23[6]-1.060660171779821*g23[5]+1.060660171779821*g23[4]-0.6123724356957944*g23[3]+0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[4] = 1.837117307087383*g23[7]-1.060660171779821*g23[6]-1.060660171779821*g23[5]+1.060660171779821*g23[4]+0.6123724356957944*g23[3]-0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[5] = (-1.837117307087383*g23[7])-1.060660171779821*g23[6]+1.060660171779821*g23[5]-1.060660171779821*g23[4]+0.6123724356957944*g23[3]-0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[6] = (-1.837117307087383*g23[7])+1.060660171779821*g23[6]-1.060660171779821*g23[5]-1.060660171779821*g23[4]+0.6123724356957944*g23[3]+0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[7] = 1.837117307087383*g23[7]+1.060660171779821*g23[6]+1.060660171779821*g23[5]+1.060660171779821*g23[4]+0.6123724356957944*g23[3]+0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g33_n[0] = (-1.837117307087383*g33[7])+1.060660171779821*g33[6]+1.060660171779821*g33[5]+1.060660171779821*g33[4]-0.6123724356957944*g33[3]-0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[1] = 1.837117307087383*g33[7]+1.060660171779821*g33[6]-1.060660171779821*g33[5]-1.060660171779821*g33[4]-0.6123724356957944*g33[3]-0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[2] = 1.837117307087383*g33[7]-1.060660171779821*g33[6]+1.060660171779821*g33[5]-1.060660171779821*g33[4]-0.6123724356957944*g33[3]+0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[3] = (-1.837117307087383*g33[7])-1.060660171779821*g33[6]-1.060660171779821*g33[5]+1.060660171779821*g33[4]-0.6123724356957944*g33[3]+0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[4] = 1.837117307087383*g33[7]-1.060660171779821*g33[6]-1.060660171779821*g33[5]+1.060660171779821*g33[4]+0.6123724356957944*g33[3]-0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[5] = (-1.837117307087383*g33[7])-1.060660171779821*g33[6]+1.060660171779821*g33[5]-1.060660171779821*g33[4]+0.6123724356957944*g33[3]-0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[6] = (-1.837117307087383*g33[7])+1.060660171779821*g33[6]-1.060660171779821*g33[5]-1.060660171779821*g33[4]+0.6123724356957944*g33[3]+0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[7] = 1.837117307087383*g33[7]+1.060660171779821*g33[6]+1.060660171779821*g33[5]+1.060660171779821*g33[4]+0.6123724356957944*g33[3]+0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
// Calculate Jsq at nodes 
  Jsq_n[0] = g11_n[0]*(g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0])-1.0*g12_n[0]*(g21_n[0]*g33_n[0]-1.0*g23_n[0]*g31_n[0])+g13_n[0]*(g21_n[0]*g32_n[0]-1.0*g22_n[0]*g31_n[0]); 
  Jsq_n[1] = g11_n[1]*(g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1])-1.0*g12_n[1]*(g21_n[1]*g33_n[1]-1.0*g23_n[1]*g31_n[1])+g13_n[1]*(g21_n[1]*g32_n[1]-1.0*g22_n[1]*g31_n[1]); 
  Jsq_n[2] = g11_n[2]*(g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2])-1.0*g12_n[2]*(g21_n[2]*g33_n[2]-1.0*g23_n[2]*g31_n[2])+g13_n[2]*(g21_n[2]*g32_n[2]-1.0*g22_n[2]*g31_n[2]); 
  Jsq_n[3] = g11_n[3]*(g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3])-1.0*g12_n[3]*(g21_n[3]*g33_n[3]-1.0*g23_n[3]*g31_n[3])+g13_n[3]*(g21_n[3]*g32_n[3]-1.0*g22_n[3]*g31_n[3]); 
  Jsq_n[4] = g11_n[4]*(g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4])-1.0*g12_n[4]*(g21_n[4]*g33_n[4]-1.0*g23_n[4]*g31_n[4])+g13_n[4]*(g21_n[4]*g32_n[4]-1.0*g22_n[4]*g31_n[4]); 
  Jsq_n[5] = g11_n[5]*(g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5])-1.0*g12_n[5]*(g21_n[5]*g33_n[5]-1.0*g23_n[5]*g31_n[5])+g13_n[5]*(g21_n[5]*g32_n[5]-1.0*g22_n[5]*g31_n[5]); 
  Jsq_n[6] = g11_n[6]*(g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6])-1.0*g12_n[6]*(g21_n[6]*g33_n[6]-1.0*g23_n[6]*g31_n[6])+g13_n[6]*(g21_n[6]*g32_n[6]-1.0*g22_n[6]*g31_n[6]); 
  Jsq_n[7] = g11_n[7]*(g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7])-1.0*g12_n[7]*(g21_n[7]*g33_n[7]-1.0*g23_n[7]*g31_n[7])+g13_n[7]*(g21_n[7]*g32_n[7]-1.0*g22_n[7]*g31_n[7]); 
// Jsq at nodes cannot be less than 0 
for (int k=0; k<8; k++){ Jsq_n[k] =fmax(Jsq_n[k],0); } 
// Take the square root 
J_n[0] = sqrt(Jsq_n[0]); 
J_n[1] = sqrt(Jsq_n[1]); 
J_n[2] = sqrt(Jsq_n[2]); 
J_n[3] = sqrt(Jsq_n[3]); 
J_n[4] = sqrt(Jsq_n[4]); 
J_n[5] = sqrt(Jsq_n[5]); 
J_n[6] = sqrt(Jsq_n[6]); 
J_n[7] = sqrt(Jsq_n[7]); 
// Convert nodal to modal for J 
  J[0] = 0.353553390593274*J_n[7]+0.3535533905932739*J_n[6]+0.3535533905932739*J_n[5]+0.3535533905932739*J_n[4]+0.3535533905932737*J_n[3]+0.3535533905932737*J_n[2]+0.3535533905932737*J_n[1]+0.3535533905932737*J_n[0]; 
  J[1] = 0.2041241452319316*J_n[7]-0.2041241452319316*J_n[6]+0.2041241452319316*J_n[5]-0.2041241452319316*J_n[4]+0.2041241452319315*J_n[3]-0.2041241452319315*J_n[2]+0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[2] = 0.2041241452319316*J_n[7]+0.2041241452319316*J_n[6]-0.2041241452319316*J_n[5]-0.2041241452319316*J_n[4]+0.2041241452319315*J_n[3]+0.2041241452319315*J_n[2]-0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[3] = 0.2041241452319315*J_n[7]+0.2041241452319316*J_n[6]+0.2041241452319316*J_n[5]+0.2041241452319316*J_n[4]-0.2041241452319315*J_n[3]-0.2041241452319315*J_n[2]-0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[4] = 0.117851130197758*J_n[7]-0.117851130197758*J_n[6]-0.117851130197758*J_n[5]+0.117851130197758*J_n[4]+0.1178511301977579*J_n[3]-0.1178511301977579*J_n[2]-0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[5] = 0.1178511301977579*J_n[7]-0.117851130197758*J_n[6]+0.117851130197758*J_n[5]-0.117851130197758*J_n[4]-0.1178511301977579*J_n[3]+0.1178511301977579*J_n[2]-0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[6] = 0.1178511301977579*J_n[7]+0.117851130197758*J_n[6]-0.1178511301977579*J_n[5]-0.1178511301977579*J_n[4]-0.1178511301977579*J_n[3]-0.1178511301977579*J_n[2]+0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[7] = 0.0680413817439772*J_n[7]-0.06804138174397721*J_n[6]-0.06804138174397721*J_n[5]+0.06804138174397721*J_n[4]-0.06804138174397717*J_n[3]+0.06804138174397717*J_n[2]+0.06804138174397717*J_n[1]-0.06804138174397717*J_n[0]; 
// Calculate g^ij at nodes without factor of 1/det
  gr11_n[0] = g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0]; 
  gr11_n[1] = g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1]; 
  gr11_n[2] = g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2]; 
  gr11_n[3] = g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3]; 
  gr11_n[4] = g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4]; 
  gr11_n[5] = g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5]; 
  gr11_n[6] = g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6]; 
  gr11_n[7] = g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7]; 
  gr12_n[0] = g13_n[0]*g32_n[0]-1.0*g12_n[0]*g33_n[0]; 
  gr12_n[1] = g13_n[1]*g32_n[1]-1.0*g12_n[1]*g33_n[1]; 
  gr12_n[2] = g13_n[2]*g32_n[2]-1.0*g12_n[2]*g33_n[2]; 
  gr12_n[3] = g13_n[3]*g32_n[3]-1.0*g12_n[3]*g33_n[3]; 
  gr12_n[4] = g13_n[4]*g32_n[4]-1.0*g12_n[4]*g33_n[4]; 
  gr12_n[5] = g13_n[5]*g32_n[5]-1.0*g12_n[5]*g33_n[5]; 
  gr12_n[6] = g13_n[6]*g32_n[6]-1.0*g12_n[6]*g33_n[6]; 
  gr12_n[7] = g13_n[7]*g32_n[7]-1.0*g12_n[7]*g33_n[7]; 
  gr13_n[0] = g12_n[0]*g23_n[0]-1.0*g13_n[0]*g22_n[0]; 
  gr13_n[1] = g12_n[1]*g23_n[1]-1.0*g13_n[1]*g22_n[1]; 
  gr13_n[2] = g12_n[2]*g23_n[2]-1.0*g13_n[2]*g22_n[2]; 
  gr13_n[3] = g12_n[3]*g23_n[3]-1.0*g13_n[3]*g22_n[3]; 
  gr13_n[4] = g12_n[4]*g23_n[4]-1.0*g13_n[4]*g22_n[4]; 
  gr13_n[5] = g12_n[5]*g23_n[5]-1.0*g13_n[5]*g22_n[5]; 
  gr13_n[6] = g12_n[6]*g23_n[6]-1.0*g13_n[6]*g22_n[6]; 
  gr13_n[7] = g12_n[7]*g23_n[7]-1.0*g13_n[7]*g22_n[7]; 
  gr22_n[0] = g11_n[0]*g33_n[0]-1.0*g13_n[0]*g31_n[0]; 
  gr22_n[1] = g11_n[1]*g33_n[1]-1.0*g13_n[1]*g31_n[1]; 
  gr22_n[2] = g11_n[2]*g33_n[2]-1.0*g13_n[2]*g31_n[2]; 
  gr22_n[3] = g11_n[3]*g33_n[3]-1.0*g13_n[3]*g31_n[3]; 
  gr22_n[4] = g11_n[4]*g33_n[4]-1.0*g13_n[4]*g31_n[4]; 
  gr22_n[5] = g11_n[5]*g33_n[5]-1.0*g13_n[5]*g31_n[5]; 
  gr22_n[6] = g11_n[6]*g33_n[6]-1.0*g13_n[6]*g31_n[6]; 
  gr22_n[7] = g11_n[7]*g33_n[7]-1.0*g13_n[7]*g31_n[7]; 
  gr23_n[0] = g13_n[0]*g21_n[0]-1.0*g11_n[0]*g23_n[0]; 
  gr23_n[1] = g13_n[1]*g21_n[1]-1.0*g11_n[1]*g23_n[1]; 
  gr23_n[2] = g13_n[2]*g21_n[2]-1.0*g11_n[2]*g23_n[2]; 
  gr23_n[3] = g13_n[3]*g21_n[3]-1.0*g11_n[3]*g23_n[3]; 
  gr23_n[4] = g13_n[4]*g21_n[4]-1.0*g11_n[4]*g23_n[4]; 
  gr23_n[5] = g13_n[5]*g21_n[5]-1.0*g11_n[5]*g23_n[5]; 
  gr23_n[6] = g13_n[6]*g21_n[6]-1.0*g11_n[6]*g23_n[6]; 
  gr23_n[7] = g13_n[7]*g21_n[7]-1.0*g11_n[7]*g23_n[7]; 
  gr33_n[0] = g11_n[0]*g22_n[0]-1.0*g12_n[0]*g21_n[0]; 
  gr33_n[1] = g11_n[1]*g22_n[1]-1.0*g12_n[1]*g21_n[1]; 
  gr33_n[2] = g11_n[2]*g22_n[2]-1.0*g12_n[2]*g21_n[2]; 
  gr33_n[3] = g11_n[3]*g22_n[3]-1.0*g12_n[3]*g21_n[3]; 
  gr33_n[4] = g11_n[4]*g22_n[4]-1.0*g12_n[4]*g21_n[4]; 
  gr33_n[5] = g11_n[5]*g22_n[5]-1.0*g12_n[5]*g21_n[5]; 
  gr33_n[6] = g11_n[6]*g22_n[6]-1.0*g12_n[6]*g21_n[6]; 
  gr33_n[7] = g11_n[7]*g22_n[7]-1.0*g12_n[7]*g21_n[7]; 
// multiply by 1/det
gr11_n[0] = gr11_n[0]/Jsq_n[0]; 
gr11_n[1] = gr11_n[1]/Jsq_n[1]; 
gr11_n[2] = gr11_n[2]/Jsq_n[2]; 
gr11_n[3] = gr11_n[3]/Jsq_n[3]; 
gr11_n[4] = gr11_n[4]/Jsq_n[4]; 
gr11_n[5] = gr11_n[5]/Jsq_n[5]; 
gr11_n[6] = gr11_n[6]/Jsq_n[6]; 
gr11_n[7] = gr11_n[7]/Jsq_n[7]; 
gr12_n[0] = gr12_n[0]/Jsq_n[0]; 
gr12_n[1] = gr12_n[1]/Jsq_n[1]; 
gr12_n[2] = gr12_n[2]/Jsq_n[2]; 
gr12_n[3] = gr12_n[3]/Jsq_n[3]; 
gr12_n[4] = gr12_n[4]/Jsq_n[4]; 
gr12_n[5] = gr12_n[5]/Jsq_n[5]; 
gr12_n[6] = gr12_n[6]/Jsq_n[6]; 
gr12_n[7] = gr12_n[7]/Jsq_n[7]; 
gr13_n[0] = gr13_n[0]/Jsq_n[0]; 
gr13_n[1] = gr13_n[1]/Jsq_n[1]; 
gr13_n[2] = gr13_n[2]/Jsq_n[2]; 
gr13_n[3] = gr13_n[3]/Jsq_n[3]; 
gr13_n[4] = gr13_n[4]/Jsq_n[4]; 
gr13_n[5] = gr13_n[5]/Jsq_n[5]; 
gr13_n[6] = gr13_n[6]/Jsq_n[6]; 
gr13_n[7] = gr13_n[7]/Jsq_n[7]; 
gr22_n[0] = gr22_n[0]/Jsq_n[0]; 
gr22_n[1] = gr22_n[1]/Jsq_n[1]; 
gr22_n[2] = gr22_n[2]/Jsq_n[2]; 
gr22_n[3] = gr22_n[3]/Jsq_n[3]; 
gr22_n[4] = gr22_n[4]/Jsq_n[4]; 
gr22_n[5] = gr22_n[5]/Jsq_n[5]; 
gr22_n[6] = gr22_n[6]/Jsq_n[6]; 
gr22_n[7] = gr22_n[7]/Jsq_n[7]; 
gr23_n[0] = gr23_n[0]/Jsq_n[0]; 
gr23_n[1] = gr23_n[1]/Jsq_n[1]; 
gr23_n[2] = gr23_n[2]/Jsq_n[2]; 
gr23_n[3] = gr23_n[3]/Jsq_n[3]; 
gr23_n[4] = gr23_n[4]/Jsq_n[4]; 
gr23_n[5] = gr23_n[5]/Jsq_n[5]; 
gr23_n[6] = gr23_n[6]/Jsq_n[6]; 
gr23_n[7] = gr23_n[7]/Jsq_n[7]; 
gr33_n[0] = gr33_n[0]/Jsq_n[0]; 
gr33_n[1] = gr33_n[1]/Jsq_n[1]; 
gr33_n[2] = gr33_n[2]/Jsq_n[2]; 
gr33_n[3] = gr33_n[3]/Jsq_n[3]; 
gr33_n[4] = gr33_n[4]/Jsq_n[4]; 
gr33_n[5] = gr33_n[5]/Jsq_n[5]; 
gr33_n[6] = gr33_n[6]/Jsq_n[6]; 
gr33_n[7] = gr33_n[7]/Jsq_n[7]; 
  gr11[0] = 0.353553390593274*gr11_n[7]+0.3535533905932739*gr11_n[6]+0.3535533905932739*gr11_n[5]+0.3535533905932739*gr11_n[4]+0.3535533905932737*gr11_n[3]+0.3535533905932737*gr11_n[2]+0.3535533905932737*gr11_n[1]+0.3535533905932737*gr11_n[0]; 
  gr11[1] = 0.2041241452319316*gr11_n[7]-0.2041241452319316*gr11_n[6]+0.2041241452319316*gr11_n[5]-0.2041241452319316*gr11_n[4]+0.2041241452319315*gr11_n[3]-0.2041241452319315*gr11_n[2]+0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[2] = 0.2041241452319316*gr11_n[7]+0.2041241452319316*gr11_n[6]-0.2041241452319316*gr11_n[5]-0.2041241452319316*gr11_n[4]+0.2041241452319315*gr11_n[3]+0.2041241452319315*gr11_n[2]-0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[3] = 0.2041241452319315*gr11_n[7]+0.2041241452319316*gr11_n[6]+0.2041241452319316*gr11_n[5]+0.2041241452319316*gr11_n[4]-0.2041241452319315*gr11_n[3]-0.2041241452319315*gr11_n[2]-0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[4] = 0.117851130197758*gr11_n[7]-0.117851130197758*gr11_n[6]-0.117851130197758*gr11_n[5]+0.117851130197758*gr11_n[4]+0.1178511301977579*gr11_n[3]-0.1178511301977579*gr11_n[2]-0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[5] = 0.1178511301977579*gr11_n[7]-0.117851130197758*gr11_n[6]+0.117851130197758*gr11_n[5]-0.117851130197758*gr11_n[4]-0.1178511301977579*gr11_n[3]+0.1178511301977579*gr11_n[2]-0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[6] = 0.1178511301977579*gr11_n[7]+0.117851130197758*gr11_n[6]-0.1178511301977579*gr11_n[5]-0.1178511301977579*gr11_n[4]-0.1178511301977579*gr11_n[3]-0.1178511301977579*gr11_n[2]+0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[7] = 0.0680413817439772*gr11_n[7]-0.06804138174397721*gr11_n[6]-0.06804138174397721*gr11_n[5]+0.06804138174397721*gr11_n[4]-0.06804138174397717*gr11_n[3]+0.06804138174397717*gr11_n[2]+0.06804138174397717*gr11_n[1]-0.06804138174397717*gr11_n[0]; 

  gr12[0] = 0.353553390593274*gr12_n[7]+0.3535533905932739*gr12_n[6]+0.3535533905932739*gr12_n[5]+0.3535533905932739*gr12_n[4]+0.3535533905932737*gr12_n[3]+0.3535533905932737*gr12_n[2]+0.3535533905932737*gr12_n[1]+0.3535533905932737*gr12_n[0]; 
  gr12[1] = 0.2041241452319316*gr12_n[7]-0.2041241452319316*gr12_n[6]+0.2041241452319316*gr12_n[5]-0.2041241452319316*gr12_n[4]+0.2041241452319315*gr12_n[3]-0.2041241452319315*gr12_n[2]+0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[2] = 0.2041241452319316*gr12_n[7]+0.2041241452319316*gr12_n[6]-0.2041241452319316*gr12_n[5]-0.2041241452319316*gr12_n[4]+0.2041241452319315*gr12_n[3]+0.2041241452319315*gr12_n[2]-0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[3] = 0.2041241452319315*gr12_n[7]+0.2041241452319316*gr12_n[6]+0.2041241452319316*gr12_n[5]+0.2041241452319316*gr12_n[4]-0.2041241452319315*gr12_n[3]-0.2041241452319315*gr12_n[2]-0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[4] = 0.117851130197758*gr12_n[7]-0.117851130197758*gr12_n[6]-0.117851130197758*gr12_n[5]+0.117851130197758*gr12_n[4]+0.1178511301977579*gr12_n[3]-0.1178511301977579*gr12_n[2]-0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[5] = 0.1178511301977579*gr12_n[7]-0.117851130197758*gr12_n[6]+0.117851130197758*gr12_n[5]-0.117851130197758*gr12_n[4]-0.1178511301977579*gr12_n[3]+0.1178511301977579*gr12_n[2]-0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[6] = 0.1178511301977579*gr12_n[7]+0.117851130197758*gr12_n[6]-0.1178511301977579*gr12_n[5]-0.1178511301977579*gr12_n[4]-0.1178511301977579*gr12_n[3]-0.1178511301977579*gr12_n[2]+0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[7] = 0.0680413817439772*gr12_n[7]-0.06804138174397721*gr12_n[6]-0.06804138174397721*gr12_n[5]+0.06804138174397721*gr12_n[4]-0.06804138174397717*gr12_n[3]+0.06804138174397717*gr12_n[2]+0.06804138174397717*gr12_n[1]-0.06804138174397717*gr12_n[0]; 

  gr13[0] = 0.353553390593274*gr13_n[7]+0.3535533905932739*gr13_n[6]+0.3535533905932739*gr13_n[5]+0.3535533905932739*gr13_n[4]+0.3535533905932737*gr13_n[3]+0.3535533905932737*gr13_n[2]+0.3535533905932737*gr13_n[1]+0.3535533905932737*gr13_n[0]; 
  gr13[1] = 0.2041241452319316*gr13_n[7]-0.2041241452319316*gr13_n[6]+0.2041241452319316*gr13_n[5]-0.2041241452319316*gr13_n[4]+0.2041241452319315*gr13_n[3]-0.2041241452319315*gr13_n[2]+0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[2] = 0.2041241452319316*gr13_n[7]+0.2041241452319316*gr13_n[6]-0.2041241452319316*gr13_n[5]-0.2041241452319316*gr13_n[4]+0.2041241452319315*gr13_n[3]+0.2041241452319315*gr13_n[2]-0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[3] = 0.2041241452319315*gr13_n[7]+0.2041241452319316*gr13_n[6]+0.2041241452319316*gr13_n[5]+0.2041241452319316*gr13_n[4]-0.2041241452319315*gr13_n[3]-0.2041241452319315*gr13_n[2]-0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[4] = 0.117851130197758*gr13_n[7]-0.117851130197758*gr13_n[6]-0.117851130197758*gr13_n[5]+0.117851130197758*gr13_n[4]+0.1178511301977579*gr13_n[3]-0.1178511301977579*gr13_n[2]-0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[5] = 0.1178511301977579*gr13_n[7]-0.117851130197758*gr13_n[6]+0.117851130197758*gr13_n[5]-0.117851130197758*gr13_n[4]-0.1178511301977579*gr13_n[3]+0.1178511301977579*gr13_n[2]-0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[6] = 0.1178511301977579*gr13_n[7]+0.117851130197758*gr13_n[6]-0.1178511301977579*gr13_n[5]-0.1178511301977579*gr13_n[4]-0.1178511301977579*gr13_n[3]-0.1178511301977579*gr13_n[2]+0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[7] = 0.0680413817439772*gr13_n[7]-0.06804138174397721*gr13_n[6]-0.06804138174397721*gr13_n[5]+0.06804138174397721*gr13_n[4]-0.06804138174397717*gr13_n[3]+0.06804138174397717*gr13_n[2]+0.06804138174397717*gr13_n[1]-0.06804138174397717*gr13_n[0]; 

  gr22[0] = 0.353553390593274*gr22_n[7]+0.3535533905932739*gr22_n[6]+0.3535533905932739*gr22_n[5]+0.3535533905932739*gr22_n[4]+0.3535533905932737*gr22_n[3]+0.3535533905932737*gr22_n[2]+0.3535533905932737*gr22_n[1]+0.3535533905932737*gr22_n[0]; 
  gr22[1] = 0.2041241452319316*gr22_n[7]-0.2041241452319316*gr22_n[6]+0.2041241452319316*gr22_n[5]-0.2041241452319316*gr22_n[4]+0.2041241452319315*gr22_n[3]-0.2041241452319315*gr22_n[2]+0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[2] = 0.2041241452319316*gr22_n[7]+0.2041241452319316*gr22_n[6]-0.2041241452319316*gr22_n[5]-0.2041241452319316*gr22_n[4]+0.2041241452319315*gr22_n[3]+0.2041241452319315*gr22_n[2]-0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[3] = 0.2041241452319315*gr22_n[7]+0.2041241452319316*gr22_n[6]+0.2041241452319316*gr22_n[5]+0.2041241452319316*gr22_n[4]-0.2041241452319315*gr22_n[3]-0.2041241452319315*gr22_n[2]-0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[4] = 0.117851130197758*gr22_n[7]-0.117851130197758*gr22_n[6]-0.117851130197758*gr22_n[5]+0.117851130197758*gr22_n[4]+0.1178511301977579*gr22_n[3]-0.1178511301977579*gr22_n[2]-0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[5] = 0.1178511301977579*gr22_n[7]-0.117851130197758*gr22_n[6]+0.117851130197758*gr22_n[5]-0.117851130197758*gr22_n[4]-0.1178511301977579*gr22_n[3]+0.1178511301977579*gr22_n[2]-0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[6] = 0.1178511301977579*gr22_n[7]+0.117851130197758*gr22_n[6]-0.1178511301977579*gr22_n[5]-0.1178511301977579*gr22_n[4]-0.1178511301977579*gr22_n[3]-0.1178511301977579*gr22_n[2]+0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[7] = 0.0680413817439772*gr22_n[7]-0.06804138174397721*gr22_n[6]-0.06804138174397721*gr22_n[5]+0.06804138174397721*gr22_n[4]-0.06804138174397717*gr22_n[3]+0.06804138174397717*gr22_n[2]+0.06804138174397717*gr22_n[1]-0.06804138174397717*gr22_n[0]; 

  gr23[0] = 0.353553390593274*gr23_n[7]+0.3535533905932739*gr23_n[6]+0.3535533905932739*gr23_n[5]+0.3535533905932739*gr23_n[4]+0.3535533905932737*gr23_n[3]+0.3535533905932737*gr23_n[2]+0.3535533905932737*gr23_n[1]+0.3535533905932737*gr23_n[0]; 
  gr23[1] = 0.2041241452319316*gr23_n[7]-0.2041241452319316*gr23_n[6]+0.2041241452319316*gr23_n[5]-0.2041241452319316*gr23_n[4]+0.2041241452319315*gr23_n[3]-0.2041241452319315*gr23_n[2]+0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[2] = 0.2041241452319316*gr23_n[7]+0.2041241452319316*gr23_n[6]-0.2041241452319316*gr23_n[5]-0.2041241452319316*gr23_n[4]+0.2041241452319315*gr23_n[3]+0.2041241452319315*gr23_n[2]-0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[3] = 0.2041241452319315*gr23_n[7]+0.2041241452319316*gr23_n[6]+0.2041241452319316*gr23_n[5]+0.2041241452319316*gr23_n[4]-0.2041241452319315*gr23_n[3]-0.2041241452319315*gr23_n[2]-0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[4] = 0.117851130197758*gr23_n[7]-0.117851130197758*gr23_n[6]-0.117851130197758*gr23_n[5]+0.117851130197758*gr23_n[4]+0.1178511301977579*gr23_n[3]-0.1178511301977579*gr23_n[2]-0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[5] = 0.1178511301977579*gr23_n[7]-0.117851130197758*gr23_n[6]+0.117851130197758*gr23_n[5]-0.117851130197758*gr23_n[4]-0.1178511301977579*gr23_n[3]+0.1178511301977579*gr23_n[2]-0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[6] = 0.1178511301977579*gr23_n[7]+0.117851130197758*gr23_n[6]-0.1178511301977579*gr23_n[5]-0.1178511301977579*gr23_n[4]-0.1178511301977579*gr23_n[3]-0.1178511301977579*gr23_n[2]+0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[7] = 0.0680413817439772*gr23_n[7]-0.06804138174397721*gr23_n[6]-0.06804138174397721*gr23_n[5]+0.06804138174397721*gr23_n[4]-0.06804138174397717*gr23_n[3]+0.06804138174397717*gr23_n[2]+0.06804138174397717*gr23_n[1]-0.06804138174397717*gr23_n[0]; 

  gr33[0] = 0.353553390593274*gr33_n[7]+0.3535533905932739*gr33_n[6]+0.3535533905932739*gr33_n[5]+0.3535533905932739*gr33_n[4]+0.3535533905932737*gr33_n[3]+0.3535533905932737*gr33_n[2]+0.3535533905932737*gr33_n[1]+0.3535533905932737*gr33_n[0]; 
  gr33[1] = 0.2041241452319316*gr33_n[7]-0.2041241452319316*gr33_n[6]+0.2041241452319316*gr33_n[5]-0.2041241452319316*gr33_n[4]+0.2041241452319315*gr33_n[3]-0.2041241452319315*gr33_n[2]+0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[2] = 0.2041241452319316*gr33_n[7]+0.2041241452319316*gr33_n[6]-0.2041241452319316*gr33_n[5]-0.2041241452319316*gr33_n[4]+0.2041241452319315*gr33_n[3]+0.2041241452319315*gr33_n[2]-0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[3] = 0.2041241452319315*gr33_n[7]+0.2041241452319316*gr33_n[6]+0.2041241452319316*gr33_n[5]+0.2041241452319316*gr33_n[4]-0.2041241452319315*gr33_n[3]-0.2041241452319315*gr33_n[2]-0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[4] = 0.117851130197758*gr33_n[7]-0.117851130197758*gr33_n[6]-0.117851130197758*gr33_n[5]+0.117851130197758*gr33_n[4]+0.1178511301977579*gr33_n[3]-0.1178511301977579*gr33_n[2]-0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[5] = 0.1178511301977579*gr33_n[7]-0.117851130197758*gr33_n[6]+0.117851130197758*gr33_n[5]-0.117851130197758*gr33_n[4]-0.1178511301977579*gr33_n[3]+0.1178511301977579*gr33_n[2]-0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[6] = 0.1178511301977579*gr33_n[7]+0.117851130197758*gr33_n[6]-0.1178511301977579*gr33_n[5]-0.1178511301977579*gr33_n[4]-0.1178511301977579*gr33_n[3]-0.1178511301977579*gr33_n[2]+0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[7] = 0.0680413817439772*gr33_n[7]-0.06804138174397721*gr33_n[6]-0.06804138174397721*gr33_n[5]+0.06804138174397721*gr33_n[4]-0.06804138174397717*gr33_n[3]+0.06804138174397717*gr33_n[2]+0.06804138174397717*gr33_n[1]-0.06804138174397717*gr33_n[0]; 

 
// Convert nodal to modal for g^ij 
}
