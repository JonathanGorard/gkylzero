#include <gkyl_bc_sheath_gyrokinetic_kernels.h> 


GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_lower_1x1v_ser_p2(const double wv, const double dv, const double vlowerSq, const double vupperSq, const double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurf[3] = {0.}; 

  vcutSq = 0.5*(3.16227766016838*phiWall[2]-3.16227766016838*phi[2]-2.449489742783178*phiWall[1]+2.449489742783178*phi[1]+1.414213562373095*phiWall[0]-1.414213562373095*phi[0])*q2Dm; 

  if (vcutSq <= vlowerSq) { // absorb (no reflection) 

  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection 

  fReflSurf[0] = 0.7071067811865475*(2.23606797749979*f[4]-1.732050807568877*f[1]+f[0]); 
  fReflSurf[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[6]-3.0*f[3])+3.0*f[2]); 
  fReflSurf[2] = -0.1414213562373095*(8.660254037844387*f[7]-5.0*f[5]); 

  } else { // partial reflection 

    double xBar, xSqBar;

    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurf[0] = -0.07905694150420944*((8.660254037844387*f[7]-5.0*f[5])*vcut_lR3+((-8.660254037844387*f[6])+6.708203932499369*f[3]-3.872983346207417*f[2])*vcut_lR2+((-8.660254037844387*f[7])+5.0*f[5]-10.0*f[4]+7.745966692414834*f[1]-4.47213595499958*f[0])*vcut_l+8.660254037844387*f[6]-10.0*f[4]-6.708203932499369*f[3]+3.872983346207417*f[2]+7.745966692414834*f[1]-4.47213595499958*f[0]); 
  fReflSurf[1] = -0.01473139127471973*((60.37383539249431*f[7]-34.85685011586674*f[5])*vcut_lR4+((-53.66563145999495*f[6])+41.56921938165305*f[3]-24.0*f[2])*vcut_lR3+((-40.24922359499621*f[7])+23.2379000772445*f[5]-46.475800154489*f[4]+36.0*f[1]-20.78460969082652*f[0])*vcut_lR2-20.1246117974981*f[7]-53.66563145999495*f[6]+11.61895003862225*f[5]+46.475800154489*f[4]+41.56921938165305*f[3]-24.0*f[2]-36.0*f[1]+20.78460969082652*f[0]); 
  fReflSurf[2] = -0.008838834764831839*((155.884572681199*f[7]-90.0*f[5])*vcut_lR5+((-129.9038105676658*f[6])+100.6230589874906*f[3]-58.09475019311126*f[2])*vcut_lR4+((-173.2050807568878*f[7])+100.0*f[5]-100.0*f[4]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+(86.60254037844389*f[6]-67.0820393249937*f[3]+38.72983346207418*f[2])*vcut_lR2+(86.60254037844389*f[7]-50.0*f[5]+100.0*f[4]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l+69.2820323027551*f[7]+43.30127018922195*f[6]-40.0*f[5]-33.54101966249685*f[3]+19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurf[0] = 0.07905694150420944*((8.660254037844387*f[7]-5.0*f[5])*vcut_lR3+((-8.660254037844387*f[6])+6.708203932499369*f[3]-3.872983346207417*f[2])*vcut_lR2+((-8.660254037844387*f[7])+5.0*f[5]-10.0*f[4]+7.745966692414834*f[1]-4.47213595499958*f[0])*vcut_l+8.660254037844387*f[6]+10.0*f[4]-6.708203932499369*f[3]+3.872983346207417*f[2]-7.745966692414834*f[1]+4.47213595499958*f[0]); 
  fReflSurf[1] = 0.01473139127471973*((60.37383539249431*f[7]-34.85685011586674*f[5])*vcut_lR4+((-53.66563145999495*f[6])+41.56921938165305*f[3]-24.0*f[2])*vcut_lR3+((-40.24922359499621*f[7])+23.2379000772445*f[5]-46.475800154489*f[4]+36.0*f[1]-20.78460969082652*f[0])*vcut_lR2-20.1246117974981*f[7]+53.66563145999495*f[6]+11.61895003862225*f[5]+46.475800154489*f[4]-41.56921938165305*f[3]+24.0*f[2]-36.0*f[1]+20.78460969082652*f[0]); 
  fReflSurf[2] = 0.008838834764831839*((155.884572681199*f[7]-90.0*f[5])*vcut_lR5+((-129.9038105676658*f[6])+100.6230589874906*f[3]-58.09475019311126*f[2])*vcut_lR4+((-173.2050807568878*f[7])+100.0*f[5]-100.0*f[4]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+(86.60254037844389*f[6]-67.0820393249937*f[3]+38.72983346207418*f[2])*vcut_lR2+(86.60254037844389*f[7]-50.0*f[5]+100.0*f[4]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l-69.2820323027551*f[7]+43.30127018922195*f[6]+40.0*f[5]-33.54101966249685*f[3]+19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurf[1])/fReflSurf[0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurf[2]+5.0*fReflSurf[0]))/fReflSurf[0];
  if (fReflSurf[0]<0.) {
  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  }

  }

  fRefl[0] = 1.414213562373095*fReflSurf[0]; 
  fRefl[1] = 0.0; 
  fRefl[2] = 1.414213562373095*fReflSurf[1]; 
  fRefl[3] = 0.0; 
  fRefl[4] = 0.0; 
  fRefl[5] = 1.414213562373095*fReflSurf[2]; 
  fRefl[6] = 0.0; 
  fRefl[7] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_upper_1x1v_ser_p2(const double wv, const double dv, const double vlowerSq, const double vupperSq, const double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurf[3] = {0.}; 

  vcutSq = 0.5*(3.16227766016838*phiWall[2]-3.16227766016838*phi[2]+2.449489742783178*phiWall[1]-2.449489742783178*phi[1]+1.414213562373095*phiWall[0]-1.414213562373095*phi[0])*q2Dm; 

  if (vcutSq <= vlowerSq) { // absorb (no reflection) 

  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection 

  fReflSurf[0] = 0.7071067811865475*(2.23606797749979*f[4]+1.732050807568877*f[1]+f[0]); 
  fReflSurf[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[6]+3.0*f[3])+3.0*f[2]); 
  fReflSurf[2] = 0.1414213562373095*(8.660254037844387*f[7]+5.0*f[5]); 

  } else { // partial reflection 

    double xBar, xSqBar;

    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurf[0] = 0.07905694150420944*((8.660254037844387*f[7]+5.0*f[5])*vcut_lR3+(8.660254037844387*f[6]+6.708203932499369*f[3]+3.872983346207417*f[2])*vcut_lR2+((-8.660254037844387*f[7])-5.0*f[5]+10.0*f[4]+7.745966692414834*f[1]+4.47213595499958*f[0])*vcut_l-8.660254037844387*f[6]+10.0*f[4]-6.708203932499369*f[3]-3.872983346207417*f[2]+7.745966692414834*f[1]+4.47213595499958*f[0]); 
  fReflSurf[1] = 0.01473139127471973*((60.37383539249431*f[7]+34.85685011586674*f[5])*vcut_lR4+(53.66563145999495*f[6]+41.56921938165305*f[3]+24.0*f[2])*vcut_lR3+((-40.24922359499621*f[7])-23.2379000772445*f[5]+46.475800154489*f[4]+36.0*f[1]+20.78460969082652*f[0])*vcut_lR2-20.1246117974981*f[7]+53.66563145999495*f[6]-11.61895003862225*f[5]-46.475800154489*f[4]+41.56921938165305*f[3]+24.0*f[2]-36.0*f[1]-20.78460969082652*f[0]); 
  fReflSurf[2] = 0.008838834764831839*((155.884572681199*f[7]+90.0*f[5])*vcut_lR5+(129.9038105676658*f[6]+100.6230589874906*f[3]+58.09475019311126*f[2])*vcut_lR4+((-173.2050807568878*f[7])-100.0*f[5]+100.0*f[4]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+((-86.60254037844389*f[6])-67.0820393249937*f[3]-38.72983346207418*f[2])*vcut_lR2+(86.60254037844389*f[7]+50.0*f[5]-100.0*f[4]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l+69.2820323027551*f[7]-43.30127018922195*f[6]+40.0*f[5]-33.54101966249685*f[3]-19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurf[0] = -0.07905694150420944*((8.660254037844387*f[7]+5.0*f[5])*vcut_lR3+(8.660254037844387*f[6]+6.708203932499369*f[3]+3.872983346207417*f[2])*vcut_lR2+((-8.660254037844387*f[7])-5.0*f[5]+10.0*f[4]+7.745966692414834*f[1]+4.47213595499958*f[0])*vcut_l-8.660254037844387*f[6]-10.0*f[4]-6.708203932499369*f[3]-3.872983346207417*f[2]-7.745966692414834*f[1]-4.47213595499958*f[0]); 
  fReflSurf[1] = -0.01473139127471973*((60.37383539249431*f[7]+34.85685011586674*f[5])*vcut_lR4+(53.66563145999495*f[6]+41.56921938165305*f[3]+24.0*f[2])*vcut_lR3+((-40.24922359499621*f[7])-23.2379000772445*f[5]+46.475800154489*f[4]+36.0*f[1]+20.78460969082652*f[0])*vcut_lR2-20.1246117974981*f[7]-53.66563145999495*f[6]-11.61895003862225*f[5]-46.475800154489*f[4]-41.56921938165305*f[3]-24.0*f[2]-36.0*f[1]-20.78460969082652*f[0]); 
  fReflSurf[2] = -0.008838834764831839*((155.884572681199*f[7]+90.0*f[5])*vcut_lR5+(129.9038105676658*f[6]+100.6230589874906*f[3]+58.09475019311126*f[2])*vcut_lR4+((-173.2050807568878*f[7])-100.0*f[5]+100.0*f[4]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+((-86.60254037844389*f[6])-67.0820393249937*f[3]-38.72983346207418*f[2])*vcut_lR2+(86.60254037844389*f[7]+50.0*f[5]-100.0*f[4]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l-69.2820323027551*f[7]-43.30127018922195*f[6]-40.0*f[5]-33.54101966249685*f[3]-19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurf[1])/fReflSurf[0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurf[2]+5.0*fReflSurf[0]))/fReflSurf[0];
  if (fReflSurf[0]<0.) {
  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  }

  }

  fRefl[0] = 1.414213562373095*fReflSurf[0]; 
  fRefl[1] = 0.0; 
  fRefl[2] = 1.414213562373095*fReflSurf[1]; 
  fRefl[3] = 0.0; 
  fRefl[4] = 0.0; 
  fRefl[5] = 1.414213562373095*fReflSurf[2]; 
  fRefl[6] = 0.0; 
  fRefl[7] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_lower_1x2v_ser_p2(const double wv, const double dv, const double vlowerSq, const double vupperSq, const double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurf[8] = {0.}; 

  vcutSq = 0.5*(3.16227766016838*phiWall[2]-3.16227766016838*phi[2]-2.449489742783178*phiWall[1]+2.449489742783178*phi[1]+1.414213562373095*phiWall[0]-1.414213562373095*phi[0])*q2Dm; 

  if (vcutSq <= vlowerSq) { // absorb (no reflection) 

  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  fReflSurf[3] = 0.0; 
  fReflSurf[4] = 0.0; 
  fReflSurf[5] = 0.0; 
  fReflSurf[6] = 0.0; 
  fReflSurf[7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection 

  fReflSurf[0] = 0.7071067811865475*(2.23606797749979*f[7]-1.732050807568877*f[1]+f[0]); 
  fReflSurf[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[11]-3.0*f[4])+3.0*f[2]); 
  fReflSurf[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[13]-3.0*f[5])+3.0*f[3]); 
  fReflSurf[3] = 0.7071067811865475*(2.23606797749979*f[17]-1.732050807568877*f[10]+f[6]); 
  fReflSurf[4] = -0.1414213562373095*(8.660254037844387*f[12]-5.0*f[8]); 
  fReflSurf[5] = -0.1414213562373095*(8.660254037844387*f[15]-5.0*f[9]); 
  fReflSurf[6] = -0.1414213562373095*(8.660254037844387*f[18]-5.0*f[14]); 
  fReflSurf[7] = -0.1414213562373095*(8.660254037844387*f[19]-5.0*f[16]); 

  } else { // partial reflection 

    double xBar, xSqBar;
    double fReflSurfMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[0][0] = 0.01118033988749895*((58.09475019311126*f[18]-33.54101966249684*f[14]-43.30127018922195*f[12]+25.0*f[8])*vcut_lR3+((-30.0*f[19])-58.09475019311126*f[17]+17.32050807568877*f[16]+43.30127018922195*f[11]+45.0*f[10]-25.98076211353316*f[6]-33.54101966249685*f[4]+19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])-34.64101615137755*f[15]+33.54101966249684*f[14]-67.08203932499369*f[13]+43.30127018922195*f[12]+20.0*f[9]-25.0*f[8]+50.0*f[7]+51.96152422706631*f[5]-30.0*f[3]-38.72983346207418*f[1]+22.3606797749979*f[0])*vcut_l+30.0*f[19]+58.09475019311126*f[17]-17.32050807568877*f[16]-34.64101615137755*f[15]-67.08203932499369*f[13]-43.30127018922195*f[11]-45.0*f[10]+20.0*f[9]+50.0*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]+33.54101966249685*f[4]-30.0*f[3]-19.36491673103709*f[2]-38.72983346207418*f[1]+22.3606797749979*f[0]); 
  fReflSurfMu[0][1] = 0.002083333333333333*((405.0*f[18]-233.8268590217985*f[14]-301.8691769624715*f[12]+174.2842505793337*f[8])*vcut_lR4+((-185.903200617956*f[19])-360.0*f[17]+107.3312629199899*f[16]+268.3281572999747*f[11]+278.8548009269339*f[10]-160.9968943799849*f[6]-207.8460969082653*f[4]+120.0*f[2])*vcut_lR3+((-270.0*f[18])-160.9968943799848*f[15]+155.884572681199*f[14]-311.7691453623979*f[13]+201.246117974981*f[12]+92.951600308978*f[9]-116.1895003862225*f[8]+232.379000772445*f[7]+241.4953415699773*f[5]-139.427400463467*f[3]-180.0*f[1]+103.9230484541326*f[0])*vcut_lR2-185.903200617956*f[19]-135.0*f[18]-360.0*f[17]+107.3312629199899*f[16]+160.9968943799848*f[15]+77.94228634059948*f[14]+311.7691453623979*f[13]+100.6230589874905*f[12]+268.3281572999747*f[11]+278.8548009269339*f[10]-92.951600308978*f[9]-58.09475019311126*f[8]-232.379000772445*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]-207.8460969082653*f[4]+139.427400463467*f[3]+120.0*f[2]+180.0*f[1]-103.9230484541326*f[0]); 
  fReflSurfMu[0][2] = 0.00625*((209.1411006952004*f[18]-120.7476707849886*f[14]-155.884572681199*f[12]+90.0*f[8])*vcut_lR5+((-90.0*f[19])-174.2842505793337*f[17]+51.96152422706632*f[16]+129.9038105676658*f[11]+135.0*f[10]-77.94228634059945*f[6]-100.6230589874906*f[4]+58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])-69.2820323027551*f[15]+134.1640786499874*f[14]-134.1640786499874*f[13]+173.2050807568878*f[12]+40.0*f[9]-100.0*f[8]+100.0*f[7]+103.9230484541326*f[5]-60.0*f[3]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+(60.0*f[19]+116.1895003862225*f[17]-34.64101615137755*f[16]-86.60254037844389*f[11]-90.0*f[10]+51.96152422706631*f[6]+67.0820393249937*f[4]-38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]+69.2820323027551*f[15]-67.08203932499369*f[14]+134.1640786499874*f[13]-86.60254037844389*f[12]-40.0*f[9]+50.0*f[8]-100.0*f[7]-103.9230484541326*f[5]+60.0*f[3]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l+30.0*f[19]+92.951600308978*f[18]+58.09475019311126*f[17]-17.32050807568877*f[16]-53.66563145999495*f[14]-69.2820323027551*f[12]-43.30127018922195*f[11]-45.0*f[10]+40.0*f[8]+25.98076211353316*f[6]+33.54101966249685*f[4]-19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[0][0] = -0.01118033988749895*((58.09475019311126*f[18]-33.54101966249684*f[14]-43.30127018922195*f[12]+25.0*f[8])*vcut_lR3+((-30.0*f[19])-58.09475019311126*f[17]+17.32050807568877*f[16]+43.30127018922195*f[11]+45.0*f[10]-25.98076211353316*f[6]-33.54101966249685*f[4]+19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])-34.64101615137755*f[15]+33.54101966249684*f[14]-67.08203932499369*f[13]+43.30127018922195*f[12]+20.0*f[9]-25.0*f[8]+50.0*f[7]+51.96152422706631*f[5]-30.0*f[3]-38.72983346207418*f[1]+22.3606797749979*f[0])*vcut_l+30.0*f[19]+58.09475019311126*f[17]-17.32050807568877*f[16]+34.64101615137755*f[15]+67.08203932499369*f[13]-43.30127018922195*f[11]-45.0*f[10]-20.0*f[9]-50.0*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]+33.54101966249685*f[4]+30.0*f[3]-19.36491673103709*f[2]+38.72983346207418*f[1]-22.3606797749979*f[0]); 
  fReflSurfMu[0][1] = -0.002083333333333333*((405.0*f[18]-233.8268590217985*f[14]-301.8691769624715*f[12]+174.2842505793337*f[8])*vcut_lR4+((-185.903200617956*f[19])-360.0*f[17]+107.3312629199899*f[16]+268.3281572999747*f[11]+278.8548009269339*f[10]-160.9968943799849*f[6]-207.8460969082653*f[4]+120.0*f[2])*vcut_lR3+((-270.0*f[18])-160.9968943799848*f[15]+155.884572681199*f[14]-311.7691453623979*f[13]+201.246117974981*f[12]+92.951600308978*f[9]-116.1895003862225*f[8]+232.379000772445*f[7]+241.4953415699773*f[5]-139.427400463467*f[3]-180.0*f[1]+103.9230484541326*f[0])*vcut_lR2+185.903200617956*f[19]-135.0*f[18]+360.0*f[17]-107.3312629199899*f[16]+160.9968943799848*f[15]+77.94228634059948*f[14]+311.7691453623979*f[13]+100.6230589874905*f[12]-268.3281572999747*f[11]-278.8548009269339*f[10]-92.951600308978*f[9]-58.09475019311126*f[8]-232.379000772445*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]+207.8460969082653*f[4]+139.427400463467*f[3]-120.0*f[2]+180.0*f[1]-103.9230484541326*f[0]); 
  fReflSurfMu[0][2] = -0.00625*((209.1411006952004*f[18]-120.7476707849886*f[14]-155.884572681199*f[12]+90.0*f[8])*vcut_lR5+((-90.0*f[19])-174.2842505793337*f[17]+51.96152422706632*f[16]+129.9038105676658*f[11]+135.0*f[10]-77.94228634059945*f[6]-100.6230589874906*f[4]+58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])-69.2820323027551*f[15]+134.1640786499874*f[14]-134.1640786499874*f[13]+173.2050807568878*f[12]+40.0*f[9]-100.0*f[8]+100.0*f[7]+103.9230484541326*f[5]-60.0*f[3]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+(60.0*f[19]+116.1895003862225*f[17]-34.64101615137755*f[16]-86.60254037844389*f[11]-90.0*f[10]+51.96152422706631*f[6]+67.0820393249937*f[4]-38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]+69.2820323027551*f[15]-67.08203932499369*f[14]+134.1640786499874*f[13]-86.60254037844389*f[12]-40.0*f[9]+50.0*f[8]-100.0*f[7]-103.9230484541326*f[5]+60.0*f[3]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l+30.0*f[19]-92.951600308978*f[18]+58.09475019311126*f[17]-17.32050807568877*f[16]+53.66563145999495*f[14]+69.2820323027551*f[12]-43.30127018922195*f[11]-45.0*f[10]-40.0*f[8]+25.98076211353316*f[6]+33.54101966249685*f[4]-19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[0][1])/fReflSurfMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[0][2]+5.0*fReflSurfMu[0][0]))/fReflSurfMu[0][0];
  if (fReflSurfMu[0][0]<0.) {
  fReflSurfMu[0][0] = 0.0; 
  fReflSurfMu[0][1] = 0.0; 
  fReflSurfMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[0][0] = 0.0; 
  fReflSurfMu[0][1] = 0.0; 
  fReflSurfMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[1][0] = -0.02795084971874737*((17.32050807568877*f[12]-10.0*f[8])*vcut_lR3+((-15.0*f[19])+8.660254037844387*f[16]-17.32050807568877*f[11]+13.41640786499874*f[4]-7.745966692414834*f[2])*vcut_lR2+((-17.32050807568877*f[15])-17.32050807568877*f[12]+10.0*f[9]+10.0*f[8]-20.0*f[7]+15.49193338482967*f[1]-8.94427190999916*f[0])*vcut_l+15.0*f[19]-8.660254037844387*f[16]-17.32050807568877*f[15]+17.32050807568877*f[11]+10.0*f[9]-20.0*f[7]-13.41640786499874*f[4]+7.745966692414834*f[2]+15.49193338482967*f[1]-8.94427190999916*f[0]); 
  fReflSurfMu[1][1] = -0.01041666666666667*((60.37383539249431*f[12]-34.85685011586674*f[8])*vcut_lR4+((-46.475800154489*f[19])+26.83281572999747*f[16]-53.66563145999495*f[11]+41.56921938165305*f[4]-24.0*f[2])*vcut_lR3+((-40.24922359499621*f[15])-40.24922359499621*f[12]+23.2379000772445*f[9]+23.2379000772445*f[8]-46.475800154489*f[7]+36.0*f[1]-20.78460969082652*f[0])*vcut_lR2-46.475800154489*f[19]+26.83281572999747*f[16]+40.24922359499621*f[15]-20.1246117974981*f[12]-53.66563145999495*f[11]-23.2379000772445*f[9]+11.61895003862225*f[8]+46.475800154489*f[7]+41.56921938165305*f[4]-24.0*f[2]-36.0*f[1]+20.78460969082652*f[0]); 
  fReflSurfMu[1][2] = -0.003125*((311.7691453623979*f[12]-180.0*f[8])*vcut_lR5+((-225.0*f[19])+129.9038105676658*f[16]-259.8076211353317*f[11]+201.2461179749811*f[4]-116.1895003862225*f[2])*vcut_lR4+((-173.2050807568878*f[15])-346.4101615137756*f[12]+100.0*f[9]+200.0*f[8]-200.0*f[7]+154.9193338482967*f[1]-89.4427190999916*f[0])*vcut_lR3+(150.0*f[19]-86.60254037844389*f[16]+173.2050807568878*f[11]-134.1640786499874*f[4]+77.45966692414835*f[2])*vcut_lR2+(173.2050807568878*f[15]+173.2050807568878*f[12]-100.0*f[9]-100.0*f[8]+200.0*f[7]-154.9193338482967*f[1]+89.4427190999916*f[0])*vcut_l+75.0*f[19]-43.30127018922195*f[16]+138.5640646055102*f[12]+86.60254037844389*f[11]-80.0*f[8]-67.0820393249937*f[4]+38.72983346207418*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[1][0] = 0.02795084971874737*((17.32050807568877*f[12]-10.0*f[8])*vcut_lR3+((-15.0*f[19])+8.660254037844387*f[16]-17.32050807568877*f[11]+13.41640786499874*f[4]-7.745966692414834*f[2])*vcut_lR2+((-17.32050807568877*f[15])-17.32050807568877*f[12]+10.0*f[9]+10.0*f[8]-20.0*f[7]+15.49193338482967*f[1]-8.94427190999916*f[0])*vcut_l+15.0*f[19]-8.660254037844387*f[16]+17.32050807568877*f[15]+17.32050807568877*f[11]-10.0*f[9]+20.0*f[7]-13.41640786499874*f[4]+7.745966692414834*f[2]-15.49193338482967*f[1]+8.94427190999916*f[0]); 
  fReflSurfMu[1][1] = 0.01041666666666667*((60.37383539249431*f[12]-34.85685011586674*f[8])*vcut_lR4+((-46.475800154489*f[19])+26.83281572999747*f[16]-53.66563145999495*f[11]+41.56921938165305*f[4]-24.0*f[2])*vcut_lR3+((-40.24922359499621*f[15])-40.24922359499621*f[12]+23.2379000772445*f[9]+23.2379000772445*f[8]-46.475800154489*f[7]+36.0*f[1]-20.78460969082652*f[0])*vcut_lR2+46.475800154489*f[19]-26.83281572999747*f[16]+40.24922359499621*f[15]-20.1246117974981*f[12]+53.66563145999495*f[11]-23.2379000772445*f[9]+11.61895003862225*f[8]+46.475800154489*f[7]-41.56921938165305*f[4]+24.0*f[2]-36.0*f[1]+20.78460969082652*f[0]); 
  fReflSurfMu[1][2] = 0.003125*((311.7691453623979*f[12]-180.0*f[8])*vcut_lR5+((-225.0*f[19])+129.9038105676658*f[16]-259.8076211353317*f[11]+201.2461179749811*f[4]-116.1895003862225*f[2])*vcut_lR4+((-173.2050807568878*f[15])-346.4101615137756*f[12]+100.0*f[9]+200.0*f[8]-200.0*f[7]+154.9193338482967*f[1]-89.4427190999916*f[0])*vcut_lR3+(150.0*f[19]-86.60254037844389*f[16]+173.2050807568878*f[11]-134.1640786499874*f[4]+77.45966692414835*f[2])*vcut_lR2+(173.2050807568878*f[15]+173.2050807568878*f[12]-100.0*f[9]-100.0*f[8]+200.0*f[7]-154.9193338482967*f[1]+89.4427190999916*f[0])*vcut_l+75.0*f[19]-43.30127018922195*f[16]-138.5640646055102*f[12]+86.60254037844389*f[11]+80.0*f[8]-67.0820393249937*f[4]+38.72983346207418*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[1][1])/fReflSurfMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[1][2]+5.0*fReflSurfMu[1][0]))/fReflSurfMu[1][0];
  if (fReflSurfMu[1][0]<0.) {
  fReflSurfMu[1][0] = 0.0; 
  fReflSurfMu[1][1] = 0.0; 
  fReflSurfMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[1][0] = 0.0; 
  fReflSurfMu[1][1] = 0.0; 
  fReflSurfMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[2][0] = -0.01118033988749895*((58.09475019311126*f[18]-33.54101966249684*f[14]+43.30127018922195*f[12]-25.0*f[8])*vcut_lR3+(30.0*f[19]-58.09475019311126*f[17]-17.32050807568877*f[16]-43.30127018922195*f[11]+45.0*f[10]-25.98076211353316*f[6]+33.54101966249685*f[4]-19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])+34.64101615137755*f[15]+33.54101966249684*f[14]-67.08203932499369*f[13]-43.30127018922195*f[12]-20.0*f[9]+25.0*f[8]-50.0*f[7]+51.96152422706631*f[5]-30.0*f[3]+38.72983346207418*f[1]-22.3606797749979*f[0])*vcut_l-30.0*f[19]+58.09475019311126*f[17]+17.32050807568877*f[16]+34.64101615137755*f[15]-67.08203932499369*f[13]+43.30127018922195*f[11]-45.0*f[10]-20.0*f[9]-50.0*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]-33.54101966249685*f[4]-30.0*f[3]+19.36491673103709*f[2]+38.72983346207418*f[1]-22.3606797749979*f[0]); 
  fReflSurfMu[2][1] = -0.002083333333333333*((405.0*f[18]-233.8268590217985*f[14]+301.8691769624715*f[12]-174.2842505793337*f[8])*vcut_lR4+(185.903200617956*f[19]-360.0*f[17]-107.3312629199899*f[16]-268.3281572999747*f[11]+278.8548009269339*f[10]-160.9968943799849*f[6]+207.8460969082653*f[4]-120.0*f[2])*vcut_lR3+((-270.0*f[18])+160.9968943799848*f[15]+155.884572681199*f[14]-311.7691453623979*f[13]-201.246117974981*f[12]-92.951600308978*f[9]+116.1895003862225*f[8]-232.379000772445*f[7]+241.4953415699773*f[5]-139.427400463467*f[3]+180.0*f[1]-103.9230484541326*f[0])*vcut_lR2+185.903200617956*f[19]-135.0*f[18]-360.0*f[17]-107.3312629199899*f[16]-160.9968943799848*f[15]+77.94228634059948*f[14]+311.7691453623979*f[13]-100.6230589874905*f[12]-268.3281572999747*f[11]+278.8548009269339*f[10]+92.951600308978*f[9]+58.09475019311126*f[8]+232.379000772445*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]+207.8460969082653*f[4]+139.427400463467*f[3]-120.0*f[2]-180.0*f[1]+103.9230484541326*f[0]); 
  fReflSurfMu[2][2] = -0.00625*((209.1411006952004*f[18]-120.7476707849886*f[14]+155.884572681199*f[12]-90.0*f[8])*vcut_lR5+(90.0*f[19]-174.2842505793337*f[17]-51.96152422706632*f[16]-129.9038105676658*f[11]+135.0*f[10]-77.94228634059945*f[6]+100.6230589874906*f[4]-58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])+69.2820323027551*f[15]+134.1640786499874*f[14]-134.1640786499874*f[13]-173.2050807568878*f[12]-40.0*f[9]+100.0*f[8]-100.0*f[7]+103.9230484541326*f[5]-60.0*f[3]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+((-60.0*f[19])+116.1895003862225*f[17]+34.64101615137755*f[16]+86.60254037844389*f[11]-90.0*f[10]+51.96152422706631*f[6]-67.0820393249937*f[4]+38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]-69.2820323027551*f[15]-67.08203932499369*f[14]+134.1640786499874*f[13]+86.60254037844389*f[12]+40.0*f[9]-50.0*f[8]+100.0*f[7]-103.9230484541326*f[5]+60.0*f[3]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l-30.0*f[19]+92.951600308978*f[18]+58.09475019311126*f[17]+17.32050807568877*f[16]-53.66563145999495*f[14]+69.2820323027551*f[12]+43.30127018922195*f[11]-45.0*f[10]-40.0*f[8]+25.98076211353316*f[6]-33.54101966249685*f[4]+19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[2][0] = 0.01118033988749895*((58.09475019311126*f[18]-33.54101966249684*f[14]+43.30127018922195*f[12]-25.0*f[8])*vcut_lR3+(30.0*f[19]-58.09475019311126*f[17]-17.32050807568877*f[16]-43.30127018922195*f[11]+45.0*f[10]-25.98076211353316*f[6]+33.54101966249685*f[4]-19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])+34.64101615137755*f[15]+33.54101966249684*f[14]-67.08203932499369*f[13]-43.30127018922195*f[12]-20.0*f[9]+25.0*f[8]-50.0*f[7]+51.96152422706631*f[5]-30.0*f[3]+38.72983346207418*f[1]-22.3606797749979*f[0])*vcut_l-30.0*f[19]+58.09475019311126*f[17]+17.32050807568877*f[16]-34.64101615137755*f[15]+67.08203932499369*f[13]+43.30127018922195*f[11]-45.0*f[10]+20.0*f[9]+50.0*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]-33.54101966249685*f[4]+30.0*f[3]+19.36491673103709*f[2]-38.72983346207418*f[1]+22.3606797749979*f[0]); 
  fReflSurfMu[2][1] = 0.002083333333333333*((405.0*f[18]-233.8268590217985*f[14]+301.8691769624715*f[12]-174.2842505793337*f[8])*vcut_lR4+(185.903200617956*f[19]-360.0*f[17]-107.3312629199899*f[16]-268.3281572999747*f[11]+278.8548009269339*f[10]-160.9968943799849*f[6]+207.8460969082653*f[4]-120.0*f[2])*vcut_lR3+((-270.0*f[18])+160.9968943799848*f[15]+155.884572681199*f[14]-311.7691453623979*f[13]-201.246117974981*f[12]-92.951600308978*f[9]+116.1895003862225*f[8]-232.379000772445*f[7]+241.4953415699773*f[5]-139.427400463467*f[3]+180.0*f[1]-103.9230484541326*f[0])*vcut_lR2-185.903200617956*f[19]-135.0*f[18]+360.0*f[17]+107.3312629199899*f[16]-160.9968943799848*f[15]+77.94228634059948*f[14]+311.7691453623979*f[13]-100.6230589874905*f[12]+268.3281572999747*f[11]-278.8548009269339*f[10]+92.951600308978*f[9]+58.09475019311126*f[8]+232.379000772445*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]-207.8460969082653*f[4]+139.427400463467*f[3]+120.0*f[2]-180.0*f[1]+103.9230484541326*f[0]); 
  fReflSurfMu[2][2] = 0.00625*((209.1411006952004*f[18]-120.7476707849886*f[14]+155.884572681199*f[12]-90.0*f[8])*vcut_lR5+(90.0*f[19]-174.2842505793337*f[17]-51.96152422706632*f[16]-129.9038105676658*f[11]+135.0*f[10]-77.94228634059945*f[6]+100.6230589874906*f[4]-58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])+69.2820323027551*f[15]+134.1640786499874*f[14]-134.1640786499874*f[13]-173.2050807568878*f[12]-40.0*f[9]+100.0*f[8]-100.0*f[7]+103.9230484541326*f[5]-60.0*f[3]+77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+((-60.0*f[19])+116.1895003862225*f[17]+34.64101615137755*f[16]+86.60254037844389*f[11]-90.0*f[10]+51.96152422706631*f[6]-67.0820393249937*f[4]+38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]-69.2820323027551*f[15]-67.08203932499369*f[14]+134.1640786499874*f[13]+86.60254037844389*f[12]+40.0*f[9]-50.0*f[8]+100.0*f[7]-103.9230484541326*f[5]+60.0*f[3]-77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l-30.0*f[19]-92.951600308978*f[18]+58.09475019311126*f[17]+17.32050807568877*f[16]+53.66563145999495*f[14]-69.2820323027551*f[12]+43.30127018922195*f[11]-45.0*f[10]+40.0*f[8]+25.98076211353316*f[6]-33.54101966249685*f[4]+19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[2][1])/fReflSurfMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[2][2]+5.0*fReflSurfMu[2][0]))/fReflSurfMu[2][0];
  if (fReflSurfMu[2][0]<0.) {
  fReflSurfMu[2][0] = 0.0; 
  fReflSurfMu[2][1] = 0.0; 
  fReflSurfMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[2][0] = 0.0; 
  fReflSurfMu[2][1] = 0.0; 
  fReflSurfMu[2][2] = 0.0; 
  }

  fReflSurf[0] = 0.07856742013183861*(5.0*fReflSurfMu[2][0]+8.0*fReflSurfMu[1][0]+5.0*fReflSurfMu[0][0]); 
  fReflSurf[1] = 0.07856742013183861*(5.0*fReflSurfMu[2][1]+8.0*fReflSurfMu[1][1]+5.0*fReflSurfMu[0][1]); 
  fReflSurf[2] = 0.5270462766947298*(fReflSurfMu[2][0]-1.0*fReflSurfMu[0][0]); 
  fReflSurf[3] = 0.5270462766947298*(fReflSurfMu[2][1]-1.0*fReflSurfMu[0][1]); 
  fReflSurf[4] = 0.07856742013183861*(5.0*fReflSurfMu[2][2]+8.0*fReflSurfMu[1][2]+5.0*fReflSurfMu[0][2]); 
  fReflSurf[5] = 0.3513641844631533*(fReflSurfMu[2][0]-2.0*fReflSurfMu[1][0]+fReflSurfMu[0][0]); 
  fReflSurf[6] = 0.5270462766947299*(fReflSurfMu[2][2]-1.0*fReflSurfMu[0][2]); 
  fReflSurf[7] = 0.3513641844631534*(fReflSurfMu[2][1]-2.0*fReflSurfMu[1][1]+fReflSurfMu[0][1]); 

  }

  fRefl[0] = 1.414213562373095*fReflSurf[0]; 
  fRefl[1] = 0.0; 
  fRefl[2] = 1.414213562373095*fReflSurf[1]; 
  fRefl[3] = 1.414213562373095*fReflSurf[2]; 
  fRefl[4] = 0.0; 
  fRefl[5] = 0.0; 
  fRefl[6] = 1.414213562373095*fReflSurf[3]; 
  fRefl[7] = 0.0; 
  fRefl[8] = 1.414213562373095*fReflSurf[4]; 
  fRefl[9] = 1.414213562373095*fReflSurf[5]; 
  fRefl[10] = 0.0; 
  fRefl[11] = 0.0; 
  fRefl[12] = 0.0; 
  fRefl[13] = 0.0; 
  fRefl[14] = 1.414213562373095*fReflSurf[6]; 
  fRefl[15] = 0.0; 
  fRefl[16] = 1.414213562373095*fReflSurf[7]; 
  fRefl[17] = 0.0; 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_upper_1x2v_ser_p2(const double wv, const double dv, const double vlowerSq, const double vupperSq, const double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurf[8] = {0.}; 

  vcutSq = 0.5*(3.16227766016838*phiWall[2]-3.16227766016838*phi[2]+2.449489742783178*phiWall[1]-2.449489742783178*phi[1]+1.414213562373095*phiWall[0]-1.414213562373095*phi[0])*q2Dm; 

  if (vcutSq <= vlowerSq) { // absorb (no reflection) 

  fReflSurf[0] = 0.0; 
  fReflSurf[1] = 0.0; 
  fReflSurf[2] = 0.0; 
  fReflSurf[3] = 0.0; 
  fReflSurf[4] = 0.0; 
  fReflSurf[5] = 0.0; 
  fReflSurf[6] = 0.0; 
  fReflSurf[7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection 

  fReflSurf[0] = 0.7071067811865475*(2.23606797749979*f[7]+1.732050807568877*f[1]+f[0]); 
  fReflSurf[1] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[11]+3.0*f[4])+3.0*f[2]); 
  fReflSurf[2] = 0.2357022603955158*(1.732050807568877*(3.872983346207417*f[13]+3.0*f[5])+3.0*f[3]); 
  fReflSurf[3] = 0.7071067811865475*(2.23606797749979*f[17]+1.732050807568877*f[10]+f[6]); 
  fReflSurf[4] = 0.1414213562373095*(8.660254037844387*f[12]+5.0*f[8]); 
  fReflSurf[5] = 0.1414213562373095*(8.660254037844387*f[15]+5.0*f[9]); 
  fReflSurf[6] = 0.1414213562373095*(8.660254037844387*f[18]+5.0*f[14]); 
  fReflSurf[7] = 0.1414213562373095*(8.660254037844387*f[19]+5.0*f[16]); 

  } else { // partial reflection 

    double xBar, xSqBar;
    double fReflSurfMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[0][0] = -0.01118033988749895*((58.09475019311126*f[18]+33.54101966249684*f[14]-43.30127018922195*f[12]-25.0*f[8])*vcut_lR3+((-30.0*f[19])+58.09475019311126*f[17]-17.32050807568877*f[16]-43.30127018922195*f[11]+45.0*f[10]+25.98076211353316*f[6]-33.54101966249685*f[4]-19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])-34.64101615137755*f[15]-33.54101966249684*f[14]+67.08203932499369*f[13]+43.30127018922195*f[12]-20.0*f[9]+25.0*f[8]-50.0*f[7]+51.96152422706631*f[5]+30.0*f[3]-38.72983346207418*f[1]-22.3606797749979*f[0])*vcut_l+30.0*f[19]-58.09475019311126*f[17]+17.32050807568877*f[16]-34.64101615137755*f[15]+67.08203932499369*f[13]+43.30127018922195*f[11]-45.0*f[10]-20.0*f[9]-50.0*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]+33.54101966249685*f[4]+30.0*f[3]+19.36491673103709*f[2]-38.72983346207418*f[1]-22.3606797749979*f[0]); 
  fReflSurfMu[0][1] = -0.002083333333333333*((405.0*f[18]+233.8268590217985*f[14]-301.8691769624715*f[12]-174.2842505793337*f[8])*vcut_lR4+((-185.903200617956*f[19])+360.0*f[17]-107.3312629199899*f[16]-268.3281572999747*f[11]+278.8548009269339*f[10]+160.9968943799849*f[6]-207.8460969082653*f[4]-120.0*f[2])*vcut_lR3+((-270.0*f[18])-160.9968943799848*f[15]-155.884572681199*f[14]+311.7691453623979*f[13]+201.246117974981*f[12]-92.951600308978*f[9]+116.1895003862225*f[8]-232.379000772445*f[7]+241.4953415699773*f[5]+139.427400463467*f[3]-180.0*f[1]-103.9230484541326*f[0])*vcut_lR2-185.903200617956*f[19]-135.0*f[18]+360.0*f[17]-107.3312629199899*f[16]+160.9968943799848*f[15]-77.94228634059948*f[14]-311.7691453623979*f[13]+100.6230589874905*f[12]-268.3281572999747*f[11]+278.8548009269339*f[10]+92.951600308978*f[9]+58.09475019311126*f[8]+232.379000772445*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]-207.8460969082653*f[4]-139.427400463467*f[3]-120.0*f[2]+180.0*f[1]+103.9230484541326*f[0]); 
  fReflSurfMu[0][2] = -0.00625*((209.1411006952004*f[18]+120.7476707849886*f[14]-155.884572681199*f[12]-90.0*f[8])*vcut_lR5+((-90.0*f[19])+174.2842505793337*f[17]-51.96152422706632*f[16]-129.9038105676658*f[11]+135.0*f[10]+77.94228634059945*f[6]-100.6230589874906*f[4]-58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])-69.2820323027551*f[15]-134.1640786499874*f[14]+134.1640786499874*f[13]+173.2050807568878*f[12]-40.0*f[9]+100.0*f[8]-100.0*f[7]+103.9230484541326*f[5]+60.0*f[3]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+(60.0*f[19]-116.1895003862225*f[17]+34.64101615137755*f[16]+86.60254037844389*f[11]-90.0*f[10]-51.96152422706631*f[6]+67.0820393249937*f[4]+38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]+69.2820323027551*f[15]+67.08203932499369*f[14]-134.1640786499874*f[13]-86.60254037844389*f[12]+40.0*f[9]-50.0*f[8]+100.0*f[7]-103.9230484541326*f[5]-60.0*f[3]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l+30.0*f[19]+92.951600308978*f[18]-58.09475019311126*f[17]+17.32050807568877*f[16]+53.66563145999495*f[14]-69.2820323027551*f[12]+43.30127018922195*f[11]-45.0*f[10]-40.0*f[8]-25.98076211353316*f[6]+33.54101966249685*f[4]+19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[0][0] = 0.01118033988749895*((58.09475019311126*f[18]+33.54101966249684*f[14]-43.30127018922195*f[12]-25.0*f[8])*vcut_lR3+((-30.0*f[19])+58.09475019311126*f[17]-17.32050807568877*f[16]-43.30127018922195*f[11]+45.0*f[10]+25.98076211353316*f[6]-33.54101966249685*f[4]-19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])-34.64101615137755*f[15]-33.54101966249684*f[14]+67.08203932499369*f[13]+43.30127018922195*f[12]-20.0*f[9]+25.0*f[8]-50.0*f[7]+51.96152422706631*f[5]+30.0*f[3]-38.72983346207418*f[1]-22.3606797749979*f[0])*vcut_l+30.0*f[19]-58.09475019311126*f[17]+17.32050807568877*f[16]+34.64101615137755*f[15]-67.08203932499369*f[13]+43.30127018922195*f[11]-45.0*f[10]+20.0*f[9]+50.0*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]+33.54101966249685*f[4]-30.0*f[3]+19.36491673103709*f[2]+38.72983346207418*f[1]+22.3606797749979*f[0]); 
  fReflSurfMu[0][1] = 0.002083333333333333*((405.0*f[18]+233.8268590217985*f[14]-301.8691769624715*f[12]-174.2842505793337*f[8])*vcut_lR4+((-185.903200617956*f[19])+360.0*f[17]-107.3312629199899*f[16]-268.3281572999747*f[11]+278.8548009269339*f[10]+160.9968943799849*f[6]-207.8460969082653*f[4]-120.0*f[2])*vcut_lR3+((-270.0*f[18])-160.9968943799848*f[15]-155.884572681199*f[14]+311.7691453623979*f[13]+201.246117974981*f[12]-92.951600308978*f[9]+116.1895003862225*f[8]-232.379000772445*f[7]+241.4953415699773*f[5]+139.427400463467*f[3]-180.0*f[1]-103.9230484541326*f[0])*vcut_lR2+185.903200617956*f[19]-135.0*f[18]-360.0*f[17]+107.3312629199899*f[16]+160.9968943799848*f[15]-77.94228634059948*f[14]-311.7691453623979*f[13]+100.6230589874905*f[12]+268.3281572999747*f[11]-278.8548009269339*f[10]+92.951600308978*f[9]+58.09475019311126*f[8]+232.379000772445*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]+207.8460969082653*f[4]-139.427400463467*f[3]+120.0*f[2]+180.0*f[1]+103.9230484541326*f[0]); 
  fReflSurfMu[0][2] = 0.00625*((209.1411006952004*f[18]+120.7476707849886*f[14]-155.884572681199*f[12]-90.0*f[8])*vcut_lR5+((-90.0*f[19])+174.2842505793337*f[17]-51.96152422706632*f[16]-129.9038105676658*f[11]+135.0*f[10]+77.94228634059945*f[6]-100.6230589874906*f[4]-58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])-69.2820323027551*f[15]-134.1640786499874*f[14]+134.1640786499874*f[13]+173.2050807568878*f[12]-40.0*f[9]+100.0*f[8]-100.0*f[7]+103.9230484541326*f[5]+60.0*f[3]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_lR3+(60.0*f[19]-116.1895003862225*f[17]+34.64101615137755*f[16]+86.60254037844389*f[11]-90.0*f[10]-51.96152422706631*f[6]+67.0820393249937*f[4]+38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]+69.2820323027551*f[15]+67.08203932499369*f[14]-134.1640786499874*f[13]-86.60254037844389*f[12]+40.0*f[9]-50.0*f[8]+100.0*f[7]-103.9230484541326*f[5]-60.0*f[3]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_l+30.0*f[19]-92.951600308978*f[18]-58.09475019311126*f[17]+17.32050807568877*f[16]-53.66563145999495*f[14]+69.2820323027551*f[12]+43.30127018922195*f[11]-45.0*f[10]+40.0*f[8]-25.98076211353316*f[6]+33.54101966249685*f[4]+19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[0][1])/fReflSurfMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[0][2]+5.0*fReflSurfMu[0][0]))/fReflSurfMu[0][0];
  if (fReflSurfMu[0][0]<0.) {
  fReflSurfMu[0][0] = 0.0; 
  fReflSurfMu[0][1] = 0.0; 
  fReflSurfMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[0][0] = 0.0; 
  fReflSurfMu[0][1] = 0.0; 
  fReflSurfMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[1][0] = 0.02795084971874737*((17.32050807568877*f[12]+10.0*f[8])*vcut_lR3+((-15.0*f[19])-8.660254037844387*f[16]+17.32050807568877*f[11]+13.41640786499874*f[4]+7.745966692414834*f[2])*vcut_lR2+((-17.32050807568877*f[15])-17.32050807568877*f[12]-10.0*f[9]-10.0*f[8]+20.0*f[7]+15.49193338482967*f[1]+8.94427190999916*f[0])*vcut_l+15.0*f[19]+8.660254037844387*f[16]-17.32050807568877*f[15]-17.32050807568877*f[11]-10.0*f[9]+20.0*f[7]-13.41640786499874*f[4]-7.745966692414834*f[2]+15.49193338482967*f[1]+8.94427190999916*f[0]); 
  fReflSurfMu[1][1] = 0.01041666666666667*((60.37383539249431*f[12]+34.85685011586674*f[8])*vcut_lR4+((-46.475800154489*f[19])-26.83281572999747*f[16]+53.66563145999495*f[11]+41.56921938165305*f[4]+24.0*f[2])*vcut_lR3+((-40.24922359499621*f[15])-40.24922359499621*f[12]-23.2379000772445*f[9]-23.2379000772445*f[8]+46.475800154489*f[7]+36.0*f[1]+20.78460969082652*f[0])*vcut_lR2-46.475800154489*f[19]-26.83281572999747*f[16]+40.24922359499621*f[15]-20.1246117974981*f[12]+53.66563145999495*f[11]+23.2379000772445*f[9]-11.61895003862225*f[8]-46.475800154489*f[7]+41.56921938165305*f[4]+24.0*f[2]-36.0*f[1]-20.78460969082652*f[0]); 
  fReflSurfMu[1][2] = 0.003125*((311.7691453623979*f[12]+180.0*f[8])*vcut_lR5+((-225.0*f[19])-129.9038105676658*f[16]+259.8076211353317*f[11]+201.2461179749811*f[4]+116.1895003862225*f[2])*vcut_lR4+((-173.2050807568878*f[15])-346.4101615137756*f[12]-100.0*f[9]-200.0*f[8]+200.0*f[7]+154.9193338482967*f[1]+89.4427190999916*f[0])*vcut_lR3+(150.0*f[19]+86.60254037844389*f[16]-173.2050807568878*f[11]-134.1640786499874*f[4]-77.45966692414835*f[2])*vcut_lR2+(173.2050807568878*f[15]+173.2050807568878*f[12]+100.0*f[9]+100.0*f[8]-200.0*f[7]-154.9193338482967*f[1]-89.4427190999916*f[0])*vcut_l+75.0*f[19]+43.30127018922195*f[16]+138.5640646055102*f[12]-86.60254037844389*f[11]+80.0*f[8]-67.0820393249937*f[4]-38.72983346207418*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[1][0] = -0.02795084971874737*((17.32050807568877*f[12]+10.0*f[8])*vcut_lR3+((-15.0*f[19])-8.660254037844387*f[16]+17.32050807568877*f[11]+13.41640786499874*f[4]+7.745966692414834*f[2])*vcut_lR2+((-17.32050807568877*f[15])-17.32050807568877*f[12]-10.0*f[9]-10.0*f[8]+20.0*f[7]+15.49193338482967*f[1]+8.94427190999916*f[0])*vcut_l+15.0*f[19]+8.660254037844387*f[16]+17.32050807568877*f[15]-17.32050807568877*f[11]+10.0*f[9]-20.0*f[7]-13.41640786499874*f[4]-7.745966692414834*f[2]-15.49193338482967*f[1]-8.94427190999916*f[0]); 
  fReflSurfMu[1][1] = -0.01041666666666667*((60.37383539249431*f[12]+34.85685011586674*f[8])*vcut_lR4+((-46.475800154489*f[19])-26.83281572999747*f[16]+53.66563145999495*f[11]+41.56921938165305*f[4]+24.0*f[2])*vcut_lR3+((-40.24922359499621*f[15])-40.24922359499621*f[12]-23.2379000772445*f[9]-23.2379000772445*f[8]+46.475800154489*f[7]+36.0*f[1]+20.78460969082652*f[0])*vcut_lR2+46.475800154489*f[19]+26.83281572999747*f[16]+40.24922359499621*f[15]-20.1246117974981*f[12]-53.66563145999495*f[11]+23.2379000772445*f[9]-11.61895003862225*f[8]-46.475800154489*f[7]-41.56921938165305*f[4]-24.0*f[2]-36.0*f[1]-20.78460969082652*f[0]); 
  fReflSurfMu[1][2] = -0.003125*((311.7691453623979*f[12]+180.0*f[8])*vcut_lR5+((-225.0*f[19])-129.9038105676658*f[16]+259.8076211353317*f[11]+201.2461179749811*f[4]+116.1895003862225*f[2])*vcut_lR4+((-173.2050807568878*f[15])-346.4101615137756*f[12]-100.0*f[9]-200.0*f[8]+200.0*f[7]+154.9193338482967*f[1]+89.4427190999916*f[0])*vcut_lR3+(150.0*f[19]+86.60254037844389*f[16]-173.2050807568878*f[11]-134.1640786499874*f[4]-77.45966692414835*f[2])*vcut_lR2+(173.2050807568878*f[15]+173.2050807568878*f[12]+100.0*f[9]+100.0*f[8]-200.0*f[7]-154.9193338482967*f[1]-89.4427190999916*f[0])*vcut_l+75.0*f[19]+43.30127018922195*f[16]-138.5640646055102*f[12]-86.60254037844389*f[11]-80.0*f[8]-67.0820393249937*f[4]-38.72983346207418*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[1][1])/fReflSurfMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[1][2]+5.0*fReflSurfMu[1][0]))/fReflSurfMu[1][0];
  if (fReflSurfMu[1][0]<0.) {
  fReflSurfMu[1][0] = 0.0; 
  fReflSurfMu[1][1] = 0.0; 
  fReflSurfMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[1][0] = 0.0; 
  fReflSurfMu[1][1] = 0.0; 
  fReflSurfMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[2][0] = 0.01118033988749895*((58.09475019311126*f[18]+33.54101966249684*f[14]+43.30127018922195*f[12]+25.0*f[8])*vcut_lR3+(30.0*f[19]+58.09475019311126*f[17]+17.32050807568877*f[16]+43.30127018922195*f[11]+45.0*f[10]+25.98076211353316*f[6]+33.54101966249685*f[4]+19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])+34.64101615137755*f[15]-33.54101966249684*f[14]+67.08203932499369*f[13]-43.30127018922195*f[12]+20.0*f[9]-25.0*f[8]+50.0*f[7]+51.96152422706631*f[5]+30.0*f[3]+38.72983346207418*f[1]+22.3606797749979*f[0])*vcut_l-30.0*f[19]-58.09475019311126*f[17]-17.32050807568877*f[16]+34.64101615137755*f[15]+67.08203932499369*f[13]-43.30127018922195*f[11]-45.0*f[10]+20.0*f[9]+50.0*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]-33.54101966249685*f[4]+30.0*f[3]-19.36491673103709*f[2]+38.72983346207418*f[1]+22.3606797749979*f[0]); 
  fReflSurfMu[2][1] = 0.002083333333333333*((405.0*f[18]+233.8268590217985*f[14]+301.8691769624715*f[12]+174.2842505793337*f[8])*vcut_lR4+(185.903200617956*f[19]+360.0*f[17]+107.3312629199899*f[16]+268.3281572999747*f[11]+278.8548009269339*f[10]+160.9968943799849*f[6]+207.8460969082653*f[4]+120.0*f[2])*vcut_lR3+((-270.0*f[18])+160.9968943799848*f[15]-155.884572681199*f[14]+311.7691453623979*f[13]-201.246117974981*f[12]+92.951600308978*f[9]-116.1895003862225*f[8]+232.379000772445*f[7]+241.4953415699773*f[5]+139.427400463467*f[3]+180.0*f[1]+103.9230484541326*f[0])*vcut_lR2+185.903200617956*f[19]-135.0*f[18]+360.0*f[17]+107.3312629199899*f[16]-160.9968943799848*f[15]-77.94228634059948*f[14]-311.7691453623979*f[13]-100.6230589874905*f[12]+268.3281572999747*f[11]+278.8548009269339*f[10]-92.951600308978*f[9]-58.09475019311126*f[8]-232.379000772445*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]+207.8460969082653*f[4]-139.427400463467*f[3]+120.0*f[2]-180.0*f[1]-103.9230484541326*f[0]); 
  fReflSurfMu[2][2] = 0.00625*((209.1411006952004*f[18]+120.7476707849886*f[14]+155.884572681199*f[12]+90.0*f[8])*vcut_lR5+(90.0*f[19]+174.2842505793337*f[17]+51.96152422706632*f[16]+129.9038105676658*f[11]+135.0*f[10]+77.94228634059945*f[6]+100.6230589874906*f[4]+58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])+69.2820323027551*f[15]-134.1640786499874*f[14]+134.1640786499874*f[13]-173.2050807568878*f[12]+40.0*f[9]-100.0*f[8]+100.0*f[7]+103.9230484541326*f[5]+60.0*f[3]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+((-60.0*f[19])-116.1895003862225*f[17]-34.64101615137755*f[16]-86.60254037844389*f[11]-90.0*f[10]-51.96152422706631*f[6]-67.0820393249937*f[4]-38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]-69.2820323027551*f[15]+67.08203932499369*f[14]-134.1640786499874*f[13]+86.60254037844389*f[12]-40.0*f[9]+50.0*f[8]-100.0*f[7]-103.9230484541326*f[5]-60.0*f[3]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l-30.0*f[19]+92.951600308978*f[18]-58.09475019311126*f[17]-17.32050807568877*f[16]+53.66563145999495*f[14]+69.2820323027551*f[12]-43.30127018922195*f[11]-45.0*f[10]+40.0*f[8]-25.98076211353316*f[6]-33.54101966249685*f[4]-19.36491673103709*f[2]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfMu[2][0] = -0.01118033988749895*((58.09475019311126*f[18]+33.54101966249684*f[14]+43.30127018922195*f[12]+25.0*f[8])*vcut_lR3+(30.0*f[19]+58.09475019311126*f[17]+17.32050807568877*f[16]+43.30127018922195*f[11]+45.0*f[10]+25.98076211353316*f[6]+33.54101966249685*f[4]+19.36491673103709*f[2])*vcut_lR2+((-58.09475019311126*f[18])+34.64101615137755*f[15]-33.54101966249684*f[14]+67.08203932499369*f[13]-43.30127018922195*f[12]+20.0*f[9]-25.0*f[8]+50.0*f[7]+51.96152422706631*f[5]+30.0*f[3]+38.72983346207418*f[1]+22.3606797749979*f[0])*vcut_l-30.0*f[19]-58.09475019311126*f[17]-17.32050807568877*f[16]-34.64101615137755*f[15]-67.08203932499369*f[13]-43.30127018922195*f[11]-45.0*f[10]-20.0*f[9]-50.0*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]-33.54101966249685*f[4]-30.0*f[3]-19.36491673103709*f[2]-38.72983346207418*f[1]-22.3606797749979*f[0]); 
  fReflSurfMu[2][1] = -0.002083333333333333*((405.0*f[18]+233.8268590217985*f[14]+301.8691769624715*f[12]+174.2842505793337*f[8])*vcut_lR4+(185.903200617956*f[19]+360.0*f[17]+107.3312629199899*f[16]+268.3281572999747*f[11]+278.8548009269339*f[10]+160.9968943799849*f[6]+207.8460969082653*f[4]+120.0*f[2])*vcut_lR3+((-270.0*f[18])+160.9968943799848*f[15]-155.884572681199*f[14]+311.7691453623979*f[13]-201.246117974981*f[12]+92.951600308978*f[9]-116.1895003862225*f[8]+232.379000772445*f[7]+241.4953415699773*f[5]+139.427400463467*f[3]+180.0*f[1]+103.9230484541326*f[0])*vcut_lR2-185.903200617956*f[19]-135.0*f[18]-360.0*f[17]-107.3312629199899*f[16]-160.9968943799848*f[15]-77.94228634059948*f[14]-311.7691453623979*f[13]-100.6230589874905*f[12]-268.3281572999747*f[11]-278.8548009269339*f[10]-92.951600308978*f[9]-58.09475019311126*f[8]-232.379000772445*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]-207.8460969082653*f[4]-139.427400463467*f[3]-120.0*f[2]-180.0*f[1]-103.9230484541326*f[0]); 
  fReflSurfMu[2][2] = -0.00625*((209.1411006952004*f[18]+120.7476707849886*f[14]+155.884572681199*f[12]+90.0*f[8])*vcut_lR5+(90.0*f[19]+174.2842505793337*f[17]+51.96152422706632*f[16]+129.9038105676658*f[11]+135.0*f[10]+77.94228634059945*f[6]+100.6230589874906*f[4]+58.09475019311126*f[2])*vcut_lR4+((-232.379000772445*f[18])+69.2820323027551*f[15]-134.1640786499874*f[14]+134.1640786499874*f[13]-173.2050807568878*f[12]+40.0*f[9]-100.0*f[8]+100.0*f[7]+103.9230484541326*f[5]+60.0*f[3]+77.45966692414835*f[1]+44.7213595499958*f[0])*vcut_lR3+((-60.0*f[19])-116.1895003862225*f[17]-34.64101615137755*f[16]-86.60254037844389*f[11]-90.0*f[10]-51.96152422706631*f[6]-67.0820393249937*f[4]-38.72983346207418*f[2])*vcut_lR2+(116.1895003862225*f[18]-69.2820323027551*f[15]+67.08203932499369*f[14]-134.1640786499874*f[13]+86.60254037844389*f[12]-40.0*f[9]+50.0*f[8]-100.0*f[7]-103.9230484541326*f[5]-60.0*f[3]-77.45966692414835*f[1]-44.7213595499958*f[0])*vcut_l-30.0*f[19]-92.951600308978*f[18]-58.09475019311126*f[17]-17.32050807568877*f[16]-53.66563145999495*f[14]-69.2820323027551*f[12]-43.30127018922195*f[11]-45.0*f[10]-40.0*f[8]-25.98076211353316*f[6]-33.54101966249685*f[4]-19.36491673103709*f[2]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfMu[2][1])/fReflSurfMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfMu[2][2]+5.0*fReflSurfMu[2][0]))/fReflSurfMu[2][0];
  if (fReflSurfMu[2][0]<0.) {
  fReflSurfMu[2][0] = 0.0; 
  fReflSurfMu[2][1] = 0.0; 
  fReflSurfMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfMu[2][0] = 0.0; 
  fReflSurfMu[2][1] = 0.0; 
  fReflSurfMu[2][2] = 0.0; 
  }

  fReflSurf[0] = 0.07856742013183861*(5.0*fReflSurfMu[2][0]+8.0*fReflSurfMu[1][0]+5.0*fReflSurfMu[0][0]); 
  fReflSurf[1] = 0.07856742013183861*(5.0*fReflSurfMu[2][1]+8.0*fReflSurfMu[1][1]+5.0*fReflSurfMu[0][1]); 
  fReflSurf[2] = 0.5270462766947298*(fReflSurfMu[2][0]-1.0*fReflSurfMu[0][0]); 
  fReflSurf[3] = 0.5270462766947298*(fReflSurfMu[2][1]-1.0*fReflSurfMu[0][1]); 
  fReflSurf[4] = 0.07856742013183861*(5.0*fReflSurfMu[2][2]+8.0*fReflSurfMu[1][2]+5.0*fReflSurfMu[0][2]); 
  fReflSurf[5] = 0.3513641844631533*(fReflSurfMu[2][0]-2.0*fReflSurfMu[1][0]+fReflSurfMu[0][0]); 
  fReflSurf[6] = 0.5270462766947299*(fReflSurfMu[2][2]-1.0*fReflSurfMu[0][2]); 
  fReflSurf[7] = 0.3513641844631534*(fReflSurfMu[2][1]-2.0*fReflSurfMu[1][1]+fReflSurfMu[0][1]); 

  }

  fRefl[0] = 1.414213562373095*fReflSurf[0]; 
  fRefl[1] = 0.0; 
  fRefl[2] = 1.414213562373095*fReflSurf[1]; 
  fRefl[3] = 1.414213562373095*fReflSurf[2]; 
  fRefl[4] = 0.0; 
  fRefl[5] = 0.0; 
  fRefl[6] = 1.414213562373095*fReflSurf[3]; 
  fRefl[7] = 0.0; 
  fRefl[8] = 1.414213562373095*fReflSurf[4]; 
  fRefl[9] = 1.414213562373095*fReflSurf[5]; 
  fRefl[10] = 0.0; 
  fRefl[11] = 0.0; 
  fRefl[12] = 0.0; 
  fRefl[13] = 0.0; 
  fRefl[14] = 1.414213562373095*fReflSurf[6]; 
  fRefl[15] = 0.0; 
  fRefl[16] = 1.414213562373095*fReflSurf[7]; 
  fRefl[17] = 0.0; 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_lower_2x2v_ser_p2(double wv, double dv, double vlowerSq, double vupperSq, double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurfX[3][8] = {0.}; 
  // node (x)_0 
  vcutSq = -0.1*(15.0*phiWall[7]-15.0*phi[7]+7.745966692414834*phiWall[6]-7.745966692414834*phi[6]-11.18033988749895*phiWall[5]+11.18033988749895*phi[5]-4.47213595499958*phiWall[4]+4.47213595499958*phi[4]-11.61895003862225*phiWall[3]+11.61895003862225*phi[3]+8.660254037844386*phiWall[2]-8.660254037844386*phi[2]+6.708203932499369*phiWall[1]-6.708203932499369*phi[1]-5.0*phiWall[0]+5.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[0][0] = 0.0; 
  fReflSurfX[0][1] = 0.0; 
  fReflSurfX[0][2] = 0.0; 
  fReflSurfX[0][3] = 0.0; 
  fReflSurfX[0][4] = 0.0; 
  fReflSurfX[0][5] = 0.0; 
  fReflSurfX[0][6] = 0.0; 
  fReflSurfX[0][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[0][0] = -0.1*(3.872983346207417*(3.872983346207417*f[20]+2.0*f[19])-2.23606797749979*(5.0*f[12]+2.0*f[11])+1.732050807568877*(5.0*f[2]-6.708203932499369*f[5])+6.708203932499369*f[1]-5.0*f[0]); 
  fReflSurfX[0][1] = -0.03333333333333333*(45.0*f[33]+1.732050807568877*(13.41640786499874*f[32]-3.872983346207417*(5.0*f[22]+2.0*f[21])+3.0*(5.0*f[7]-6.708203932499369*f[15]))+3.0*(6.708203932499369*f[6]-5.0*f[3])); 
  fReflSurfX[0][2] = -0.03333333333333333*(45.0*f[36]+1.732050807568877*(13.41640786499874*f[35]-3.872983346207417*(5.0*f[26]+2.0*f[25])+3.0*(5.0*f[9]-6.708203932499369*f[16]))+3.0*(6.708203932499369*f[8]-5.0*f[4])); 
  fReflSurfX[0][3] = -0.1*(3.872983346207417*(3.872983346207417*f[45]+2.0*f[44])-2.23606797749979*(5.0*f[38]+2.0*f[37])+1.732050807568877*(5.0*f[18]-6.708203932499369*f[31])+6.708203932499369*f[17]-5.0*f[10]); 
  fReflSurfX[0][4] = 0.1*(11.61895003862225*f[34]-3.872983346207417*(2.23606797749979*f[24]+1.732050807568877*f[23])+5.0*f[13]); 
  fReflSurfX[0][5] = 0.1*(11.61895003862225*f[41]-3.872983346207417*(2.23606797749979*f[29]+1.732050807568877*f[28])+5.0*f[14]); 
  fReflSurfX[0][6] = 0.1*(11.61895003862225*f[46]-3.872983346207417*(2.23606797749979*f[40]+1.732050807568877*f[39])+5.0*f[27]); 
  fReflSurfX[0][7] = 0.1*(11.61895003862225*f[47]-3.872983346207417*(2.23606797749979*f[43]+1.732050807568877*f[42])+5.0*f[30]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]-45.0*f[39]-58.09475019311126*f[34]+33.54101966249684*f[27]+43.30127018922195*f[24]+33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])-77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]+58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]-45.0*f[18]-34.85685011586674*f[17]-45.0*f[15]+25.98076211353316*f[10]+33.54101966249685*f[7]+25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]+58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[34]+34.64101615137755*f[29]+26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]-51.96152422706631*f[9]-40.24922359499622*f[8]-51.96152422706631*f[5]+30.0*f[4]+38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]-46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]-90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]+34.64101615137755*f[29]+26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]+67.08203932499369*f[20]+34.64101615137755*f[19]+45.0*f[18]+34.85685011586674*f[17]+69.71370023173348*f[16]+45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]-25.98076211353316*f[10]-51.96152422706631*f[9]-40.24922359499622*f[8]-33.54101966249685*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]+30.0*f[4]+19.36491673103709*f[3]+38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = -2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]-1568.558255214003*f[39]-2025.0*f[34]+1169.134295108993*f[27]+1509.345884812358*f[24]+1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])-2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1800.0*f[38]+720.0*f[37]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]-1394.27400463467*f[18]-1080.0*f[17]-1394.27400463467*f[15]+804.9844718999244*f[10]+1039.230484541326*f[7]+804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]+1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]-1080.0*f[35]+1350.0*f[34]+804.9844718999242*f[29]+623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-1207.476707849887*f[9]-935.3074360871933*f[8]-1207.476707849887*f[5]+697.1370023173349*f[4]+900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1080.0*f[41]+675.0*f[40]+522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]+2091.411006952005*f[36]+1080.0*f[35]+675.0*f[34]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-804.9844718999242*f[29]-623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-503.1152949374526*f[24]-389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]-1558.84572681199*f[20]-804.9844718999242*f[19]-1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+804.9844718999244*f[10]+1207.476707849887*f[9]+935.3074360871933*f[8]+1039.230484541326*f[7]+804.9844718999244*f[6]+1207.476707849887*f[5]-697.1370023173349*f[4]-600.0*f[3]-900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = -8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]-810.0*f[39]-1045.705503476002*f[34]+603.738353924943*f[27]+779.4228634059949*f[24]+603.738353924943*f[23]-450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])-1169.134295108993*f[45]-603.738353924943*f[44]+450.0*f[43]+348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]+871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]-675.0*f[18]-522.8527517380012*f[17]-675.0*f[15]+389.7114317029973*f[10]+503.1152949374528*f[7]+389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]+1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]-464.7580015448901*f[35]+1161.895003862225*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]+779.4228634059949*f[45]+402.4922359499621*f[44]-300.0*f[43]-232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]-580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]+450.0*f[18]+348.5685011586675*f[17]+450.0*f[15]-259.8076211353315*f[10]-335.4101966249685*f[7]-259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]-580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]+464.7580015448901*f[35]-580.9475019311126*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_l+201.246117974981*f[47]+623.5382907247958*f[46]+389.7114317029975*f[45]+201.246117974981*f[44]-150.0*f[43]-116.1895003862225*f[42]-464.7580015448901*f[40]-360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]-464.7580015448901*f[34]-290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]+268.3281572999747*f[27]+346.4101615137756*f[24]+268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]+225.0*f[18]+174.2842505793337*f[17]+225.0*f[15]-200.0*f[13]-129.9038105676658*f[10]-167.7050983124843*f[7]-129.9038105676658*f[6]+96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]-45.0*f[39]-58.09475019311126*f[34]+33.54101966249684*f[27]+43.30127018922195*f[24]+33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])-77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]+58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]-45.0*f[18]-34.85685011586674*f[17]-45.0*f[15]+25.98076211353316*f[10]+33.54101966249685*f[7]+25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]+58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[34]+34.64101615137755*f[29]+26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]-51.96152422706631*f[9]-40.24922359499622*f[8]-51.96152422706631*f[5]+30.0*f[4]+38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]+90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]-34.64101615137755*f[29]-26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]-67.08203932499369*f[20]-34.64101615137755*f[19]+45.0*f[18]+34.85685011586674*f[17]-69.71370023173348*f[16]+45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]-25.98076211353316*f[10]+51.96152422706631*f[9]+40.24922359499622*f[8]-33.54101966249685*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]-30.0*f[4]+19.36491673103709*f[3]-38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = 2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]-1568.558255214003*f[39]-2025.0*f[34]+1169.134295108993*f[27]+1509.345884812358*f[24]+1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])-2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1800.0*f[38]+720.0*f[37]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]-1394.27400463467*f[18]-1080.0*f[17]-1394.27400463467*f[15]+804.9844718999244*f[10]+1039.230484541326*f[7]+804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]+1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]-1080.0*f[35]+1350.0*f[34]+804.9844718999242*f[29]+623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-1207.476707849887*f[9]-935.3074360871933*f[8]-1207.476707849887*f[5]+697.1370023173349*f[4]+900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1080.0*f[41]+675.0*f[40]+522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]+2091.411006952005*f[36]+1080.0*f[35]+675.0*f[34]-1800.0*f[33]-929.5160030897802*f[32]-1870.614872174387*f[31]+536.6563145999495*f[30]-804.9844718999242*f[29]-623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-503.1152949374526*f[24]-389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]-1558.84572681199*f[20]-804.9844718999242*f[19]+1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-804.9844718999244*f[10]+1207.476707849887*f[9]+935.3074360871933*f[8]-1039.230484541326*f[7]-804.9844718999244*f[6]+1207.476707849887*f[5]-697.1370023173349*f[4]+600.0*f[3]-900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = 8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]-810.0*f[39]-1045.705503476002*f[34]+603.738353924943*f[27]+779.4228634059949*f[24]+603.738353924943*f[23]-450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])-1169.134295108993*f[45]-603.738353924943*f[44]+450.0*f[43]+348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]+871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]-675.0*f[18]-522.8527517380012*f[17]-675.0*f[15]+389.7114317029973*f[10]+503.1152949374528*f[7]+389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]+1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]-464.7580015448901*f[35]+1161.895003862225*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]+779.4228634059949*f[45]+402.4922359499621*f[44]-300.0*f[43]-232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]-580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]+450.0*f[18]+348.5685011586675*f[17]+450.0*f[15]-259.8076211353315*f[10]-335.4101966249685*f[7]-259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]-580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]+464.7580015448901*f[35]-580.9475019311126*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_l+201.246117974981*f[47]-623.5382907247958*f[46]+389.7114317029975*f[45]+201.246117974981*f[44]-150.0*f[43]-116.1895003862225*f[42]+464.7580015448901*f[40]+360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]+464.7580015448901*f[34]-290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]-268.3281572999747*f[27]-346.4101615137756*f[24]-268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]+225.0*f[18]+174.2842505793337*f[17]+225.0*f[15]+200.0*f[13]-129.9038105676658*f[10]-167.7050983124843*f[7]-129.9038105676658*f[6]+96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.003952847075210471*((116.1895003862225*f[34]-86.60254037844389*f[24]-67.08203932499369*f[23]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])+75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[22]+34.64101615137755*f[21]+90.0*f[15]-67.0820393249937*f[7]-51.96152422706631*f[6]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]+86.60254037844389*f[29]+67.08203932499369*f[28]+86.60254037844389*f[24]+67.08203932499369*f[23]-134.1640786499874*f[20]-69.2820323027551*f[19]-50.0*f[14]-50.0*f[13]+100.0*f[12]+40.0*f[11]+103.9230484541326*f[5]-77.45966692414835*f[2]-60.0*f[1]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]-58.09475019311126*f[42]-116.1895003862225*f[41]+116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]+86.60254037844389*f[29]+67.08203932499369*f[28]-86.60254037844389*f[22]-34.64101615137755*f[21]-134.1640786499874*f[20]-69.2820323027551*f[19]-90.0*f[15]-50.0*f[14]+100.0*f[12]+40.0*f[11]+67.0820393249937*f[7]+51.96152422706631*f[6]+103.9230484541326*f[5]-38.72983346207418*f[3]-77.45966692414835*f[2]-60.0*f[1]+44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = 0.001473139127471973*((405.0*f[34]-301.8691769624715*f[24]-233.8268590217985*f[23]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])+232.379000772445*f[43]+180.0*f[42]-360.0*f[33]-185.903200617956*f[32]-134.1640786499874*f[30]+268.3281572999747*f[22]+107.3312629199899*f[21]+278.8548009269339*f[15]-207.8460969082653*f[7]-160.9968943799849*f[6]+120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]+201.246117974981*f[29]+155.884572681199*f[28]+201.246117974981*f[24]+155.884572681199*f[23]-311.7691453623979*f[20]-160.9968943799848*f[19]-116.1895003862225*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+241.4953415699773*f[5]-180.0*f[2]-139.427400463467*f[1]+103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[47]+232.379000772445*f[43]+180.0*f[42]+270.0*f[41]-135.0*f[34]-360.0*f[33]-185.903200617956*f[32]-134.1640786499874*f[30]-201.246117974981*f[29]-155.884572681199*f[28]+100.6230589874905*f[24]+77.94228634059948*f[23]+268.3281572999747*f[22]+107.3312629199899*f[21]+311.7691453623979*f[20]+160.9968943799848*f[19]+278.8548009269339*f[15]+116.1895003862225*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]-92.951600308978*f[11]-207.8460969082653*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]+120.0*f[3]+180.0*f[2]+139.427400463467*f[1]-103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((418.2822013904009*f[34]-311.7691453623979*f[24]-241.4953415699772*f[23]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])+225.0*f[43]+174.2842505793337*f[42]-348.5685011586675*f[33]-180.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]+103.9230484541326*f[21]+270.0*f[15]-201.2461179749811*f[7]-155.8845726811989*f[6]+116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]+173.2050807568878*f[29]+134.1640786499874*f[28]+346.4101615137756*f[24]+268.3281572999747*f[23]-268.3281572999747*f[20]-138.5640646055102*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]+80.0*f[11]+207.8460969082653*f[5]-154.9193338482967*f[2]-120.0*f[1]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]-150.0*f[43]-116.1895003862225*f[42]+232.379000772445*f[33]+120.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]-69.2820323027551*f[21]-180.0*f[15]+134.1640786499874*f[7]+103.9230484541326*f[6]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]-173.2050807568878*f[29]-134.1640786499874*f[28]-173.2050807568878*f[24]-134.1640786499874*f[23]+268.3281572999747*f[20]+138.5640646055102*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]-80.0*f[11]-207.8460969082653*f[5]+154.9193338482967*f[2]+120.0*f[1]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]-58.09475019311126*f[42]+185.903200617956*f[34]+116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]-138.5640646055102*f[24]-107.3312629199899*f[23]-86.60254037844389*f[22]-34.64101615137755*f[21]-90.0*f[15]+80.0*f[13]+67.0820393249937*f[7]+51.96152422706631*f[6]-38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.003952847075210471*((116.1895003862225*f[34]-86.60254037844389*f[24]-67.08203932499369*f[23]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])+75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[22]+34.64101615137755*f[21]+90.0*f[15]-67.0820393249937*f[7]-51.96152422706631*f[6]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]+86.60254037844389*f[29]+67.08203932499369*f[28]+86.60254037844389*f[24]+67.08203932499369*f[23]-134.1640786499874*f[20]-69.2820323027551*f[19]-50.0*f[14]-50.0*f[13]+100.0*f[12]+40.0*f[11]+103.9230484541326*f[5]-77.45966692414835*f[2]-60.0*f[1]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[41]+116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[29]-67.08203932499369*f[28]-86.60254037844389*f[22]-34.64101615137755*f[21]+134.1640786499874*f[20]+69.2820323027551*f[19]-90.0*f[15]+50.0*f[14]-100.0*f[12]-40.0*f[11]+67.0820393249937*f[7]+51.96152422706631*f[6]-103.9230484541326*f[5]-38.72983346207418*f[3]+77.45966692414835*f[2]+60.0*f[1]-44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = -0.001473139127471973*((405.0*f[34]-301.8691769624715*f[24]-233.8268590217985*f[23]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])+232.379000772445*f[43]+180.0*f[42]-360.0*f[33]-185.903200617956*f[32]-134.1640786499874*f[30]+268.3281572999747*f[22]+107.3312629199899*f[21]+278.8548009269339*f[15]-207.8460969082653*f[7]-160.9968943799849*f[6]+120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]+201.246117974981*f[29]+155.884572681199*f[28]+201.246117974981*f[24]+155.884572681199*f[23]-311.7691453623979*f[20]-160.9968943799848*f[19]-116.1895003862225*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+241.4953415699773*f[5]-180.0*f[2]-139.427400463467*f[1]+103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[47]-232.379000772445*f[43]-180.0*f[42]+270.0*f[41]-135.0*f[34]+360.0*f[33]+185.903200617956*f[32]+134.1640786499874*f[30]-201.246117974981*f[29]-155.884572681199*f[28]+100.6230589874905*f[24]+77.94228634059948*f[23]-268.3281572999747*f[22]-107.3312629199899*f[21]+311.7691453623979*f[20]+160.9968943799848*f[19]-278.8548009269339*f[15]+116.1895003862225*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+207.8460969082653*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]-120.0*f[3]+180.0*f[2]+139.427400463467*f[1]-103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((418.2822013904009*f[34]-311.7691453623979*f[24]-241.4953415699772*f[23]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])+225.0*f[43]+174.2842505793337*f[42]-348.5685011586675*f[33]-180.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]+103.9230484541326*f[21]+270.0*f[15]-201.2461179749811*f[7]-155.8845726811989*f[6]+116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]+173.2050807568878*f[29]+134.1640786499874*f[28]+346.4101615137756*f[24]+268.3281572999747*f[23]-268.3281572999747*f[20]-138.5640646055102*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]+80.0*f[11]+207.8460969082653*f[5]-154.9193338482967*f[2]-120.0*f[1]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]-150.0*f[43]-116.1895003862225*f[42]+232.379000772445*f[33]+120.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]-69.2820323027551*f[21]-180.0*f[15]+134.1640786499874*f[7]+103.9230484541326*f[6]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]-173.2050807568878*f[29]-134.1640786499874*f[28]-173.2050807568878*f[24]-134.1640786499874*f[23]+268.3281572999747*f[20]+138.5640646055102*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]-80.0*f[11]-207.8460969082653*f[5]+154.9193338482967*f[2]+120.0*f[1]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]-58.09475019311126*f[42]-185.903200617956*f[34]+116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]+138.5640646055102*f[24]+107.3312629199899*f[23]-86.60254037844389*f[22]-34.64101615137755*f[21]-90.0*f[15]-80.0*f[13]+67.0820393249937*f[7]+51.96152422706631*f[6]-38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]-45.0*f[39]+58.09475019311126*f[34]+33.54101966249684*f[27]-43.30127018922195*f[24]-33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]-58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]-45.0*f[18]-34.85685011586674*f[17]+45.0*f[15]+25.98076211353316*f[10]-33.54101966249685*f[7]-25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]+58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[34]-34.64101615137755*f[29]-26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]-51.96152422706631*f[9]-40.24922359499622*f[8]+51.96152422706631*f[5]+30.0*f[4]-38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]-90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]-34.64101615137755*f[29]-26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]-67.08203932499369*f[20]-34.64101615137755*f[19]+45.0*f[18]+34.85685011586674*f[17]+69.71370023173348*f[16]-45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]-25.98076211353316*f[10]-51.96152422706631*f[9]-40.24922359499622*f[8]+33.54101966249685*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]+30.0*f[4]-19.36491673103709*f[3]-38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = 2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]-1568.558255214003*f[39]+2025.0*f[34]+1169.134295108993*f[27]-1509.345884812358*f[24]-1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]-2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1800.0*f[38]+720.0*f[37]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]-1394.27400463467*f[18]-1080.0*f[17]+1394.27400463467*f[15]+804.9844718999244*f[10]-1039.230484541326*f[7]-804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]+1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]-1080.0*f[35]-1350.0*f[34]-804.9844718999242*f[29]-623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-1207.476707849887*f[9]-935.3074360871933*f[8]+1207.476707849887*f[5]+697.1370023173349*f[4]-900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]-1080.0*f[41]+675.0*f[40]+522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]+2091.411006952005*f[36]+1080.0*f[35]-675.0*f[34]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+804.9844718999242*f[29]+623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+503.1152949374526*f[24]+389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]+1558.84572681199*f[20]+804.9844718999242*f[19]-1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+804.9844718999244*f[10]+1207.476707849887*f[9]+935.3074360871933*f[8]-1039.230484541326*f[7]-804.9844718999244*f[6]-1207.476707849887*f[5]-697.1370023173349*f[4]+600.0*f[3]+900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = 8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]-810.0*f[39]+1045.705503476002*f[34]+603.738353924943*f[27]-779.4228634059949*f[24]-603.738353924943*f[23]+450.0*f[13])*vcut_lR5+(603.738353924943*f[47]-1169.134295108993*f[45]-603.738353924943*f[44]-450.0*f[43]-348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]-871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]-675.0*f[18]-522.8527517380012*f[17]+675.0*f[15]+389.7114317029973*f[10]-503.1152949374528*f[7]-389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]+1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]-464.7580015448901*f[35]-1161.895003862225*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])+779.4228634059949*f[45]+402.4922359499621*f[44]+300.0*f[43]+232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]+580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]+450.0*f[18]+348.5685011586675*f[17]-450.0*f[15]-259.8076211353315*f[10]+335.4101966249685*f[7]+259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]-580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]+464.7580015448901*f[35]+580.9475019311126*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_l-201.246117974981*f[47]+623.5382907247958*f[46]+389.7114317029975*f[45]+201.246117974981*f[44]+150.0*f[43]+116.1895003862225*f[42]-464.7580015448901*f[40]-360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]+464.7580015448901*f[34]+290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]+268.3281572999747*f[27]-346.4101615137756*f[24]-268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]+225.0*f[18]+174.2842505793337*f[17]-225.0*f[15]+200.0*f[13]-129.9038105676658*f[10]+167.7050983124843*f[7]+129.9038105676658*f[6]-96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]-45.0*f[39]+58.09475019311126*f[34]+33.54101966249684*f[27]-43.30127018922195*f[24]-33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]-58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]-45.0*f[18]-34.85685011586674*f[17]+45.0*f[15]+25.98076211353316*f[10]-33.54101966249685*f[7]-25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]+58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[34]-34.64101615137755*f[29]-26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]-51.96152422706631*f[9]-40.24922359499622*f[8]+51.96152422706631*f[5]+30.0*f[4]-38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]-46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]+90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]+34.64101615137755*f[29]+26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]+67.08203932499369*f[20]+34.64101615137755*f[19]+45.0*f[18]+34.85685011586674*f[17]-69.71370023173348*f[16]-45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]-25.98076211353316*f[10]+51.96152422706631*f[9]+40.24922359499622*f[8]+33.54101966249685*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]-30.0*f[4]-19.36491673103709*f[3]+38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = -2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]-1568.558255214003*f[39]+2025.0*f[34]+1169.134295108993*f[27]-1509.345884812358*f[24]-1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]-2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1800.0*f[38]+720.0*f[37]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]-1394.27400463467*f[18]-1080.0*f[17]+1394.27400463467*f[15]+804.9844718999244*f[10]-1039.230484541326*f[7]-804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]+1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]-1080.0*f[35]-1350.0*f[34]-804.9844718999242*f[29]-623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-1207.476707849887*f[9]-935.3074360871933*f[8]+1207.476707849887*f[5]+697.1370023173349*f[4]-900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]-1080.0*f[41]+675.0*f[40]+522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]+2091.411006952005*f[36]+1080.0*f[35]-675.0*f[34]+1800.0*f[33]+929.5160030897802*f[32]-1870.614872174387*f[31]-536.6563145999495*f[30]+804.9844718999242*f[29]+623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+503.1152949374526*f[24]+389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]+1558.84572681199*f[20]+804.9844718999242*f[19]+1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-804.9844718999244*f[10]+1207.476707849887*f[9]+935.3074360871933*f[8]+1039.230484541326*f[7]+804.9844718999244*f[6]-1207.476707849887*f[5]-697.1370023173349*f[4]-600.0*f[3]+900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = -8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]-810.0*f[39]+1045.705503476002*f[34]+603.738353924943*f[27]-779.4228634059949*f[24]-603.738353924943*f[23]+450.0*f[13])*vcut_lR5+(603.738353924943*f[47]-1169.134295108993*f[45]-603.738353924943*f[44]-450.0*f[43]-348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]-871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]-675.0*f[18]-522.8527517380012*f[17]+675.0*f[15]+389.7114317029973*f[10]-503.1152949374528*f[7]-389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]+1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]-464.7580015448901*f[35]-1161.895003862225*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])+779.4228634059949*f[45]+402.4922359499621*f[44]+300.0*f[43]+232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]+580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]+450.0*f[18]+348.5685011586675*f[17]-450.0*f[15]-259.8076211353315*f[10]+335.4101966249685*f[7]+259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]-580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]+464.7580015448901*f[35]+580.9475019311126*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_l-201.246117974981*f[47]-623.5382907247958*f[46]+389.7114317029975*f[45]+201.246117974981*f[44]+150.0*f[43]+116.1895003862225*f[42]+464.7580015448901*f[40]+360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]-464.7580015448901*f[34]+290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]-268.3281572999747*f[27]+346.4101615137756*f[24]+268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]+225.0*f[18]+174.2842505793337*f[17]-225.0*f[15]-200.0*f[13]-129.9038105676658*f[10]+167.7050983124843*f[7]+129.9038105676658*f[6]-96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[0][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[0][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[0][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[0][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[0][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[0][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[0][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[0][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  // node (x)_1 
  vcutSq = 0.25*(3.872983346207417*phiWall[6]-3.872983346207417*phi[6]+4.47213595499958*phiWall[5]-4.47213595499958*phi[5]-2.23606797749979*phiWall[4]+2.23606797749979*phi[4]-3.464101615137754*phiWall[2]+3.464101615137754*phi[2]+2.0*phiWall[0]-2.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[1][0] = 0.0; 
  fReflSurfX[1][1] = 0.0; 
  fReflSurfX[1][2] = 0.0; 
  fReflSurfX[1][3] = 0.0; 
  fReflSurfX[1][4] = 0.0; 
  fReflSurfX[1][5] = 0.0; 
  fReflSurfX[1][6] = 0.0; 
  fReflSurfX[1][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[1][0] = 0.25*(3.872983346207417*f[19]+2.23606797749979*(2.0*f[12]-1.0*f[11])+2.0*(f[0]-1.732050807568877*f[2])); 
  fReflSurfX[1][1] = 0.08333333333333333*(1.732050807568877*(6.708203932499369*f[32]+3.872983346207417*(2.0*f[22]-1.0*f[21]))+2.0*(3.0*f[3]-5.196152422706631*f[7])); 
  fReflSurfX[1][2] = 0.08333333333333333*(1.732050807568877*(6.708203932499369*f[35]+3.872983346207417*(2.0*f[26]-1.0*f[25]))+2.0*(3.0*f[4]-5.196152422706631*f[9])); 
  fReflSurfX[1][3] = 0.25*(3.872983346207417*f[44]+2.23606797749979*(2.0*f[38]-1.0*f[37])+2.0*(f[10]-1.732050807568877*f[18])); 
  fReflSurfX[1][4] = -0.1*(8.660254037844387*f[24]-5.0*f[13]); 
  fReflSurfX[1][5] = -0.1*(8.660254037844387*f[29]-5.0*f[14]); 
  fReflSurfX[1][6] = -0.1*(8.660254037844387*f[40]-5.0*f[27]); 
  fReflSurfX[1][7] = -0.1*(8.660254037844387*f[43]-5.0*f[30]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.003952847075210471*((116.1895003862225*f[40]-67.08203932499369*f[27]-86.60254037844389*f[24]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])-60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]+75.0*f[32]+34.64101615137755*f[30]+86.60254037844389*f[22]-43.30127018922195*f[21]+90.0*f[18]-51.96152422706631*f[10]-67.0820393249937*f[7]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]-69.2820323027551*f[29]+67.08203932499369*f[27]-134.1640786499874*f[26]+67.08203932499369*f[25]+86.60254037844389*f[24]+86.60254037844389*f[19]+40.0*f[14]-50.0*f[13]+100.0*f[12]-50.0*f[11]+103.9230484541326*f[9]-60.0*f[4]-77.45966692414835*f[2]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]-116.1895003862225*f[35]-75.0*f[32]-34.64101615137755*f[30]-69.2820323027551*f[29]-134.1640786499874*f[26]+67.08203932499369*f[25]-86.60254037844389*f[22]+43.30127018922195*f[21]+86.60254037844389*f[19]-90.0*f[18]+40.0*f[14]+100.0*f[12]-50.0*f[11]+51.96152422706631*f[10]+103.9230484541326*f[9]+67.0820393249937*f[7]-60.0*f[4]-38.72983346207418*f[3]-77.45966692414835*f[2]+44.7213595499958*f[0]); 
  fReflSurfXMu[0][1] = 0.001473139127471973*((405.0*f[40]-233.8268590217985*f[27]-301.8691769624715*f[24]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])-185.903200617956*f[43]-360.0*f[38]+180.0*f[37]+232.379000772445*f[32]+107.3312629199899*f[30]+268.3281572999747*f[22]-134.1640786499874*f[21]+278.8548009269339*f[18]-160.9968943799849*f[10]-207.8460969082653*f[7]+120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]-160.9968943799848*f[29]+155.884572681199*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]+201.246117974981*f[24]+201.246117974981*f[19]+92.951600308978*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+241.4953415699773*f[9]-139.427400463467*f[4]-180.0*f[2]+103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[44]-185.903200617956*f[43]-135.0*f[40]-360.0*f[38]+180.0*f[37]+270.0*f[35]+232.379000772445*f[32]+107.3312629199899*f[30]+160.9968943799848*f[29]+77.94228634059948*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]+100.6230589874905*f[24]+268.3281572999747*f[22]-134.1640786499874*f[21]-201.246117974981*f[19]+278.8548009269339*f[18]-92.951600308978*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]-160.9968943799849*f[10]-241.4953415699773*f[9]-207.8460969082653*f[7]+139.427400463467*f[4]+120.0*f[3]+180.0*f[2]-103.9230484541326*f[0]); 
  fReflSurfXMu[0][2] = 0.002209708691207959*((418.2822013904009*f[40]-241.4953415699772*f[27]-311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])-180.0*f[43]-348.5685011586675*f[38]+174.2842505793337*f[37]+225.0*f[32]+103.9230484541326*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+270.0*f[18]-155.8845726811989*f[10]-201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]-138.5640646055102*f[29]+268.3281572999747*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]+346.4101615137756*f[24]+173.2050807568878*f[19]+80.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+207.8460969082653*f[9]-120.0*f[4]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]+120.0*f[43]+232.379000772445*f[38]-116.1895003862225*f[37]-150.0*f[32]-69.2820323027551*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-180.0*f[18]+103.9230484541326*f[10]+134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]+138.5640646055102*f[29]-134.1640786499874*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]-173.2050807568878*f[24]-173.2050807568878*f[19]-80.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-207.8460969082653*f[9]+120.0*f[4]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]+185.903200617956*f[40]+116.1895003862225*f[38]-58.09475019311126*f[37]-75.0*f[32]-34.64101615137755*f[30]-107.3312629199899*f[27]-138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]-90.0*f[18]+80.0*f[13]+51.96152422706631*f[10]+67.0820393249937*f[7]-38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.003952847075210471*((116.1895003862225*f[40]-67.08203932499369*f[27]-86.60254037844389*f[24]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])-60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]+75.0*f[32]+34.64101615137755*f[30]+86.60254037844389*f[22]-43.30127018922195*f[21]+90.0*f[18]-51.96152422706631*f[10]-67.0820393249937*f[7]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]-69.2820323027551*f[29]+67.08203932499369*f[27]-134.1640786499874*f[26]+67.08203932499369*f[25]+86.60254037844389*f[24]+86.60254037844389*f[19]+40.0*f[14]-50.0*f[13]+100.0*f[12]-50.0*f[11]+103.9230484541326*f[9]-60.0*f[4]-77.45966692414835*f[2]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]+116.1895003862225*f[35]-75.0*f[32]-34.64101615137755*f[30]+69.2820323027551*f[29]+134.1640786499874*f[26]-67.08203932499369*f[25]-86.60254037844389*f[22]+43.30127018922195*f[21]-86.60254037844389*f[19]-90.0*f[18]-40.0*f[14]-100.0*f[12]+50.0*f[11]+51.96152422706631*f[10]-103.9230484541326*f[9]+67.0820393249937*f[7]+60.0*f[4]-38.72983346207418*f[3]+77.45966692414835*f[2]-44.7213595499958*f[0]); 
  fReflSurfXMu[0][1] = -0.001473139127471973*((405.0*f[40]-233.8268590217985*f[27]-301.8691769624715*f[24]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])-185.903200617956*f[43]-360.0*f[38]+180.0*f[37]+232.379000772445*f[32]+107.3312629199899*f[30]+268.3281572999747*f[22]-134.1640786499874*f[21]+278.8548009269339*f[18]-160.9968943799849*f[10]-207.8460969082653*f[7]+120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]-160.9968943799848*f[29]+155.884572681199*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]+201.246117974981*f[24]+201.246117974981*f[19]+92.951600308978*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+241.4953415699773*f[9]-139.427400463467*f[4]-180.0*f[2]+103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[44]+185.903200617956*f[43]-135.0*f[40]+360.0*f[38]-180.0*f[37]+270.0*f[35]-232.379000772445*f[32]-107.3312629199899*f[30]+160.9968943799848*f[29]+77.94228634059948*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]+100.6230589874905*f[24]-268.3281572999747*f[22]+134.1640786499874*f[21]-201.246117974981*f[19]-278.8548009269339*f[18]-92.951600308978*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+160.9968943799849*f[10]-241.4953415699773*f[9]+207.8460969082653*f[7]+139.427400463467*f[4]-120.0*f[3]+180.0*f[2]-103.9230484541326*f[0]); 
  fReflSurfXMu[0][2] = -0.002209708691207959*((418.2822013904009*f[40]-241.4953415699772*f[27]-311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])-180.0*f[43]-348.5685011586675*f[38]+174.2842505793337*f[37]+225.0*f[32]+103.9230484541326*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+270.0*f[18]-155.8845726811989*f[10]-201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]-138.5640646055102*f[29]+268.3281572999747*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]+346.4101615137756*f[24]+173.2050807568878*f[19]+80.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+207.8460969082653*f[9]-120.0*f[4]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]+120.0*f[43]+232.379000772445*f[38]-116.1895003862225*f[37]-150.0*f[32]-69.2820323027551*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-180.0*f[18]+103.9230484541326*f[10]+134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]+138.5640646055102*f[29]-134.1640786499874*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]-173.2050807568878*f[24]-173.2050807568878*f[19]-80.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-207.8460969082653*f[9]+120.0*f[4]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]-185.903200617956*f[40]+116.1895003862225*f[38]-58.09475019311126*f[37]-75.0*f[32]-34.64101615137755*f[30]+107.3312629199899*f[27]+138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]-90.0*f[18]-80.0*f[13]+51.96152422706631*f[10]+67.0820393249937*f[7]-38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.01976423537605236*((17.32050807568877*f[24]-10.0*f[13])*vcut_lR3+((-15.0*f[43])-15.0*f[32]+8.660254037844387*f[30]-17.32050807568877*f[22]+8.660254037844387*f[21]+13.41640786499874*f[7]-7.745966692414834*f[3])*vcut_lR2+((-17.32050807568877*f[29])-17.32050807568877*f[24]-17.32050807568877*f[19]+10.0*f[14]+10.0*f[13]-20.0*f[12]+10.0*f[11]+15.49193338482967*f[2]-8.94427190999916*f[0])*vcut_l+15.0*f[43]+15.0*f[32]-8.660254037844387*f[30]-17.32050807568877*f[29]+17.32050807568877*f[22]-8.660254037844387*f[21]-17.32050807568877*f[19]+10.0*f[14]-20.0*f[12]+10.0*f[11]-13.41640786499874*f[7]+7.745966692414834*f[3]+15.49193338482967*f[2]-8.94427190999916*f[0]); 
  fReflSurfXMu[1][1] = -0.007365695637359865*((60.37383539249431*f[24]-34.85685011586674*f[13])*vcut_lR4+((-46.475800154489*f[43])-46.475800154489*f[32]+26.83281572999747*f[30]-53.66563145999495*f[22]+26.83281572999747*f[21]+41.56921938165305*f[7]-24.0*f[3])*vcut_lR3+((-40.24922359499621*f[29])-40.24922359499621*f[24]-40.24922359499621*f[19]+23.2379000772445*f[14]+23.2379000772445*f[13]-46.475800154489*f[12]+23.2379000772445*f[11]+36.0*f[2]-20.78460969082652*f[0])*vcut_lR2-46.475800154489*f[43]-46.475800154489*f[32]+26.83281572999747*f[30]+40.24922359499621*f[29]-20.1246117974981*f[24]-53.66563145999495*f[22]+26.83281572999747*f[21]+40.24922359499621*f[19]-23.2379000772445*f[14]+11.61895003862225*f[13]+46.475800154489*f[12]-23.2379000772445*f[11]+41.56921938165305*f[7]-24.0*f[3]-36.0*f[2]+20.78460969082652*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-225.0*f[43])-225.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-173.2050807568878*f[29])-346.4101615137756*f[24]-173.2050807568878*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(150.0*f[43]+150.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(173.2050807568878*f[29]+173.2050807568878*f[24]+173.2050807568878*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+75.0*f[43]+75.0*f[32]-43.30127018922195*f[30]+138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]-80.0*f[13]-67.0820393249937*f[7]+38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.01976423537605236*((17.32050807568877*f[24]-10.0*f[13])*vcut_lR3+((-15.0*f[43])-15.0*f[32]+8.660254037844387*f[30]-17.32050807568877*f[22]+8.660254037844387*f[21]+13.41640786499874*f[7]-7.745966692414834*f[3])*vcut_lR2+((-17.32050807568877*f[29])-17.32050807568877*f[24]-17.32050807568877*f[19]+10.0*f[14]+10.0*f[13]-20.0*f[12]+10.0*f[11]+15.49193338482967*f[2]-8.94427190999916*f[0])*vcut_l+15.0*f[43]+15.0*f[32]-8.660254037844387*f[30]+17.32050807568877*f[29]+17.32050807568877*f[22]-8.660254037844387*f[21]+17.32050807568877*f[19]-10.0*f[14]+20.0*f[12]-10.0*f[11]-13.41640786499874*f[7]+7.745966692414834*f[3]-15.49193338482967*f[2]+8.94427190999916*f[0]); 
  fReflSurfXMu[1][1] = 0.007365695637359865*((60.37383539249431*f[24]-34.85685011586674*f[13])*vcut_lR4+((-46.475800154489*f[43])-46.475800154489*f[32]+26.83281572999747*f[30]-53.66563145999495*f[22]+26.83281572999747*f[21]+41.56921938165305*f[7]-24.0*f[3])*vcut_lR3+((-40.24922359499621*f[29])-40.24922359499621*f[24]-40.24922359499621*f[19]+23.2379000772445*f[14]+23.2379000772445*f[13]-46.475800154489*f[12]+23.2379000772445*f[11]+36.0*f[2]-20.78460969082652*f[0])*vcut_lR2+46.475800154489*f[43]+46.475800154489*f[32]-26.83281572999747*f[30]+40.24922359499621*f[29]-20.1246117974981*f[24]+53.66563145999495*f[22]-26.83281572999747*f[21]+40.24922359499621*f[19]-23.2379000772445*f[14]+11.61895003862225*f[13]+46.475800154489*f[12]-23.2379000772445*f[11]-41.56921938165305*f[7]+24.0*f[3]-36.0*f[2]+20.78460969082652*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-225.0*f[43])-225.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-173.2050807568878*f[29])-346.4101615137756*f[24]-173.2050807568878*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(150.0*f[43]+150.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(173.2050807568878*f[29]+173.2050807568878*f[24]+173.2050807568878*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+75.0*f[43]+75.0*f[32]-43.30127018922195*f[30]-138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]+80.0*f[13]-67.0820393249937*f[7]+38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.003952847075210471*((116.1895003862225*f[40]-67.08203932499369*f[27]+86.60254037844389*f[24]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])+60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]-75.0*f[32]-34.64101615137755*f[30]-86.60254037844389*f[22]+43.30127018922195*f[21]+90.0*f[18]-51.96152422706631*f[10]+67.0820393249937*f[7]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]+69.2820323027551*f[29]+67.08203932499369*f[27]-134.1640786499874*f[26]+67.08203932499369*f[25]-86.60254037844389*f[24]-86.60254037844389*f[19]-40.0*f[14]+50.0*f[13]-100.0*f[12]+50.0*f[11]+103.9230484541326*f[9]-60.0*f[4]+77.45966692414835*f[2]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]-116.1895003862225*f[35]+75.0*f[32]+34.64101615137755*f[30]+69.2820323027551*f[29]-134.1640786499874*f[26]+67.08203932499369*f[25]+86.60254037844389*f[22]-43.30127018922195*f[21]-86.60254037844389*f[19]-90.0*f[18]-40.0*f[14]-100.0*f[12]+50.0*f[11]+51.96152422706631*f[10]+103.9230484541326*f[9]-67.0820393249937*f[7]-60.0*f[4]+38.72983346207418*f[3]+77.45966692414835*f[2]-44.7213595499958*f[0]); 
  fReflSurfXMu[2][1] = -0.001473139127471973*((405.0*f[40]-233.8268590217985*f[27]+301.8691769624715*f[24]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])+185.903200617956*f[43]-360.0*f[38]+180.0*f[37]-232.379000772445*f[32]-107.3312629199899*f[30]-268.3281572999747*f[22]+134.1640786499874*f[21]+278.8548009269339*f[18]-160.9968943799849*f[10]+207.8460969082653*f[7]-120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]+160.9968943799848*f[29]+155.884572681199*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]-201.246117974981*f[24]-201.246117974981*f[19]-92.951600308978*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+241.4953415699773*f[9]-139.427400463467*f[4]+180.0*f[2]-103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[44]+185.903200617956*f[43]-135.0*f[40]-360.0*f[38]+180.0*f[37]+270.0*f[35]-232.379000772445*f[32]-107.3312629199899*f[30]-160.9968943799848*f[29]+77.94228634059948*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]-100.6230589874905*f[24]-268.3281572999747*f[22]+134.1640786499874*f[21]+201.246117974981*f[19]+278.8548009269339*f[18]+92.951600308978*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]-160.9968943799849*f[10]-241.4953415699773*f[9]+207.8460969082653*f[7]+139.427400463467*f[4]-120.0*f[3]-180.0*f[2]+103.9230484541326*f[0]); 
  fReflSurfXMu[2][2] = -0.002209708691207959*((418.2822013904009*f[40]-241.4953415699772*f[27]+311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])+180.0*f[43]-348.5685011586675*f[38]+174.2842505793337*f[37]-225.0*f[32]-103.9230484541326*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+270.0*f[18]-155.8845726811989*f[10]+201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]+138.5640646055102*f[29]+268.3281572999747*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]-346.4101615137756*f[24]-173.2050807568878*f[19]-80.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+207.8460969082653*f[9]-120.0*f[4]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]-120.0*f[43]+232.379000772445*f[38]-116.1895003862225*f[37]+150.0*f[32]+69.2820323027551*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-180.0*f[18]+103.9230484541326*f[10]-134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]-138.5640646055102*f[29]-134.1640786499874*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]+173.2050807568878*f[24]+173.2050807568878*f[19]+80.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-207.8460969082653*f[9]+120.0*f[4]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]+185.903200617956*f[40]+116.1895003862225*f[38]-58.09475019311126*f[37]+75.0*f[32]+34.64101615137755*f[30]-107.3312629199899*f[27]+138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]-90.0*f[18]-80.0*f[13]+51.96152422706631*f[10]-67.0820393249937*f[7]+38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.003952847075210471*((116.1895003862225*f[40]-67.08203932499369*f[27]+86.60254037844389*f[24]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])+60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]-75.0*f[32]-34.64101615137755*f[30]-86.60254037844389*f[22]+43.30127018922195*f[21]+90.0*f[18]-51.96152422706631*f[10]+67.0820393249937*f[7]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]+69.2820323027551*f[29]+67.08203932499369*f[27]-134.1640786499874*f[26]+67.08203932499369*f[25]-86.60254037844389*f[24]-86.60254037844389*f[19]-40.0*f[14]+50.0*f[13]-100.0*f[12]+50.0*f[11]+103.9230484541326*f[9]-60.0*f[4]+77.45966692414835*f[2]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]+116.1895003862225*f[35]+75.0*f[32]+34.64101615137755*f[30]-69.2820323027551*f[29]+134.1640786499874*f[26]-67.08203932499369*f[25]+86.60254037844389*f[22]-43.30127018922195*f[21]+86.60254037844389*f[19]-90.0*f[18]+40.0*f[14]+100.0*f[12]-50.0*f[11]+51.96152422706631*f[10]-103.9230484541326*f[9]-67.0820393249937*f[7]+60.0*f[4]+38.72983346207418*f[3]-77.45966692414835*f[2]+44.7213595499958*f[0]); 
  fReflSurfXMu[2][1] = 0.001473139127471973*((405.0*f[40]-233.8268590217985*f[27]+301.8691769624715*f[24]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])+185.903200617956*f[43]-360.0*f[38]+180.0*f[37]-232.379000772445*f[32]-107.3312629199899*f[30]-268.3281572999747*f[22]+134.1640786499874*f[21]+278.8548009269339*f[18]-160.9968943799849*f[10]+207.8460969082653*f[7]-120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]+160.9968943799848*f[29]+155.884572681199*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]-201.246117974981*f[24]-201.246117974981*f[19]-92.951600308978*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+241.4953415699773*f[9]-139.427400463467*f[4]+180.0*f[2]-103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[44]-185.903200617956*f[43]-135.0*f[40]+360.0*f[38]-180.0*f[37]+270.0*f[35]+232.379000772445*f[32]+107.3312629199899*f[30]-160.9968943799848*f[29]+77.94228634059948*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]-100.6230589874905*f[24]+268.3281572999747*f[22]-134.1640786499874*f[21]+201.246117974981*f[19]-278.8548009269339*f[18]+92.951600308978*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+160.9968943799849*f[10]-241.4953415699773*f[9]-207.8460969082653*f[7]+139.427400463467*f[4]+120.0*f[3]-180.0*f[2]+103.9230484541326*f[0]); 
  fReflSurfXMu[2][2] = 0.002209708691207959*((418.2822013904009*f[40]-241.4953415699772*f[27]+311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])+180.0*f[43]-348.5685011586675*f[38]+174.2842505793337*f[37]-225.0*f[32]-103.9230484541326*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+270.0*f[18]-155.8845726811989*f[10]+201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]+138.5640646055102*f[29]+268.3281572999747*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]-346.4101615137756*f[24]-173.2050807568878*f[19]-80.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+207.8460969082653*f[9]-120.0*f[4]+154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]-120.0*f[43]+232.379000772445*f[38]-116.1895003862225*f[37]+150.0*f[32]+69.2820323027551*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-180.0*f[18]+103.9230484541326*f[10]-134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]-138.5640646055102*f[29]-134.1640786499874*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]+173.2050807568878*f[24]+173.2050807568878*f[19]+80.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-207.8460969082653*f[9]+120.0*f[4]-154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]-185.903200617956*f[40]+116.1895003862225*f[38]-58.09475019311126*f[37]+75.0*f[32]+34.64101615137755*f[30]+107.3312629199899*f[27]-138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]-90.0*f[18]+80.0*f[13]+51.96152422706631*f[10]-67.0820393249937*f[7]+38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[1][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[1][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[1][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[1][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[1][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[1][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[1][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[1][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  // node (x)_2 
  vcutSq = 0.1*(15.0*phiWall[7]-15.0*phi[7]-7.745966692414834*phiWall[6]+7.745966692414834*phi[6]+11.18033988749895*phiWall[5]-11.18033988749895*phi[5]+4.47213595499958*phiWall[4]-4.47213595499958*phi[4]-11.61895003862225*phiWall[3]+11.61895003862225*phi[3]-8.660254037844386*phiWall[2]+8.660254037844386*phi[2]+6.708203932499369*phiWall[1]-6.708203932499369*phi[1]+5.0*phiWall[0]-5.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[2][0] = 0.0; 
  fReflSurfX[2][1] = 0.0; 
  fReflSurfX[2][2] = 0.0; 
  fReflSurfX[2][3] = 0.0; 
  fReflSurfX[2][4] = 0.0; 
  fReflSurfX[2][5] = 0.0; 
  fReflSurfX[2][6] = 0.0; 
  fReflSurfX[2][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[2][0] = 0.1*(3.872983346207417*(3.872983346207417*f[20]-2.0*f[19])+2.23606797749979*(5.0*f[12]+2.0*f[11])-1.732050807568877*(6.708203932499369*f[5]+5.0*f[2])+6.708203932499369*f[1]+5.0*f[0]); 
  fReflSurfX[2][1] = 0.03333333333333333*(45.0*f[33]+1.732050807568877*((-13.41640786499874*f[32])+3.872983346207417*(5.0*f[22]+2.0*f[21])-3.0*(6.708203932499369*f[15]+5.0*f[7]))+3.0*(6.708203932499369*f[6]+5.0*f[3])); 
  fReflSurfX[2][2] = 0.03333333333333333*(45.0*f[36]+1.732050807568877*((-13.41640786499874*f[35])+3.872983346207417*(5.0*f[26]+2.0*f[25])-3.0*(6.708203932499369*f[16]+5.0*f[9]))+3.0*(6.708203932499369*f[8]+5.0*f[4])); 
  fReflSurfX[2][3] = 0.1*(3.872983346207417*(3.872983346207417*f[45]-2.0*f[44])+2.23606797749979*(5.0*f[38]+2.0*f[37])-1.732050807568877*(6.708203932499369*f[31]+5.0*f[18])+6.708203932499369*f[17]+5.0*f[10]); 
  fReflSurfX[2][4] = -0.1*(2.23606797749979*(5.196152422706631*f[34]+3.872983346207417*f[24])-1.0*(6.708203932499369*f[23]+5.0*f[13])); 
  fReflSurfX[2][5] = -0.1*(2.23606797749979*(5.196152422706631*f[41]+3.872983346207417*f[29])-1.0*(6.708203932499369*f[28]+5.0*f[14])); 
  fReflSurfX[2][6] = -0.1*(2.23606797749979*(5.196152422706631*f[46]+3.872983346207417*f[40])-1.0*(6.708203932499369*f[39]+5.0*f[27])); 
  fReflSurfX[2][7] = -0.1*(2.23606797749979*(5.196152422706631*f[47]+3.872983346207417*f[43])-1.0*(6.708203932499369*f[42]+5.0*f[30])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]-45.0*f[39]-58.09475019311126*f[34]-33.54101966249684*f[27]-43.30127018922195*f[24]+33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])-77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]+58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]+45.0*f[18]-34.85685011586674*f[17]-45.0*f[15]-25.98076211353316*f[10]-33.54101966249685*f[7]+25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]-58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[34]-34.64101615137755*f[29]+26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]+51.96152422706631*f[9]-40.24922359499622*f[8]-51.96152422706631*f[5]-30.0*f[4]-38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]-90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]-34.64101615137755*f[29]+26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]+67.08203932499369*f[20]-34.64101615137755*f[19]-45.0*f[18]+34.85685011586674*f[17]+69.71370023173348*f[16]+45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]+25.98076211353316*f[10]+51.96152422706631*f[9]-40.24922359499622*f[8]+33.54101966249685*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]-30.0*f[4]-19.36491673103709*f[3]-38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = 2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]-1568.558255214003*f[39]-2025.0*f[34]-1169.134295108993*f[27]-1509.345884812358*f[24]+1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])-2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1800.0*f[38]-720.0*f[37]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]+1394.27400463467*f[18]-1080.0*f[17]-1394.27400463467*f[15]-804.9844718999244*f[10]-1039.230484541326*f[7]+804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]-1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]+1080.0*f[35]+1350.0*f[34]-804.9844718999242*f[29]+623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+1207.476707849887*f[9]-935.3074360871933*f[8]-1207.476707849887*f[5]-697.1370023173349*f[4]-900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]+1080.0*f[41]-675.0*f[40]+522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]+2091.411006952005*f[36]-1080.0*f[35]+675.0*f[34]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+804.9844718999242*f[29]-623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+503.1152949374526*f[24]-389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]-1558.84572681199*f[20]+804.9844718999242*f[19]+1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-804.9844718999244*f[10]-1207.476707849887*f[9]+935.3074360871933*f[8]-1039.230484541326*f[7]+804.9844718999244*f[6]+1207.476707849887*f[5]+697.1370023173349*f[4]+600.0*f[3]+900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = 8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]-810.0*f[39]-1045.705503476002*f[34]-603.738353924943*f[27]-779.4228634059949*f[24]+603.738353924943*f[23]+450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])-1169.134295108993*f[45]+603.738353924943*f[44]-450.0*f[43]+348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]+871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]+675.0*f[18]-522.8527517380012*f[17]-675.0*f[15]-389.7114317029973*f[10]-503.1152949374528*f[7]+389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]-1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]+464.7580015448901*f[35]+1161.895003862225*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]+779.4228634059949*f[45]-402.4922359499621*f[44]+300.0*f[43]-232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]-580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]-450.0*f[18]+348.5685011586675*f[17]+450.0*f[15]+259.8076211353315*f[10]+335.4101966249685*f[7]-259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]+580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]-464.7580015448901*f[35]-580.9475019311126*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_l+201.246117974981*f[47]+623.5382907247958*f[46]+389.7114317029975*f[45]-201.246117974981*f[44]+150.0*f[43]-116.1895003862225*f[42]+464.7580015448901*f[40]-360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]-464.7580015448901*f[34]-290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]-268.3281572999747*f[27]-346.4101615137756*f[24]+268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]-225.0*f[18]+174.2842505793337*f[17]+225.0*f[15]+200.0*f[13]+129.9038105676658*f[10]+167.7050983124843*f[7]-129.9038105676658*f[6]-96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]-45.0*f[39]-58.09475019311126*f[34]-33.54101966249684*f[27]-43.30127018922195*f[24]+33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])-77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]+58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]+45.0*f[18]-34.85685011586674*f[17]-45.0*f[15]-25.98076211353316*f[10]-33.54101966249685*f[7]+25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]-58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[34]-34.64101615137755*f[29]+26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]+51.96152422706631*f[9]-40.24922359499622*f[8]-51.96152422706631*f[5]-30.0*f[4]-38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]+46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]+90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]+34.64101615137755*f[29]-26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]-67.08203932499369*f[20]+34.64101615137755*f[19]-45.0*f[18]+34.85685011586674*f[17]-69.71370023173348*f[16]+45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]+25.98076211353316*f[10]-51.96152422706631*f[9]+40.24922359499622*f[8]+33.54101966249685*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]+30.0*f[4]-19.36491673103709*f[3]+38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = -2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]-1568.558255214003*f[39]-2025.0*f[34]-1169.134295108993*f[27]-1509.345884812358*f[24]+1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])-2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1800.0*f[38]-720.0*f[37]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]+1394.27400463467*f[18]-1080.0*f[17]-1394.27400463467*f[15]-804.9844718999244*f[10]-1039.230484541326*f[7]+804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]-1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]+1080.0*f[35]+1350.0*f[34]-804.9844718999242*f[29]+623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+1207.476707849887*f[9]-935.3074360871933*f[8]-1207.476707849887*f[5]-697.1370023173349*f[4]-900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]+1080.0*f[41]-675.0*f[40]+522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]+2091.411006952005*f[36]-1080.0*f[35]+675.0*f[34]-1800.0*f[33]+929.5160030897802*f[32]-1870.614872174387*f[31]-536.6563145999495*f[30]+804.9844718999242*f[29]-623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+503.1152949374526*f[24]-389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]-1558.84572681199*f[20]+804.9844718999242*f[19]-1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+804.9844718999244*f[10]-1207.476707849887*f[9]+935.3074360871933*f[8]+1039.230484541326*f[7]-804.9844718999244*f[6]+1207.476707849887*f[5]+697.1370023173349*f[4]-600.0*f[3]+900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = -8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]-810.0*f[39]-1045.705503476002*f[34]-603.738353924943*f[27]-779.4228634059949*f[24]+603.738353924943*f[23]+450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])-1169.134295108993*f[45]+603.738353924943*f[44]-450.0*f[43]+348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]+871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]+675.0*f[18]-522.8527517380012*f[17]-675.0*f[15]-389.7114317029973*f[10]-503.1152949374528*f[7]+389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]-1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]+464.7580015448901*f[35]+1161.895003862225*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]+779.4228634059949*f[45]-402.4922359499621*f[44]+300.0*f[43]-232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]-580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]-450.0*f[18]+348.5685011586675*f[17]+450.0*f[15]+259.8076211353315*f[10]+335.4101966249685*f[7]-259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]+580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]-464.7580015448901*f[35]-580.9475019311126*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_l+201.246117974981*f[47]-623.5382907247958*f[46]+389.7114317029975*f[45]-201.246117974981*f[44]+150.0*f[43]-116.1895003862225*f[42]-464.7580015448901*f[40]+360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]+464.7580015448901*f[34]-290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]+268.3281572999747*f[27]+346.4101615137756*f[24]-268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]-225.0*f[18]+174.2842505793337*f[17]+225.0*f[15]-200.0*f[13]+129.9038105676658*f[10]+167.7050983124843*f[7]-129.9038105676658*f[6]-96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.003952847075210471*((116.1895003862225*f[34]+86.60254037844389*f[24]-67.08203932499369*f[23]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])-75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[22]-34.64101615137755*f[21]+90.0*f[15]+67.0820393249937*f[7]-51.96152422706631*f[6]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]-86.60254037844389*f[29]+67.08203932499369*f[28]-86.60254037844389*f[24]+67.08203932499369*f[23]-134.1640786499874*f[20]+69.2820323027551*f[19]+50.0*f[14]+50.0*f[13]-100.0*f[12]-40.0*f[11]+103.9230484541326*f[5]+77.45966692414835*f[2]-60.0*f[1]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]-58.09475019311126*f[42]-116.1895003862225*f[41]+116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]-86.60254037844389*f[29]+67.08203932499369*f[28]+86.60254037844389*f[22]+34.64101615137755*f[21]-134.1640786499874*f[20]+69.2820323027551*f[19]-90.0*f[15]+50.0*f[14]-100.0*f[12]-40.0*f[11]-67.0820393249937*f[7]+51.96152422706631*f[6]+103.9230484541326*f[5]+38.72983346207418*f[3]+77.45966692414835*f[2]-60.0*f[1]-44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = -0.001473139127471973*((405.0*f[34]+301.8691769624715*f[24]-233.8268590217985*f[23]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])-232.379000772445*f[43]+180.0*f[42]-360.0*f[33]+185.903200617956*f[32]+134.1640786499874*f[30]-268.3281572999747*f[22]-107.3312629199899*f[21]+278.8548009269339*f[15]+207.8460969082653*f[7]-160.9968943799849*f[6]-120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]-201.246117974981*f[29]+155.884572681199*f[28]-201.246117974981*f[24]+155.884572681199*f[23]-311.7691453623979*f[20]+160.9968943799848*f[19]+116.1895003862225*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+241.4953415699773*f[5]+180.0*f[2]-139.427400463467*f[1]-103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[47]-232.379000772445*f[43]+180.0*f[42]+270.0*f[41]-135.0*f[34]-360.0*f[33]+185.903200617956*f[32]+134.1640786499874*f[30]+201.246117974981*f[29]-155.884572681199*f[28]-100.6230589874905*f[24]+77.94228634059948*f[23]-268.3281572999747*f[22]-107.3312629199899*f[21]+311.7691453623979*f[20]-160.9968943799848*f[19]+278.8548009269339*f[15]-116.1895003862225*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+207.8460969082653*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]-120.0*f[3]-180.0*f[2]+139.427400463467*f[1]+103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((418.2822013904009*f[34]+311.7691453623979*f[24]-241.4953415699772*f[23]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])-225.0*f[43]+174.2842505793337*f[42]-348.5685011586675*f[33]+180.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]-103.9230484541326*f[21]+270.0*f[15]+201.2461179749811*f[7]-155.8845726811989*f[6]-116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]-173.2050807568878*f[29]+134.1640786499874*f[28]-346.4101615137756*f[24]+268.3281572999747*f[23]-268.3281572999747*f[20]+138.5640646055102*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]-80.0*f[11]+207.8460969082653*f[5]+154.9193338482967*f[2]-120.0*f[1]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]+150.0*f[43]-116.1895003862225*f[42]+232.379000772445*f[33]-120.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]+69.2820323027551*f[21]-180.0*f[15]-134.1640786499874*f[7]+103.9230484541326*f[6]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]+173.2050807568878*f[29]-134.1640786499874*f[28]+173.2050807568878*f[24]-134.1640786499874*f[23]+268.3281572999747*f[20]-138.5640646055102*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]+80.0*f[11]-207.8460969082653*f[5]-154.9193338482967*f[2]+120.0*f[1]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]-58.09475019311126*f[42]+185.903200617956*f[34]+116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]+138.5640646055102*f[24]-107.3312629199899*f[23]+86.60254037844389*f[22]+34.64101615137755*f[21]-90.0*f[15]-80.0*f[13]-67.0820393249937*f[7]+51.96152422706631*f[6]+38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.003952847075210471*((116.1895003862225*f[34]+86.60254037844389*f[24]-67.08203932499369*f[23]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])-75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[33]+60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[22]-34.64101615137755*f[21]+90.0*f[15]+67.0820393249937*f[7]-51.96152422706631*f[6]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]-86.60254037844389*f[29]+67.08203932499369*f[28]-86.60254037844389*f[24]+67.08203932499369*f[23]-134.1640786499874*f[20]+69.2820323027551*f[19]+50.0*f[14]+50.0*f[13]-100.0*f[12]-40.0*f[11]+103.9230484541326*f[5]+77.45966692414835*f[2]-60.0*f[1]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[41]+116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[29]-67.08203932499369*f[28]+86.60254037844389*f[22]+34.64101615137755*f[21]+134.1640786499874*f[20]-69.2820323027551*f[19]-90.0*f[15]-50.0*f[14]+100.0*f[12]+40.0*f[11]-67.0820393249937*f[7]+51.96152422706631*f[6]-103.9230484541326*f[5]+38.72983346207418*f[3]-77.45966692414835*f[2]+60.0*f[1]+44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = 0.001473139127471973*((405.0*f[34]+301.8691769624715*f[24]-233.8268590217985*f[23]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])-232.379000772445*f[43]+180.0*f[42]-360.0*f[33]+185.903200617956*f[32]+134.1640786499874*f[30]-268.3281572999747*f[22]-107.3312629199899*f[21]+278.8548009269339*f[15]+207.8460969082653*f[7]-160.9968943799849*f[6]-120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]-201.246117974981*f[29]+155.884572681199*f[28]-201.246117974981*f[24]+155.884572681199*f[23]-311.7691453623979*f[20]+160.9968943799848*f[19]+116.1895003862225*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+241.4953415699773*f[5]+180.0*f[2]-139.427400463467*f[1]-103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[47]+232.379000772445*f[43]-180.0*f[42]+270.0*f[41]-135.0*f[34]+360.0*f[33]-185.903200617956*f[32]-134.1640786499874*f[30]+201.246117974981*f[29]-155.884572681199*f[28]-100.6230589874905*f[24]+77.94228634059948*f[23]+268.3281572999747*f[22]+107.3312629199899*f[21]+311.7691453623979*f[20]-160.9968943799848*f[19]-278.8548009269339*f[15]-116.1895003862225*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]+92.951600308978*f[11]-207.8460969082653*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]+120.0*f[3]-180.0*f[2]+139.427400463467*f[1]+103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((418.2822013904009*f[34]+311.7691453623979*f[24]-241.4953415699772*f[23]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])-225.0*f[43]+174.2842505793337*f[42]-348.5685011586675*f[33]+180.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]-103.9230484541326*f[21]+270.0*f[15]+201.2461179749811*f[7]-155.8845726811989*f[6]-116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]-173.2050807568878*f[29]+134.1640786499874*f[28]-346.4101615137756*f[24]+268.3281572999747*f[23]-268.3281572999747*f[20]+138.5640646055102*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]-80.0*f[11]+207.8460969082653*f[5]+154.9193338482967*f[2]-120.0*f[1]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]+150.0*f[43]-116.1895003862225*f[42]+232.379000772445*f[33]-120.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]+69.2820323027551*f[21]-180.0*f[15]-134.1640786499874*f[7]+103.9230484541326*f[6]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]+173.2050807568878*f[29]-134.1640786499874*f[28]+173.2050807568878*f[24]-134.1640786499874*f[23]+268.3281572999747*f[20]-138.5640646055102*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]+80.0*f[11]-207.8460969082653*f[5]-154.9193338482967*f[2]+120.0*f[1]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]-58.09475019311126*f[42]-185.903200617956*f[34]+116.1895003862225*f[33]-60.0*f[32]-43.30127018922195*f[30]-138.5640646055102*f[24]+107.3312629199899*f[23]+86.60254037844389*f[22]+34.64101615137755*f[21]-90.0*f[15]+80.0*f[13]-67.0820393249937*f[7]+51.96152422706631*f[6]+38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]-45.0*f[39]+58.09475019311126*f[34]-33.54101966249684*f[27]+43.30127018922195*f[24]-33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]-58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]+45.0*f[18]-34.85685011586674*f[17]+45.0*f[15]-25.98076211353316*f[10]+33.54101966249685*f[7]-25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]-58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[34]+34.64101615137755*f[29]-26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]+51.96152422706631*f[9]-40.24922359499622*f[8]+51.96152422706631*f[5]-30.0*f[4]+38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]+46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]-90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]+34.64101615137755*f[29]-26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]-67.08203932499369*f[20]+34.64101615137755*f[19]-45.0*f[18]+34.85685011586674*f[17]+69.71370023173348*f[16]-45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]+25.98076211353316*f[10]+51.96152422706631*f[9]-40.24922359499622*f[8]-33.54101966249685*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]-30.0*f[4]+19.36491673103709*f[3]+38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = -2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]-1568.558255214003*f[39]+2025.0*f[34]-1169.134295108993*f[27]+1509.345884812358*f[24]-1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]-2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1800.0*f[38]-720.0*f[37]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]+1394.27400463467*f[18]-1080.0*f[17]+1394.27400463467*f[15]-804.9844718999244*f[10]+1039.230484541326*f[7]-804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]-1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]+1080.0*f[35]-1350.0*f[34]+804.9844718999242*f[29]-623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+1207.476707849887*f[9]-935.3074360871933*f[8]+1207.476707849887*f[5]-697.1370023173349*f[4]+900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1080.0*f[41]-675.0*f[40]+522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]+2091.411006952005*f[36]-1080.0*f[35]-675.0*f[34]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-804.9844718999242*f[29]+623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-503.1152949374526*f[24]+389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]+1558.84572681199*f[20]-804.9844718999242*f[19]+1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-804.9844718999244*f[10]-1207.476707849887*f[9]+935.3074360871933*f[8]+1039.230484541326*f[7]-804.9844718999244*f[6]-1207.476707849887*f[5]+697.1370023173349*f[4]-600.0*f[3]-900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = -8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]-810.0*f[39]+1045.705503476002*f[34]-603.738353924943*f[27]+779.4228634059949*f[24]-603.738353924943*f[23]-450.0*f[13])*vcut_lR5+(603.738353924943*f[47]-1169.134295108993*f[45]+603.738353924943*f[44]+450.0*f[43]-348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]-871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]+675.0*f[18]-522.8527517380012*f[17]+675.0*f[15]-389.7114317029973*f[10]+503.1152949374528*f[7]-389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]-1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]+464.7580015448901*f[35]-1161.895003862225*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])+779.4228634059949*f[45]-402.4922359499621*f[44]-300.0*f[43]+232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]+580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]-450.0*f[18]+348.5685011586675*f[17]-450.0*f[15]+259.8076211353315*f[10]-335.4101966249685*f[7]+259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]+580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]-464.7580015448901*f[35]+580.9475019311126*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_l-201.246117974981*f[47]+623.5382907247958*f[46]+389.7114317029975*f[45]-201.246117974981*f[44]-150.0*f[43]+116.1895003862225*f[42]+464.7580015448901*f[40]-360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]+464.7580015448901*f[34]+290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]-268.3281572999747*f[27]+346.4101615137756*f[24]-268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]-225.0*f[18]+174.2842505793337*f[17]-225.0*f[15]-200.0*f[13]+129.9038105676658*f[10]-167.7050983124843*f[7]+129.9038105676658*f[6]+96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]-45.0*f[39]+58.09475019311126*f[34]-33.54101966249684*f[27]+43.30127018922195*f[24]-33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]-58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]+45.0*f[18]-34.85685011586674*f[17]+45.0*f[15]-25.98076211353316*f[10]+33.54101966249685*f[7]-25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]-58.09475019311126*f[40]+45.0*f[39]-90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[34]+34.64101615137755*f[29]-26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]+51.96152422706631*f[9]-40.24922359499622*f[8]+51.96152422706631*f[5]-30.0*f[4]+38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]+90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]-34.64101615137755*f[29]+26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]+67.08203932499369*f[20]-34.64101615137755*f[19]-45.0*f[18]+34.85685011586674*f[17]-69.71370023173348*f[16]-45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]+25.98076211353316*f[10]-51.96152422706631*f[9]+40.24922359499622*f[8]-33.54101966249685*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]+30.0*f[4]+19.36491673103709*f[3]-38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = 2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]-1568.558255214003*f[39]+2025.0*f[34]-1169.134295108993*f[27]+1509.345884812358*f[24]-1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]-2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1800.0*f[38]-720.0*f[37]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]+1394.27400463467*f[18]-1080.0*f[17]+1394.27400463467*f[15]-804.9844718999244*f[10]+1039.230484541326*f[7]-804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]-1350.0*f[40]+1045.705503476002*f[39]-2091.411006952005*f[36]+1080.0*f[35]-1350.0*f[34]+804.9844718999242*f[29]-623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+1207.476707849887*f[9]-935.3074360871933*f[8]+1207.476707849887*f[5]-697.1370023173349*f[4]+900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1080.0*f[41]-675.0*f[40]+522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]+2091.411006952005*f[36]-1080.0*f[35]-675.0*f[34]+1800.0*f[33]-929.5160030897802*f[32]-1870.614872174387*f[31]+536.6563145999495*f[30]-804.9844718999242*f[29]+623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-503.1152949374526*f[24]+389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]+1558.84572681199*f[20]-804.9844718999242*f[19]-1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+804.9844718999244*f[10]-1207.476707849887*f[9]+935.3074360871933*f[8]-1039.230484541326*f[7]+804.9844718999244*f[6]-1207.476707849887*f[5]+697.1370023173349*f[4]+600.0*f[3]-900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = 8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]-810.0*f[39]+1045.705503476002*f[34]-603.738353924943*f[27]+779.4228634059949*f[24]-603.738353924943*f[23]-450.0*f[13])*vcut_lR5+(603.738353924943*f[47]-1169.134295108993*f[45]+603.738353924943*f[44]+450.0*f[43]-348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]-871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]+675.0*f[18]-522.8527517380012*f[17]+675.0*f[15]-389.7114317029973*f[10]+503.1152949374528*f[7]-389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]-1161.895003862225*f[40]+900.0*f[39]-900.0*f[36]+464.7580015448901*f[35]-1161.895003862225*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])+779.4228634059949*f[45]-402.4922359499621*f[44]-300.0*f[43]+232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]+580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]-450.0*f[18]+348.5685011586675*f[17]-450.0*f[15]+259.8076211353315*f[10]-335.4101966249685*f[7]+259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]+580.9475019311126*f[40]-450.0*f[39]+900.0*f[36]-464.7580015448901*f[35]+580.9475019311126*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_l-201.246117974981*f[47]-623.5382907247958*f[46]+389.7114317029975*f[45]-201.246117974981*f[44]-150.0*f[43]+116.1895003862225*f[42]-464.7580015448901*f[40]+360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]-464.7580015448901*f[34]+290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]+268.3281572999747*f[27]-346.4101615137756*f[24]+268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]-225.0*f[18]+174.2842505793337*f[17]-225.0*f[15]+200.0*f[13]+129.9038105676658*f[10]-167.7050983124843*f[7]+129.9038105676658*f[6]+96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[2][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[2][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[2][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[2][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[2][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[2][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[2][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[2][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  fRefl[0] = 0.1111111111111111*(5.0*fReflSurfX[2][0]+8.0*fReflSurfX[1][0]+5.0*fReflSurfX[0][0]); 
  fRefl[1] = 0.7453559924999299*(fReflSurfX[2][0]-1.0*fReflSurfX[0][0]); 
  fRefl[2] = 0.0; 
  fRefl[3] = 0.1111111111111111*(5.0*fReflSurfX[2][1]+8.0*fReflSurfX[1][1]+5.0*fReflSurfX[0][1]); 
  fRefl[4] = 0.1111111111111111*(5.0*fReflSurfX[2][2]+8.0*fReflSurfX[1][2]+5.0*fReflSurfX[0][2]); 
  fRefl[5] = 0.0; 
  fRefl[6] = 0.7453559924999299*(fReflSurfX[2][1]-1.0*fReflSurfX[0][1]); 
  fRefl[7] = 0.0; 
  fRefl[8] = 0.7453559924999299*(fReflSurfX[2][2]-1.0*fReflSurfX[0][2]); 
  fRefl[9] = 0.0; 
  fRefl[10] = 0.1111111111111111*(5.0*fReflSurfX[2][3]+8.0*fReflSurfX[1][3]+5.0*fReflSurfX[0][3]); 
  fRefl[11] = 0.4969039949999532*(fReflSurfX[2][0]-2.0*fReflSurfX[1][0]+fReflSurfX[0][0]); 
  fRefl[12] = 0.0; 
  fRefl[13] = 0.1111111111111111*(5.0*fReflSurfX[2][4]+8.0*fReflSurfX[1][4]+5.0*fReflSurfX[0][4]); 
  fRefl[14] = 0.1111111111111111*(5.0*fReflSurfX[2][5]+8.0*fReflSurfX[1][5]+5.0*fReflSurfX[0][5]); 
  fRefl[15] = 0.0; 
  fRefl[16] = 0.0; 
  fRefl[17] = 0.7453559924999299*(fReflSurfX[2][3]-1.0*fReflSurfX[0][3]); 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.0; 
  fRefl[20] = 0.0; 
  fRefl[21] = 0.4969039949999535*(fReflSurfX[2][1]-2.0*fReflSurfX[1][1]+fReflSurfX[0][1]); 
  fRefl[22] = 0.0; 
  fRefl[23] = 0.74535599249993*(fReflSurfX[2][4]-1.0*fReflSurfX[0][4]); 
  fRefl[24] = 0.0; 
  fRefl[25] = 0.4969039949999535*(fReflSurfX[2][2]-2.0*fReflSurfX[1][2]+fReflSurfX[0][2]); 
  fRefl[26] = 0.0; 
  fRefl[27] = 0.1111111111111111*(5.0*fReflSurfX[2][6]+8.0*fReflSurfX[1][6]+5.0*fReflSurfX[0][6]); 
  fRefl[28] = 0.74535599249993*(fReflSurfX[2][5]-1.0*fReflSurfX[0][5]); 
  fRefl[29] = 0.0; 
  fRefl[30] = 0.1111111111111111*(5.0*fReflSurfX[2][7]+8.0*fReflSurfX[1][7]+5.0*fReflSurfX[0][7]); 
  fRefl[31] = 0.0; 
  fRefl[32] = 0.0; 
  fRefl[33] = 0.0; 
  fRefl[34] = 0.0; 
  fRefl[35] = 0.0; 
  fRefl[36] = 0.0; 
  fRefl[37] = 0.4969039949999532*(fReflSurfX[2][3]-2.0*fReflSurfX[1][3]+fReflSurfX[0][3]); 
  fRefl[38] = 0.0; 
  fRefl[39] = 0.74535599249993*(fReflSurfX[2][6]-1.0*fReflSurfX[0][6]); 
  fRefl[40] = 0.0; 
  fRefl[41] = 0.0; 
  fRefl[42] = 0.74535599249993*(fReflSurfX[2][7]-1.0*fReflSurfX[0][7]); 
  fRefl[43] = 0.0; 
  fRefl[44] = 0.0; 
  fRefl[45] = 0.0; 
  fRefl[46] = 0.0; 
  fRefl[47] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_upper_2x2v_ser_p2(double wv, double dv, double vlowerSq, double vupperSq, double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurfX[3][8] = {0.}; 
  // node (x)_0 
  vcutSq = -0.1*(15.0*phiWall[7]-15.0*phi[7]-7.745966692414834*phiWall[6]+7.745966692414834*phi[6]-11.18033988749895*phiWall[5]+11.18033988749895*phi[5]-4.47213595499958*phiWall[4]+4.47213595499958*phi[4]+11.61895003862225*phiWall[3]-11.61895003862225*phi[3]-8.660254037844386*phiWall[2]+8.660254037844386*phi[2]+6.708203932499369*phiWall[1]-6.708203932499369*phi[1]-5.0*phiWall[0]+5.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[0][0] = 0.0; 
  fReflSurfX[0][1] = 0.0; 
  fReflSurfX[0][2] = 0.0; 
  fReflSurfX[0][3] = 0.0; 
  fReflSurfX[0][4] = 0.0; 
  fReflSurfX[0][5] = 0.0; 
  fReflSurfX[0][6] = 0.0; 
  fReflSurfX[0][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[0][0] = -0.1*(15.0*f[20]-1.0*(7.745966692414834*f[19]+2.23606797749979*(5.0*f[12]+2.0*f[11]))+1.732050807568877*(6.708203932499369*f[5]-5.0*f[2])+6.708203932499369*f[1]-5.0*f[0]); 
  fReflSurfX[0][1] = -0.03333333333333333*(45.0*f[33]+1.732050807568877*(3.0*(6.708203932499369*f[15]-5.0*f[7])-1.0*(13.41640786499874*f[32]+3.872983346207417*(5.0*f[22]+2.0*f[21])))+3.0*(6.708203932499369*f[6]-5.0*f[3])); 
  fReflSurfX[0][2] = -0.03333333333333333*(45.0*f[36]+1.732050807568877*(3.0*(6.708203932499369*f[16]-5.0*f[9])-1.0*(13.41640786499874*f[35]+3.872983346207417*(5.0*f[26]+2.0*f[25])))+3.0*(6.708203932499369*f[8]-5.0*f[4])); 
  fReflSurfX[0][3] = -0.1*(15.0*f[45]-1.0*(7.745966692414834*f[44]+2.23606797749979*(5.0*f[38]+2.0*f[37]))+1.732050807568877*(6.708203932499369*f[31]-5.0*f[18])+6.708203932499369*f[17]-5.0*f[10]); 
  fReflSurfX[0][4] = -0.1*(11.61895003862225*f[34]+3.872983346207417*(1.732050807568877*f[23]-2.23606797749979*f[24])-5.0*f[13]); 
  fReflSurfX[0][5] = -0.1*(11.61895003862225*f[41]+3.872983346207417*(1.732050807568877*f[28]-2.23606797749979*f[29])-5.0*f[14]); 
  fReflSurfX[0][6] = -0.1*(11.61895003862225*f[46]+3.872983346207417*(1.732050807568877*f[39]-2.23606797749979*f[40])-5.0*f[27]); 
  fReflSurfX[0][7] = -0.1*(11.61895003862225*f[47]+3.872983346207417*(1.732050807568877*f[42]-2.23606797749979*f[43])-5.0*f[30]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]+45.0*f[39]-58.09475019311126*f[34]-33.54101966249684*f[27]+43.30127018922195*f[24]-33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])+77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]-58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]-45.0*f[18]+34.85685011586674*f[17]-45.0*f[15]-25.98076211353316*f[10]+33.54101966249685*f[7]-25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]+58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[34]+34.64101615137755*f[29]-26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]-51.96152422706631*f[9]+40.24922359499622*f[8]-51.96152422706631*f[5]-30.0*f[4]+38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]+90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]+34.64101615137755*f[29]-26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]-67.08203932499369*f[20]+34.64101615137755*f[19]+45.0*f[18]-34.85685011586674*f[17]+69.71370023173348*f[16]+45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]+25.98076211353316*f[10]-51.96152422706631*f[9]+40.24922359499622*f[8]-33.54101966249685*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]-30.0*f[4]-19.36491673103709*f[3]+38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = 2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]+1568.558255214003*f[39]-2025.0*f[34]-1169.134295108993*f[27]+1509.345884812358*f[24]-1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])+2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1800.0*f[38]-720.0*f[37]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]-1394.27400463467*f[18]+1080.0*f[17]-1394.27400463467*f[15]-804.9844718999244*f[10]+1039.230484541326*f[7]-804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]+1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]-1080.0*f[35]+1350.0*f[34]+804.9844718999242*f[29]-623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-1207.476707849887*f[9]+935.3074360871933*f[8]-1207.476707849887*f[5]-697.1370023173349*f[4]+900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]+1080.0*f[41]+675.0*f[40]-522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]-2091.411006952005*f[36]+1080.0*f[35]+675.0*f[34]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]-804.9844718999242*f[29]+623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-503.1152949374526*f[24]+389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]+1558.84572681199*f[20]-804.9844718999242*f[19]-1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-804.9844718999244*f[10]+1207.476707849887*f[9]-935.3074360871933*f[8]+1039.230484541326*f[7]-804.9844718999244*f[6]+1207.476707849887*f[5]+697.1370023173349*f[4]+600.0*f[3]-900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = 8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]+810.0*f[39]-1045.705503476002*f[34]-603.738353924943*f[27]+779.4228634059949*f[24]-603.738353924943*f[23]+450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])+1169.134295108993*f[45]-603.738353924943*f[44]+450.0*f[43]-348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]-871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]-675.0*f[18]+522.8527517380012*f[17]-675.0*f[15]-389.7114317029973*f[10]+503.1152949374528*f[7]-389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]+1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]-464.7580015448901*f[35]+1161.895003862225*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]-779.4228634059949*f[45]+402.4922359499621*f[44]-300.0*f[43]+232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]+580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]+450.0*f[18]-348.5685011586675*f[17]+450.0*f[15]+259.8076211353315*f[10]-335.4101966249685*f[7]+259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]-580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]+464.7580015448901*f[35]-580.9475019311126*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_l+201.246117974981*f[47]+623.5382907247958*f[46]-389.7114317029975*f[45]+201.246117974981*f[44]-150.0*f[43]+116.1895003862225*f[42]-464.7580015448901*f[40]+360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]-464.7580015448901*f[34]+290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]-268.3281572999747*f[27]+346.4101615137756*f[24]-268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]+225.0*f[18]-174.2842505793337*f[17]+225.0*f[15]+200.0*f[13]+129.9038105676658*f[10]-167.7050983124843*f[7]+129.9038105676658*f[6]-96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]+45.0*f[39]-58.09475019311126*f[34]-33.54101966249684*f[27]+43.30127018922195*f[24]-33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])+77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]-58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]-45.0*f[18]+34.85685011586674*f[17]-45.0*f[15]-25.98076211353316*f[10]+33.54101966249685*f[7]-25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]+58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[34]+34.64101615137755*f[29]-26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]-51.96152422706631*f[9]+40.24922359499622*f[8]-51.96152422706631*f[5]-30.0*f[4]+38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]+46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]-90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]-34.64101615137755*f[29]+26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]+67.08203932499369*f[20]-34.64101615137755*f[19]+45.0*f[18]-34.85685011586674*f[17]-69.71370023173348*f[16]+45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]+25.98076211353316*f[10]+51.96152422706631*f[9]-40.24922359499622*f[8]-33.54101966249685*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]+30.0*f[4]-19.36491673103709*f[3]-38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = -2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]+1568.558255214003*f[39]-2025.0*f[34]-1169.134295108993*f[27]+1509.345884812358*f[24]-1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])+2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1800.0*f[38]-720.0*f[37]-1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]-1394.27400463467*f[18]+1080.0*f[17]-1394.27400463467*f[15]-804.9844718999244*f[10]+1039.230484541326*f[7]-804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]+1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]-1080.0*f[35]+1350.0*f[34]+804.9844718999242*f[29]-623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-1207.476707849887*f[9]+935.3074360871933*f[8]-1207.476707849887*f[5]-697.1370023173349*f[4]+900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]+1080.0*f[41]+675.0*f[40]-522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]-2091.411006952005*f[36]+1080.0*f[35]+675.0*f[34]+1800.0*f[33]-929.5160030897802*f[32]-1870.614872174387*f[31]-536.6563145999495*f[30]-804.9844718999242*f[29]+623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-503.1152949374526*f[24]+389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]+1558.84572681199*f[20]-804.9844718999242*f[19]+1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+804.9844718999244*f[10]+1207.476707849887*f[9]-935.3074360871933*f[8]-1039.230484541326*f[7]+804.9844718999244*f[6]+1207.476707849887*f[5]+697.1370023173349*f[4]-600.0*f[3]-900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = -8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]+810.0*f[39]-1045.705503476002*f[34]-603.738353924943*f[27]+779.4228634059949*f[24]-603.738353924943*f[23]+450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])+1169.134295108993*f[45]-603.738353924943*f[44]+450.0*f[43]-348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]-871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]-675.0*f[18]+522.8527517380012*f[17]-675.0*f[15]-389.7114317029973*f[10]+503.1152949374528*f[7]-389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]+1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]-464.7580015448901*f[35]+1161.895003862225*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]-779.4228634059949*f[45]+402.4922359499621*f[44]-300.0*f[43]+232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]+580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]+450.0*f[18]-348.5685011586675*f[17]+450.0*f[15]+259.8076211353315*f[10]-335.4101966249685*f[7]+259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]-580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]+464.7580015448901*f[35]-580.9475019311126*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_l+201.246117974981*f[47]-623.5382907247958*f[46]-389.7114317029975*f[45]+201.246117974981*f[44]-150.0*f[43]+116.1895003862225*f[42]+464.7580015448901*f[40]-360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]+464.7580015448901*f[34]+290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]+268.3281572999747*f[27]-346.4101615137756*f[24]+268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]+225.0*f[18]-174.2842505793337*f[17]+225.0*f[15]-200.0*f[13]+129.9038105676658*f[10]-167.7050983124843*f[7]+129.9038105676658*f[6]-96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.003952847075210471*((116.1895003862225*f[34]-86.60254037844389*f[24]+67.08203932499369*f[23]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])+75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[22]-34.64101615137755*f[21]+90.0*f[15]-67.0820393249937*f[7]+51.96152422706631*f[6]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]+86.60254037844389*f[29]-67.08203932499369*f[28]+86.60254037844389*f[24]-67.08203932499369*f[23]+134.1640786499874*f[20]-69.2820323027551*f[19]+50.0*f[14]+50.0*f[13]-100.0*f[12]-40.0*f[11]+103.9230484541326*f[5]-77.45966692414835*f[2]+60.0*f[1]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[41]-116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[29]-67.08203932499369*f[28]+86.60254037844389*f[22]+34.64101615137755*f[21]+134.1640786499874*f[20]-69.2820323027551*f[19]-90.0*f[15]+50.0*f[14]-100.0*f[12]-40.0*f[11]+67.0820393249937*f[7]-51.96152422706631*f[6]+103.9230484541326*f[5]+38.72983346207418*f[3]-77.45966692414835*f[2]+60.0*f[1]-44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = -0.001473139127471973*((405.0*f[34]-301.8691769624715*f[24]+233.8268590217985*f[23]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])+232.379000772445*f[43]-180.0*f[42]+360.0*f[33]-185.903200617956*f[32]+134.1640786499874*f[30]-268.3281572999747*f[22]-107.3312629199899*f[21]+278.8548009269339*f[15]-207.8460969082653*f[7]+160.9968943799849*f[6]-120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]+201.246117974981*f[29]-155.884572681199*f[28]+201.246117974981*f[24]-155.884572681199*f[23]+311.7691453623979*f[20]-160.9968943799848*f[19]+116.1895003862225*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+241.4953415699773*f[5]-180.0*f[2]+139.427400463467*f[1]-103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[47]+232.379000772445*f[43]-180.0*f[42]+270.0*f[41]-135.0*f[34]+360.0*f[33]-185.903200617956*f[32]+134.1640786499874*f[30]-201.246117974981*f[29]+155.884572681199*f[28]+100.6230589874905*f[24]-77.94228634059948*f[23]-268.3281572999747*f[22]-107.3312629199899*f[21]-311.7691453623979*f[20]+160.9968943799848*f[19]+278.8548009269339*f[15]-116.1895003862225*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]+92.951600308978*f[11]-207.8460969082653*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]-120.0*f[3]+180.0*f[2]-139.427400463467*f[1]+103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((418.2822013904009*f[34]-311.7691453623979*f[24]+241.4953415699772*f[23]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])+225.0*f[43]-174.2842505793337*f[42]+348.5685011586675*f[33]-180.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]-103.9230484541326*f[21]+270.0*f[15]-201.2461179749811*f[7]+155.8845726811989*f[6]-116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]+173.2050807568878*f[29]-134.1640786499874*f[28]+346.4101615137756*f[24]-268.3281572999747*f[23]+268.3281572999747*f[20]-138.5640646055102*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]-80.0*f[11]+207.8460969082653*f[5]-154.9193338482967*f[2]+120.0*f[1]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]-150.0*f[43]+116.1895003862225*f[42]-232.379000772445*f[33]+120.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]+69.2820323027551*f[21]-180.0*f[15]+134.1640786499874*f[7]-103.9230484541326*f[6]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]-173.2050807568878*f[29]+134.1640786499874*f[28]-173.2050807568878*f[24]+134.1640786499874*f[23]-268.3281572999747*f[20]+138.5640646055102*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]+80.0*f[11]-207.8460969082653*f[5]+154.9193338482967*f[2]-120.0*f[1]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]+58.09475019311126*f[42]+185.903200617956*f[34]-116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]-138.5640646055102*f[24]+107.3312629199899*f[23]+86.60254037844389*f[22]+34.64101615137755*f[21]-90.0*f[15]-80.0*f[13]+67.0820393249937*f[7]-51.96152422706631*f[6]+38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.003952847075210471*((116.1895003862225*f[34]-86.60254037844389*f[24]+67.08203932499369*f[23]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])+75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[22]-34.64101615137755*f[21]+90.0*f[15]-67.0820393249937*f[7]+51.96152422706631*f[6]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]+86.60254037844389*f[29]-67.08203932499369*f[28]+86.60254037844389*f[24]-67.08203932499369*f[23]+134.1640786499874*f[20]-69.2820323027551*f[19]+50.0*f[14]+50.0*f[13]-100.0*f[12]-40.0*f[11]+103.9230484541326*f[5]-77.45966692414835*f[2]+60.0*f[1]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]+58.09475019311126*f[42]+116.1895003862225*f[41]-116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]-86.60254037844389*f[29]+67.08203932499369*f[28]+86.60254037844389*f[22]+34.64101615137755*f[21]-134.1640786499874*f[20]+69.2820323027551*f[19]-90.0*f[15]-50.0*f[14]+100.0*f[12]+40.0*f[11]+67.0820393249937*f[7]-51.96152422706631*f[6]-103.9230484541326*f[5]+38.72983346207418*f[3]+77.45966692414835*f[2]-60.0*f[1]+44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = 0.001473139127471973*((405.0*f[34]-301.8691769624715*f[24]+233.8268590217985*f[23]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])+232.379000772445*f[43]-180.0*f[42]+360.0*f[33]-185.903200617956*f[32]+134.1640786499874*f[30]-268.3281572999747*f[22]-107.3312629199899*f[21]+278.8548009269339*f[15]-207.8460969082653*f[7]+160.9968943799849*f[6]-120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]+201.246117974981*f[29]-155.884572681199*f[28]+201.246117974981*f[24]-155.884572681199*f[23]+311.7691453623979*f[20]-160.9968943799848*f[19]+116.1895003862225*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+241.4953415699773*f[5]-180.0*f[2]+139.427400463467*f[1]-103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[47]-232.379000772445*f[43]+180.0*f[42]+270.0*f[41]-135.0*f[34]-360.0*f[33]+185.903200617956*f[32]-134.1640786499874*f[30]-201.246117974981*f[29]+155.884572681199*f[28]+100.6230589874905*f[24]-77.94228634059948*f[23]+268.3281572999747*f[22]+107.3312629199899*f[21]-311.7691453623979*f[20]+160.9968943799848*f[19]-278.8548009269339*f[15]-116.1895003862225*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+207.8460969082653*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]+120.0*f[3]+180.0*f[2]-139.427400463467*f[1]+103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((418.2822013904009*f[34]-311.7691453623979*f[24]+241.4953415699772*f[23]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])+225.0*f[43]-174.2842505793337*f[42]+348.5685011586675*f[33]-180.0*f[32]+129.9038105676658*f[30]-259.8076211353317*f[22]-103.9230484541326*f[21]+270.0*f[15]-201.2461179749811*f[7]+155.8845726811989*f[6]-116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]+173.2050807568878*f[29]-134.1640786499874*f[28]+346.4101615137756*f[24]-268.3281572999747*f[23]+268.3281572999747*f[20]-138.5640646055102*f[19]+100.0*f[14]+200.0*f[13]-200.0*f[12]-80.0*f[11]+207.8460969082653*f[5]-154.9193338482967*f[2]+120.0*f[1]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]-150.0*f[43]+116.1895003862225*f[42]-232.379000772445*f[33]+120.0*f[32]-86.60254037844389*f[30]+173.2050807568878*f[22]+69.2820323027551*f[21]-180.0*f[15]+134.1640786499874*f[7]-103.9230484541326*f[6]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]-173.2050807568878*f[29]+134.1640786499874*f[28]-173.2050807568878*f[24]+134.1640786499874*f[23]-268.3281572999747*f[20]+138.5640646055102*f[19]-100.0*f[14]-100.0*f[13]+200.0*f[12]+80.0*f[11]-207.8460969082653*f[5]+154.9193338482967*f[2]-120.0*f[1]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]-75.0*f[43]+58.09475019311126*f[42]-185.903200617956*f[34]-116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]+138.5640646055102*f[24]-107.3312629199899*f[23]+86.60254037844389*f[22]+34.64101615137755*f[21]-90.0*f[15]+80.0*f[13]+67.0820393249937*f[7]-51.96152422706631*f[6]+38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]+45.0*f[39]+58.09475019311126*f[34]-33.54101966249684*f[27]-43.30127018922195*f[24]+33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]+58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]-45.0*f[18]+34.85685011586674*f[17]+45.0*f[15]-25.98076211353316*f[10]-33.54101966249685*f[7]+25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]+58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[34]-34.64101615137755*f[29]+26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]-51.96152422706631*f[9]+40.24922359499622*f[8]+51.96152422706631*f[5]-30.0*f[4]-38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]+46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]+90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]-34.64101615137755*f[29]+26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]+67.08203932499369*f[20]-34.64101615137755*f[19]+45.0*f[18]-34.85685011586674*f[17]+69.71370023173348*f[16]-45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]+25.98076211353316*f[10]-51.96152422706631*f[9]+40.24922359499622*f[8]+33.54101966249685*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]-30.0*f[4]+19.36491673103709*f[3]-38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = -2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]+1568.558255214003*f[39]+2025.0*f[34]-1169.134295108993*f[27]-1509.345884812358*f[24]+1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]+2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1800.0*f[38]-720.0*f[37]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]-1394.27400463467*f[18]+1080.0*f[17]+1394.27400463467*f[15]-804.9844718999244*f[10]-1039.230484541326*f[7]+804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]+1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]-1080.0*f[35]-1350.0*f[34]-804.9844718999242*f[29]+623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-1207.476707849887*f[9]+935.3074360871933*f[8]+1207.476707849887*f[5]-697.1370023173349*f[4]-900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1080.0*f[41]+675.0*f[40]-522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]-2091.411006952005*f[36]+1080.0*f[35]-675.0*f[34]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]+804.9844718999242*f[29]-623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+503.1152949374526*f[24]-389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]-1558.84572681199*f[20]+804.9844718999242*f[19]-1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-804.9844718999244*f[10]+1207.476707849887*f[9]-935.3074360871933*f[8]-1039.230484541326*f[7]+804.9844718999244*f[6]-1207.476707849887*f[5]+697.1370023173349*f[4]-600.0*f[3]+900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = -8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]+810.0*f[39]+1045.705503476002*f[34]-603.738353924943*f[27]-779.4228634059949*f[24]+603.738353924943*f[23]-450.0*f[13])*vcut_lR5+(603.738353924943*f[47]+1169.134295108993*f[45]-603.738353924943*f[44]-450.0*f[43]+348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]+871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]-675.0*f[18]+522.8527517380012*f[17]+675.0*f[15]-389.7114317029973*f[10]-503.1152949374528*f[7]+389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]+1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]-464.7580015448901*f[35]-1161.895003862225*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])-779.4228634059949*f[45]+402.4922359499621*f[44]+300.0*f[43]-232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]-580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]+450.0*f[18]-348.5685011586675*f[17]-450.0*f[15]+259.8076211353315*f[10]+335.4101966249685*f[7]-259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]-580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]+464.7580015448901*f[35]+580.9475019311126*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_l-201.246117974981*f[47]+623.5382907247958*f[46]-389.7114317029975*f[45]+201.246117974981*f[44]+150.0*f[43]-116.1895003862225*f[42]-464.7580015448901*f[40]+360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]+464.7580015448901*f[34]-290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]-268.3281572999747*f[27]-346.4101615137756*f[24]+268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]+225.0*f[18]-174.2842505793337*f[17]-225.0*f[15]-200.0*f[13]+129.9038105676658*f[10]+167.7050983124843*f[7]-129.9038105676658*f[6]+96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.007905694150420944*((77.94228634059948*f[46]-58.09475019311126*f[40]+45.0*f[39]+58.09475019311126*f[34]-33.54101966249684*f[27]-43.30127018922195*f[24]+33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]+77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]+23.2379000772445*f[42]-58.09475019311126*f[38]-23.2379000772445*f[37]+58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]-45.0*f[18]+34.85685011586674*f[17]+45.0*f[15]-25.98076211353316*f[10]-33.54101966249685*f[7]+25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]+58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[34]-34.64101615137755*f[29]+26.83281572999747*f[28]+33.54101966249684*f[27]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]-51.96152422706631*f[9]+40.24922359499622*f[8]+51.96152422706631*f[5]-30.0*f[4]-38.72983346207418*f[2]+30.0*f[1]-22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]-77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]-23.2379000772445*f[42]-46.475800154489*f[41]+58.09475019311126*f[38]+23.2379000772445*f[37]-90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]+34.64101615137755*f[29]-26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]-67.08203932499369*f[20]+34.64101615137755*f[19]+45.0*f[18]-34.85685011586674*f[17]-69.71370023173348*f[16]-45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]+25.98076211353316*f[10]+51.96152422706631*f[9]-40.24922359499622*f[8]+33.54101966249685*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]+30.0*f[4]+19.36491673103709*f[3]+38.72983346207418*f[2]-30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = 2.946278254943946e-4*((2716.822592662243*f[46]-2025.0*f[40]+1568.558255214003*f[39]+2025.0*f[34]-1169.134295108993*f[27]-1509.345884812358*f[24]+1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]+2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]+720.0*f[42]-1800.0*f[38]-720.0*f[37]+1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]-1394.27400463467*f[18]+1080.0*f[17]+1394.27400463467*f[15]-804.9844718999244*f[10]-1039.230484541326*f[7]+804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]+1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]-1080.0*f[35]-1350.0*f[34]-804.9844718999242*f[29]+623.5382907247958*f[28]+779.4228634059949*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-1207.476707849887*f[9]+935.3074360871933*f[8]+1207.476707849887*f[5]-697.1370023173349*f[4]-900.0*f[2]+697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]-720.0*f[42]-1080.0*f[41]+675.0*f[40]-522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]-2091.411006952005*f[36]+1080.0*f[35]-675.0*f[34]-1800.0*f[33]+929.5160030897802*f[32]-1870.614872174387*f[31]+536.6563145999495*f[30]+804.9844718999242*f[29]-623.5382907247958*f[28]+389.7114317029975*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+503.1152949374526*f[24]-389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]-1558.84572681199*f[20]+804.9844718999242*f[19]+1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+804.9844718999244*f[10]+1207.476707849887*f[9]-935.3074360871933*f[8]+1039.230484541326*f[7]-804.9844718999244*f[6]-1207.476707849887*f[5]+697.1370023173349*f[4]+600.0*f[3]+900.0*f[2]-697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = 8.838834764831837e-4*((1402.961154130791*f[46]-1045.705503476002*f[40]+810.0*f[39]+1045.705503476002*f[34]-603.738353924943*f[27]-779.4228634059949*f[24]+603.738353924943*f[23]-450.0*f[13])*vcut_lR5+(603.738353924943*f[47]+1169.134295108993*f[45]-603.738353924943*f[44]-450.0*f[43]+348.5685011586675*f[42]-871.4212528966688*f[38]-348.5685011586675*f[37]+871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]-675.0*f[18]+522.8527517380012*f[17]+675.0*f[15]-389.7114317029973*f[10]-503.1152949374528*f[7]+389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]+1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]-464.7580015448901*f[35]-1161.895003862225*f[34]-346.4101615137756*f[29]+268.3281572999747*f[28]+670.820393249937*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]+300.0*f[1]-223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])-779.4228634059949*f[45]+402.4922359499621*f[44]+300.0*f[43]-232.379000772445*f[42]+580.9475019311126*f[38]+232.379000772445*f[37]-580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]+450.0*f[18]-348.5685011586675*f[17]-450.0*f[15]+259.8076211353315*f[10]+335.4101966249685*f[7]-259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]-580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]+464.7580015448901*f[35]+580.9475019311126*f[34]+346.4101615137756*f[29]-268.3281572999747*f[28]-335.4101966249685*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]-300.0*f[1]+223.606797749979*f[0])*vcut_l-201.246117974981*f[47]-623.5382907247958*f[46]-389.7114317029975*f[45]+201.246117974981*f[44]+150.0*f[43]-116.1895003862225*f[42]+464.7580015448901*f[40]-360.0*f[39]+290.4737509655563*f[38]+116.1895003862225*f[37]-464.7580015448901*f[34]-290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]+268.3281572999747*f[27]+346.4101615137756*f[24]-268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]+225.0*f[18]-174.2842505793337*f[17]-225.0*f[15]+200.0*f[13]+129.9038105676658*f[10]+167.7050983124843*f[7]-129.9038105676658*f[6]+96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[0][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[0][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[0][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[0][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[0][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[0][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[0][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[0][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  // node (x)_1 
  vcutSq = -0.25*(3.872983346207417*phiWall[6]-3.872983346207417*phi[6]-4.47213595499958*phiWall[5]+4.47213595499958*phi[5]+2.23606797749979*phiWall[4]-2.23606797749979*phi[4]-3.464101615137754*phiWall[2]+3.464101615137754*phi[2]-2.0*phiWall[0]+2.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[1][0] = 0.0; 
  fReflSurfX[1][1] = 0.0; 
  fReflSurfX[1][2] = 0.0; 
  fReflSurfX[1][3] = 0.0; 
  fReflSurfX[1][4] = 0.0; 
  fReflSurfX[1][5] = 0.0; 
  fReflSurfX[1][6] = 0.0; 
  fReflSurfX[1][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[1][0] = -0.25*(3.872983346207417*f[19]+2.23606797749979*(f[11]-2.0*f[12])-2.0*(1.732050807568877*f[2]+f[0])); 
  fReflSurfX[1][1] = -0.08333333333333333*(1.732050807568877*(6.708203932499369*f[32]+3.872983346207417*(f[21]-2.0*f[22]))-2.0*(5.196152422706631*f[7]+3.0*f[3])); 
  fReflSurfX[1][2] = -0.08333333333333333*(1.732050807568877*(6.708203932499369*f[35]+3.872983346207417*(f[25]-2.0*f[26]))-2.0*(5.196152422706631*f[9]+3.0*f[4])); 
  fReflSurfX[1][3] = -0.25*(3.872983346207417*f[44]+2.23606797749979*(f[37]-2.0*f[38])-2.0*(1.732050807568877*f[18]+f[10])); 
  fReflSurfX[1][4] = 0.1*(8.660254037844387*f[24]+5.0*f[13]); 
  fReflSurfX[1][5] = 0.1*(8.660254037844387*f[29]+5.0*f[14]); 
  fReflSurfX[1][6] = 0.1*(8.660254037844387*f[40]+5.0*f[27]); 
  fReflSurfX[1][7] = 0.1*(8.660254037844387*f[43]+5.0*f[30]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.003952847075210471*((116.1895003862225*f[40]+67.08203932499369*f[27]-86.60254037844389*f[24]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])-60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]+75.0*f[32]-34.64101615137755*f[30]-86.60254037844389*f[22]+43.30127018922195*f[21]+90.0*f[18]+51.96152422706631*f[10]-67.0820393249937*f[7]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]-69.2820323027551*f[29]-67.08203932499369*f[27]+134.1640786499874*f[26]-67.08203932499369*f[25]+86.60254037844389*f[24]+86.60254037844389*f[19]-40.0*f[14]+50.0*f[13]-100.0*f[12]+50.0*f[11]+103.9230484541326*f[9]+60.0*f[4]-77.45966692414835*f[2]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]-116.1895003862225*f[35]-75.0*f[32]+34.64101615137755*f[30]-69.2820323027551*f[29]+134.1640786499874*f[26]-67.08203932499369*f[25]+86.60254037844389*f[22]-43.30127018922195*f[21]+86.60254037844389*f[19]-90.0*f[18]-40.0*f[14]-100.0*f[12]+50.0*f[11]-51.96152422706631*f[10]+103.9230484541326*f[9]+67.0820393249937*f[7]+60.0*f[4]+38.72983346207418*f[3]-77.45966692414835*f[2]-44.7213595499958*f[0]); 
  fReflSurfXMu[0][1] = -0.001473139127471973*((405.0*f[40]+233.8268590217985*f[27]-301.8691769624715*f[24]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])-185.903200617956*f[43]+360.0*f[38]-180.0*f[37]+232.379000772445*f[32]-107.3312629199899*f[30]-268.3281572999747*f[22]+134.1640786499874*f[21]+278.8548009269339*f[18]+160.9968943799849*f[10]-207.8460969082653*f[7]-120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]-160.9968943799848*f[29]-155.884572681199*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]+201.246117974981*f[24]+201.246117974981*f[19]-92.951600308978*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+241.4953415699773*f[9]+139.427400463467*f[4]-180.0*f[2]-103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[44]-185.903200617956*f[43]-135.0*f[40]+360.0*f[38]-180.0*f[37]+270.0*f[35]+232.379000772445*f[32]-107.3312629199899*f[30]+160.9968943799848*f[29]-77.94228634059948*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]+100.6230589874905*f[24]-268.3281572999747*f[22]+134.1640786499874*f[21]-201.246117974981*f[19]+278.8548009269339*f[18]+92.951600308978*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+160.9968943799849*f[10]-241.4953415699773*f[9]-207.8460969082653*f[7]-139.427400463467*f[4]-120.0*f[3]+180.0*f[2]+103.9230484541326*f[0]); 
  fReflSurfXMu[0][2] = -0.002209708691207959*((418.2822013904009*f[40]+241.4953415699772*f[27]-311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])-180.0*f[43]+348.5685011586675*f[38]-174.2842505793337*f[37]+225.0*f[32]-103.9230484541326*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+270.0*f[18]+155.8845726811989*f[10]-201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]-138.5640646055102*f[29]-268.3281572999747*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]+346.4101615137756*f[24]+173.2050807568878*f[19]-80.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+207.8460969082653*f[9]+120.0*f[4]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]+120.0*f[43]-232.379000772445*f[38]+116.1895003862225*f[37]-150.0*f[32]+69.2820323027551*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-180.0*f[18]-103.9230484541326*f[10]+134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]+138.5640646055102*f[29]+134.1640786499874*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]-173.2050807568878*f[24]-173.2050807568878*f[19]+80.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-207.8460969082653*f[9]-120.0*f[4]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]+185.903200617956*f[40]-116.1895003862225*f[38]+58.09475019311126*f[37]-75.0*f[32]+34.64101615137755*f[30]+107.3312629199899*f[27]-138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]-90.0*f[18]-80.0*f[13]-51.96152422706631*f[10]+67.0820393249937*f[7]+38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.003952847075210471*((116.1895003862225*f[40]+67.08203932499369*f[27]-86.60254037844389*f[24]-50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])-60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]+75.0*f[32]-34.64101615137755*f[30]-86.60254037844389*f[22]+43.30127018922195*f[21]+90.0*f[18]+51.96152422706631*f[10]-67.0820393249937*f[7]-38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]-69.2820323027551*f[29]-67.08203932499369*f[27]+134.1640786499874*f[26]-67.08203932499369*f[25]+86.60254037844389*f[24]+86.60254037844389*f[19]-40.0*f[14]+50.0*f[13]-100.0*f[12]+50.0*f[11]+103.9230484541326*f[9]+60.0*f[4]-77.45966692414835*f[2]-44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]+116.1895003862225*f[35]-75.0*f[32]+34.64101615137755*f[30]+69.2820323027551*f[29]-134.1640786499874*f[26]+67.08203932499369*f[25]+86.60254037844389*f[22]-43.30127018922195*f[21]-86.60254037844389*f[19]-90.0*f[18]+40.0*f[14]+100.0*f[12]-50.0*f[11]-51.96152422706631*f[10]-103.9230484541326*f[9]+67.0820393249937*f[7]-60.0*f[4]+38.72983346207418*f[3]+77.45966692414835*f[2]+44.7213595499958*f[0]); 
  fReflSurfXMu[0][1] = 0.001473139127471973*((405.0*f[40]+233.8268590217985*f[27]-301.8691769624715*f[24]-174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])-185.903200617956*f[43]+360.0*f[38]-180.0*f[37]+232.379000772445*f[32]-107.3312629199899*f[30]-268.3281572999747*f[22]+134.1640786499874*f[21]+278.8548009269339*f[18]+160.9968943799849*f[10]-207.8460969082653*f[7]-120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]-160.9968943799848*f[29]-155.884572681199*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]+201.246117974981*f[24]+201.246117974981*f[19]-92.951600308978*f[14]+116.1895003862225*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+241.4953415699773*f[9]+139.427400463467*f[4]-180.0*f[2]-103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[44]+185.903200617956*f[43]-135.0*f[40]-360.0*f[38]+180.0*f[37]+270.0*f[35]-232.379000772445*f[32]+107.3312629199899*f[30]+160.9968943799848*f[29]-77.94228634059948*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]+100.6230589874905*f[24]+268.3281572999747*f[22]-134.1640786499874*f[21]-201.246117974981*f[19]-278.8548009269339*f[18]+92.951600308978*f[14]+58.09475019311126*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]-160.9968943799849*f[10]-241.4953415699773*f[9]+207.8460969082653*f[7]-139.427400463467*f[4]+120.0*f[3]+180.0*f[2]+103.9230484541326*f[0]); 
  fReflSurfXMu[0][2] = 0.002209708691207959*((418.2822013904009*f[40]+241.4953415699772*f[27]-311.7691453623979*f[24]-180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])-180.0*f[43]+348.5685011586675*f[38]-174.2842505793337*f[37]+225.0*f[32]-103.9230484541326*f[30]-259.8076211353317*f[22]+129.9038105676658*f[21]+270.0*f[18]+155.8845726811989*f[10]-201.2461179749811*f[7]-116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]-138.5640646055102*f[29]-268.3281572999747*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]+346.4101615137756*f[24]+173.2050807568878*f[19]-80.0*f[14]+200.0*f[13]-200.0*f[12]+100.0*f[11]+207.8460969082653*f[9]+120.0*f[4]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]+120.0*f[43]-232.379000772445*f[38]+116.1895003862225*f[37]-150.0*f[32]+69.2820323027551*f[30]+173.2050807568878*f[22]-86.60254037844389*f[21]-180.0*f[18]-103.9230484541326*f[10]+134.1640786499874*f[7]+77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]+138.5640646055102*f[29]+134.1640786499874*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]-173.2050807568878*f[24]-173.2050807568878*f[19]+80.0*f[14]-100.0*f[13]+200.0*f[12]-100.0*f[11]-207.8460969082653*f[9]-120.0*f[4]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]+60.0*f[43]-185.903200617956*f[40]-116.1895003862225*f[38]+58.09475019311126*f[37]-75.0*f[32]+34.64101615137755*f[30]-107.3312629199899*f[27]+138.5640646055102*f[24]+86.60254037844389*f[22]-43.30127018922195*f[21]-90.0*f[18]+80.0*f[13]-51.96152422706631*f[10]+67.0820393249937*f[7]+38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.01976423537605236*((17.32050807568877*f[24]+10.0*f[13])*vcut_lR3+((-15.0*f[43])-15.0*f[32]-8.660254037844387*f[30]+17.32050807568877*f[22]-8.660254037844387*f[21]+13.41640786499874*f[7]+7.745966692414834*f[3])*vcut_lR2+((-17.32050807568877*f[29])-17.32050807568877*f[24]-17.32050807568877*f[19]-10.0*f[14]-10.0*f[13]+20.0*f[12]-10.0*f[11]+15.49193338482967*f[2]+8.94427190999916*f[0])*vcut_l+15.0*f[43]+15.0*f[32]+8.660254037844387*f[30]-17.32050807568877*f[29]-17.32050807568877*f[22]+8.660254037844387*f[21]-17.32050807568877*f[19]-10.0*f[14]+20.0*f[12]-10.0*f[11]-13.41640786499874*f[7]-7.745966692414834*f[3]+15.49193338482967*f[2]+8.94427190999916*f[0]); 
  fReflSurfXMu[1][1] = 0.007365695637359865*((60.37383539249431*f[24]+34.85685011586674*f[13])*vcut_lR4+((-46.475800154489*f[43])-46.475800154489*f[32]-26.83281572999747*f[30]+53.66563145999495*f[22]-26.83281572999747*f[21]+41.56921938165305*f[7]+24.0*f[3])*vcut_lR3+((-40.24922359499621*f[29])-40.24922359499621*f[24]-40.24922359499621*f[19]-23.2379000772445*f[14]-23.2379000772445*f[13]+46.475800154489*f[12]-23.2379000772445*f[11]+36.0*f[2]+20.78460969082652*f[0])*vcut_lR2-46.475800154489*f[43]-46.475800154489*f[32]-26.83281572999747*f[30]+40.24922359499621*f[29]-20.1246117974981*f[24]+53.66563145999495*f[22]-26.83281572999747*f[21]+40.24922359499621*f[19]+23.2379000772445*f[14]-11.61895003862225*f[13]-46.475800154489*f[12]+23.2379000772445*f[11]+41.56921938165305*f[7]+24.0*f[3]-36.0*f[2]-20.78460969082652*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-225.0*f[43])-225.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-173.2050807568878*f[29])-346.4101615137756*f[24]-173.2050807568878*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(150.0*f[43]+150.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(173.2050807568878*f[29]+173.2050807568878*f[24]+173.2050807568878*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+75.0*f[43]+75.0*f[32]+43.30127018922195*f[30]+138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]+80.0*f[13]-67.0820393249937*f[7]-38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.01976423537605236*((17.32050807568877*f[24]+10.0*f[13])*vcut_lR3+((-15.0*f[43])-15.0*f[32]-8.660254037844387*f[30]+17.32050807568877*f[22]-8.660254037844387*f[21]+13.41640786499874*f[7]+7.745966692414834*f[3])*vcut_lR2+((-17.32050807568877*f[29])-17.32050807568877*f[24]-17.32050807568877*f[19]-10.0*f[14]-10.0*f[13]+20.0*f[12]-10.0*f[11]+15.49193338482967*f[2]+8.94427190999916*f[0])*vcut_l+15.0*f[43]+15.0*f[32]+8.660254037844387*f[30]+17.32050807568877*f[29]-17.32050807568877*f[22]+8.660254037844387*f[21]+17.32050807568877*f[19]+10.0*f[14]-20.0*f[12]+10.0*f[11]-13.41640786499874*f[7]-7.745966692414834*f[3]-15.49193338482967*f[2]-8.94427190999916*f[0]); 
  fReflSurfXMu[1][1] = -0.007365695637359865*((60.37383539249431*f[24]+34.85685011586674*f[13])*vcut_lR4+((-46.475800154489*f[43])-46.475800154489*f[32]-26.83281572999747*f[30]+53.66563145999495*f[22]-26.83281572999747*f[21]+41.56921938165305*f[7]+24.0*f[3])*vcut_lR3+((-40.24922359499621*f[29])-40.24922359499621*f[24]-40.24922359499621*f[19]-23.2379000772445*f[14]-23.2379000772445*f[13]+46.475800154489*f[12]-23.2379000772445*f[11]+36.0*f[2]+20.78460969082652*f[0])*vcut_lR2+46.475800154489*f[43]+46.475800154489*f[32]+26.83281572999747*f[30]+40.24922359499621*f[29]-20.1246117974981*f[24]-53.66563145999495*f[22]+26.83281572999747*f[21]+40.24922359499621*f[19]+23.2379000772445*f[14]-11.61895003862225*f[13]-46.475800154489*f[12]+23.2379000772445*f[11]-41.56921938165305*f[7]-24.0*f[3]-36.0*f[2]-20.78460969082652*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-225.0*f[43])-225.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-173.2050807568878*f[29])-346.4101615137756*f[24]-173.2050807568878*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(150.0*f[43]+150.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(173.2050807568878*f[29]+173.2050807568878*f[24]+173.2050807568878*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+75.0*f[43]+75.0*f[32]+43.30127018922195*f[30]-138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]-80.0*f[13]-67.0820393249937*f[7]-38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.003952847075210471*((116.1895003862225*f[40]+67.08203932499369*f[27]+86.60254037844389*f[24]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])+60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]-75.0*f[32]+34.64101615137755*f[30]+86.60254037844389*f[22]-43.30127018922195*f[21]+90.0*f[18]+51.96152422706631*f[10]+67.0820393249937*f[7]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]+69.2820323027551*f[29]-67.08203932499369*f[27]+134.1640786499874*f[26]-67.08203932499369*f[25]-86.60254037844389*f[24]-86.60254037844389*f[19]+40.0*f[14]-50.0*f[13]+100.0*f[12]-50.0*f[11]+103.9230484541326*f[9]+60.0*f[4]+77.45966692414835*f[2]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]-116.1895003862225*f[35]+75.0*f[32]-34.64101615137755*f[30]+69.2820323027551*f[29]+134.1640786499874*f[26]-67.08203932499369*f[25]-86.60254037844389*f[22]+43.30127018922195*f[21]-86.60254037844389*f[19]-90.0*f[18]+40.0*f[14]+100.0*f[12]-50.0*f[11]-51.96152422706631*f[10]+103.9230484541326*f[9]-67.0820393249937*f[7]+60.0*f[4]-38.72983346207418*f[3]+77.45966692414835*f[2]+44.7213595499958*f[0]); 
  fReflSurfXMu[2][1] = 0.001473139127471973*((405.0*f[40]+233.8268590217985*f[27]+301.8691769624715*f[24]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])+185.903200617956*f[43]+360.0*f[38]-180.0*f[37]-232.379000772445*f[32]+107.3312629199899*f[30]+268.3281572999747*f[22]-134.1640786499874*f[21]+278.8548009269339*f[18]+160.9968943799849*f[10]+207.8460969082653*f[7]+120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]+160.9968943799848*f[29]-155.884572681199*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]-201.246117974981*f[24]-201.246117974981*f[19]+92.951600308978*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+241.4953415699773*f[9]+139.427400463467*f[4]+180.0*f[2]+103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[44]+185.903200617956*f[43]-135.0*f[40]+360.0*f[38]-180.0*f[37]+270.0*f[35]-232.379000772445*f[32]+107.3312629199899*f[30]-160.9968943799848*f[29]-77.94228634059948*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]-100.6230589874905*f[24]+268.3281572999747*f[22]-134.1640786499874*f[21]+201.246117974981*f[19]+278.8548009269339*f[18]-92.951600308978*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]+160.9968943799849*f[10]-241.4953415699773*f[9]+207.8460969082653*f[7]-139.427400463467*f[4]+120.0*f[3]-180.0*f[2]-103.9230484541326*f[0]); 
  fReflSurfXMu[2][2] = 0.002209708691207959*((418.2822013904009*f[40]+241.4953415699772*f[27]+311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])+180.0*f[43]+348.5685011586675*f[38]-174.2842505793337*f[37]-225.0*f[32]+103.9230484541326*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+270.0*f[18]+155.8845726811989*f[10]+201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]+138.5640646055102*f[29]-268.3281572999747*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]-346.4101615137756*f[24]-173.2050807568878*f[19]+80.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+207.8460969082653*f[9]+120.0*f[4]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]-120.0*f[43]-232.379000772445*f[38]+116.1895003862225*f[37]+150.0*f[32]-69.2820323027551*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-180.0*f[18]-103.9230484541326*f[10]-134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]-138.5640646055102*f[29]+134.1640786499874*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]+173.2050807568878*f[24]+173.2050807568878*f[19]-80.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-207.8460969082653*f[9]-120.0*f[4]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]+185.903200617956*f[40]-116.1895003862225*f[38]+58.09475019311126*f[37]+75.0*f[32]-34.64101615137755*f[30]+107.3312629199899*f[27]+138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]-90.0*f[18]+80.0*f[13]-51.96152422706631*f[10]-67.0820393249937*f[7]-38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.003952847075210471*((116.1895003862225*f[40]+67.08203932499369*f[27]+86.60254037844389*f[24]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[44])+60.0*f[43]+116.1895003862225*f[38]-58.09475019311126*f[37]-75.0*f[32]+34.64101615137755*f[30]+86.60254037844389*f[22]-43.30127018922195*f[21]+90.0*f[18]+51.96152422706631*f[10]+67.0820393249937*f[7]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[40])-116.1895003862225*f[35]+69.2820323027551*f[29]-67.08203932499369*f[27]+134.1640786499874*f[26]-67.08203932499369*f[25]-86.60254037844389*f[24]-86.60254037844389*f[19]+40.0*f[14]-50.0*f[13]+100.0*f[12]-50.0*f[11]+103.9230484541326*f[9]+60.0*f[4]+77.45966692414835*f[2]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]-116.1895003862225*f[38]+58.09475019311126*f[37]+116.1895003862225*f[35]+75.0*f[32]-34.64101615137755*f[30]-69.2820323027551*f[29]-134.1640786499874*f[26]+67.08203932499369*f[25]-86.60254037844389*f[22]+43.30127018922195*f[21]+86.60254037844389*f[19]-90.0*f[18]-40.0*f[14]-100.0*f[12]+50.0*f[11]-51.96152422706631*f[10]-103.9230484541326*f[9]-67.0820393249937*f[7]-60.0*f[4]-38.72983346207418*f[3]-77.45966692414835*f[2]-44.7213595499958*f[0]); 
  fReflSurfXMu[2][1] = -0.001473139127471973*((405.0*f[40]+233.8268590217985*f[27]+301.8691769624715*f[24]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[44])+185.903200617956*f[43]+360.0*f[38]-180.0*f[37]-232.379000772445*f[32]+107.3312629199899*f[30]+268.3281572999747*f[22]-134.1640786499874*f[21]+278.8548009269339*f[18]+160.9968943799849*f[10]+207.8460969082653*f[7]+120.0*f[3])*vcut_lR3+((-270.0*f[40])-270.0*f[35]+160.9968943799848*f[29]-155.884572681199*f[27]+311.7691453623979*f[26]-155.884572681199*f[25]-201.246117974981*f[24]-201.246117974981*f[19]+92.951600308978*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]-116.1895003862225*f[11]+241.4953415699773*f[9]+139.427400463467*f[4]+180.0*f[2]+103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[44]-185.903200617956*f[43]-135.0*f[40]-360.0*f[38]+180.0*f[37]+270.0*f[35]+232.379000772445*f[32]-107.3312629199899*f[30]-160.9968943799848*f[29]-77.94228634059948*f[27]-311.7691453623979*f[26]+155.884572681199*f[25]-100.6230589874905*f[24]-268.3281572999747*f[22]+134.1640786499874*f[21]+201.246117974981*f[19]-278.8548009269339*f[18]-92.951600308978*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]+116.1895003862225*f[11]-160.9968943799849*f[10]-241.4953415699773*f[9]-207.8460969082653*f[7]-139.427400463467*f[4]-120.0*f[3]-180.0*f[2]-103.9230484541326*f[0]); 
  fReflSurfXMu[2][2] = -0.002209708691207959*((418.2822013904009*f[40]+241.4953415699772*f[27]+311.7691453623979*f[24]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[44])+180.0*f[43]+348.5685011586675*f[38]-174.2842505793337*f[37]-225.0*f[32]+103.9230484541326*f[30]+259.8076211353317*f[22]-129.9038105676658*f[21]+270.0*f[18]+155.8845726811989*f[10]+201.2461179749811*f[7]+116.1895003862225*f[3])*vcut_lR4+((-464.7580015448901*f[40])-232.379000772445*f[35]+138.5640646055102*f[29]-268.3281572999747*f[27]+268.3281572999747*f[26]-134.1640786499874*f[25]-346.4101615137756*f[24]-173.2050807568878*f[19]+80.0*f[14]-200.0*f[13]+200.0*f[12]-100.0*f[11]+207.8460969082653*f[9]+120.0*f[4]+154.9193338482967*f[2]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[44]-120.0*f[43]-232.379000772445*f[38]+116.1895003862225*f[37]+150.0*f[32]-69.2820323027551*f[30]-173.2050807568878*f[22]+86.60254037844389*f[21]-180.0*f[18]-103.9230484541326*f[10]-134.1640786499874*f[7]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[40]+232.379000772445*f[35]-138.5640646055102*f[29]+134.1640786499874*f[27]-268.3281572999747*f[26]+134.1640786499874*f[25]+173.2050807568878*f[24]+173.2050807568878*f[19]-80.0*f[14]+100.0*f[13]-200.0*f[12]+100.0*f[11]-207.8460969082653*f[9]-120.0*f[4]-154.9193338482967*f[2]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[44]-60.0*f[43]-185.903200617956*f[40]-116.1895003862225*f[38]+58.09475019311126*f[37]+75.0*f[32]-34.64101615137755*f[30]-107.3312629199899*f[27]-138.5640646055102*f[24]-86.60254037844389*f[22]+43.30127018922195*f[21]-90.0*f[18]-80.0*f[13]-51.96152422706631*f[10]-67.0820393249937*f[7]-38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[1][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[1][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[1][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[1][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[1][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[1][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[1][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[1][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  // node (x)_2 
  vcutSq = 0.1*(15.0*phiWall[7]-15.0*phi[7]+7.745966692414834*phiWall[6]-7.745966692414834*phi[6]+11.18033988749895*phiWall[5]-11.18033988749895*phi[5]+4.47213595499958*phiWall[4]-4.47213595499958*phi[4]+11.61895003862225*phiWall[3]-11.61895003862225*phi[3]+8.660254037844386*phiWall[2]-8.660254037844386*phi[2]+6.708203932499369*phiWall[1]-6.708203932499369*phi[1]+5.0*phiWall[0]-5.0*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfX[2][0] = 0.0; 
  fReflSurfX[2][1] = 0.0; 
  fReflSurfX[2][2] = 0.0; 
  fReflSurfX[2][3] = 0.0; 
  fReflSurfX[2][4] = 0.0; 
  fReflSurfX[2][5] = 0.0; 
  fReflSurfX[2][6] = 0.0; 
  fReflSurfX[2][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfX[2][0] = 0.1*(3.872983346207417*(3.872983346207417*f[20]+2.0*f[19])+2.23606797749979*(5.0*f[12]+2.0*f[11])+1.732050807568877*(6.708203932499369*f[5]+5.0*f[2])+6.708203932499369*f[1]+5.0*f[0]); 
  fReflSurfX[2][1] = 0.03333333333333333*(45.0*f[33]+1.732050807568877*(13.41640786499874*f[32]+3.872983346207417*(5.0*f[22]+2.0*f[21])+3.0*(6.708203932499369*f[15]+5.0*f[7]))+3.0*(6.708203932499369*f[6]+5.0*f[3])); 
  fReflSurfX[2][2] = 0.03333333333333333*(45.0*f[36]+1.732050807568877*(13.41640786499874*f[35]+3.872983346207417*(5.0*f[26]+2.0*f[25])+3.0*(6.708203932499369*f[16]+5.0*f[9]))+3.0*(6.708203932499369*f[8]+5.0*f[4])); 
  fReflSurfX[2][3] = 0.1*(3.872983346207417*(3.872983346207417*f[45]+2.0*f[44])+2.23606797749979*(5.0*f[38]+2.0*f[37])+1.732050807568877*(6.708203932499369*f[31]+5.0*f[18])+6.708203932499369*f[17]+5.0*f[10]); 
  fReflSurfX[2][4] = 0.1*(11.61895003862225*f[34]+3.872983346207417*(2.23606797749979*f[24]+1.732050807568877*f[23])+5.0*f[13]); 
  fReflSurfX[2][5] = 0.1*(11.61895003862225*f[41]+3.872983346207417*(2.23606797749979*f[29]+1.732050807568877*f[28])+5.0*f[14]); 
  fReflSurfX[2][6] = 0.1*(11.61895003862225*f[46]+3.872983346207417*(2.23606797749979*f[40]+1.732050807568877*f[39])+5.0*f[27]); 
  fReflSurfX[2][7] = 0.1*(11.61895003862225*f[47]+3.872983346207417*(2.23606797749979*f[43]+1.732050807568877*f[42])+5.0*f[30]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXMu[3][3] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = -0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]+45.0*f[39]-58.09475019311126*f[34]+33.54101966249684*f[27]-43.30127018922195*f[24]-33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])+77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]-58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]+45.0*f[18]+34.85685011586674*f[17]-45.0*f[15]+25.98076211353316*f[10]-33.54101966249685*f[7]-25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]-58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[34]-34.64101615137755*f[29]-26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]+51.96152422706631*f[9]+40.24922359499622*f[8]-51.96152422706631*f[5]+30.0*f[4]-38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]-46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]+90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]-34.64101615137755*f[29]-26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]-67.08203932499369*f[20]-34.64101615137755*f[19]-45.0*f[18]-34.85685011586674*f[17]+69.71370023173348*f[16]+45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]-25.98076211353316*f[10]+51.96152422706631*f[9]+40.24922359499622*f[8]+33.54101966249685*f[7]+25.98076211353316*f[6]-51.96152422706631*f[5]+30.0*f[4]+19.36491673103709*f[3]-38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = -2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]+1568.558255214003*f[39]-2025.0*f[34]+1169.134295108993*f[27]-1509.345884812358*f[24]-1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])+2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1800.0*f[38]+720.0*f[37]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]+1394.27400463467*f[18]+1080.0*f[17]-1394.27400463467*f[15]+804.9844718999244*f[10]-1039.230484541326*f[7]-804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]-1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]+1080.0*f[35]+1350.0*f[34]-804.9844718999242*f[29]-623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+1207.476707849887*f[9]+935.3074360871933*f[8]-1207.476707849887*f[5]+697.1370023173349*f[4]-900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1080.0*f[41]-675.0*f[40]-522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]-2091.411006952005*f[36]-1080.0*f[35]+675.0*f[34]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]+804.9844718999242*f[29]+623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+503.1152949374526*f[24]+389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]+1558.84572681199*f[20]+804.9844718999242*f[19]+1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+804.9844718999244*f[10]-1207.476707849887*f[9]-935.3074360871933*f[8]-1039.230484541326*f[7]-804.9844718999244*f[6]+1207.476707849887*f[5]-697.1370023173349*f[4]-600.0*f[3]+900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = -8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]+810.0*f[39]-1045.705503476002*f[34]+603.738353924943*f[27]-779.4228634059949*f[24]-603.738353924943*f[23]-450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])+1169.134295108993*f[45]+603.738353924943*f[44]-450.0*f[43]-348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]-871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]+675.0*f[18]+522.8527517380012*f[17]-675.0*f[15]+389.7114317029973*f[10]-503.1152949374528*f[7]-389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]-1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]+464.7580015448901*f[35]+1161.895003862225*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]-779.4228634059949*f[45]-402.4922359499621*f[44]+300.0*f[43]+232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]+580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]-450.0*f[18]-348.5685011586675*f[17]+450.0*f[15]-259.8076211353315*f[10]+335.4101966249685*f[7]+259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]+580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]-464.7580015448901*f[35]-580.9475019311126*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_l+201.246117974981*f[47]+623.5382907247958*f[46]-389.7114317029975*f[45]-201.246117974981*f[44]+150.0*f[43]+116.1895003862225*f[42]+464.7580015448901*f[40]+360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]-464.7580015448901*f[34]+290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]+268.3281572999747*f[27]-346.4101615137756*f[24]-268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]-225.0*f[18]-174.2842505793337*f[17]+225.0*f[15]-200.0*f[13]-129.9038105676658*f[10]+167.7050983124843*f[7]+129.9038105676658*f[6]+96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[0][0] = 0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]+45.0*f[39]-58.09475019311126*f[34]+33.54101966249684*f[27]-43.30127018922195*f[24]-33.54101966249684*f[23]-25.0*f[13])*vcut_lR3+((-40.24922359499621*f[47])+77.94228634059948*f[45]+40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]-58.09475019311126*f[33]-30.0*f[32]+60.37383539249433*f[31]-17.32050807568877*f[30]-43.30127018922195*f[22]-17.32050807568877*f[21]+45.0*f[18]+34.85685011586674*f[17]-45.0*f[15]+25.98076211353316*f[10]-33.54101966249685*f[7]-25.98076211353316*f[6]-19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])-46.475800154489*f[41]-58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]+46.475800154489*f[35]+58.09475019311126*f[34]-34.64101615137755*f[29]-26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]+43.30127018922195*f[24]+33.54101966249684*f[23]-67.08203932499369*f[20]-34.64101615137755*f[19]+69.71370023173348*f[16]-20.0*f[14]+25.0*f[13]-50.0*f[12]-20.0*f[11]+51.96152422706631*f[9]+40.24922359499622*f[8]-51.96152422706631*f[5]+30.0*f[4]-38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0])*vcut_l+40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]-90.0*f[36]-46.475800154489*f[35]+58.09475019311126*f[33]+30.0*f[32]-60.37383539249433*f[31]+17.32050807568877*f[30]+34.64101615137755*f[29]+26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]+43.30127018922195*f[22]+17.32050807568877*f[21]+67.08203932499369*f[20]+34.64101615137755*f[19]-45.0*f[18]-34.85685011586674*f[17]-69.71370023173348*f[16]+45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]-25.98076211353316*f[10]-51.96152422706631*f[9]-40.24922359499622*f[8]+33.54101966249685*f[7]+25.98076211353316*f[6]+51.96152422706631*f[5]-30.0*f[4]+19.36491673103709*f[3]+38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[0][1] = 2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]+1568.558255214003*f[39]-2025.0*f[34]+1169.134295108993*f[27]-1509.345884812358*f[24]-1169.134295108993*f[23]-871.4212528966688*f[13])*vcut_lR4+((-1247.076581449592*f[47])+2414.953415699772*f[45]+1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]+1800.0*f[38]+720.0*f[37]-1800.0*f[33]-929.5160030897802*f[32]+1870.614872174387*f[31]-536.6563145999495*f[30]-1341.640786499874*f[22]-536.6563145999495*f[21]+1394.27400463467*f[18]+1080.0*f[17]-1394.27400463467*f[15]+804.9844718999244*f[10]-1039.230484541326*f[7]-804.9844718999244*f[6]-600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])-1080.0*f[41]-1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]+1080.0*f[35]+1350.0*f[34]-804.9844718999242*f[29]-623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]+1006.230589874905*f[24]+779.4228634059949*f[23]-1558.84572681199*f[20]-804.9844718999242*f[19]+1620.0*f[16]-464.7580015448901*f[14]+580.9475019311126*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+1207.476707849887*f[9]+935.3074360871933*f[8]-1207.476707849887*f[5]+697.1370023173349*f[4]-900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]-1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1080.0*f[41]-675.0*f[40]-522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]-2091.411006952005*f[36]-1080.0*f[35]+675.0*f[34]+1800.0*f[33]+929.5160030897802*f[32]-1870.614872174387*f[31]+536.6563145999495*f[30]+804.9844718999242*f[29]+623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]+503.1152949374526*f[24]+389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]+1558.84572681199*f[20]+804.9844718999242*f[19]-1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]+464.7580015448901*f[14]+290.4737509655563*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]-804.9844718999244*f[10]-1207.476707849887*f[9]-935.3074360871933*f[8]+1039.230484541326*f[7]+804.9844718999244*f[6]+1207.476707849887*f[5]-697.1370023173349*f[4]+600.0*f[3]+900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0]); 
  fReflSurfXMu[0][2] = 8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]+810.0*f[39]-1045.705503476002*f[34]+603.738353924943*f[27]-779.4228634059949*f[24]-603.738353924943*f[23]-450.0*f[13])*vcut_lR5+((-603.738353924943*f[47])+1169.134295108993*f[45]+603.738353924943*f[44]-450.0*f[43]-348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]-871.4212528966688*f[33]-450.0*f[32]+905.607530887415*f[31]-259.8076211353317*f[30]-649.5190528383291*f[22]-259.8076211353317*f[21]+675.0*f[18]+522.8527517380012*f[17]-675.0*f[15]+389.7114317029973*f[10]-503.1152949374528*f[7]-389.7114317029973*f[6]-290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])-464.7580015448901*f[41]-1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]+464.7580015448901*f[35]+1161.895003862225*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]+866.0254037844389*f[24]+670.820393249937*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]+697.1370023173349*f[16]-200.0*f[14]+500.0*f[13]-500.0*f[12]-200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]-519.6152422706631*f[5]+300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_lR3+(402.4922359499621*f[47]-779.4228634059949*f[45]-402.4922359499621*f[44]+300.0*f[43]+232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]+580.9475019311126*f[33]+300.0*f[32]-603.7383539249433*f[31]+173.2050807568878*f[30]+433.0127018922195*f[22]+173.2050807568878*f[21]-450.0*f[18]-348.5685011586675*f[17]+450.0*f[15]-259.8076211353315*f[10]+335.4101966249685*f[7]+259.8076211353315*f[6]+193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]+464.7580015448901*f[41]+580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]-464.7580015448901*f[35]-580.9475019311126*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]-433.0127018922195*f[24]-335.4101966249685*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]-697.1370023173349*f[16]+200.0*f[14]-250.0*f[13]+500.0*f[12]+200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]+519.6152422706631*f[5]-300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_l+201.246117974981*f[47]-623.5382907247958*f[46]-389.7114317029975*f[45]-201.246117974981*f[44]+150.0*f[43]+116.1895003862225*f[42]-464.7580015448901*f[40]-360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]+464.7580015448901*f[34]+290.4737509655563*f[33]+150.0*f[32]-301.8691769624717*f[31]+86.60254037844389*f[30]-268.3281572999747*f[27]+346.4101615137756*f[24]+268.3281572999747*f[23]+216.5063509461097*f[22]+86.60254037844389*f[21]-225.0*f[18]-174.2842505793337*f[17]+225.0*f[15]+200.0*f[13]-129.9038105676658*f[10]+167.7050983124843*f[7]+129.9038105676658*f[6]+96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[0][1])/fReflSurfXMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[0][2]+5.0*fReflSurfXMu[0][0]))/fReflSurfXMu[0][0];
  if (fReflSurfXMu[0][0]<0.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[0][0] = 0.0; 
  fReflSurfXMu[0][1] = 0.0; 
  fReflSurfXMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = 0.003952847075210471*((116.1895003862225*f[34]+86.60254037844389*f[24]+67.08203932499369*f[23]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])-75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[22]+34.64101615137755*f[21]+90.0*f[15]+67.0820393249937*f[7]+51.96152422706631*f[6]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]-86.60254037844389*f[29]-67.08203932499369*f[28]-86.60254037844389*f[24]-67.08203932499369*f[23]+134.1640786499874*f[20]+69.2820323027551*f[19]-50.0*f[14]-50.0*f[13]+100.0*f[12]+40.0*f[11]+103.9230484541326*f[5]+77.45966692414835*f[2]+60.0*f[1]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]+58.09475019311126*f[42]-116.1895003862225*f[41]-116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]-86.60254037844389*f[29]-67.08203932499369*f[28]-86.60254037844389*f[22]-34.64101615137755*f[21]+134.1640786499874*f[20]+69.2820323027551*f[19]-90.0*f[15]-50.0*f[14]+100.0*f[12]+40.0*f[11]-67.0820393249937*f[7]-51.96152422706631*f[6]+103.9230484541326*f[5]-38.72983346207418*f[3]+77.45966692414835*f[2]+60.0*f[1]+44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = 0.001473139127471973*((405.0*f[34]+301.8691769624715*f[24]+233.8268590217985*f[23]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])-232.379000772445*f[43]-180.0*f[42]+360.0*f[33]+185.903200617956*f[32]-134.1640786499874*f[30]+268.3281572999747*f[22]+107.3312629199899*f[21]+278.8548009269339*f[15]+207.8460969082653*f[7]+160.9968943799849*f[6]+120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]-201.246117974981*f[29]-155.884572681199*f[28]-201.246117974981*f[24]-155.884572681199*f[23]+311.7691453623979*f[20]+160.9968943799848*f[19]-116.1895003862225*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+241.4953415699773*f[5]+180.0*f[2]+139.427400463467*f[1]+103.9230484541326*f[0])*vcut_lR2-311.7691453623979*f[47]-232.379000772445*f[43]-180.0*f[42]+270.0*f[41]-135.0*f[34]+360.0*f[33]+185.903200617956*f[32]-134.1640786499874*f[30]+201.246117974981*f[29]+155.884572681199*f[28]-100.6230589874905*f[24]-77.94228634059948*f[23]+268.3281572999747*f[22]+107.3312629199899*f[21]-311.7691453623979*f[20]-160.9968943799848*f[19]+278.8548009269339*f[15]+116.1895003862225*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]-92.951600308978*f[11]+207.8460969082653*f[7]+160.9968943799849*f[6]-241.4953415699773*f[5]+120.0*f[3]-180.0*f[2]-139.427400463467*f[1]-103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = 0.002209708691207959*((418.2822013904009*f[34]+311.7691453623979*f[24]+241.4953415699772*f[23]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])-225.0*f[43]-174.2842505793337*f[42]+348.5685011586675*f[33]+180.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]+103.9230484541326*f[21]+270.0*f[15]+201.2461179749811*f[7]+155.8845726811989*f[6]+116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]-173.2050807568878*f[29]-134.1640786499874*f[28]-346.4101615137756*f[24]-268.3281572999747*f[23]+268.3281572999747*f[20]+138.5640646055102*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]+80.0*f[11]+207.8460969082653*f[5]+154.9193338482967*f[2]+120.0*f[1]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]+150.0*f[43]+116.1895003862225*f[42]-232.379000772445*f[33]-120.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]-69.2820323027551*f[21]-180.0*f[15]-134.1640786499874*f[7]-103.9230484541326*f[6]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]+173.2050807568878*f[29]+134.1640786499874*f[28]+173.2050807568878*f[24]+134.1640786499874*f[23]-268.3281572999747*f[20]-138.5640646055102*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]-80.0*f[11]-207.8460969082653*f[5]-154.9193338482967*f[2]-120.0*f[1]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]+58.09475019311126*f[42]+185.903200617956*f[34]-116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]+138.5640646055102*f[24]+107.3312629199899*f[23]-86.60254037844389*f[22]-34.64101615137755*f[21]-90.0*f[15]+80.0*f[13]-67.0820393249937*f[7]-51.96152422706631*f[6]-38.72983346207418*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[1][0] = -0.003952847075210471*((116.1895003862225*f[34]+86.60254037844389*f[24]+67.08203932499369*f[23]+50.0*f[13])*vcut_lR3+((-100.6230589874905*f[47])-75.0*f[43]-58.09475019311126*f[42]+116.1895003862225*f[33]+60.0*f[32]-43.30127018922195*f[30]+86.60254037844389*f[22]+34.64101615137755*f[21]+90.0*f[15]+67.0820393249937*f[7]+51.96152422706631*f[6]+38.72983346207418*f[3])*vcut_lR2+((-116.1895003862225*f[41])-116.1895003862225*f[34]-86.60254037844389*f[29]-67.08203932499369*f[28]-86.60254037844389*f[24]-67.08203932499369*f[23]+134.1640786499874*f[20]+69.2820323027551*f[19]-50.0*f[14]-50.0*f[13]+100.0*f[12]+40.0*f[11]+103.9230484541326*f[5]+77.45966692414835*f[2]+60.0*f[1]+44.7213595499958*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]+58.09475019311126*f[42]+116.1895003862225*f[41]-116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]+86.60254037844389*f[29]+67.08203932499369*f[28]-86.60254037844389*f[22]-34.64101615137755*f[21]-134.1640786499874*f[20]-69.2820323027551*f[19]-90.0*f[15]+50.0*f[14]-100.0*f[12]-40.0*f[11]-67.0820393249937*f[7]-51.96152422706631*f[6]-103.9230484541326*f[5]-38.72983346207418*f[3]-77.45966692414835*f[2]-60.0*f[1]-44.7213595499958*f[0]); 
  fReflSurfXMu[1][1] = -0.001473139127471973*((405.0*f[34]+301.8691769624715*f[24]+233.8268590217985*f[23]+174.2842505793337*f[13])*vcut_lR4+((-311.7691453623979*f[47])-232.379000772445*f[43]-180.0*f[42]+360.0*f[33]+185.903200617956*f[32]-134.1640786499874*f[30]+268.3281572999747*f[22]+107.3312629199899*f[21]+278.8548009269339*f[15]+207.8460969082653*f[7]+160.9968943799849*f[6]+120.0*f[3])*vcut_lR3+((-270.0*f[41])-270.0*f[34]-201.246117974981*f[29]-155.884572681199*f[28]-201.246117974981*f[24]-155.884572681199*f[23]+311.7691453623979*f[20]+160.9968943799848*f[19]-116.1895003862225*f[14]-116.1895003862225*f[13]+232.379000772445*f[12]+92.951600308978*f[11]+241.4953415699773*f[5]+180.0*f[2]+139.427400463467*f[1]+103.9230484541326*f[0])*vcut_lR2+311.7691453623979*f[47]+232.379000772445*f[43]+180.0*f[42]+270.0*f[41]-135.0*f[34]-360.0*f[33]-185.903200617956*f[32]+134.1640786499874*f[30]+201.246117974981*f[29]+155.884572681199*f[28]-100.6230589874905*f[24]-77.94228634059948*f[23]-268.3281572999747*f[22]-107.3312629199899*f[21]-311.7691453623979*f[20]-160.9968943799848*f[19]-278.8548009269339*f[15]+116.1895003862225*f[14]-58.09475019311126*f[13]-232.379000772445*f[12]-92.951600308978*f[11]-207.8460969082653*f[7]-160.9968943799849*f[6]-241.4953415699773*f[5]-120.0*f[3]-180.0*f[2]-139.427400463467*f[1]-103.9230484541326*f[0]); 
  fReflSurfXMu[1][2] = -0.002209708691207959*((418.2822013904009*f[34]+311.7691453623979*f[24]+241.4953415699772*f[23]+180.0*f[13])*vcut_lR5+((-301.8691769624715*f[47])-225.0*f[43]-174.2842505793337*f[42]+348.5685011586675*f[33]+180.0*f[32]-129.9038105676658*f[30]+259.8076211353317*f[22]+103.9230484541326*f[21]+270.0*f[15]+201.2461179749811*f[7]+155.8845726811989*f[6]+116.1895003862225*f[3])*vcut_lR4+((-232.379000772445*f[41])-464.7580015448901*f[34]-173.2050807568878*f[29]-134.1640786499874*f[28]-346.4101615137756*f[24]-268.3281572999747*f[23]+268.3281572999747*f[20]+138.5640646055102*f[19]-100.0*f[14]-200.0*f[13]+200.0*f[12]+80.0*f[11]+207.8460969082653*f[5]+154.9193338482967*f[2]+120.0*f[1]+89.4427190999916*f[0])*vcut_lR3+(201.246117974981*f[47]+150.0*f[43]+116.1895003862225*f[42]-232.379000772445*f[33]-120.0*f[32]+86.60254037844389*f[30]-173.2050807568878*f[22]-69.2820323027551*f[21]-180.0*f[15]-134.1640786499874*f[7]-103.9230484541326*f[6]-77.45966692414835*f[3])*vcut_lR2+(232.379000772445*f[41]+232.379000772445*f[34]+173.2050807568878*f[29]+134.1640786499874*f[28]+173.2050807568878*f[24]+134.1640786499874*f[23]-268.3281572999747*f[20]-138.5640646055102*f[19]+100.0*f[14]+100.0*f[13]-200.0*f[12]-80.0*f[11]-207.8460969082653*f[5]-154.9193338482967*f[2]-120.0*f[1]-89.4427190999916*f[0])*vcut_l+100.6230589874905*f[47]+75.0*f[43]+58.09475019311126*f[42]-185.903200617956*f[34]-116.1895003862225*f[33]-60.0*f[32]+43.30127018922195*f[30]-138.5640646055102*f[24]-107.3312629199899*f[23]-86.60254037844389*f[22]-34.64101615137755*f[21]-90.0*f[15]-80.0*f[13]-67.0820393249937*f[7]-51.96152422706631*f[6]-38.72983346207418*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[1][1])/fReflSurfXMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[1][0]))/fReflSurfXMu[1][0];
  if (fReflSurfXMu[1][0]<0.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[1][0] = 0.0; 
  fReflSurfXMu[1][1] = 0.0; 
  fReflSurfXMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = 0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]+45.0*f[39]+58.09475019311126*f[34]+33.54101966249684*f[27]+43.30127018922195*f[24]+33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]+58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]+45.0*f[18]+34.85685011586674*f[17]+45.0*f[15]+25.98076211353316*f[10]+33.54101966249685*f[7]+25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]-58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[34]+34.64101615137755*f[29]+26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]+51.96152422706631*f[9]+40.24922359499622*f[8]+51.96152422706631*f[5]+30.0*f[4]+38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]+46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]+90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]+34.64101615137755*f[29]+26.83281572999747*f[28]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]+67.08203932499369*f[20]+34.64101615137755*f[19]-45.0*f[18]-34.85685011586674*f[17]+69.71370023173348*f[16]-45.0*f[15]+20.0*f[14]+50.0*f[12]+20.0*f[11]-25.98076211353316*f[10]+51.96152422706631*f[9]+40.24922359499622*f[8]-33.54101966249685*f[7]-25.98076211353316*f[6]+51.96152422706631*f[5]+30.0*f[4]-19.36491673103709*f[3]+38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = 2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]+1568.558255214003*f[39]+2025.0*f[34]+1169.134295108993*f[27]+1509.345884812358*f[24]+1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]+2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1800.0*f[38]+720.0*f[37]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]+1394.27400463467*f[18]+1080.0*f[17]+1394.27400463467*f[15]+804.9844718999244*f[10]+1039.230484541326*f[7]+804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]-1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]+1080.0*f[35]-1350.0*f[34]+804.9844718999242*f[29]+623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+1207.476707849887*f[9]+935.3074360871933*f[8]+1207.476707849887*f[5]+697.1370023173349*f[4]+900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2+1247.076581449592*f[47]-905.6075308874144*f[46]+2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]-1080.0*f[41]-675.0*f[40]-522.8527517380012*f[39]+1800.0*f[38]+720.0*f[37]-2091.411006952005*f[36]-1080.0*f[35]-675.0*f[34]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]-804.9844718999242*f[29]-623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-503.1152949374526*f[24]-389.7114317029975*f[23]+1341.640786499874*f[22]+536.6563145999495*f[21]-1558.84572681199*f[20]-804.9844718999242*f[19]+1394.27400463467*f[18]+1080.0*f[17]-1620.0*f[16]+1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]+804.9844718999244*f[10]-1207.476707849887*f[9]-935.3074360871933*f[8]+1039.230484541326*f[7]+804.9844718999244*f[6]-1207.476707849887*f[5]-697.1370023173349*f[4]+600.0*f[3]-900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = 8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]+810.0*f[39]+1045.705503476002*f[34]+603.738353924943*f[27]+779.4228634059949*f[24]+603.738353924943*f[23]+450.0*f[13])*vcut_lR5+(603.738353924943*f[47]+1169.134295108993*f[45]+603.738353924943*f[44]+450.0*f[43]+348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]+871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]+675.0*f[18]+522.8527517380012*f[17]+675.0*f[15]+389.7114317029973*f[10]+503.1152949374528*f[7]+389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]-1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]+464.7580015448901*f[35]-1161.895003862225*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])-779.4228634059949*f[45]-402.4922359499621*f[44]-300.0*f[43]-232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]-580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]-450.0*f[18]-348.5685011586675*f[17]-450.0*f[15]-259.8076211353315*f[10]-335.4101966249685*f[7]-259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]+580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]-464.7580015448901*f[35]+580.9475019311126*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_l-201.246117974981*f[47]+623.5382907247958*f[46]-389.7114317029975*f[45]-201.246117974981*f[44]-150.0*f[43]-116.1895003862225*f[42]+464.7580015448901*f[40]+360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]+464.7580015448901*f[34]-290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]+268.3281572999747*f[27]+346.4101615137756*f[24]+268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]-225.0*f[18]-174.2842505793337*f[17]-225.0*f[15]+200.0*f[13]-129.9038105676658*f[10]-167.7050983124843*f[7]-129.9038105676658*f[6]-96.82458365518544*f[3]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXMu[2][0] = -0.007905694150420944*((77.94228634059948*f[46]+58.09475019311126*f[40]+45.0*f[39]+58.09475019311126*f[34]+33.54101966249684*f[27]+43.30127018922195*f[24]+33.54101966249684*f[23]+25.0*f[13])*vcut_lR3+(40.24922359499621*f[47]+77.94228634059948*f[45]+40.24922359499621*f[44]+30.0*f[43]+23.2379000772445*f[42]+58.09475019311126*f[38]+23.2379000772445*f[37]+58.09475019311126*f[33]+30.0*f[32]+60.37383539249433*f[31]+17.32050807568877*f[30]+43.30127018922195*f[22]+17.32050807568877*f[21]+45.0*f[18]+34.85685011586674*f[17]+45.0*f[15]+25.98076211353316*f[10]+33.54101966249685*f[7]+25.98076211353316*f[6]+19.36491673103709*f[3])*vcut_lR2+((-77.94228634059948*f[46])+46.475800154489*f[41]-58.09475019311126*f[40]-45.0*f[39]+90.0*f[36]+46.475800154489*f[35]-58.09475019311126*f[34]+34.64101615137755*f[29]+26.83281572999747*f[28]-33.54101966249684*f[27]+67.08203932499369*f[26]+26.83281572999747*f[25]-43.30127018922195*f[24]-33.54101966249684*f[23]+67.08203932499369*f[20]+34.64101615137755*f[19]+69.71370023173348*f[16]+20.0*f[14]-25.0*f[13]+50.0*f[12]+20.0*f[11]+51.96152422706631*f[9]+40.24922359499622*f[8]+51.96152422706631*f[5]+30.0*f[4]+38.72983346207418*f[2]+30.0*f[1]+22.3606797749979*f[0])*vcut_l-40.24922359499621*f[47]-77.94228634059948*f[45]-40.24922359499621*f[44]-30.0*f[43]-23.2379000772445*f[42]-46.475800154489*f[41]-58.09475019311126*f[38]-23.2379000772445*f[37]-90.0*f[36]-46.475800154489*f[35]-58.09475019311126*f[33]-30.0*f[32]-60.37383539249433*f[31]-17.32050807568877*f[30]-34.64101615137755*f[29]-26.83281572999747*f[28]-67.08203932499369*f[26]-26.83281572999747*f[25]-43.30127018922195*f[22]-17.32050807568877*f[21]-67.08203932499369*f[20]-34.64101615137755*f[19]-45.0*f[18]-34.85685011586674*f[17]-69.71370023173348*f[16]-45.0*f[15]-20.0*f[14]-50.0*f[12]-20.0*f[11]-25.98076211353316*f[10]-51.96152422706631*f[9]-40.24922359499622*f[8]-33.54101966249685*f[7]-25.98076211353316*f[6]-51.96152422706631*f[5]-30.0*f[4]-19.36491673103709*f[3]-38.72983346207418*f[2]-30.0*f[1]-22.3606797749979*f[0]); 
  fReflSurfXMu[2][1] = -2.946278254943946e-4*((2716.822592662243*f[46]+2025.0*f[40]+1568.558255214003*f[39]+2025.0*f[34]+1169.134295108993*f[27]+1509.345884812358*f[24]+1169.134295108993*f[23]+871.4212528966688*f[13])*vcut_lR4+(1247.076581449592*f[47]+2414.953415699772*f[45]+1247.076581449592*f[44]+929.5160030897802*f[43]+720.0*f[42]+1800.0*f[38]+720.0*f[37]+1800.0*f[33]+929.5160030897802*f[32]+1870.614872174387*f[31]+536.6563145999495*f[30]+1341.640786499874*f[22]+536.6563145999495*f[21]+1394.27400463467*f[18]+1080.0*f[17]+1394.27400463467*f[15]+804.9844718999244*f[10]+1039.230484541326*f[7]+804.9844718999244*f[6]+600.0*f[3])*vcut_lR3+((-1811.215061774829*f[46])+1080.0*f[41]-1350.0*f[40]-1045.705503476002*f[39]+2091.411006952005*f[36]+1080.0*f[35]-1350.0*f[34]+804.9844718999242*f[29]+623.5382907247958*f[28]-779.4228634059949*f[27]+1558.84572681199*f[26]+623.5382907247958*f[25]-1006.230589874905*f[24]-779.4228634059949*f[23]+1558.84572681199*f[20]+804.9844718999242*f[19]+1620.0*f[16]+464.7580015448901*f[14]-580.9475019311126*f[13]+1161.895003862225*f[12]+464.7580015448901*f[11]+1207.476707849887*f[9]+935.3074360871933*f[8]+1207.476707849887*f[5]+697.1370023173349*f[4]+900.0*f[2]+697.1370023173349*f[1]+519.6152422706631*f[0])*vcut_lR2-1247.076581449592*f[47]-905.6075308874144*f[46]-2414.953415699772*f[45]-1247.076581449592*f[44]-929.5160030897802*f[43]-720.0*f[42]-1080.0*f[41]-675.0*f[40]-522.8527517380012*f[39]-1800.0*f[38]-720.0*f[37]-2091.411006952005*f[36]-1080.0*f[35]-675.0*f[34]-1800.0*f[33]-929.5160030897802*f[32]-1870.614872174387*f[31]-536.6563145999495*f[30]-804.9844718999242*f[29]-623.5382907247958*f[28]-389.7114317029975*f[27]-1558.84572681199*f[26]-623.5382907247958*f[25]-503.1152949374526*f[24]-389.7114317029975*f[23]-1341.640786499874*f[22]-536.6563145999495*f[21]-1558.84572681199*f[20]-804.9844718999242*f[19]-1394.27400463467*f[18]-1080.0*f[17]-1620.0*f[16]-1394.27400463467*f[15]-464.7580015448901*f[14]-290.4737509655563*f[13]-1161.895003862225*f[12]-464.7580015448901*f[11]-804.9844718999244*f[10]-1207.476707849887*f[9]-935.3074360871933*f[8]-1039.230484541326*f[7]-804.9844718999244*f[6]-1207.476707849887*f[5]-697.1370023173349*f[4]-600.0*f[3]-900.0*f[2]-697.1370023173349*f[1]-519.6152422706631*f[0]); 
  fReflSurfXMu[2][2] = -8.838834764831837e-4*((1402.961154130791*f[46]+1045.705503476002*f[40]+810.0*f[39]+1045.705503476002*f[34]+603.738353924943*f[27]+779.4228634059949*f[24]+603.738353924943*f[23]+450.0*f[13])*vcut_lR5+(603.738353924943*f[47]+1169.134295108993*f[45]+603.738353924943*f[44]+450.0*f[43]+348.5685011586675*f[42]+871.4212528966688*f[38]+348.5685011586675*f[37]+871.4212528966688*f[33]+450.0*f[32]+905.607530887415*f[31]+259.8076211353317*f[30]+649.5190528383291*f[22]+259.8076211353317*f[21]+675.0*f[18]+522.8527517380012*f[17]+675.0*f[15]+389.7114317029973*f[10]+503.1152949374528*f[7]+389.7114317029973*f[6]+290.4737509655563*f[3])*vcut_lR4+((-1558.84572681199*f[46])+464.7580015448901*f[41]-1161.895003862225*f[40]-900.0*f[39]+900.0*f[36]+464.7580015448901*f[35]-1161.895003862225*f[34]+346.4101615137756*f[29]+268.3281572999747*f[28]-670.820393249937*f[27]+670.820393249937*f[26]+268.3281572999747*f[25]-866.0254037844389*f[24]-670.820393249937*f[23]+670.820393249937*f[20]+346.4101615137756*f[19]+697.1370023173349*f[16]+200.0*f[14]-500.0*f[13]+500.0*f[12]+200.0*f[11]+519.6152422706631*f[9]+402.4922359499622*f[8]+519.6152422706631*f[5]+300.0*f[4]+387.2983346207417*f[2]+300.0*f[1]+223.606797749979*f[0])*vcut_lR3+((-402.4922359499621*f[47])-779.4228634059949*f[45]-402.4922359499621*f[44]-300.0*f[43]-232.379000772445*f[42]-580.9475019311126*f[38]-232.379000772445*f[37]-580.9475019311126*f[33]-300.0*f[32]-603.7383539249433*f[31]-173.2050807568878*f[30]-433.0127018922195*f[22]-173.2050807568878*f[21]-450.0*f[18]-348.5685011586675*f[17]-450.0*f[15]-259.8076211353315*f[10]-335.4101966249685*f[7]-259.8076211353315*f[6]-193.6491673103709*f[3])*vcut_lR2+(779.4228634059949*f[46]-464.7580015448901*f[41]+580.9475019311126*f[40]+450.0*f[39]-900.0*f[36]-464.7580015448901*f[35]+580.9475019311126*f[34]-346.4101615137756*f[29]-268.3281572999747*f[28]+335.4101966249685*f[27]-670.820393249937*f[26]-268.3281572999747*f[25]+433.0127018922195*f[24]+335.4101966249685*f[23]-670.820393249937*f[20]-346.4101615137756*f[19]-697.1370023173349*f[16]-200.0*f[14]+250.0*f[13]-500.0*f[12]-200.0*f[11]-519.6152422706631*f[9]-402.4922359499622*f[8]-519.6152422706631*f[5]-300.0*f[4]-387.2983346207417*f[2]-300.0*f[1]-223.606797749979*f[0])*vcut_l-201.246117974981*f[47]-623.5382907247958*f[46]-389.7114317029975*f[45]-201.246117974981*f[44]-150.0*f[43]-116.1895003862225*f[42]-464.7580015448901*f[40]-360.0*f[39]-290.4737509655563*f[38]-116.1895003862225*f[37]-464.7580015448901*f[34]-290.4737509655563*f[33]-150.0*f[32]-301.8691769624717*f[31]-86.60254037844389*f[30]-268.3281572999747*f[27]-346.4101615137756*f[24]-268.3281572999747*f[23]-216.5063509461097*f[22]-86.60254037844389*f[21]-225.0*f[18]-174.2842505793337*f[17]-225.0*f[15]-200.0*f[13]-129.9038105676658*f[10]-167.7050983124843*f[7]-129.9038105676658*f[6]-96.82458365518544*f[3]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXMu[2][1])/fReflSurfXMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXMu[2][2]+5.0*fReflSurfXMu[2][0]))/fReflSurfXMu[2][0];
  if (fReflSurfXMu[2][0]<0.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXMu[2][0] = 0.0; 
  fReflSurfXMu[2][1] = 0.0; 
  fReflSurfXMu[2][2] = 0.0; 
  }

  fReflSurfX[2][0] = 0.07856742013183861*(5.0*fReflSurfXMu[2][0]+8.0*fReflSurfXMu[1][0]+5.0*fReflSurfXMu[0][0]); 
  fReflSurfX[2][1] = 0.07856742013183861*(5.0*fReflSurfXMu[2][1]+8.0*fReflSurfXMu[1][1]+5.0*fReflSurfXMu[0][1]); 
  fReflSurfX[2][2] = 0.5270462766947298*(fReflSurfXMu[2][0]-1.0*fReflSurfXMu[0][0]); 
  fReflSurfX[2][3] = 0.5270462766947298*(fReflSurfXMu[2][1]-1.0*fReflSurfXMu[0][1]); 
  fReflSurfX[2][4] = 0.07856742013183861*(5.0*fReflSurfXMu[2][2]+8.0*fReflSurfXMu[1][2]+5.0*fReflSurfXMu[0][2]); 
  fReflSurfX[2][5] = 0.3513641844631533*(fReflSurfXMu[2][0]-2.0*fReflSurfXMu[1][0]+fReflSurfXMu[0][0]); 
  fReflSurfX[2][6] = 0.5270462766947299*(fReflSurfXMu[2][2]-1.0*fReflSurfXMu[0][2]); 
  fReflSurfX[2][7] = 0.3513641844631534*(fReflSurfXMu[2][1]-2.0*fReflSurfXMu[1][1]+fReflSurfXMu[0][1]); 

  }

  fRefl[0] = 0.1111111111111111*(5.0*fReflSurfX[2][0]+8.0*fReflSurfX[1][0]+5.0*fReflSurfX[0][0]); 
  fRefl[1] = 0.7453559924999299*(fReflSurfX[2][0]-1.0*fReflSurfX[0][0]); 
  fRefl[2] = 0.0; 
  fRefl[3] = 0.1111111111111111*(5.0*fReflSurfX[2][1]+8.0*fReflSurfX[1][1]+5.0*fReflSurfX[0][1]); 
  fRefl[4] = 0.1111111111111111*(5.0*fReflSurfX[2][2]+8.0*fReflSurfX[1][2]+5.0*fReflSurfX[0][2]); 
  fRefl[5] = 0.0; 
  fRefl[6] = 0.7453559924999299*(fReflSurfX[2][1]-1.0*fReflSurfX[0][1]); 
  fRefl[7] = 0.0; 
  fRefl[8] = 0.7453559924999299*(fReflSurfX[2][2]-1.0*fReflSurfX[0][2]); 
  fRefl[9] = 0.0; 
  fRefl[10] = 0.1111111111111111*(5.0*fReflSurfX[2][3]+8.0*fReflSurfX[1][3]+5.0*fReflSurfX[0][3]); 
  fRefl[11] = 0.4969039949999532*(fReflSurfX[2][0]-2.0*fReflSurfX[1][0]+fReflSurfX[0][0]); 
  fRefl[12] = 0.0; 
  fRefl[13] = 0.1111111111111111*(5.0*fReflSurfX[2][4]+8.0*fReflSurfX[1][4]+5.0*fReflSurfX[0][4]); 
  fRefl[14] = 0.1111111111111111*(5.0*fReflSurfX[2][5]+8.0*fReflSurfX[1][5]+5.0*fReflSurfX[0][5]); 
  fRefl[15] = 0.0; 
  fRefl[16] = 0.0; 
  fRefl[17] = 0.7453559924999299*(fReflSurfX[2][3]-1.0*fReflSurfX[0][3]); 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.0; 
  fRefl[20] = 0.0; 
  fRefl[21] = 0.4969039949999535*(fReflSurfX[2][1]-2.0*fReflSurfX[1][1]+fReflSurfX[0][1]); 
  fRefl[22] = 0.0; 
  fRefl[23] = 0.74535599249993*(fReflSurfX[2][4]-1.0*fReflSurfX[0][4]); 
  fRefl[24] = 0.0; 
  fRefl[25] = 0.4969039949999535*(fReflSurfX[2][2]-2.0*fReflSurfX[1][2]+fReflSurfX[0][2]); 
  fRefl[26] = 0.0; 
  fRefl[27] = 0.1111111111111111*(5.0*fReflSurfX[2][6]+8.0*fReflSurfX[1][6]+5.0*fReflSurfX[0][6]); 
  fRefl[28] = 0.74535599249993*(fReflSurfX[2][5]-1.0*fReflSurfX[0][5]); 
  fRefl[29] = 0.0; 
  fRefl[30] = 0.1111111111111111*(5.0*fReflSurfX[2][7]+8.0*fReflSurfX[1][7]+5.0*fReflSurfX[0][7]); 
  fRefl[31] = 0.0; 
  fRefl[32] = 0.0; 
  fRefl[33] = 0.0; 
  fRefl[34] = 0.0; 
  fRefl[35] = 0.0; 
  fRefl[36] = 0.0; 
  fRefl[37] = 0.4969039949999532*(fReflSurfX[2][3]-2.0*fReflSurfX[1][3]+fReflSurfX[0][3]); 
  fRefl[38] = 0.0; 
  fRefl[39] = 0.74535599249993*(fReflSurfX[2][6]-1.0*fReflSurfX[0][6]); 
  fRefl[40] = 0.0; 
  fRefl[41] = 0.0; 
  fRefl[42] = 0.74535599249993*(fReflSurfX[2][7]-1.0*fReflSurfX[0][7]); 
  fRefl[43] = 0.0; 
  fRefl[44] = 0.0; 
  fRefl[45] = 0.0; 
  fRefl[46] = 0.0; 
  fRefl[47] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_lower_3x2v_ser_p2(double wv, double dv, double vlowerSq, double vupperSq, double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurfXY[9][8] = {0.}; 
  // node (x,y)_0 
  vcutSq = -0.01*(2.23606797749979*((-63.63961030678928*phiWall[19])+63.63961030678928*phi[19]-35.35533905932738*phiWall[9]+35.35533905932738*phi[9]-14.14213562373095*phiWall[8]+14.14213562373095*phi[8]-14.14213562373095*phiWall[7]+14.14213562373095*phi[7]+1.732050807568877*((-21.21320343559643*phiWall[6])+21.21320343559643*phi[6]-21.21320343559643*phiWall[5]+21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*phi[2]+21.21320343559643*phiWall[1]-21.21320343559643*phi[1])+1.732050807568877*((-42.42640687119286*phiWall[18])+42.42640687119286*phi[18]-42.42640687119286*phiWall[17]+42.42640687119286*phi[17]+63.63961030678928*phiWall[10]-63.63961030678928*phi[10]+35.35533905932738*phiWall[3]-35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*phi[16]+7.071067811865476*phiWall[15]-7.071067811865476*phi[15]+2.828427124746191*phiWall[12]-2.828427124746191*phi[12]+2.828427124746191*phiWall[11]-2.828427124746191*phi[11])+14.14213562373095*phiWall[14]-14.14213562373095*phi[14]+14.14213562373095*phiWall[13]-14.14213562373095*phi[13])-63.63961030678928*phiWall[4]+63.63961030678928*phi[4]-35.35533905932738*phiWall[0]+35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[0][0] = 0.0; 
  fReflSurfXY[0][1] = 0.0; 
  fReflSurfXY[0][2] = 0.0; 
  fReflSurfXY[0][3] = 0.0; 
  fReflSurfXY[0][4] = 0.0; 
  fReflSurfXY[0][5] = 0.0; 
  fReflSurfXY[0][6] = 0.0; 
  fReflSurfXY[0][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[0][0] = 0.01414213562373095*(11.18033988749895*(9.0*f[58]+5.0*f[18]+2.0*(f[17]+f[16])+5.196152422706631*(f[8]+f[7])-3.0*(f[2]+f[1]))+8.660254037844386*(6.0*(f[57]+f[56])-1.0*(9.0*f[21]+5.0*f[3]))-3.872983346207417*(3.872983346207417*(5.0*(f[36]+f[35])+2.0*(f[32]+f[31]))+10.0*(f[34]+f[33]))+5.0*(9.0*f[6]+5.0*f[0])); 
  fReflSurfXY[0][1] = 0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[89]+5.0*f[39]+2.0*(f[38]+f[37]))+40.24922359499622*(f[88]+f[87]))-1.0*(225.0*(f[64]+f[63])+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])-3.0*(f[24]+f[23]))+9.0*(f[10]+f[9]))+5.0*(18.0*(f[60]+f[59])+5.196152422706631*(9.0*f[51]+5.0*f[11])-3.0*(9.0*f[22]+5.0*f[4])))); 
  fReflSurfXY[0][2] = 0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[93]+5.0*f[45]+2.0*(f[44]+f[43]))+40.24922359499622*(f[92]+f[91]))-1.0*(225.0*(f[73]+f[72])+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])-3.0*(f[27]+f[26]))+9.0*(f[13]+f[12]))+5.0*(18.0*(f[69]+f[68])+5.196152422706631*(9.0*f[52]+5.0*f[14])-3.0*(9.0*f[25]+5.0*f[5])))); 
  fReflSurfXY[0][3] = 0.01414213562373095*(11.18033988749895*(9.0*f[109]+5.0*f[76]+2.0*(f[75]+f[74])+5.196152422706631*(f[55]+f[54])-3.0*(f[29]+f[28]))+8.660254037844386*(6.0*(f[108]+f[107])-1.0*(9.0*f[86]+5.0*f[30]))-3.872983346207417*(3.872983346207417*(5.0*(f[99]+f[98])+2.0*(f[95]+f[94]))+10.0*(f[97]+f[96]))+5.0*(9.0*f[53]+5.0*f[15])); 
  fReflSurfXY[0][4] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]+5.0*f[42])+8.660254037844386*(f[41]+f[40]))-1.0*(58.09475019311126*(f[67]+f[66])+5.0*(9.0*f[65]+5.0*f[19]))); 
  fReflSurfXY[0][5] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]+5.0*f[49])+8.660254037844386*(f[48]+f[47]))-1.0*(58.09475019311126*(f[82]+f[81])+5.0*(9.0*f[80]+5.0*f[20]))); 
  fReflSurfXY[0][6] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]+5.0*f[79])+8.660254037844386*(f[78]+f[77]))-1.0*(58.09475019311126*(f[102]+f[101])+5.0*(9.0*f[100]+5.0*f[46]))); 
  fReflSurfXY[0][7] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]+5.0*f[85])+8.660254037844386*(f[84]+f[83]))-1.0*(58.09475019311126*(f[106]+f[105])+5.0*(9.0*f[104]+5.0*f[50]))); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]-30.0*f[83]-60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-60.0*f[57]-60.0*f[56]+45.0*f[29]+45.0*f[28]+90.0*f[27]+90.0*f[26]+45.0*f[22]+90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+36.0*f[92]+36.0*f[91]+45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]+30.0*f[88]+30.0*f[87]+20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+((-225.0*f[78])-225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]-75.0*f[15]-150.0*f[14]-75.0*f[10]-75.0*f[9]-150.0*f[8]-150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]+225.0*f[30]+270.0*f[25]+225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]-135.0*f[102]-135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-216.0*f[92]-216.0*f[91]-135.0*f[90]-360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]+360.0*f[15]+540.0*f[14]+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+540.0*f[13]+540.0*f[12]+600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[29]-1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[27]+1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]+720.0*f[84]+720.0*f[83]+1080.0*f[82]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[29]-1080.0*f[28]-1620.0*f[27]-1620.0*f[26]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]-135.0*f[29]-135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[29]+90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]-30.0*f[84]-30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]-120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]+72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+72.0*f[90]+45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87]+40.0*f[46]+40.0*f[41]+40.0*f[40]))+((-810.0*f[78])-810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]-75.0*f[10]-75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]-30.0*f[83]+60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+60.0*f[57]+60.0*f[56]+45.0*f[29]+45.0*f[28]-90.0*f[27]-90.0*f[26]+45.0*f[22]-90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]+90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-36.0*f[92]-36.0*f[91]+45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]+30.0*f[88]+30.0*f[87]-20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+((-225.0*f[78])-225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]-75.0*f[15]+150.0*f[14]-75.0*f[10]-75.0*f[9]+150.0*f[8]+150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]+225.0*f[30]-270.0*f[25]+225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]-135.0*f[102]-135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-216.0*f[92]-216.0*f[91]-135.0*f[90]+360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]+216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]-360.0*f[15]+540.0*f[14]-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+540.0*f[13]+540.0*f[12]-600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[29]-1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[27]+1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]-720.0*f[84]-720.0*f[83]+1080.0*f[82]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[29]+1080.0*f[28]-1620.0*f[27]-1620.0*f[26]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]-135.0*f[29]-135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[29]+90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]-30.0*f[84]-30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]+120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]-72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-72.0*f[90]+45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87]-40.0*f[46]-40.0*f[41]-40.0*f[40]))+((-810.0*f[78])-810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]-75.0*f[10]-75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l-9.0*f[104]-18.0*f[103]+18.0*f[89]-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[41]+10.0*f[40])*vcut_lR3+(15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[47]-10.0*f[41]-10.0*f[40]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31])*vcut_l-15.0*f[106]-15.0*f[105]+12.0*f[88]+12.0*f[87]-10.0*f[48]-10.0*f[47]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[67])-30.0*f[66])*vcut_lR3+((-15.0*f[84])-15.0*f[83]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]-18.0*f[22]-10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[81]+30.0*f[67]+30.0*f[66]-24.0*f[57]-24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l+15.0*f[84]+15.0*f[83]+30.0*f[82]+30.0*f[81]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]-24.0*f[57]-24.0*f[56]+18.0*f[22]+36.0*f[21]+10.0*f[4]+20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+((-36.0*f[6])-20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]-36.0*f[6]-20.0*f[0])+((-90.0*f[65])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]+30.0*f[9])*vcut_lR2+((-60.0*f[8])-60.0*f[7])*vcut_l-30.0*f[10]-30.0*f[9]-60.0*f[8]-60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]-90.0*f[24]-90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]+90.0*f[80]-60.0*f[62]-60.0*f[61]-180.0*f[58]+90.0*f[24]+90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]+225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+180.0*f[104]+270.0*f[103]-135.0*f[90]-360.0*f[89]+100.0*f[50]+150.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+(180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[65])-225.0*f[19])*vcut_lR4+((-540.0*f[111])-300.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[24]-360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2-540.0*f[111]-300.0*f[85]-270.0*f[80]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[24]-360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+((-540.0*f[8])-540.0*f[7])*vcut_lR2+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+((-2025.0*f[67])-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[6])-300.0*f[0])*vcut_lR2+1080.0*f[51]+600.0*f[11]+540.0*f[6]+300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(1350.0*f[82]+1350.0*f[81]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[21]+900.0*f[3])*vcut_lR2-900.0*f[84]-900.0*f[83]-1350.0*f[82]-1350.0*f[81]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l-45.0*f[104]+144.0*f[90]+90.0*f[89]-25.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[41]+180.0*f[40])*vcut_lR5+(225.0*f[106]+225.0*f[105]-180.0*f[88]-180.0*f[87])*vcut_lR4+((-100.0*f[48])-100.0*f[47]-200.0*f[41]-200.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_lR3+((-150.0*f[106])-150.0*f[105]+120.0*f[88]+120.0*f[87])*vcut_lR2+(100.0*f[48]+100.0*f[47]+100.0*f[41]+100.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_l-75.0*f[106]-75.0*f[105]+60.0*f[88]+60.0*f[87]+80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[67])-540.0*f[66])*vcut_lR5+((-225.0*f[84])-225.0*f[83]+450.0*f[64]+450.0*f[63]+180.0*f[60]+180.0*f[59]-270.0*f[22]-150.0*f[4])*vcut_lR4+(300.0*f[82]+300.0*f[81]+600.0*f[67]+600.0*f[66]-240.0*f[57]-240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+(150.0*f[84]+150.0*f[83]-300.0*f[64]-300.0*f[63]-120.0*f[60]-120.0*f[59]+180.0*f[22]+100.0*f[4])*vcut_lR2+((-300.0*f[82])-300.0*f[81]-300.0*f[67]-300.0*f[66]+240.0*f[57]+240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l+75.0*f[84]+75.0*f[83]-240.0*f[67]-240.0*f[66]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[22]+50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+((-360.0*f[6])-200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+(360.0*f[6]+200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+((-1620.0*f[65])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]+450.0*f[9])*vcut_lR4+((-600.0*f[8])-600.0*f[7])*vcut_lR3+((-300.0*f[10])-300.0*f[9])*vcut_lR2+(600.0*f[8]+600.0*f[7])*vcut_l-150.0*f[10]-150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]-1350.0*f[24]-1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]+900.0*f[24]+900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]-720.0*f[65]-300.0*f[62]-300.0*f[61]+450.0*f[24]+450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l-9.0*f[104]+18.0*f[103]+18.0*f[89]-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[41]+10.0*f[40])*vcut_lR3+(15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[47]-10.0*f[41]-10.0*f[40]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31])*vcut_l-15.0*f[106]-15.0*f[105]+12.0*f[88]+12.0*f[87]+10.0*f[48]+10.0*f[47]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[67])-30.0*f[66])*vcut_lR3+((-15.0*f[84])-15.0*f[83]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]-18.0*f[22]-10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[81]+30.0*f[67]+30.0*f[66]-24.0*f[57]-24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l+15.0*f[84]+15.0*f[83]-30.0*f[82]-30.0*f[81]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]+24.0*f[57]+24.0*f[56]+18.0*f[22]-36.0*f[21]+10.0*f[4]-20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+((-36.0*f[6])-20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]+36.0*f[6]+20.0*f[0])+((-90.0*f[65])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]+30.0*f[9])*vcut_lR2+((-60.0*f[8])-60.0*f[7])*vcut_l-30.0*f[10]-30.0*f[9]+60.0*f[8]+60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]-90.0*f[24]-90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]-90.0*f[80]-60.0*f[62]-60.0*f[61]+180.0*f[58]+90.0*f[24]+90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]+225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-180.0*f[104]+270.0*f[103]-135.0*f[90]+360.0*f[89]-100.0*f[50]+150.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+(180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]-180.0*f[105]+144.0*f[88]+144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[65])-225.0*f[19])*vcut_lR4+((-540.0*f[111])-300.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[24]-360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2+540.0*f[111]+300.0*f[85]-270.0*f[80]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[24]+360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+((-540.0*f[8])-540.0*f[7])*vcut_lR2-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+((-2025.0*f[67])-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[6])-300.0*f[0])*vcut_lR2-1080.0*f[51]-600.0*f[11]+540.0*f[6]+300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(1350.0*f[82]+1350.0*f[81]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[21]+900.0*f[3])*vcut_lR2+900.0*f[84]+900.0*f[83]-1350.0*f[82]-1350.0*f[81]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l-45.0*f[104]-144.0*f[90]+90.0*f[89]-25.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[41]+180.0*f[40])*vcut_lR5+(225.0*f[106]+225.0*f[105]-180.0*f[88]-180.0*f[87])*vcut_lR4+((-100.0*f[48])-100.0*f[47]-200.0*f[41]-200.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_lR3+((-150.0*f[106])-150.0*f[105]+120.0*f[88]+120.0*f[87])*vcut_lR2+(100.0*f[48]+100.0*f[47]+100.0*f[41]+100.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_l-75.0*f[106]-75.0*f[105]+60.0*f[88]+60.0*f[87]-80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[67])-540.0*f[66])*vcut_lR5+((-225.0*f[84])-225.0*f[83]+450.0*f[64]+450.0*f[63]+180.0*f[60]+180.0*f[59]-270.0*f[22]-150.0*f[4])*vcut_lR4+(300.0*f[82]+300.0*f[81]+600.0*f[67]+600.0*f[66]-240.0*f[57]-240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+(150.0*f[84]+150.0*f[83]-300.0*f[64]-300.0*f[63]-120.0*f[60]-120.0*f[59]+180.0*f[22]+100.0*f[4])*vcut_lR2+((-300.0*f[82])-300.0*f[81]-300.0*f[67]-300.0*f[66]+240.0*f[57]+240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l+75.0*f[84]+75.0*f[83]+240.0*f[67]+240.0*f[66]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[22]+50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+((-360.0*f[6])-200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+(360.0*f[6]+200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+((-1620.0*f[65])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]+450.0*f[9])*vcut_lR4+((-600.0*f[8])-600.0*f[7])*vcut_lR3+((-300.0*f[10])-300.0*f[9])*vcut_lR2+(600.0*f[8]+600.0*f[7])*vcut_l-150.0*f[10]-150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]-1350.0*f[24]-1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]+900.0*f[24]+900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]+720.0*f[65]-300.0*f[62]-300.0*f[61]+450.0*f[24]+450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]+30.0*f[83]+60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+60.0*f[57]+60.0*f[56]+45.0*f[29]+45.0*f[28]+90.0*f[27]+90.0*f[26]-45.0*f[22]-90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]-90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+36.0*f[92]+36.0*f[91]-45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]-30.0*f[88]-30.0*f[87]-20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+((-225.0*f[78])-225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]-75.0*f[15]-150.0*f[14]+75.0*f[10]+75.0*f[9]+150.0*f[8]+150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]+225.0*f[30]+270.0*f[25]-225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]-135.0*f[102]-135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-216.0*f[92]-216.0*f[91]+135.0*f[90]+360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]+360.0*f[15]+540.0*f[14]-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]-1080.0*f[51]+540.0*f[13]+540.0*f[12]-600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[29]-1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[27]+1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]-720.0*f[84]-720.0*f[83]-1080.0*f[82]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[29]-1080.0*f[28]-1620.0*f[27]-1620.0*f[26]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]-135.0*f[29]-135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[29]+90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]+30.0*f[84]+30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]+120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]+72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-72.0*f[90]-45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87]+40.0*f[46]-40.0*f[41]-40.0*f[40]))+((-810.0*f[78])-810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]+75.0*f[10]+75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]+30.0*f[83]-60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-60.0*f[57]-60.0*f[56]+45.0*f[29]+45.0*f[28]-90.0*f[27]-90.0*f[26]-45.0*f[22]+90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-36.0*f[92]-36.0*f[91]-45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]-30.0*f[88]-30.0*f[87]+20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+((-225.0*f[78])-225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]-75.0*f[15]+150.0*f[14]+75.0*f[10]+75.0*f[9]-150.0*f[8]-150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]+225.0*f[30]-270.0*f[25]-225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]-135.0*f[102]-135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-216.0*f[92]-216.0*f[91]+135.0*f[90]-360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]-216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]-360.0*f[15]+540.0*f[14]+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]+1080.0*f[51]+540.0*f[13]+540.0*f[12]+600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[29]-1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[27]+1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]+720.0*f[84]+720.0*f[83]-1080.0*f[82]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[29]+1080.0*f[28]-1620.0*f[27]-1620.0*f[26]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]-135.0*f[29]-135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[29]+90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]+30.0*f[84]+30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]-120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]-72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+72.0*f[90]-45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87]-40.0*f[46]+40.0*f[41]+40.0*f[40]))+((-810.0*f[78])-810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]+75.0*f[10]+75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[0][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[0][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[0][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[0][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[0][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_1 
  vcutSq = -0.025*(1.732050807568877*(21.21320343559643*phiWall[18]-21.21320343559643*phi[18]+14.14213562373095*phiWall[3]-14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[15]-2.828427124746191*phi[15]-1.414213562373095*phiWall[12]+1.414213562373095*phi[12])-7.071067811865476*phiWall[14]+7.071067811865476*phi[14]+5.656854249492382*phiWall[13]-5.656854249492382*phi[13])+2.23606797749979*((-14.14213562373095*phiWall[9])+14.14213562373095*phi[9]+7.071067811865476*phiWall[8]-7.071067811865476*phi[8]-5.656854249492382*phiWall[7]+5.656854249492382*phi[7]+1.732050807568877*(8.485281374238571*phi[5]-8.485281374238571*phiWall[5])+8.485281374238571*phiWall[1]-8.485281374238571*phi[1])-14.14213562373095*phiWall[0]+14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[1][0] = 0.0; 
  fReflSurfXY[1][1] = 0.0; 
  fReflSurfXY[1][2] = 0.0; 
  fReflSurfXY[1][3] = 0.0; 
  fReflSurfXY[1][4] = 0.0; 
  fReflSurfXY[1][5] = 0.0; 
  fReflSurfXY[1][6] = 0.0; 
  fReflSurfXY[1][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[1][0] = -0.03535533905932736*(8.660254037844386*(3.0*f[57]+2.0*f[3])+3.872983346207417*(3.872983346207417*(2.0*f[35]-1.0*f[32])-5.0*f[34]+4.0*f[33])-1.0*(2.23606797749979*(5.0*(2.0*f[18]-1.0*f[17])+4.0*f[16]+2.0*(5.196152422706631*f[7]-2.0*f[1]))+10.0*f[0])); 
  fReflSurfXY[1][1] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[88]-1.732050807568877*(5.0*(2.0*f[39]-1.0*f[38])+4.0*f[37]))+90.0*f[63]+2.23606797749979*(18.0*f[9]-5.196152422706631*(5.0*f[62]-4.0*f[61]+6.0*f[23]))+5.0*(2.0*(5.196152422706631*f[11]-2.0*f[4])-9.0*f[60])); 
  fReflSurfXY[1][2] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[92]-1.732050807568877*(5.0*(2.0*f[45]-1.0*f[44])+4.0*f[43]))+90.0*f[72]+2.23606797749979*(18.0*f[12]-5.196152422706631*(5.0*f[71]-4.0*f[70]+6.0*f[26]))+5.0*(2.0*(5.196152422706631*f[14]-2.0*f[5])-9.0*f[69])); 
  fReflSurfXY[1][3] = -0.03535533905932736*(8.660254037844386*(3.0*f[108]+2.0*f[30])+3.872983346207417*(3.872983346207417*(2.0*f[98]-1.0*f[95])-5.0*f[97]+4.0*f[96])-1.0*(2.23606797749979*(5.0*(2.0*f[76]-1.0*f[75])+4.0*f[74]+2.0*(5.196152422706631*f[54]-2.0*f[28]))+10.0*f[15])); 
  fReflSurfXY[1][4] = 0.07071067811865474*(11.61895003862225*f[66]-3.872983346207417*(2.23606797749979*f[42]+1.732050807568877*f[40])+5.0*f[19]); 
  fReflSurfXY[1][5] = 0.07071067811865474*(11.61895003862225*f[81]-3.872983346207417*(2.23606797749979*f[49]+1.732050807568877*f[47])+5.0*f[20]); 
  fReflSurfXY[1][6] = 0.07071067811865474*(11.61895003862225*f[101]-3.872983346207417*(2.23606797749979*f[79]+1.732050807568877*f[77])+5.0*f[46]); 
  fReflSurfXY[1][7] = 0.07071067811865474*(11.61895003862225*f[105]-3.872983346207417*(2.23606797749979*f[85]+1.732050807568877*f[83])+5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]-18.0*f[92]+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[40])*vcut_lR3+((-12.0*f[105])+15.0*f[97]-12.0*f[96]+15.0*f[88])*vcut_lR2+(8.0*f[47]-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88]+8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[66])*vcut_lR3+(12.0*f[83]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[63]-15.0*f[60]-18.0*f[28]-10.0*f[4])*vcut_lR2+((-24.0*f[81])+30.0*f[79]+30.0*f[71]-24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l-12.0*f[83]-24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[71]-24.0*f[70]-30.0*f[63]+15.0*f[60]+30.0*f[57]+18.0*f[28]+36.0*f[26]+10.0*f[4]+20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+((-36.0*f[12])-20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]-30.0*f[11]-20.0*f[0])+((-90.0*f[77])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[9])*vcut_lR2+((-60.0*f[14])-60.0*f[7])*vcut_l-30.0*f[15]-60.0*f[14]-30.0*f[9]-60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]-90.0*f[30]-90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]-180.0*f[72]+90.0*f[69]+75.0*f[62]-60.0*f[61]+90.0*f[30]+90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]+225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2-135.0*f[101]-360.0*f[98]+180.0*f[95]+270.0*f[92]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+((-144.0*f[105])+180.0*f[97]-144.0*f[96]+180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2-144.0*f[105]+180.0*f[97]-144.0*f[96]+180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*(((-405.0*f[77])-225.0*f[19])*vcut_lR4+((-540.0*f[108])+240.0*f[85]-300.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2-540.0*f[108]+240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]-300.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+((-540.0*f[14])-540.0*f[7])*vcut_lR2+360.0*f[15]+540.0*f[14]+360.0*f[9]+540.0*f[7])+((-2025.0*f[79])-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]+600.0*f[11])*vcut_lR3+((-540.0*f[12])-300.0*f[0])*vcut_lR2+1080.0*f[54]+540.0*f[12]+600.0*f[11]+300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]-1080.0*f[28]-600.0*f[4])*vcut_lR3+((-1080.0*f[81])+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]+1350.0*f[66]+1350.0*f[57]+1620.0*f[26]+900.0*f[3])*vcut_lR2+720.0*f[83]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1350.0*f[71]+1080.0*f[70]+675.0*f[66]+1800.0*f[63]-900.0*f[60]-1350.0*f[57]-1080.0*f[28]-1620.0*f[26]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l+144.0*f[101]+90.0*f[98]-45.0*f[95]+20.0*f[50]+80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[40])*vcut_lR5+((-180.0*f[105])+225.0*f[97]-180.0*f[96]+225.0*f[88])*vcut_lR4+(80.0*f[47]-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+(120.0*f[105]-150.0*f[97]+120.0*f[96]-150.0*f[88])*vcut_lR2+((-80.0*f[47])+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l+60.0*f[105]-75.0*f[97]+60.0*f[96]-75.0*f[88]+80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[66])*vcut_lR5+(180.0*f[83]+450.0*f[76]-225.0*f[75]+180.0*f[74]+450.0*f[63]-225.0*f[60]-270.0*f[28]-150.0*f[4])*vcut_lR4+((-240.0*f[81])+600.0*f[79]+300.0*f[71]-240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+((-120.0*f[83])-300.0*f[76]+150.0*f[75]-120.0*f[74]-300.0*f[63]+150.0*f[60]+180.0*f[28]+100.0*f[4])*vcut_lR2+(240.0*f[81]-300.0*f[79]-300.0*f[71]+240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l-60.0*f[83]-240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]-240.0*f[66]-150.0*f[63]+75.0*f[60]+90.0*f[28]+50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+((-360.0*f[12])-200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+(360.0*f[12]+200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+((-1620.0*f[77])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[9])*vcut_lR4+((-600.0*f[14])-600.0*f[7])*vcut_lR3+((-300.0*f[15])-300.0*f[9])*vcut_lR2+(600.0*f[14]+600.0*f[7])*vcut_l-150.0*f[15]-150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]-1350.0*f[30]-1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]+900.0*f[30]+900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]-720.0*f[77]+375.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]+18.0*f[92]+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[40])*vcut_lR3+((-12.0*f[105])+15.0*f[97]-12.0*f[96]+15.0*f[88])*vcut_lR2+(8.0*f[47]-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88]-8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[66])*vcut_lR3+(12.0*f[83]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[63]-15.0*f[60]-18.0*f[28]-10.0*f[4])*vcut_lR2+((-24.0*f[81])+30.0*f[79]+30.0*f[71]-24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l-12.0*f[83]+24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[71]+24.0*f[70]-30.0*f[63]+15.0*f[60]-30.0*f[57]+18.0*f[28]-36.0*f[26]+10.0*f[4]-20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+((-36.0*f[12])-20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]-30.0*f[11]+20.0*f[0])+((-90.0*f[77])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[9])*vcut_lR2+((-60.0*f[14])-60.0*f[7])*vcut_l-30.0*f[15]+60.0*f[14]-30.0*f[9]+60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]-90.0*f[30]-90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]+180.0*f[72]-90.0*f[69]+75.0*f[62]-60.0*f[61]+90.0*f[30]+90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]+225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2-135.0*f[101]+360.0*f[98]-180.0*f[95]+270.0*f[92]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+((-144.0*f[105])+180.0*f[97]-144.0*f[96]+180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2+144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*(((-405.0*f[77])-225.0*f[19])*vcut_lR4+((-540.0*f[108])+240.0*f[85]-300.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2+540.0*f[108]-240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]+300.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+((-540.0*f[14])-540.0*f[7])*vcut_lR2-360.0*f[15]+540.0*f[14]-360.0*f[9]+540.0*f[7])+((-2025.0*f[79])-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]+600.0*f[11])*vcut_lR3+((-540.0*f[12])-300.0*f[0])*vcut_lR2-1080.0*f[54]+540.0*f[12]-600.0*f[11]+300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]-1080.0*f[28]-600.0*f[4])*vcut_lR3+((-1080.0*f[81])+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]+1350.0*f[66]+1350.0*f[57]+1620.0*f[26]+900.0*f[3])*vcut_lR2-720.0*f[83]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]-1350.0*f[71]+1080.0*f[70]+675.0*f[66]-1800.0*f[63]+900.0*f[60]-1350.0*f[57]+1080.0*f[28]-1620.0*f[26]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l-144.0*f[101]+90.0*f[98]-45.0*f[95]+20.0*f[50]-80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[40])*vcut_lR5+((-180.0*f[105])+225.0*f[97]-180.0*f[96]+225.0*f[88])*vcut_lR4+(80.0*f[47]-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+(120.0*f[105]-150.0*f[97]+120.0*f[96]-150.0*f[88])*vcut_lR2+((-80.0*f[47])+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l+60.0*f[105]-75.0*f[97]+60.0*f[96]-75.0*f[88]-80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[66])*vcut_lR5+(180.0*f[83]+450.0*f[76]-225.0*f[75]+180.0*f[74]+450.0*f[63]-225.0*f[60]-270.0*f[28]-150.0*f[4])*vcut_lR4+((-240.0*f[81])+600.0*f[79]+300.0*f[71]-240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+((-120.0*f[83])-300.0*f[76]+150.0*f[75]-120.0*f[74]-300.0*f[63]+150.0*f[60]+180.0*f[28]+100.0*f[4])*vcut_lR2+(240.0*f[81]-300.0*f[79]-300.0*f[71]+240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l-60.0*f[83]+240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]+240.0*f[66]-150.0*f[63]+75.0*f[60]+90.0*f[28]+50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+((-360.0*f[12])-200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+(360.0*f[12]+200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+((-1620.0*f[77])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[9])*vcut_lR4+((-600.0*f[14])-600.0*f[7])*vcut_lR3+((-300.0*f[15])-300.0*f[9])*vcut_lR2+(600.0*f[14]+600.0*f[7])*vcut_l-150.0*f[15]-150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]-1350.0*f[30]-1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]+900.0*f[30]+900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]+720.0*f[77]+375.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[66]*vcut_lR3)+((-15.0*f[83])+30.0*f[63]-15.0*f[60]-10.0*f[4])*vcut_lR2+(30.0*f[81]+30.0*f[66]+30.0*f[57]+20.0*f[3])*vcut_l+15.0*f[83]+30.0*f[81]-30.0*f[63]+15.0*f[60]+30.0*f[57]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-5.0*f[50]-10.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*(10.0*f[40]*vcut_lR3+(15.0*f[105]+15.0*f[88])*vcut_lR2+((-10.0*f[47])-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]-10.0*f[47]+20.0*f[35]-10.0*f[32]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[9]*vcut_lR2-60.0*f[7]*vcut_l-30.0*f[9]-60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]-90.0*f[23])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]+50.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+(20.0*f[50]-40.0*f[39]+20.0*f[38]-16.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]-30.0*f[34]+24.0*f[33])*vcut_lR2+20.0*f[50]+30.0*f[49]-15.0*f[42]-40.0*f[39]+20.0*f[38]-16.0*f[37]+30.0*f[34]-24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+(36.0*f[105]+36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2+36.0*f[105]+36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-60.0*f[85])-60.0*f[62]+48.0*f[61]-72.0*f[23])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]+36.0*f[1])*vcut_lR2-60.0*f[85]-60.0*f[62]+48.0*f[61]-72.0*f[23]-30.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3-108.0*f[7]*vcut_lR2+72.0*f[9]+108.0*f[7])-405.0*f[66]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]-120.0*f[4])*vcut_lR3+(270.0*f[81]+270.0*f[66]+270.0*f[57]+180.0*f[3])*vcut_lR2-180.0*f[83]-270.0*f[81]+135.0*f[66]+360.0*f[63]-180.0*f[60]-270.0*f[57]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[66]*vcut_lR5)+((-45.0*f[83])+90.0*f[63]-45.0*f[60]-30.0*f[4])*vcut_lR4+(60.0*f[81]+120.0*f[66]+60.0*f[57]+40.0*f[3])*vcut_lR3+(30.0*f[83]-60.0*f[63]+30.0*f[60]+20.0*f[4])*vcut_lR2+((-60.0*f[81])-60.0*f[66]-60.0*f[57]-40.0*f[3])*vcut_l+15.0*f[83]-48.0*f[66]-30.0*f[63]+15.0*f[60]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]-12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]+8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l-5.0*f[50]+16.0*f[42]+10.0*f[39]-5.0*f[38]+4.0*f[37])+1.732050807568877*(36.0*f[40]*vcut_lR5+(45.0*f[105]+45.0*f[88])*vcut_lR4+((-20.0*f[47])-40.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_lR3+((-30.0*f[105])-30.0*f[88])*vcut_lR2+(20.0*f[47]+20.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]+16.0*f[40]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[9]*vcut_lR4-120.0*f[7]*vcut_lR3-60.0*f[9]*vcut_lR2+120.0*f[7]*vcut_l-30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]-270.0*f[23])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]+120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]+180.0*f[23])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]-120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[66]*vcut_lR3)+((-15.0*f[83])+30.0*f[63]-15.0*f[60]-10.0*f[4])*vcut_lR2+(30.0*f[81]+30.0*f[66]+30.0*f[57]+20.0*f[3])*vcut_l+15.0*f[83]-30.0*f[81]-30.0*f[63]+15.0*f[60]-30.0*f[57]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-5.0*f[50]+10.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*(10.0*f[40]*vcut_lR3+(15.0*f[105]+15.0*f[88])*vcut_lR2+((-10.0*f[47])-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]+10.0*f[47]-20.0*f[35]+10.0*f[32]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[9]*vcut_lR2-60.0*f[7]*vcut_l-30.0*f[9]+60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]-90.0*f[23])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]-50.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+(20.0*f[50]-40.0*f[39]+20.0*f[38]-16.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]-30.0*f[34]+24.0*f[33])*vcut_lR2-20.0*f[50]+30.0*f[49]-15.0*f[42]+40.0*f[39]-20.0*f[38]+16.0*f[37]+30.0*f[34]-24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+(36.0*f[105]+36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2-36.0*f[105]-36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-60.0*f[85])-60.0*f[62]+48.0*f[61]-72.0*f[23])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]+36.0*f[1])*vcut_lR2+60.0*f[85]+60.0*f[62]-48.0*f[61]+72.0*f[23]-30.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3-108.0*f[7]*vcut_lR2-72.0*f[9]+108.0*f[7])-405.0*f[66]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]-120.0*f[4])*vcut_lR3+(270.0*f[81]+270.0*f[66]+270.0*f[57]+180.0*f[3])*vcut_lR2+180.0*f[83]-270.0*f[81]+135.0*f[66]-360.0*f[63]+180.0*f[60]-270.0*f[57]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[66]*vcut_lR5)+((-45.0*f[83])+90.0*f[63]-45.0*f[60]-30.0*f[4])*vcut_lR4+(60.0*f[81]+120.0*f[66]+60.0*f[57]+40.0*f[3])*vcut_lR3+(30.0*f[83]-60.0*f[63]+30.0*f[60]+20.0*f[4])*vcut_lR2+((-60.0*f[81])-60.0*f[66]-60.0*f[57]-40.0*f[3])*vcut_l+15.0*f[83]+48.0*f[66]-30.0*f[63]+15.0*f[60]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]-12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]+8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l-5.0*f[50]-16.0*f[42]+10.0*f[39]-5.0*f[38]+4.0*f[37])+1.732050807568877*(36.0*f[40]*vcut_lR5+(45.0*f[105]+45.0*f[88])*vcut_lR4+((-20.0*f[47])-40.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_lR3+((-30.0*f[105])-30.0*f[88])*vcut_lR2+(20.0*f[47]+20.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]-16.0*f[40]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[9]*vcut_lR4-120.0*f[7]*vcut_lR3-60.0*f[9]*vcut_lR2+120.0*f[7]*vcut_l-30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]-270.0*f[23])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]+120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]+180.0*f[23])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]-120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]-18.0*f[92]-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[40])*vcut_lR3+(12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88])*vcut_lR2+((-8.0*f[47])-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-12.0*f[105]-15.0*f[97]+12.0*f[96]+15.0*f[88]-8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[79])*vcut_lR3+((-12.0*f[83])+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[63]+15.0*f[60]-18.0*f[28]+10.0*f[4])*vcut_lR2+(24.0*f[81]+30.0*f[79]+30.0*f[71]-24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l+12.0*f[83]+24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[71]-24.0*f[70]+30.0*f[63]-15.0*f[60]-30.0*f[57]+18.0*f[28]+36.0*f[26]-10.0*f[4]-20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[12])*vcut_l-54.0*f[54]-36.0*f[12]+30.0*f[11]+20.0*f[0])+(50.0*f[19]-90.0*f[77])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[9])*vcut_lR2+(60.0*f[7]-60.0*f[14])*vcut_l-30.0*f[15]-60.0*f[14]+30.0*f[9]+60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[30]+90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]-180.0*f[72]+90.0*f[69]-75.0*f[62]+60.0*f[61]+90.0*f[30]-90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]-225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2-135.0*f[101]-360.0*f[98]+180.0*f[95]+270.0*f[92]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+(144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2+144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[77])*vcut_lR4+((-540.0*f[108])-240.0*f[85]+300.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2-540.0*f[108]-240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]+300.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[14])*vcut_lR2+360.0*f[15]+540.0*f[14]-360.0*f[9]-540.0*f[7])+(2025.0*f[66]-2025.0*f[79])*vcut_lR4+1.732050807568877*((1080.0*f[54]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[12])*vcut_lR2+1080.0*f[54]+540.0*f[12]-600.0*f[11]-300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]-1080.0*f[28]+600.0*f[4])*vcut_lR3+(1080.0*f[81]+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]-1350.0*f[66]-1350.0*f[57]+1620.0*f[26]-900.0*f[3])*vcut_lR2-720.0*f[83]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1350.0*f[71]+1080.0*f[70]-675.0*f[66]-1800.0*f[63]+900.0*f[60]+1350.0*f[57]-1080.0*f[28]-1620.0*f[26]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l+144.0*f[101]+90.0*f[98]-45.0*f[95]-20.0*f[50]-80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[40])*vcut_lR5+(180.0*f[105]+225.0*f[97]-180.0*f[96]-225.0*f[88])*vcut_lR4+((-80.0*f[47])-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+((-120.0*f[105])-150.0*f[97]+120.0*f[96]+150.0*f[88])*vcut_lR2+(80.0*f[47]+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l-60.0*f[105]-75.0*f[97]+60.0*f[96]+75.0*f[88]+80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[79])*vcut_lR5+((-180.0*f[83])+450.0*f[76]-225.0*f[75]+180.0*f[74]-450.0*f[63]+225.0*f[60]-270.0*f[28]+150.0*f[4])*vcut_lR4+(240.0*f[81]+600.0*f[79]+300.0*f[71]-240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+(120.0*f[83]-300.0*f[76]+150.0*f[75]-120.0*f[74]+300.0*f[63]-150.0*f[60]+180.0*f[28]-100.0*f[4])*vcut_lR2+((-240.0*f[81])-300.0*f[79]-300.0*f[71]+240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l+60.0*f[83]-240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]+240.0*f[66]+150.0*f[63]-75.0*f[60]+90.0*f[28]-50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[12])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(360.0*f[12]-200.0*f[0])*vcut_l-270.0*f[54]+150.0*f[11])+(900.0*f[19]-1620.0*f[77])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[9])*vcut_lR4+(600.0*f[7]-600.0*f[14])*vcut_lR3+(300.0*f[9]-300.0*f[15])*vcut_lR2+(600.0*f[14]-600.0*f[7])*vcut_l-150.0*f[15]+150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]-1350.0*f[30]+1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]+900.0*f[30]-900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]-720.0*f[77]-375.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]+18.0*f[92]-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[40])*vcut_lR3+(12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88])*vcut_lR2+((-8.0*f[47])-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-12.0*f[105]-15.0*f[97]+12.0*f[96]+15.0*f[88]+8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[79])*vcut_lR3+((-12.0*f[83])+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[63]+15.0*f[60]-18.0*f[28]+10.0*f[4])*vcut_lR2+(24.0*f[81]+30.0*f[79]+30.0*f[71]-24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l+12.0*f[83]-24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[71]+24.0*f[70]+30.0*f[63]-15.0*f[60]+30.0*f[57]+18.0*f[28]-36.0*f[26]-10.0*f[4]+20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[12])*vcut_l-54.0*f[54]+36.0*f[12]+30.0*f[11]-20.0*f[0])+(50.0*f[19]-90.0*f[77])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[9])*vcut_lR2+(60.0*f[7]-60.0*f[14])*vcut_l-30.0*f[15]+60.0*f[14]+30.0*f[9]-60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[30]+90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]+180.0*f[72]-90.0*f[69]-75.0*f[62]+60.0*f[61]+90.0*f[30]-90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]-225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2-135.0*f[101]+360.0*f[98]-180.0*f[95]+270.0*f[92]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+(144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2-144.0*f[105]-180.0*f[97]+144.0*f[96]+180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[77])*vcut_lR4+((-540.0*f[108])-240.0*f[85]+300.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2+540.0*f[108]+240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]-300.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[14])*vcut_lR2-360.0*f[15]+540.0*f[14]+360.0*f[9]-540.0*f[7])+(2025.0*f[66]-2025.0*f[79])*vcut_lR4+1.732050807568877*((1080.0*f[54]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[12])*vcut_lR2-1080.0*f[54]+540.0*f[12]+600.0*f[11]-300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]-1080.0*f[28]+600.0*f[4])*vcut_lR3+(1080.0*f[81]+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]-1350.0*f[66]-1350.0*f[57]+1620.0*f[26]-900.0*f[3])*vcut_lR2+720.0*f[83]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]-1350.0*f[71]+1080.0*f[70]-675.0*f[66]+1800.0*f[63]-900.0*f[60]+1350.0*f[57]+1080.0*f[28]-1620.0*f[26]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l-144.0*f[101]+90.0*f[98]-45.0*f[95]-20.0*f[50]+80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[40])*vcut_lR5+(180.0*f[105]+225.0*f[97]-180.0*f[96]-225.0*f[88])*vcut_lR4+((-80.0*f[47])-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+((-120.0*f[105])-150.0*f[97]+120.0*f[96]+150.0*f[88])*vcut_lR2+(80.0*f[47]+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l-60.0*f[105]-75.0*f[97]+60.0*f[96]+75.0*f[88]-80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[79])*vcut_lR5+((-180.0*f[83])+450.0*f[76]-225.0*f[75]+180.0*f[74]-450.0*f[63]+225.0*f[60]-270.0*f[28]+150.0*f[4])*vcut_lR4+(240.0*f[81]+600.0*f[79]+300.0*f[71]-240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+(120.0*f[83]-300.0*f[76]+150.0*f[75]-120.0*f[74]+300.0*f[63]-150.0*f[60]+180.0*f[28]-100.0*f[4])*vcut_lR2+((-240.0*f[81])-300.0*f[79]-300.0*f[71]+240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l+60.0*f[83]+240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]-240.0*f[66]+150.0*f[63]-75.0*f[60]+90.0*f[28]-50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[12])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(360.0*f[12]-200.0*f[0])*vcut_l-270.0*f[54]+150.0*f[11])+(900.0*f[19]-1620.0*f[77])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[9])*vcut_lR4+(600.0*f[7]-600.0*f[14])*vcut_lR3+(300.0*f[9]-300.0*f[15])*vcut_lR2+(600.0*f[14]-600.0*f[7])*vcut_l-150.0*f[15]+150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]-1350.0*f[30]+1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]+900.0*f[30]-900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]+720.0*f[77]-375.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[1][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[1][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[1][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[1][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[1][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_2 
  vcutSq = 0.01*(2.23606797749979*((-63.63961030678928*phiWall[19])+63.63961030678928*phi[19]+35.35533905932738*phiWall[9]-35.35533905932738*phi[9]+14.14213562373095*phiWall[8]-14.14213562373095*phi[8]+14.14213562373095*phiWall[7]-14.14213562373095*phi[7]+1.732050807568877*((-21.21320343559643*phiWall[6])+21.21320343559643*(phi[6]+phiWall[5])-21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*(phi[2]+phiWall[1])+21.21320343559643*phi[1])+1.732050807568877*(42.42640687119286*phiWall[18]-42.42640687119286*(phi[18]+phiWall[17])+42.42640687119286*phi[17]+63.63961030678928*phiWall[10]-63.63961030678928*phi[10]-35.35533905932738*phiWall[3]+35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*(phi[16]+phiWall[15])+7.071067811865476*phi[15]-2.828427124746191*phiWall[12]+2.828427124746191*(phi[12]+phiWall[11])-2.828427124746191*phi[11])-14.14213562373095*phiWall[14]+14.14213562373095*phi[14]-14.14213562373095*phiWall[13]+14.14213562373095*phi[13])-63.63961030678928*phiWall[4]+63.63961030678928*phi[4]+35.35533905932738*phiWall[0]-35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[2][0] = 0.0; 
  fReflSurfXY[2][1] = 0.0; 
  fReflSurfXY[2][2] = 0.0; 
  fReflSurfXY[2][3] = 0.0; 
  fReflSurfXY[2][4] = 0.0; 
  fReflSurfXY[2][5] = 0.0; 
  fReflSurfXY[2][6] = 0.0; 
  fReflSurfXY[2][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[2][0] = -0.01414213562373095*(11.18033988749895*(9.0*f[58]-1.0*(5.0*f[18]+2.0*(f[17]+f[16])+5.196152422706631*(f[7]-1.0*f[8]))+3.0*(f[1]-1.0*f[2]))-1.0*(8.660254037844386*(3.0*(2.0*f[57]+3.0*f[21])-5.0*f[3])+3.872983346207417*(3.872983346207417*(5.0*f[36]-1.0*(5.0*f[35]+2.0*f[32])+2.0*f[31])-10.0*(f[34]+f[33])))+5.0*(9.0*f[6]-5.0*f[0])); 
  fReflSurfXY[2][1] = 0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[88]-1.0*f[87])-8.660254037844386*(9.0*f[89]-1.0*(5.0*f[39]+2.0*(f[38]+f[37]))))+225.0*f[64]-1.0*(225.0*f[63]+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[24]-1.0*f[23]))+9.0*(f[9]-1.0*f[10])))+5.0*(9.0*(2.0*f[59]-2.0*f[60])+5.196152422706631*(9.0*f[51]-5.0*f[11])+3.0*(5.0*f[4]-9.0*f[22]))); 
  fReflSurfXY[2][2] = 0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[92]-1.0*f[91])-8.660254037844386*(9.0*f[93]-1.0*(5.0*f[45]+2.0*(f[44]+f[43]))))+225.0*f[73]-1.0*(225.0*f[72]+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[27]-1.0*f[26]))+9.0*(f[12]-1.0*f[13])))+5.0*(9.0*(2.0*f[68]-2.0*f[69])+5.196152422706631*(9.0*f[52]-5.0*f[14])+3.0*(5.0*f[5]-9.0*f[25]))); 
  fReflSurfXY[2][3] = -0.01414213562373095*(11.18033988749895*(9.0*f[109]-1.0*(5.0*f[76]+2.0*(f[75]+f[74])+5.196152422706631*(f[54]-1.0*f[55]))+3.0*(f[28]-1.0*f[29]))-1.0*(8.660254037844386*(3.0*(2.0*f[108]+3.0*f[86])-5.0*f[30])+3.872983346207417*(3.872983346207417*(5.0*f[99]-1.0*(5.0*f[98]+2.0*f[95])+2.0*f[94])-10.0*(f[97]+f[96])))+5.0*(9.0*f[53]-5.0*f[15])); 
  fReflSurfXY[2][4] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]-5.0*f[42])+8.660254037844386*(f[41]-1.0*f[40]))+58.09475019311126*(f[66]-1.0*f[67])+5.0*(5.0*f[19]-9.0*f[65])); 
  fReflSurfXY[2][5] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]-5.0*f[49])+8.660254037844386*(f[48]-1.0*f[47]))+58.09475019311126*(f[81]-1.0*f[82])+5.0*(5.0*f[20]-9.0*f[80])); 
  fReflSurfXY[2][6] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]-5.0*f[79])+8.660254037844386*(f[78]-1.0*f[77]))+58.09475019311126*(f[101]-1.0*f[102])+5.0*(5.0*f[46]-9.0*f[100])); 
  fReflSurfXY[2][7] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]-5.0*f[85])+8.660254037844386*(f[84]-1.0*f[83]))+58.09475019311126*(f[105]-1.0*f[106])+5.0*(5.0*f[50]-9.0*f[104])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]+30.0*f[83]-60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+60.0*f[57]-60.0*f[56]+45.0*f[29]-45.0*f[28]+90.0*f[27]-90.0*f[26]+45.0*f[22]+90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]-90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-36.0*f[92]+36.0*f[91]+45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]-30.0*f[88]+30.0*f[87]+20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+((-225.0*f[78])+225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]+75.0*f[15]+150.0*f[14]-75.0*f[10]+75.0*f[9]-150.0*f[8]+150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]-225.0*f[30]+270.0*f[25]+225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]-135.0*f[102]+135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+216.0*f[92]-216.0*f[91]-135.0*f[90]-360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]+216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]-360.0*f[15]-540.0*f[14]+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]+1080.0*f[51]+540.0*f[13]-540.0*f[12]-600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[29]+1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[27]-1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]+720.0*f[84]-720.0*f[83]+1080.0*f[82]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[29]+1080.0*f[28]-1620.0*f[27]+1620.0*f[26]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]-135.0*f[29]+135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[29]-90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]-30.0*f[84]+30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]+120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]-72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+72.0*f[90]+45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87]-40.0*f[46]+40.0*f[41]-40.0*f[40]))+((-810.0*f[78])+810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]-75.0*f[10]+75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]+30.0*f[83]+60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-60.0*f[57]+60.0*f[56]+45.0*f[29]-45.0*f[28]-90.0*f[27]+90.0*f[26]+45.0*f[22]-90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+36.0*f[92]-36.0*f[91]+45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]-30.0*f[88]+30.0*f[87]-20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+((-225.0*f[78])+225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]+75.0*f[15]-150.0*f[14]-75.0*f[10]+75.0*f[9]+150.0*f[8]-150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]-225.0*f[30]-270.0*f[25]+225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]-135.0*f[102]+135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+216.0*f[92]-216.0*f[91]-135.0*f[90]+360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]+360.0*f[15]-540.0*f[14]-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]-1080.0*f[51]+540.0*f[13]-540.0*f[12]+600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[29]+1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[27]-1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]-720.0*f[84]+720.0*f[83]+1080.0*f[82]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[29]-1080.0*f[28]-1620.0*f[27]+1620.0*f[26]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]-135.0*f[29]+135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[29]-90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]-30.0*f[84]+30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]-120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]+72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-72.0*f[90]+45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87]+40.0*f[46]-40.0*f[41]+40.0*f[40]))+((-810.0*f[78])+810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]-75.0*f[10]+75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l-9.0*f[104]-18.0*f[103]+18.0*f[89]+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[40])*vcut_lR3+(15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87])*vcut_lR2+((-10.0*f[48])+10.0*f[47]-10.0*f[41]+10.0*f[40]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31])*vcut_l-15.0*f[106]+15.0*f[105]-12.0*f[88]+12.0*f[87]-10.0*f[48]+10.0*f[47]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[67])*vcut_lR3+((-15.0*f[84])+15.0*f[83]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]-18.0*f[22]+10.0*f[4])*vcut_lR2+(30.0*f[82]-30.0*f[81]+30.0*f[67]-30.0*f[66]+24.0*f[57]-24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l+15.0*f[84]-15.0*f[83]+30.0*f[82]-30.0*f[81]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]+24.0*f[57]-24.0*f[56]+18.0*f[22]+36.0*f[21]-10.0*f[4]-20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[6])*vcut_l-54.0*f[51]+30.0*f[11]-36.0*f[6]+20.0*f[0])+(50.0*f[19]-90.0*f[65])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[9])*vcut_lR2+(60.0*f[7]-60.0*f[8])*vcut_l-30.0*f[10]+30.0*f[9]-60.0*f[8]+60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]-90.0*f[24]+90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]+90.0*f[80]+60.0*f[62]+60.0*f[61]-180.0*f[58]+90.0*f[24]-90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]-225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+180.0*f[104]+270.0*f[103]-135.0*f[90]-360.0*f[89]-100.0*f[50]-150.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+(180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[65])*vcut_lR4+((-540.0*f[111])+300.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[24]+360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2-540.0*f[111]+300.0*f[85]-270.0*f[80]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]-360.0*f[24]+360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[8])*vcut_lR2+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+(2025.0*f[66]-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[51]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[6])*vcut_lR2+1080.0*f[51]-600.0*f[11]+540.0*f[6]-300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(1350.0*f[82]-1350.0*f[81]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[21]-900.0*f[3])*vcut_lR2-900.0*f[84]+900.0*f[83]-1350.0*f[82]+1350.0*f[81]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l-45.0*f[104]+144.0*f[90]+90.0*f[89]+25.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[40])*vcut_lR5+(225.0*f[106]-225.0*f[105]+180.0*f[88]-180.0*f[87])*vcut_lR4+((-100.0*f[48])+100.0*f[47]-200.0*f[41]+200.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_lR3+((-150.0*f[106])+150.0*f[105]-120.0*f[88]+120.0*f[87])*vcut_lR2+(100.0*f[48]-100.0*f[47]+100.0*f[41]-100.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_l-75.0*f[106]+75.0*f[105]-60.0*f[88]+60.0*f[87]+80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[67])*vcut_lR5+((-225.0*f[84])+225.0*f[83]+450.0*f[64]-450.0*f[63]-180.0*f[60]+180.0*f[59]-270.0*f[22]+150.0*f[4])*vcut_lR4+(300.0*f[82]-300.0*f[81]+600.0*f[67]-600.0*f[66]+240.0*f[57]-240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+(150.0*f[84]-150.0*f[83]-300.0*f[64]+300.0*f[63]+120.0*f[60]-120.0*f[59]+180.0*f[22]-100.0*f[4])*vcut_lR2+((-300.0*f[82])+300.0*f[81]-300.0*f[67]+300.0*f[66]-240.0*f[57]+240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l+75.0*f[84]-75.0*f[83]-240.0*f[67]+240.0*f[66]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[22]-50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[6])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(360.0*f[6]-200.0*f[0])*vcut_l-270.0*f[51]+150.0*f[11])+(900.0*f[19]-1620.0*f[65])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[9])*vcut_lR4+(600.0*f[7]-600.0*f[8])*vcut_lR3+(300.0*f[9]-300.0*f[10])*vcut_lR2+(600.0*f[8]-600.0*f[7])*vcut_l-150.0*f[10]+150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]-1350.0*f[24]+1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]+900.0*f[24]-900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]-720.0*f[65]+300.0*f[62]+300.0*f[61]+450.0*f[24]-450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l-9.0*f[104]+18.0*f[103]+18.0*f[89]+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[40])*vcut_lR3+(15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87])*vcut_lR2+((-10.0*f[48])+10.0*f[47]-10.0*f[41]+10.0*f[40]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31])*vcut_l-15.0*f[106]+15.0*f[105]-12.0*f[88]+12.0*f[87]+10.0*f[48]-10.0*f[47]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[67])*vcut_lR3+((-15.0*f[84])+15.0*f[83]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]-18.0*f[22]+10.0*f[4])*vcut_lR2+(30.0*f[82]-30.0*f[81]+30.0*f[67]-30.0*f[66]+24.0*f[57]-24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l+15.0*f[84]-15.0*f[83]-30.0*f[82]+30.0*f[81]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]-24.0*f[57]+24.0*f[56]+18.0*f[22]-36.0*f[21]-10.0*f[4]+20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[6])*vcut_l-54.0*f[51]+30.0*f[11]+36.0*f[6]-20.0*f[0])+(50.0*f[19]-90.0*f[65])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[9])*vcut_lR2+(60.0*f[7]-60.0*f[8])*vcut_l-30.0*f[10]+30.0*f[9]+60.0*f[8]-60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]-90.0*f[24]+90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]-90.0*f[80]+60.0*f[62]+60.0*f[61]+180.0*f[58]+90.0*f[24]-90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]-225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-180.0*f[104]+270.0*f[103]-135.0*f[90]+360.0*f[89]+100.0*f[50]-150.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+(180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]+180.0*f[105]-144.0*f[88]+144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[65])*vcut_lR4+((-540.0*f[111])+300.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[24]+360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2+540.0*f[111]-300.0*f[85]-270.0*f[80]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]+360.0*f[24]-360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[8])*vcut_lR2-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+(2025.0*f[66]-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[51]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[6])*vcut_lR2-1080.0*f[51]+600.0*f[11]+540.0*f[6]-300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(1350.0*f[82]-1350.0*f[81]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[21]-900.0*f[3])*vcut_lR2+900.0*f[84]-900.0*f[83]-1350.0*f[82]+1350.0*f[81]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l-45.0*f[104]-144.0*f[90]+90.0*f[89]+25.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[40])*vcut_lR5+(225.0*f[106]-225.0*f[105]+180.0*f[88]-180.0*f[87])*vcut_lR4+((-100.0*f[48])+100.0*f[47]-200.0*f[41]+200.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_lR3+((-150.0*f[106])+150.0*f[105]-120.0*f[88]+120.0*f[87])*vcut_lR2+(100.0*f[48]-100.0*f[47]+100.0*f[41]-100.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_l-75.0*f[106]+75.0*f[105]-60.0*f[88]+60.0*f[87]-80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[67])*vcut_lR5+((-225.0*f[84])+225.0*f[83]+450.0*f[64]-450.0*f[63]-180.0*f[60]+180.0*f[59]-270.0*f[22]+150.0*f[4])*vcut_lR4+(300.0*f[82]-300.0*f[81]+600.0*f[67]-600.0*f[66]+240.0*f[57]-240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+(150.0*f[84]-150.0*f[83]-300.0*f[64]+300.0*f[63]+120.0*f[60]-120.0*f[59]+180.0*f[22]-100.0*f[4])*vcut_lR2+((-300.0*f[82])+300.0*f[81]-300.0*f[67]+300.0*f[66]-240.0*f[57]+240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l+75.0*f[84]-75.0*f[83]+240.0*f[67]-240.0*f[66]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[22]-50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[6])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(360.0*f[6]-200.0*f[0])*vcut_l-270.0*f[51]+150.0*f[11])+(900.0*f[19]-1620.0*f[65])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[9])*vcut_lR4+(600.0*f[7]-600.0*f[8])*vcut_lR3+(300.0*f[9]-300.0*f[10])*vcut_lR2+(600.0*f[8]-600.0*f[7])*vcut_l-150.0*f[10]+150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]-1350.0*f[24]+1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]+900.0*f[24]-900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]+720.0*f[65]+300.0*f[62]+300.0*f[61]+450.0*f[24]-450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]-30.0*f[83]+60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-60.0*f[57]+60.0*f[56]+45.0*f[29]-45.0*f[28]+90.0*f[27]-90.0*f[26]-45.0*f[22]-90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-36.0*f[92]+36.0*f[91]-45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]+30.0*f[88]-30.0*f[87]-20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+((-225.0*f[78])+225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]+75.0*f[15]+150.0*f[14]+75.0*f[10]-75.0*f[9]+150.0*f[8]-150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]-225.0*f[30]+270.0*f[25]-225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]-135.0*f[102]+135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+216.0*f[92]-216.0*f[91]+135.0*f[90]+360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]-216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]-360.0*f[15]-540.0*f[14]-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+540.0*f[13]-540.0*f[12]+600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[29]+1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[27]-1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]-720.0*f[84]+720.0*f[83]-1080.0*f[82]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[29]+1080.0*f[28]-1620.0*f[27]+1620.0*f[26]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]-135.0*f[29]+135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[29]-90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]+30.0*f[84]-30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]-120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]-72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-72.0*f[90]-45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87]-40.0*f[46]-40.0*f[41]+40.0*f[40]))+((-810.0*f[78])+810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]+75.0*f[10]-75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]-30.0*f[83]-60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+60.0*f[57]-60.0*f[56]+45.0*f[29]-45.0*f[28]-90.0*f[27]+90.0*f[26]-45.0*f[22]+90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]+90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+36.0*f[92]-36.0*f[91]-45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]+30.0*f[88]-30.0*f[87]+20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+((-225.0*f[78])+225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]+75.0*f[15]-150.0*f[14]+75.0*f[10]-75.0*f[9]-150.0*f[8]+150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]-225.0*f[30]-270.0*f[25]-225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]-135.0*f[102]+135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+216.0*f[92]-216.0*f[91]+135.0*f[90]-360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]+360.0*f[15]-540.0*f[14]+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+540.0*f[13]-540.0*f[12]-600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[29]+1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[27]-1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]+720.0*f[84]-720.0*f[83]-1080.0*f[82]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[29]-1080.0*f[28]-1620.0*f[27]+1620.0*f[26]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]-135.0*f[29]+135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[29]-90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]+30.0*f[84]-30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]+120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]+72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+72.0*f[90]-45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87]+40.0*f[46]+40.0*f[41]-40.0*f[40]))+((-810.0*f[78])+810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]+75.0*f[10]-75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[2][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[2][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[2][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[2][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[2][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_3 
  vcutSq = -0.025*(1.732050807568877*(21.21320343559643*phiWall[17]-21.21320343559643*phi[17]+14.14213562373095*phiWall[3]-14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[16]-2.828427124746191*phi[16]-1.414213562373095*phiWall[11]+1.414213562373095*phi[11])+5.656854249492382*phiWall[14]-5.656854249492382*phi[14]-7.071067811865476*phiWall[13]+7.071067811865476*phi[13])+2.23606797749979*((-14.14213562373095*phiWall[9])+14.14213562373095*phi[9]-5.656854249492382*phiWall[8]+5.656854249492382*phi[8]+7.071067811865476*phiWall[7]-7.071067811865476*phi[7]+1.732050807568877*(8.485281374238571*phi[6]-8.485281374238571*phiWall[6])+8.485281374238571*phiWall[2]-8.485281374238571*phi[2])-14.14213562373095*phiWall[0]+14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[3][0] = 0.0; 
  fReflSurfXY[3][1] = 0.0; 
  fReflSurfXY[3][2] = 0.0; 
  fReflSurfXY[3][3] = 0.0; 
  fReflSurfXY[3][4] = 0.0; 
  fReflSurfXY[3][5] = 0.0; 
  fReflSurfXY[3][6] = 0.0; 
  fReflSurfXY[3][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[3][0] = -0.03535533905932736*(8.660254037844386*(3.0*f[56]+2.0*f[3])+3.872983346207417*(3.872983346207417*(2.0*f[36]-1.0*f[31])+4.0*f[34]-5.0*f[33])-1.0*(2.23606797749979*(2.0*(5.0*f[18]+2.0*f[17])-5.0*f[16]+2.0*(5.196152422706631*f[8]-2.0*f[2]))+10.0*f[0])); 
  fReflSurfXY[3][1] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[87]-1.732050807568877*(2.0*(5.0*f[39]+2.0*f[38])-5.0*f[37]))+90.0*f[64]+2.23606797749979*(5.196152422706631*(4.0*f[62]-1.0*(5.0*f[61]+6.0*f[24]))+18.0*f[10])+5.0*(2.0*(5.196152422706631*f[11]-2.0*f[4])-9.0*f[59])); 
  fReflSurfXY[3][2] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[91]-1.732050807568877*(2.0*(5.0*f[45]+2.0*f[44])-5.0*f[43]))+90.0*f[73]+2.23606797749979*(5.196152422706631*(4.0*f[71]-1.0*(5.0*f[70]+6.0*f[27]))+18.0*f[13])+5.0*(2.0*(5.196152422706631*f[14]-2.0*f[5])-9.0*f[68])); 
  fReflSurfXY[3][3] = -0.03535533905932736*(8.660254037844386*(3.0*f[107]+2.0*f[30])+3.872983346207417*(3.872983346207417*(2.0*f[99]-1.0*f[94])+4.0*f[97]-5.0*f[96])-1.0*(2.23606797749979*(2.0*(5.0*f[76]+2.0*f[75])-5.0*f[74]+2.0*(5.196152422706631*f[55]-2.0*f[29]))+10.0*f[15])); 
  fReflSurfXY[3][4] = 0.07071067811865474*(11.61895003862225*f[67]-3.872983346207417*(2.23606797749979*f[42]+1.732050807568877*f[41])+5.0*f[19]); 
  fReflSurfXY[3][5] = 0.07071067811865474*(11.61895003862225*f[82]-3.872983346207417*(2.23606797749979*f[49]+1.732050807568877*f[48])+5.0*f[20]); 
  fReflSurfXY[3][6] = 0.07071067811865474*(11.61895003862225*f[102]-3.872983346207417*(2.23606797749979*f[79]+1.732050807568877*f[78])+5.0*f[46]); 
  fReflSurfXY[3][7] = 0.07071067811865474*(11.61895003862225*f[106]-3.872983346207417*(2.23606797749979*f[85]+1.732050807568877*f[84])+5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]-18.0*f[91]+4.0*f[50]+8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[41])*vcut_lR3+((-12.0*f[106])-12.0*f[97]+15.0*f[96]+15.0*f[87])*vcut_lR2+(8.0*f[48]-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87]+8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[67])*vcut_lR3+(12.0*f[84]+30.0*f[76]+12.0*f[75]-15.0*f[74]+30.0*f[64]-15.0*f[59]-18.0*f[29]-10.0*f[4])*vcut_lR2+((-24.0*f[82])+30.0*f[79]-24.0*f[71]+30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l-12.0*f[84]-24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]-24.0*f[71]+30.0*f[70]-30.0*f[64]+15.0*f[59]+30.0*f[56]+18.0*f[29]+36.0*f[27]+10.0*f[4]+20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+((-36.0*f[13])-20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]-30.0*f[11]-20.0*f[0])+((-90.0*f[78])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[10])*vcut_lR2+((-60.0*f[14])-60.0*f[8])*vcut_l-30.0*f[15]-60.0*f[14]-30.0*f[10]-60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]-90.0*f[30]-90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]-180.0*f[73]+90.0*f[68]-60.0*f[62]+75.0*f[61]+90.0*f[30]+90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2-135.0*f[102]-360.0*f[99]+180.0*f[94]+270.0*f[91]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+((-144.0*f[106])-144.0*f[97]+180.0*f[96]+180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[97]+180.0*f[96]+180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-225.0*f[19])*vcut_lR4+((-540.0*f[107])+240.0*f[85]+240.0*f[62]-300.0*f[61]-360.0*f[30]-360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2-540.0*f[107]+240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]+240.0*f[62]-300.0*f[61]-360.0*f[30]-360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+((-540.0*f[14])-540.0*f[8])*vcut_lR2+360.0*f[15]+540.0*f[14]+360.0*f[10]+540.0*f[8])+((-2025.0*f[79])-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-300.0*f[0])*vcut_lR2+1080.0*f[55]+540.0*f[13]+600.0*f[11]+300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]-1080.0*f[29]-600.0*f[4])*vcut_lR3+((-1080.0*f[82])+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]+1350.0*f[67]+1350.0*f[56]+1620.0*f[27]+900.0*f[3])*vcut_lR2+720.0*f[84]+1080.0*f[82]+675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1080.0*f[71]-1350.0*f[70]+675.0*f[67]+1800.0*f[64]-900.0*f[59]-1350.0*f[56]-1080.0*f[29]-1620.0*f[27]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l+144.0*f[102]+90.0*f[99]-45.0*f[94]+20.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[41])*vcut_lR5+((-180.0*f[106])-180.0*f[97]+225.0*f[96]+225.0*f[87])*vcut_lR4+(80.0*f[48]-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+(120.0*f[106]+120.0*f[97]-150.0*f[96]-150.0*f[87])*vcut_lR2+((-80.0*f[48])+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l+60.0*f[106]+60.0*f[97]-75.0*f[96]-75.0*f[87]+80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[67])*vcut_lR5+(180.0*f[84]+450.0*f[76]+180.0*f[75]-225.0*f[74]+450.0*f[64]-225.0*f[59]-270.0*f[29]-150.0*f[4])*vcut_lR4+((-240.0*f[82])+600.0*f[79]-240.0*f[71]+300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+((-120.0*f[84])-300.0*f[76]-120.0*f[75]+150.0*f[74]-300.0*f[64]+150.0*f[59]+180.0*f[29]+100.0*f[4])*vcut_lR2+(240.0*f[82]-300.0*f[79]+240.0*f[71]-300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l-60.0*f[84]-240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]-240.0*f[67]-150.0*f[64]+75.0*f[59]+90.0*f[29]+50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+((-360.0*f[13])-200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+(360.0*f[13]+200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+((-1620.0*f[78])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[10])*vcut_lR4+((-600.0*f[14])-600.0*f[8])*vcut_lR3+((-300.0*f[15])-300.0*f[10])*vcut_lR2+(600.0*f[14]+600.0*f[8])*vcut_l-150.0*f[15]-150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]-1350.0*f[30]-1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]+900.0*f[30]+900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]-720.0*f[78]-300.0*f[62]+375.0*f[61]+450.0*f[30]+450.0*f[24]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]+18.0*f[91]+4.0*f[50]-8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[41])*vcut_lR3+((-12.0*f[106])-12.0*f[97]+15.0*f[96]+15.0*f[87])*vcut_lR2+(8.0*f[48]-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87]-8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[67])*vcut_lR3+(12.0*f[84]+30.0*f[76]+12.0*f[75]-15.0*f[74]+30.0*f[64]-15.0*f[59]-18.0*f[29]-10.0*f[4])*vcut_lR2+((-24.0*f[82])+30.0*f[79]-24.0*f[71]+30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l-12.0*f[84]+24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]+24.0*f[71]-30.0*f[70]-30.0*f[64]+15.0*f[59]-30.0*f[56]+18.0*f[29]-36.0*f[27]+10.0*f[4]-20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+((-36.0*f[13])-20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]-30.0*f[11]+20.0*f[0])+((-90.0*f[78])-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[10])*vcut_lR2+((-60.0*f[14])-60.0*f[8])*vcut_l-30.0*f[15]+60.0*f[14]-30.0*f[10]+60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]-90.0*f[30]-90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]+180.0*f[73]-90.0*f[68]-60.0*f[62]+75.0*f[61]+90.0*f[30]+90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2-135.0*f[102]+360.0*f[99]-180.0*f[94]+270.0*f[91]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+((-144.0*f[106])-144.0*f[97]+180.0*f[96]+180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-225.0*f[19])*vcut_lR4+((-540.0*f[107])+240.0*f[85]+240.0*f[62]-300.0*f[61]-360.0*f[30]-360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2+540.0*f[107]-240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]-240.0*f[62]+300.0*f[61]+360.0*f[30]+360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+((-540.0*f[14])-540.0*f[8])*vcut_lR2-360.0*f[15]+540.0*f[14]-360.0*f[10]+540.0*f[8])+((-2025.0*f[79])-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-300.0*f[0])*vcut_lR2-1080.0*f[55]+540.0*f[13]-600.0*f[11]+300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]-1080.0*f[29]-600.0*f[4])*vcut_lR3+((-1080.0*f[82])+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]+1350.0*f[67]+1350.0*f[56]+1620.0*f[27]+900.0*f[3])*vcut_lR2-720.0*f[84]+1080.0*f[82]+675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]+1080.0*f[71]-1350.0*f[70]+675.0*f[67]-1800.0*f[64]+900.0*f[59]-1350.0*f[56]+1080.0*f[29]-1620.0*f[27]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l-144.0*f[102]+90.0*f[99]-45.0*f[94]+20.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[41])*vcut_lR5+((-180.0*f[106])-180.0*f[97]+225.0*f[96]+225.0*f[87])*vcut_lR4+(80.0*f[48]-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+(120.0*f[106]+120.0*f[97]-150.0*f[96]-150.0*f[87])*vcut_lR2+((-80.0*f[48])+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l+60.0*f[106]+60.0*f[97]-75.0*f[96]-75.0*f[87]-80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[67])*vcut_lR5+(180.0*f[84]+450.0*f[76]+180.0*f[75]-225.0*f[74]+450.0*f[64]-225.0*f[59]-270.0*f[29]-150.0*f[4])*vcut_lR4+((-240.0*f[82])+600.0*f[79]-240.0*f[71]+300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+((-120.0*f[84])-300.0*f[76]-120.0*f[75]+150.0*f[74]-300.0*f[64]+150.0*f[59]+180.0*f[29]+100.0*f[4])*vcut_lR2+(240.0*f[82]-300.0*f[79]+240.0*f[71]-300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l-60.0*f[84]+240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]+240.0*f[67]-150.0*f[64]+75.0*f[59]+90.0*f[29]+50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+((-360.0*f[13])-200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+(360.0*f[13]+200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+((-1620.0*f[78])-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[10])*vcut_lR4+((-600.0*f[14])-600.0*f[8])*vcut_lR3+((-300.0*f[15])-300.0*f[10])*vcut_lR2+(600.0*f[14]+600.0*f[8])*vcut_l-150.0*f[15]-150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]-1350.0*f[30]-1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]+900.0*f[30]+900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]+720.0*f[78]-300.0*f[62]+375.0*f[61]+450.0*f[30]+450.0*f[24]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[67]*vcut_lR3)+((-15.0*f[84])+30.0*f[64]-15.0*f[59]-10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[67]+30.0*f[56]+20.0*f[3])*vcut_l+15.0*f[84]+30.0*f[82]-30.0*f[64]+15.0*f[59]+30.0*f[56]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*(10.0*f[41]*vcut_lR3+(15.0*f[106]+15.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]-10.0*f[48]+20.0*f[36]-10.0*f[31]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[10]*vcut_lR2-60.0*f[8]*vcut_l-30.0*f[10]-60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]-90.0*f[24])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]+50.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[2]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+(20.0*f[50]-40.0*f[39]-16.0*f[38]+20.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]+24.0*f[34]-30.0*f[33])*vcut_lR2+20.0*f[50]+30.0*f[49]-15.0*f[42]-40.0*f[39]-16.0*f[38]+20.0*f[37]-24.0*f[34]+30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+(36.0*f[106]+36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2+36.0*f[106]+36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-60.0*f[85])+48.0*f[62]-60.0*f[61]-72.0*f[24])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]+36.0*f[2])*vcut_lR2-60.0*f[85]+48.0*f[62]-60.0*f[61]-72.0*f[24]-30.0*f[20]+15.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3-108.0*f[8]*vcut_lR2+72.0*f[10]+108.0*f[8])-405.0*f[67]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]-120.0*f[4])*vcut_lR3+(270.0*f[82]+270.0*f[67]+270.0*f[56]+180.0*f[3])*vcut_lR2-180.0*f[84]-270.0*f[82]+135.0*f[67]+360.0*f[64]-180.0*f[59]-270.0*f[56]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[67]*vcut_lR5)+((-45.0*f[84])+90.0*f[64]-45.0*f[59]-30.0*f[4])*vcut_lR4+(60.0*f[82]+120.0*f[67]+60.0*f[56]+40.0*f[3])*vcut_lR3+(30.0*f[84]-60.0*f[64]+30.0*f[59]+20.0*f[4])*vcut_lR2+((-60.0*f[82])-60.0*f[67]-60.0*f[56]-40.0*f[3])*vcut_l+15.0*f[84]-48.0*f[67]-30.0*f[64]+15.0*f[59]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]-12.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]+8.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]+16.0*f[42]+10.0*f[39]+4.0*f[38]-5.0*f[37])+1.732050807568877*(36.0*f[41]*vcut_lR5+(45.0*f[106]+45.0*f[87])*vcut_lR4+((-20.0*f[48])-40.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_lR3+((-30.0*f[106])-30.0*f[87])*vcut_lR2+(20.0*f[48]+20.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]+16.0*f[41]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[10]*vcut_lR4-120.0*f[8]*vcut_lR3-60.0*f[10]*vcut_lR2+120.0*f[8]*vcut_l-30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]-270.0*f[24])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]+120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]+180.0*f[24])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]-120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[67]*vcut_lR3)+((-15.0*f[84])+30.0*f[64]-15.0*f[59]-10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[67]+30.0*f[56]+20.0*f[3])*vcut_l+15.0*f[84]-30.0*f[82]-30.0*f[64]+15.0*f[59]-30.0*f[56]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*(10.0*f[41]*vcut_lR3+(15.0*f[106]+15.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]+10.0*f[48]-20.0*f[36]+10.0*f[31]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[10]*vcut_lR2-60.0*f[8]*vcut_l-30.0*f[10]+60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]-90.0*f[24])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]-50.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[2]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+(20.0*f[50]-40.0*f[39]-16.0*f[38]+20.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]+24.0*f[34]-30.0*f[33])*vcut_lR2-20.0*f[50]+30.0*f[49]-15.0*f[42]+40.0*f[39]+16.0*f[38]-20.0*f[37]-24.0*f[34]+30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+(36.0*f[106]+36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2-36.0*f[106]-36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-60.0*f[85])+48.0*f[62]-60.0*f[61]-72.0*f[24])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]+36.0*f[2])*vcut_lR2+60.0*f[85]-48.0*f[62]+60.0*f[61]+72.0*f[24]-30.0*f[20]+15.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3-108.0*f[8]*vcut_lR2-72.0*f[10]+108.0*f[8])-405.0*f[67]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]-120.0*f[4])*vcut_lR3+(270.0*f[82]+270.0*f[67]+270.0*f[56]+180.0*f[3])*vcut_lR2+180.0*f[84]-270.0*f[82]+135.0*f[67]-360.0*f[64]+180.0*f[59]-270.0*f[56]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[67]*vcut_lR5)+((-45.0*f[84])+90.0*f[64]-45.0*f[59]-30.0*f[4])*vcut_lR4+(60.0*f[82]+120.0*f[67]+60.0*f[56]+40.0*f[3])*vcut_lR3+(30.0*f[84]-60.0*f[64]+30.0*f[59]+20.0*f[4])*vcut_lR2+((-60.0*f[82])-60.0*f[67]-60.0*f[56]-40.0*f[3])*vcut_l+15.0*f[84]+48.0*f[67]-30.0*f[64]+15.0*f[59]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]-12.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]+8.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]-16.0*f[42]+10.0*f[39]+4.0*f[38]-5.0*f[37])+1.732050807568877*(36.0*f[41]*vcut_lR5+(45.0*f[106]+45.0*f[87])*vcut_lR4+((-20.0*f[48])-40.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_lR3+((-30.0*f[106])-30.0*f[87])*vcut_lR2+(20.0*f[48]+20.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]-16.0*f[41]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[10]*vcut_lR4-120.0*f[8]*vcut_lR3-60.0*f[10]*vcut_lR2+120.0*f[8]*vcut_l-30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]-270.0*f[24])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]+120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]+180.0*f[24])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]-120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]-18.0*f[91]-4.0*f[50]-8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[41])*vcut_lR3+(12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87])*vcut_lR2+((-8.0*f[48])-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-12.0*f[106]+12.0*f[97]-15.0*f[96]+15.0*f[87]-8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[79])*vcut_lR3+((-12.0*f[84])+30.0*f[76]+12.0*f[75]-15.0*f[74]-30.0*f[64]+15.0*f[59]-18.0*f[29]+10.0*f[4])*vcut_lR2+(24.0*f[82]+30.0*f[79]-24.0*f[71]+30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l+12.0*f[84]+24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]-24.0*f[71]+30.0*f[70]+30.0*f[64]-15.0*f[59]-30.0*f[56]+18.0*f[29]+36.0*f[27]-10.0*f[4]-20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[13])*vcut_l-54.0*f[55]-36.0*f[13]+30.0*f[11]+20.0*f[0])+(50.0*f[19]-90.0*f[78])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[10])*vcut_lR2+(60.0*f[8]-60.0*f[14])*vcut_l-30.0*f[15]-60.0*f[14]+30.0*f[10]+60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[30]+90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]-180.0*f[73]+90.0*f[68]+60.0*f[62]-75.0*f[61]+90.0*f[30]-90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2-135.0*f[102]-360.0*f[99]+180.0*f[94]+270.0*f[91]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+(144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[78])*vcut_lR4+((-540.0*f[107])-240.0*f[85]-240.0*f[62]+300.0*f[61]-360.0*f[30]+360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2-540.0*f[107]-240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]-240.0*f[62]+300.0*f[61]-360.0*f[30]+360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[8]-540.0*f[14])*vcut_lR2+360.0*f[15]+540.0*f[14]-360.0*f[10]-540.0*f[8])+(2025.0*f[67]-2025.0*f[79])*vcut_lR4+1.732050807568877*((1080.0*f[55]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[13])*vcut_lR2+1080.0*f[55]+540.0*f[13]-600.0*f[11]-300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]-1080.0*f[29]+600.0*f[4])*vcut_lR3+(1080.0*f[82]+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]-1350.0*f[67]-1350.0*f[56]+1620.0*f[27]-900.0*f[3])*vcut_lR2-720.0*f[84]-1080.0*f[82]+675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1080.0*f[71]-1350.0*f[70]-675.0*f[67]-1800.0*f[64]+900.0*f[59]+1350.0*f[56]-1080.0*f[29]-1620.0*f[27]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l+144.0*f[102]+90.0*f[99]-45.0*f[94]-20.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[41])*vcut_lR5+(180.0*f[106]-180.0*f[97]+225.0*f[96]-225.0*f[87])*vcut_lR4+((-80.0*f[48])-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+((-120.0*f[106])+120.0*f[97]-150.0*f[96]+150.0*f[87])*vcut_lR2+(80.0*f[48]+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l-60.0*f[106]+60.0*f[97]-75.0*f[96]+75.0*f[87]+80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[79])*vcut_lR5+((-180.0*f[84])+450.0*f[76]+180.0*f[75]-225.0*f[74]-450.0*f[64]+225.0*f[59]-270.0*f[29]+150.0*f[4])*vcut_lR4+(240.0*f[82]+600.0*f[79]-240.0*f[71]+300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+(120.0*f[84]-300.0*f[76]-120.0*f[75]+150.0*f[74]+300.0*f[64]-150.0*f[59]+180.0*f[29]-100.0*f[4])*vcut_lR2+((-240.0*f[82])-300.0*f[79]+240.0*f[71]-300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l+60.0*f[84]-240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]+240.0*f[67]+150.0*f[64]-75.0*f[59]+90.0*f[29]-50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[13])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(360.0*f[13]-200.0*f[0])*vcut_l-270.0*f[55]+150.0*f[11])+(900.0*f[19]-1620.0*f[78])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[10])*vcut_lR4+(600.0*f[8]-600.0*f[14])*vcut_lR3+(300.0*f[10]-300.0*f[15])*vcut_lR2+(600.0*f[14]-600.0*f[8])*vcut_l-150.0*f[15]+150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]-1350.0*f[30]+1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]+900.0*f[30]-900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]-720.0*f[78]+300.0*f[62]-375.0*f[61]+450.0*f[30]-450.0*f[24]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]+18.0*f[91]-4.0*f[50]+8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[41])*vcut_lR3+(12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87])*vcut_lR2+((-8.0*f[48])-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-12.0*f[106]+12.0*f[97]-15.0*f[96]+15.0*f[87]+8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[79])*vcut_lR3+((-12.0*f[84])+30.0*f[76]+12.0*f[75]-15.0*f[74]-30.0*f[64]+15.0*f[59]-18.0*f[29]+10.0*f[4])*vcut_lR2+(24.0*f[82]+30.0*f[79]-24.0*f[71]+30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l+12.0*f[84]-24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]+24.0*f[71]-30.0*f[70]+30.0*f[64]-15.0*f[59]+30.0*f[56]+18.0*f[29]-36.0*f[27]-10.0*f[4]+20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[13])*vcut_l-54.0*f[55]+36.0*f[13]+30.0*f[11]-20.0*f[0])+(50.0*f[19]-90.0*f[78])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[10])*vcut_lR2+(60.0*f[8]-60.0*f[14])*vcut_l-30.0*f[15]+60.0*f[14]+30.0*f[10]-60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[30]+90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]+180.0*f[73]-90.0*f[68]+60.0*f[62]-75.0*f[61]+90.0*f[30]-90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2-135.0*f[102]+360.0*f[99]-180.0*f[94]+270.0*f[91]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+(144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[97]-180.0*f[96]+180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[78])*vcut_lR4+((-540.0*f[107])-240.0*f[85]-240.0*f[62]+300.0*f[61]-360.0*f[30]+360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2+540.0*f[107]+240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]+240.0*f[62]-300.0*f[61]+360.0*f[30]-360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[8]-540.0*f[14])*vcut_lR2-360.0*f[15]+540.0*f[14]+360.0*f[10]-540.0*f[8])+(2025.0*f[67]-2025.0*f[79])*vcut_lR4+1.732050807568877*((1080.0*f[55]-600.0*f[11])*vcut_lR3+(300.0*f[0]-540.0*f[13])*vcut_lR2-1080.0*f[55]+540.0*f[13]+600.0*f[11]-300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]-1080.0*f[29]+600.0*f[4])*vcut_lR3+(1080.0*f[82]+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]-1350.0*f[67]-1350.0*f[56]+1620.0*f[27]-900.0*f[3])*vcut_lR2+720.0*f[84]-1080.0*f[82]+675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]+1080.0*f[71]-1350.0*f[70]-675.0*f[67]+1800.0*f[64]-900.0*f[59]+1350.0*f[56]+1080.0*f[29]-1620.0*f[27]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l-144.0*f[102]+90.0*f[99]-45.0*f[94]-20.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[41])*vcut_lR5+(180.0*f[106]-180.0*f[97]+225.0*f[96]-225.0*f[87])*vcut_lR4+((-80.0*f[48])-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+((-120.0*f[106])+120.0*f[97]-150.0*f[96]+150.0*f[87])*vcut_lR2+(80.0*f[48]+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l-60.0*f[106]+60.0*f[97]-75.0*f[96]+75.0*f[87]-80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[79])*vcut_lR5+((-180.0*f[84])+450.0*f[76]+180.0*f[75]-225.0*f[74]-450.0*f[64]+225.0*f[59]-270.0*f[29]+150.0*f[4])*vcut_lR4+(240.0*f[82]+600.0*f[79]-240.0*f[71]+300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+(120.0*f[84]-300.0*f[76]-120.0*f[75]+150.0*f[74]+300.0*f[64]-150.0*f[59]+180.0*f[29]-100.0*f[4])*vcut_lR2+((-240.0*f[82])-300.0*f[79]+240.0*f[71]-300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l+60.0*f[84]+240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]-240.0*f[67]+150.0*f[64]-75.0*f[59]+90.0*f[29]-50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[13])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(360.0*f[13]-200.0*f[0])*vcut_l-270.0*f[55]+150.0*f[11])+(900.0*f[19]-1620.0*f[78])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[10])*vcut_lR4+(600.0*f[8]-600.0*f[14])*vcut_lR3+(300.0*f[10]-300.0*f[15])*vcut_lR2+(600.0*f[14]-600.0*f[8])*vcut_l-150.0*f[15]+150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]-1350.0*f[30]+1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]+900.0*f[30]-900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]+720.0*f[78]+300.0*f[62]-375.0*f[61]+450.0*f[30]-450.0*f[24]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[3][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[3][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[3][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[3][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[3][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_4 
  vcutSq = 0.125*(3.872983346207417*(1.414213562373095*phiWall[14]-1.414213562373095*phi[14]+1.414213562373095*phiWall[13]-1.414213562373095*phi[13])+2.23606797749979*(2.828427124746191*phiWall[9]-2.828427124746191*phi[9]-1.414213562373095*phiWall[8]+1.414213562373095*phi[8]-1.414213562373095*phiWall[7]+1.414213562373095*phi[7])+1.732050807568877*(2.828427124746191*phi[3]-2.828427124746191*phiWall[3])+2.828427124746191*phiWall[0]-2.828427124746191*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[4][0] = 0.0; 
  fReflSurfXY[4][1] = 0.0; 
  fReflSurfXY[4][2] = 0.0; 
  fReflSurfXY[4][3] = 0.0; 
  fReflSurfXY[4][4] = 0.0; 
  fReflSurfXY[4][5] = 0.0; 
  fReflSurfXY[4][6] = 0.0; 
  fReflSurfXY[4][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[4][0] = 0.1767766952966368*(3.872983346207417*(f[34]+f[33])+2.23606797749979*(2.0*f[18]-1.0*(f[17]+f[16]))-3.464101615137754*f[3]+2.0*f[0]); 
  fReflSurfXY[4][1] = 0.05892556509887893*(1.732050807568877*(6.708203932499369*(f[62]+f[61])+3.872983346207417*(2.0*f[39]-1.0*(f[38]+f[37]))-6.0*f[11])+6.0*f[4]); 
  fReflSurfXY[4][2] = 0.05892556509887893*(1.732050807568877*(6.708203932499369*(f[71]+f[70])+3.872983346207417*(2.0*f[45]-1.0*(f[44]+f[43]))-6.0*f[14])+6.0*f[5]); 
  fReflSurfXY[4][3] = 0.1767766952966368*(3.872983346207417*(f[97]+f[96])+2.23606797749979*(2.0*f[76]-1.0*(f[75]+f[74]))-3.464101615137754*f[30]+2.0*f[15]); 
  fReflSurfXY[4][4] = -0.07071067811865474*(8.660254037844387*f[42]-5.0*f[19]); 
  fReflSurfXY[4][5] = -0.07071067811865474*(8.660254037844387*f[49]-5.0*f[20]); 
  fReflSurfXY[4][6] = -0.07071067811865474*(8.660254037844387*f[79]-5.0*f[46]); 
  fReflSurfXY[4][7] = -0.07071067811865474*(8.660254037844387*f[85]-5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[79]*vcut_lR3)+(30.0*f[76]-15.0*f[75]-15.0*f[74]-10.0*f[4])*vcut_lR2+(30.0*f[79]+30.0*f[71]+30.0*f[70]+20.0*f[3])*vcut_l-30.0*f[76]+15.0*f[75]+15.0*f[74]+30.0*f[71]+30.0*f[70]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(1.732050807568877*(10.0*f[46]*vcut_lR3+(15.0*f[97]+15.0*f[96])*vcut_lR2+((-10.0*f[46])+20.0*f[45]-10.0*f[44]-10.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]+20.0*f[45]-10.0*f[44]-10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+((-4.0*f[50])-10.0*f[39]+5.0*f[38]+5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]-5.0*f[37]-10.0*f[34]-10.0*f[33]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[15]*vcut_lR2-60.0*f[14]*vcut_l-30.0*f[15]-60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]-90.0*f[30])*vcut_lR2+((-40.0*f[20])+50.0*f[19]-100.0*f[18]+50.0*f[17]+50.0*f[16]+60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]-40.0*f[20]-100.0*f[18]+50.0*f[17]+50.0*f[16]+60.0*f[5]); 
  fReflSurfXYMu[0][1] = -0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+(36.0*f[97]+36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2+36.0*f[97]+36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*(45.0*f[42]*vcut_lR4+((-16.0*f[50])-40.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR3+(24.0*f[49]-30.0*f[42]-30.0*f[34]-30.0*f[33])*vcut_lR2-16.0*f[50]-24.0*f[49]-15.0*f[42]-40.0*f[39]+20.0*f[38]+20.0*f[37]+30.0*f[34]+30.0*f[33]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(48.0*f[85]-60.0*f[62]-60.0*f[61]-72.0*f[30])*vcut_lR3+((-24.0*f[20])+30.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]+36.0*f[5])*vcut_lR2+48.0*f[85]-60.0*f[62]-60.0*f[61]-72.0*f[30]+24.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3-108.0*f[14]*vcut_lR2+72.0*f[15]+108.0*f[14])-405.0*f[79]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]-120.0*f[4])*vcut_lR3+(270.0*f[79]+270.0*f[71]+270.0*f[70]+180.0*f[3])*vcut_lR2+135.0*f[79]+360.0*f[76]-180.0*f[75]-180.0*f[74]-270.0*f[71]-270.0*f[70]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[0][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[79]*vcut_lR5)+(90.0*f[76]-45.0*f[75]-45.0*f[74]-30.0*f[4])*vcut_lR4+(120.0*f[79]+60.0*f[71]+60.0*f[70]+40.0*f[3])*vcut_lR3+((-60.0*f[76])+30.0*f[75]+30.0*f[74]+20.0*f[4])*vcut_lR2+((-60.0*f[79])-60.0*f[71]-60.0*f[70]-40.0*f[3])*vcut_l-48.0*f[79]-30.0*f[76]+15.0*f[75]+15.0*f[74]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*(36.0*f[46]*vcut_lR5+(45.0*f[97]+45.0*f[96])*vcut_lR4+((-40.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_lR3+((-30.0*f[97])-30.0*f[96])*vcut_lR2+(20.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]+16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+((-12.0*f[50])-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(8.0*f[50]+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+4.0*f[50]+16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[15]*vcut_lR4-120.0*f[14]*vcut_lR3-60.0*f[15]*vcut_lR2+120.0*f[14]*vcut_l-30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]-270.0*f[30])*vcut_lR4+((-80.0*f[20])+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]+120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]+180.0*f[30])*vcut_lR2+(80.0*f[20]-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]-120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[79]*vcut_lR3)+(30.0*f[76]-15.0*f[75]-15.0*f[74]-10.0*f[4])*vcut_lR2+(30.0*f[79]+30.0*f[71]+30.0*f[70]+20.0*f[3])*vcut_l-30.0*f[76]+15.0*f[75]+15.0*f[74]-30.0*f[71]-30.0*f[70]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(1.732050807568877*(10.0*f[46]*vcut_lR3+(15.0*f[97]+15.0*f[96])*vcut_lR2+((-10.0*f[46])+20.0*f[45]-10.0*f[44]-10.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]-20.0*f[45]+10.0*f[44]+10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+((-4.0*f[50])-10.0*f[39]+5.0*f[38]+5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]-5.0*f[37]+10.0*f[34]+10.0*f[33]))-50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[15]*vcut_lR2-60.0*f[14]*vcut_l-30.0*f[15]+60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]-90.0*f[30])*vcut_lR2+((-40.0*f[20])+50.0*f[19]-100.0*f[18]+50.0*f[17]+50.0*f[16]+60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]+40.0*f[20]+100.0*f[18]-50.0*f[17]-50.0*f[16]-60.0*f[5]); 
  fReflSurfXYMu[0][1] = 0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+(36.0*f[97]+36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2-36.0*f[97]-36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*(45.0*f[42]*vcut_lR4+((-16.0*f[50])-40.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR3+(24.0*f[49]-30.0*f[42]-30.0*f[34]-30.0*f[33])*vcut_lR2+16.0*f[50]-24.0*f[49]-15.0*f[42]+40.0*f[39]-20.0*f[38]-20.0*f[37]+30.0*f[34]+30.0*f[33]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(48.0*f[85]-60.0*f[62]-60.0*f[61]-72.0*f[30])*vcut_lR3+((-24.0*f[20])+30.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]+36.0*f[5])*vcut_lR2-48.0*f[85]+60.0*f[62]+60.0*f[61]+72.0*f[30]+24.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3-108.0*f[14]*vcut_lR2-72.0*f[15]+108.0*f[14])-405.0*f[79]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]-120.0*f[4])*vcut_lR3+(270.0*f[79]+270.0*f[71]+270.0*f[70]+180.0*f[3])*vcut_lR2+135.0*f[79]-360.0*f[76]+180.0*f[75]+180.0*f[74]-270.0*f[71]-270.0*f[70]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[0][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[79]*vcut_lR5)+(90.0*f[76]-45.0*f[75]-45.0*f[74]-30.0*f[4])*vcut_lR4+(120.0*f[79]+60.0*f[71]+60.0*f[70]+40.0*f[3])*vcut_lR3+((-60.0*f[76])+30.0*f[75]+30.0*f[74]+20.0*f[4])*vcut_lR2+((-60.0*f[79])-60.0*f[71]-60.0*f[70]-40.0*f[3])*vcut_l+48.0*f[79]-30.0*f[76]+15.0*f[75]+15.0*f[74]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*(36.0*f[46]*vcut_lR5+(45.0*f[97]+45.0*f[96])*vcut_lR4+((-40.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_lR3+((-30.0*f[97])-30.0*f[96])*vcut_lR2+(20.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]-16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+((-12.0*f[50])-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(8.0*f[50]+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+4.0*f[50]-16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37]))-180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[15]*vcut_lR4-120.0*f[14]*vcut_lR3-60.0*f[15]*vcut_lR2+120.0*f[14]*vcut_l-30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]-270.0*f[30])*vcut_lR4+((-80.0*f[20])+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]+120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]+180.0*f[30])*vcut_lR2+(80.0*f[20]-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]-120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.01397542485937369*(8.660254037844387*(2.0*f[42]*vcut_lR3+(f[50]-2.0*f[39]+f[38]+f[37])*vcut_lR2+((-2.0*f[49])-2.0*f[42]-2.0*f[34]-2.0*f[33])*vcut_l-1.0*f[50]-2.0*f[49]+2.0*f[39]-1.0*f[38]-1.0*f[37]-2.0*f[34]-2.0*f[33])-10.0*f[19]*vcut_lR3+2.23606797749979*(1.732050807568877*((-2.0*f[4]*vcut_lR2)+4.0*f[3]*vcut_l+2.0*f[4]+4.0*f[3])+6.0*f[11]*vcut_lR2-4.0*f[0]*vcut_l-6.0*f[11]-4.0*f[0])+((-15.0*f[85])-15.0*f[62]-15.0*f[61])*vcut_lR2+(10.0*f[20]+10.0*f[19]-20.0*f[18]+10.0*f[17]+10.0*f[16])*vcut_l+15.0*f[85]+15.0*f[62]+15.0*f[61]+10.0*f[20]-20.0*f[18]+10.0*f[17]+10.0*f[16]); 
  fReflSurfXYMu[1][1] = -0.005208333333333333*(6.708203932499369*(9.0*f[42]*vcut_lR4+(4.0*f[50]-8.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR3+((-6.0*f[49])-6.0*f[42]-6.0*f[34]-6.0*f[33])*vcut_lR2+4.0*f[50]+6.0*f[49]-3.0*f[42]-8.0*f[39]+4.0*f[38]+4.0*f[37]+6.0*f[34]+6.0*f[33])+3.872983346207417*((-9.0*f[19]*vcut_lR4)+((-12.0*f[85])-12.0*f[62]-12.0*f[61])*vcut_lR3+(6.0*f[20]+6.0*f[19]-12.0*f[18]+6.0*f[17]+6.0*f[16])*vcut_lR2-12.0*f[85]-12.0*f[62]-12.0*f[61]-6.0*f[20]+3.0*f[19]+12.0*f[18]-6.0*f[17]-6.0*f[16])+1.732050807568877*(24.0*f[11]*vcut_lR3-12.0*f[0]*vcut_lR2+24.0*f[11]+12.0*f[0])-24.0*f[4]*vcut_lR3+36.0*f[3]*vcut_lR2-24.0*f[4]-36.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(8.660254037844387*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]+16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37])-180.0*f[19]*vcut_lR5+2.23606797749979*(1.732050807568877*((-30.0*f[4]*vcut_lR4)+40.0*f[3]*vcut_lR3+20.0*f[4]*vcut_lR2-40.0*f[3]*vcut_l+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+((-225.0*f[85])-225.0*f[62]-225.0*f[61])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16])*vcut_lR3+(150.0*f[85]+150.0*f[62]+150.0*f[61])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16])*vcut_l+75.0*f[85]+75.0*f[62]+75.0*f[61]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.01397542485937369*(8.660254037844387*(2.0*f[42]*vcut_lR3+(f[50]-2.0*f[39]+f[38]+f[37])*vcut_lR2+((-2.0*f[49])-2.0*f[42]-2.0*f[34]-2.0*f[33])*vcut_l-1.0*f[50]+2.0*f[49]+2.0*f[39]-1.0*f[38]-1.0*f[37]+2.0*f[34]+2.0*f[33])-10.0*f[19]*vcut_lR3+2.23606797749979*(1.732050807568877*((-2.0*f[4]*vcut_lR2)+4.0*f[3]*vcut_l+2.0*f[4]-4.0*f[3])+6.0*f[11]*vcut_lR2-4.0*f[0]*vcut_l-6.0*f[11]+4.0*f[0])+((-15.0*f[85])-15.0*f[62]-15.0*f[61])*vcut_lR2+(10.0*f[20]+10.0*f[19]-20.0*f[18]+10.0*f[17]+10.0*f[16])*vcut_l+15.0*f[85]+15.0*f[62]+15.0*f[61]-10.0*f[20]+20.0*f[18]-10.0*f[17]-10.0*f[16]); 
  fReflSurfXYMu[1][1] = 0.005208333333333333*(6.708203932499369*(9.0*f[42]*vcut_lR4+(4.0*f[50]-8.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR3+((-6.0*f[49])-6.0*f[42]-6.0*f[34]-6.0*f[33])*vcut_lR2-4.0*f[50]+6.0*f[49]-3.0*f[42]+8.0*f[39]-4.0*f[38]-4.0*f[37]+6.0*f[34]+6.0*f[33])+3.872983346207417*((-9.0*f[19]*vcut_lR4)+((-12.0*f[85])-12.0*f[62]-12.0*f[61])*vcut_lR3+(6.0*f[20]+6.0*f[19]-12.0*f[18]+6.0*f[17]+6.0*f[16])*vcut_lR2+12.0*f[85]+12.0*f[62]+12.0*f[61]-6.0*f[20]+3.0*f[19]+12.0*f[18]-6.0*f[17]-6.0*f[16])+1.732050807568877*(24.0*f[11]*vcut_lR3-12.0*f[0]*vcut_lR2-24.0*f[11]+12.0*f[0])-24.0*f[4]*vcut_lR3+36.0*f[3]*vcut_lR2+24.0*f[4]-36.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(8.660254037844387*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]-16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37])-180.0*f[19]*vcut_lR5+2.23606797749979*(1.732050807568877*((-30.0*f[4]*vcut_lR4)+40.0*f[3]*vcut_lR3+20.0*f[4]*vcut_lR2-40.0*f[3]*vcut_l+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+((-225.0*f[85])-225.0*f[62]-225.0*f[61])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16])*vcut_lR3+(150.0*f[85]+150.0*f[62]+150.0*f[61])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16])*vcut_l+75.0*f[85]+75.0*f[62]+75.0*f[61]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[79]*vcut_lR3+((-30.0*f[76])+15.0*f[75]+15.0*f[74]-10.0*f[4])*vcut_lR2+((-30.0*f[79])-30.0*f[71]-30.0*f[70]+20.0*f[3])*vcut_l+30.0*f[76]-15.0*f[75]-15.0*f[74]-30.0*f[71]-30.0*f[70]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(1.732050807568877*((-10.0*f[46]*vcut_lR3)+((-15.0*f[97])-15.0*f[96])*vcut_lR2+(10.0*f[46]-20.0*f[45]+10.0*f[44]+10.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]-20.0*f[45]+10.0*f[44]+10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+((-4.0*f[50])-10.0*f[39]+5.0*f[38]+5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]-5.0*f[37]-10.0*f[34]-10.0*f[33]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[15]*vcut_lR2)+60.0*f[14]*vcut_l+30.0*f[15]+60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]+90.0*f[30])*vcut_lR2+((-40.0*f[20])+50.0*f[19]-100.0*f[18]+50.0*f[17]+50.0*f[16]-60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]-40.0*f[20]-100.0*f[18]+50.0*f[17]+50.0*f[16]-60.0*f[5]); 
  fReflSurfXYMu[2][1] = 0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+(36.0*f[97]+36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2+36.0*f[97]+36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*((-45.0*f[42]*vcut_lR4)+(16.0*f[50]+40.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR3+((-24.0*f[49])+30.0*f[42]+30.0*f[34]+30.0*f[33])*vcut_lR2+16.0*f[50]+24.0*f[49]+15.0*f[42]+40.0*f[39]-20.0*f[38]-20.0*f[37]-30.0*f[34]-30.0*f[33]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-48.0*f[85])+60.0*f[62]+60.0*f[61]-72.0*f[30])*vcut_lR3+(24.0*f[20]-30.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]+36.0*f[5])*vcut_lR2-48.0*f[85]+60.0*f[62]+60.0*f[61]-72.0*f[30]-24.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3-108.0*f[14]*vcut_lR2+72.0*f[15]+108.0*f[14])-405.0*f[79]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]+120.0*f[4])*vcut_lR3+(270.0*f[79]+270.0*f[71]+270.0*f[70]-180.0*f[3])*vcut_lR2+135.0*f[79]+360.0*f[76]-180.0*f[75]-180.0*f[74]-270.0*f[71]-270.0*f[70]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[2][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[79]*vcut_lR5+((-90.0*f[76])+45.0*f[75]+45.0*f[74]-30.0*f[4])*vcut_lR4+((-120.0*f[79])-60.0*f[71]-60.0*f[70]+40.0*f[3])*vcut_lR3+(60.0*f[76]-30.0*f[75]-30.0*f[74]+20.0*f[4])*vcut_lR2+(60.0*f[79]+60.0*f[71]+60.0*f[70]-40.0*f[3])*vcut_l+48.0*f[79]+30.0*f[76]-15.0*f[75]-15.0*f[74]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*((-36.0*f[46]*vcut_lR5)+((-45.0*f[97])-45.0*f[96])*vcut_lR4+(40.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_lR3+(30.0*f[97]+30.0*f[96])*vcut_lR2+((-20.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]-16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+((-12.0*f[50])-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(8.0*f[50]+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+4.0*f[50]+16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[15]*vcut_lR4)+120.0*f[14]*vcut_lR3+60.0*f[15]*vcut_lR2-120.0*f[14]*vcut_l+30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]+270.0*f[30])*vcut_lR4+((-80.0*f[20])+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]-120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]-180.0*f[30])*vcut_lR2+(80.0*f[20]-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]+120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[79]*vcut_lR3+((-30.0*f[76])+15.0*f[75]+15.0*f[74]-10.0*f[4])*vcut_lR2+((-30.0*f[79])-30.0*f[71]-30.0*f[70]+20.0*f[3])*vcut_l+30.0*f[76]-15.0*f[75]-15.0*f[74]+30.0*f[71]+30.0*f[70]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(1.732050807568877*((-10.0*f[46]*vcut_lR3)+((-15.0*f[97])-15.0*f[96])*vcut_lR2+(10.0*f[46]-20.0*f[45]+10.0*f[44]+10.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]+20.0*f[45]-10.0*f[44]-10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+((-4.0*f[50])-10.0*f[39]+5.0*f[38]+5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]-5.0*f[37]+10.0*f[34]+10.0*f[33]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[15]*vcut_lR2)+60.0*f[14]*vcut_l+30.0*f[15]-60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]+90.0*f[30])*vcut_lR2+((-40.0*f[20])+50.0*f[19]-100.0*f[18]+50.0*f[17]+50.0*f[16]-60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]+40.0*f[20]+100.0*f[18]-50.0*f[17]-50.0*f[16]+60.0*f[5]); 
  fReflSurfXYMu[2][1] = -0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+(36.0*f[97]+36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2-36.0*f[97]-36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*((-45.0*f[42]*vcut_lR4)+(16.0*f[50]+40.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR3+((-24.0*f[49])+30.0*f[42]+30.0*f[34]+30.0*f[33])*vcut_lR2-16.0*f[50]+24.0*f[49]+15.0*f[42]-40.0*f[39]+20.0*f[38]+20.0*f[37]-30.0*f[34]-30.0*f[33]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-48.0*f[85])+60.0*f[62]+60.0*f[61]-72.0*f[30])*vcut_lR3+(24.0*f[20]-30.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]+36.0*f[5])*vcut_lR2+48.0*f[85]-60.0*f[62]-60.0*f[61]+72.0*f[30]-24.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3-108.0*f[14]*vcut_lR2-72.0*f[15]+108.0*f[14])-405.0*f[79]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]+120.0*f[4])*vcut_lR3+(270.0*f[79]+270.0*f[71]+270.0*f[70]-180.0*f[3])*vcut_lR2+135.0*f[79]-360.0*f[76]+180.0*f[75]+180.0*f[74]-270.0*f[71]-270.0*f[70]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[2][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[79]*vcut_lR5+((-90.0*f[76])+45.0*f[75]+45.0*f[74]-30.0*f[4])*vcut_lR4+((-120.0*f[79])-60.0*f[71]-60.0*f[70]+40.0*f[3])*vcut_lR3+(60.0*f[76]-30.0*f[75]-30.0*f[74]+20.0*f[4])*vcut_lR2+(60.0*f[79]+60.0*f[71]+60.0*f[70]-40.0*f[3])*vcut_l-48.0*f[79]+30.0*f[76]-15.0*f[75]-15.0*f[74]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*((-36.0*f[46]*vcut_lR5)+((-45.0*f[97])-45.0*f[96])*vcut_lR4+(40.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_lR3+(30.0*f[97]+30.0*f[96])*vcut_lR2+((-20.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]+16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+((-12.0*f[50])-30.0*f[39]+15.0*f[38]+15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(8.0*f[50]+20.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+4.0*f[50]-16.0*f[42]+10.0*f[39]-5.0*f[38]-5.0*f[37]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[15]*vcut_lR4)+120.0*f[14]*vcut_lR3+60.0*f[15]*vcut_lR2-120.0*f[14]*vcut_l+30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]+270.0*f[30])*vcut_lR4+((-80.0*f[20])+200.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]-120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]-180.0*f[30])*vcut_lR2+(80.0*f[20]-100.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]+120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[4][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[4][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[4][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[4][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[4][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_5 
  vcutSq = 0.025*(1.732050807568877*(21.21320343559643*phiWall[17]-21.21320343559643*phi[17]-14.14213562373095*phiWall[3]+14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[16]-2.828427124746191*phi[16]-1.414213562373095*phiWall[11]+1.414213562373095*phi[11])-5.656854249492382*phiWall[14]+5.656854249492382*phi[14]+7.071067811865476*phiWall[13]-7.071067811865476*phi[13])+2.23606797749979*(14.14213562373095*phiWall[9]-14.14213562373095*phi[9]+5.656854249492382*phiWall[8]-5.656854249492382*phi[8]-7.071067811865476*phiWall[7]+7.071067811865476*phi[7]+1.732050807568877*(8.485281374238571*phi[6]-8.485281374238571*phiWall[6])+8.485281374238571*phiWall[2]-8.485281374238571*phi[2])+14.14213562373095*phiWall[0]-14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[5][0] = 0.0; 
  fReflSurfXY[5][1] = 0.0; 
  fReflSurfXY[5][2] = 0.0; 
  fReflSurfXY[5][3] = 0.0; 
  fReflSurfXY[5][4] = 0.0; 
  fReflSurfXY[5][5] = 0.0; 
  fReflSurfXY[5][6] = 0.0; 
  fReflSurfXY[5][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[5][0] = 0.03535533905932736*(8.660254037844386*(3.0*f[56]-2.0*f[3])+3.872983346207417*(3.872983346207417*(2.0*f[36]-1.0*f[31])-4.0*f[34]+5.0*f[33])+2.23606797749979*(2.0*(5.0*f[18]+2.0*f[17])-1.0*(5.0*f[16]+10.39230484541326*f[8])+6.0*f[2])+10.0*f[0]); 
  fReflSurfXY[5][1] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[87]+1.732050807568877*(2.0*(5.0*f[39]+2.0*f[38])-5.0*f[37]))+90.0*f[64]+2.23606797749979*(18.0*f[10]-5.196152422706631*(4.0*f[62]-5.0*f[61]+6.0*f[24]))+5.0*(6.0*f[4]-1.0*(9.0*f[59]+10.39230484541326*f[11]))); 
  fReflSurfXY[5][2] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[91]+1.732050807568877*(2.0*(5.0*f[45]+2.0*f[44])-5.0*f[43]))+90.0*f[73]+2.23606797749979*(18.0*f[13]-5.196152422706631*(4.0*f[71]-5.0*f[70]+6.0*f[27]))+5.0*(6.0*f[5]-1.0*(9.0*f[68]+10.39230484541326*f[14]))); 
  fReflSurfXY[5][3] = 0.03535533905932736*(8.660254037844386*(3.0*f[107]-2.0*f[30])+3.872983346207417*(3.872983346207417*(2.0*f[99]-1.0*f[94])-4.0*f[97]+5.0*f[96])+2.23606797749979*(2.0*(5.0*f[76]+2.0*f[75])-1.0*(5.0*f[74]+10.39230484541326*f[55])+6.0*f[29])+10.0*f[15]); 
  fReflSurfXY[5][4] = -0.07071067811865474*(11.61895003862225*f[67]+3.872983346207417*(2.23606797749979*f[42]-1.732050807568877*f[41])-5.0*f[19]); 
  fReflSurfXY[5][5] = -0.07071067811865474*(11.61895003862225*f[82]+3.872983346207417*(2.23606797749979*f[49]-1.732050807568877*f[48])-5.0*f[20]); 
  fReflSurfXY[5][6] = -0.07071067811865474*(11.61895003862225*f[102]+3.872983346207417*(2.23606797749979*f[79]-1.732050807568877*f[78])-5.0*f[46]); 
  fReflSurfXY[5][7] = -0.07071067811865474*(11.61895003862225*f[106]+3.872983346207417*(2.23606797749979*f[85]-1.732050807568877*f[84])-5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]-18.0*f[91]-4.0*f[50]-8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[46])*vcut_lR3+((-12.0*f[106])+12.0*f[97]-15.0*f[96]+15.0*f[87])*vcut_lR2+(8.0*f[48]+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87]+8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[67])*vcut_lR3+(12.0*f[84]-30.0*f[76]-12.0*f[75]+15.0*f[74]+30.0*f[64]-15.0*f[59]-18.0*f[29]+10.0*f[4])*vcut_lR2+((-24.0*f[82])-30.0*f[79]+24.0*f[71]-30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l-12.0*f[84]-24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]+24.0*f[71]-30.0*f[70]-30.0*f[64]+15.0*f[59]+30.0*f[56]+18.0*f[29]+36.0*f[27]-10.0*f[4]-20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[13])*vcut_l-54.0*f[55]-36.0*f[13]+30.0*f[11]+20.0*f[0])+(50.0*f[19]-90.0*f[78])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[15])*vcut_lR2+(60.0*f[14]-60.0*f[8])*vcut_l+30.0*f[15]+60.0*f[14]-30.0*f[10]-60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[30]-90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]-180.0*f[73]+90.0*f[68]+60.0*f[62]-75.0*f[61]-90.0*f[30]+90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[102])*vcut_lR4+(360.0*f[99]-180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2+135.0*f[102]+360.0*f[99]-180.0*f[94]-270.0*f[91]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+(144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-225.0*f[19])*vcut_lR4+(540.0*f[107]+240.0*f[85]+240.0*f[62]-300.0*f[61]-360.0*f[30]+360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2+540.0*f[107]+240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]+240.0*f[62]-300.0*f[61]-360.0*f[30]+360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[8]-540.0*f[14])*vcut_lR2+360.0*f[15]+540.0*f[14]-360.0*f[10]-540.0*f[8])+(2025.0*f[67]-2025.0*f[79])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[55])*vcut_lR3+(540.0*f[13]-300.0*f[0])*vcut_lR2-1080.0*f[55]-540.0*f[13]+600.0*f[11]+300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]+1080.0*f[29]-600.0*f[4])*vcut_lR3+(1080.0*f[82]+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]-1350.0*f[67]-1350.0*f[56]-1620.0*f[27]+900.0*f[3])*vcut_lR2-720.0*f[84]-1080.0*f[82]+675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1080.0*f[71]-1350.0*f[70]-675.0*f[67]-1800.0*f[64]+900.0*f[59]+1350.0*f[56]+1080.0*f[29]+1620.0*f[27]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l+144.0*f[102]+90.0*f[99]-45.0*f[94]-20.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[46])*vcut_lR5+((-180.0*f[106])+180.0*f[97]-225.0*f[96]+225.0*f[87])*vcut_lR4+(80.0*f[48]+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+(120.0*f[106]-120.0*f[97]+150.0*f[96]-150.0*f[87])*vcut_lR2+((-80.0*f[48])-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l+60.0*f[106]-60.0*f[97]+75.0*f[96]-75.0*f[87]-80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[67])*vcut_lR5+(180.0*f[84]-450.0*f[76]-180.0*f[75]+225.0*f[74]+450.0*f[64]-225.0*f[59]-270.0*f[29]+150.0*f[4])*vcut_lR4+((-240.0*f[82])-600.0*f[79]+240.0*f[71]-300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+((-120.0*f[84])+300.0*f[76]+120.0*f[75]-150.0*f[74]-300.0*f[64]+150.0*f[59]+180.0*f[29]-100.0*f[4])*vcut_lR2+(240.0*f[82]+300.0*f[79]-240.0*f[71]+300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l-60.0*f[84]+240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]-240.0*f[67]-150.0*f[64]+75.0*f[59]+90.0*f[29]-50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[13])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(360.0*f[13]-200.0*f[0])*vcut_l-270.0*f[55]+150.0*f[11])+(900.0*f[19]-1620.0*f[78])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[15])*vcut_lR4+(600.0*f[14]-600.0*f[8])*vcut_lR3+(300.0*f[15]-300.0*f[10])*vcut_lR2+(600.0*f[8]-600.0*f[14])*vcut_l+150.0*f[15]-150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]+1350.0*f[30]-1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]-900.0*f[30]+900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]-720.0*f[78]+300.0*f[62]-375.0*f[61]-450.0*f[30]+450.0*f[24]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]+18.0*f[91]-4.0*f[50]+8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[46])*vcut_lR3+((-12.0*f[106])+12.0*f[97]-15.0*f[96]+15.0*f[87])*vcut_lR2+(8.0*f[48]+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87]-8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[67])*vcut_lR3+(12.0*f[84]-30.0*f[76]-12.0*f[75]+15.0*f[74]+30.0*f[64]-15.0*f[59]-18.0*f[29]+10.0*f[4])*vcut_lR2+((-24.0*f[82])-30.0*f[79]+24.0*f[71]-30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l-12.0*f[84]+24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]-24.0*f[71]+30.0*f[70]-30.0*f[64]+15.0*f[59]-30.0*f[56]+18.0*f[29]-36.0*f[27]-10.0*f[4]+20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[13])*vcut_l-54.0*f[55]+36.0*f[13]+30.0*f[11]-20.0*f[0])+(50.0*f[19]-90.0*f[78])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[15])*vcut_lR2+(60.0*f[14]-60.0*f[8])*vcut_l+30.0*f[15]-60.0*f[14]-30.0*f[10]+60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[30]-90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]+180.0*f[73]-90.0*f[68]+60.0*f[62]-75.0*f[61]-90.0*f[30]+90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[102])*vcut_lR4+(360.0*f[99]-180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2+135.0*f[102]-360.0*f[99]+180.0*f[94]-270.0*f[91]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+(144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[97]-180.0*f[96]+180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-225.0*f[19])*vcut_lR4+(540.0*f[107]+240.0*f[85]+240.0*f[62]-300.0*f[61]-360.0*f[30]+360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2-540.0*f[107]-240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]-240.0*f[62]+300.0*f[61]+360.0*f[30]-360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[8]-540.0*f[14])*vcut_lR2-360.0*f[15]+540.0*f[14]+360.0*f[10]-540.0*f[8])+(2025.0*f[67]-2025.0*f[79])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[55])*vcut_lR3+(540.0*f[13]-300.0*f[0])*vcut_lR2+1080.0*f[55]-540.0*f[13]-600.0*f[11]+300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]+1080.0*f[29]-600.0*f[4])*vcut_lR3+(1080.0*f[82]+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]-1350.0*f[67]-1350.0*f[56]-1620.0*f[27]+900.0*f[3])*vcut_lR2+720.0*f[84]-1080.0*f[82]+675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]+1080.0*f[71]-1350.0*f[70]-675.0*f[67]+1800.0*f[64]-900.0*f[59]+1350.0*f[56]-1080.0*f[29]+1620.0*f[27]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l-144.0*f[102]+90.0*f[99]-45.0*f[94]-20.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[46])*vcut_lR5+((-180.0*f[106])+180.0*f[97]-225.0*f[96]+225.0*f[87])*vcut_lR4+(80.0*f[48]+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+(120.0*f[106]-120.0*f[97]+150.0*f[96]-150.0*f[87])*vcut_lR2+((-80.0*f[48])-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l+60.0*f[106]-60.0*f[97]+75.0*f[96]-75.0*f[87]+80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[67])*vcut_lR5+(180.0*f[84]-450.0*f[76]-180.0*f[75]+225.0*f[74]+450.0*f[64]-225.0*f[59]-270.0*f[29]+150.0*f[4])*vcut_lR4+((-240.0*f[82])-600.0*f[79]+240.0*f[71]-300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+((-120.0*f[84])+300.0*f[76]+120.0*f[75]-150.0*f[74]-300.0*f[64]+150.0*f[59]+180.0*f[29]-100.0*f[4])*vcut_lR2+(240.0*f[82]+300.0*f[79]-240.0*f[71]+300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l-60.0*f[84]-240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]+240.0*f[67]-150.0*f[64]+75.0*f[59]+90.0*f[29]-50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[13])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(360.0*f[13]-200.0*f[0])*vcut_l-270.0*f[55]+150.0*f[11])+(900.0*f[19]-1620.0*f[78])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[15])*vcut_lR4+(600.0*f[14]-600.0*f[8])*vcut_lR3+(300.0*f[15]-300.0*f[10])*vcut_lR2+(600.0*f[8]-600.0*f[14])*vcut_l+150.0*f[15]-150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]+1350.0*f[30]-1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]-900.0*f[30]+900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]+720.0*f[78]+300.0*f[62]-375.0*f[61]-450.0*f[30]+450.0*f[24]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[67]*vcut_lR3+(15.0*f[84]-30.0*f[64]+15.0*f[59]-10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[67]-30.0*f[56]+20.0*f[3])*vcut_l-15.0*f[84]-30.0*f[82]+30.0*f[64]-15.0*f[59]-30.0*f[56]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((-10.0*f[41]*vcut_lR3)+((-15.0*f[106])-15.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]+10.0*f[48]-20.0*f[36]+10.0*f[31]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[10]*vcut_lR2)+60.0*f[8]*vcut_l+30.0*f[10]+60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]+90.0*f[24])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]+50.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[2]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-20.0*f[50])+40.0*f[39]+16.0*f[38]-20.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]-24.0*f[34]+30.0*f[33])*vcut_lR2-20.0*f[50]-30.0*f[49]+15.0*f[42]+40.0*f[39]+16.0*f[38]-20.0*f[37]+24.0*f[34]-30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+(36.0*f[106]+36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2+36.0*f[106]+36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(60.0*f[85]-48.0*f[62]+60.0*f[61]-72.0*f[24])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]+36.0*f[2])*vcut_lR2+60.0*f[85]-48.0*f[62]+60.0*f[61]-72.0*f[24]+30.0*f[20]-15.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3-108.0*f[8]*vcut_lR2+72.0*f[10]+108.0*f[8])-405.0*f[67]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]+120.0*f[4])*vcut_lR3+(270.0*f[82]+270.0*f[67]+270.0*f[56]-180.0*f[3])*vcut_lR2-180.0*f[84]-270.0*f[82]+135.0*f[67]+360.0*f[64]-180.0*f[59]-270.0*f[56]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[67]*vcut_lR5+(45.0*f[84]-90.0*f[64]+45.0*f[59]-30.0*f[4])*vcut_lR4+((-60.0*f[82])-120.0*f[67]-60.0*f[56]+40.0*f[3])*vcut_lR3+((-30.0*f[84])+60.0*f[64]-30.0*f[59]+20.0*f[4])*vcut_lR2+(60.0*f[82]+60.0*f[67]+60.0*f[56]-40.0*f[3])*vcut_l-15.0*f[84]+48.0*f[67]+30.0*f[64]-15.0*f[59]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]-12.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]+8.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]+16.0*f[42]+10.0*f[39]+4.0*f[38]-5.0*f[37])+1.732050807568877*((-36.0*f[41]*vcut_lR5)+((-45.0*f[106])-45.0*f[87])*vcut_lR4+(20.0*f[48]+40.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_lR3+(30.0*f[106]+30.0*f[87])*vcut_lR2+((-20.0*f[48])-20.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]-16.0*f[41]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[10]*vcut_lR4)+120.0*f[8]*vcut_lR3+60.0*f[10]*vcut_lR2-120.0*f[8]*vcut_l+30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]+270.0*f[24])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]-120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]-180.0*f[24])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]+120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[67]*vcut_lR3+(15.0*f[84]-30.0*f[64]+15.0*f[59]-10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[67]-30.0*f[56]+20.0*f[3])*vcut_l-15.0*f[84]+30.0*f[82]+30.0*f[64]-15.0*f[59]+30.0*f[56]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((-10.0*f[41]*vcut_lR3)+((-15.0*f[106])-15.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]-10.0*f[48]+20.0*f[36]-10.0*f[31]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[10]*vcut_lR2)+60.0*f[8]*vcut_l+30.0*f[10]-60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]+90.0*f[24])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]-50.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[2]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-20.0*f[50])+40.0*f[39]+16.0*f[38]-20.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]-24.0*f[34]+30.0*f[33])*vcut_lR2+20.0*f[50]-30.0*f[49]+15.0*f[42]-40.0*f[39]-16.0*f[38]+20.0*f[37]+24.0*f[34]-30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+(36.0*f[106]+36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2-36.0*f[106]-36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(60.0*f[85]-48.0*f[62]+60.0*f[61]-72.0*f[24])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]+36.0*f[2])*vcut_lR2-60.0*f[85]+48.0*f[62]-60.0*f[61]+72.0*f[24]+30.0*f[20]-15.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3-108.0*f[8]*vcut_lR2-72.0*f[10]+108.0*f[8])-405.0*f[67]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]+120.0*f[4])*vcut_lR3+(270.0*f[82]+270.0*f[67]+270.0*f[56]-180.0*f[3])*vcut_lR2+180.0*f[84]-270.0*f[82]+135.0*f[67]-360.0*f[64]+180.0*f[59]-270.0*f[56]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[67]*vcut_lR5+(45.0*f[84]-90.0*f[64]+45.0*f[59]-30.0*f[4])*vcut_lR4+((-60.0*f[82])-120.0*f[67]-60.0*f[56]+40.0*f[3])*vcut_lR3+((-30.0*f[84])+60.0*f[64]-30.0*f[59]+20.0*f[4])*vcut_lR2+(60.0*f[82]+60.0*f[67]+60.0*f[56]-40.0*f[3])*vcut_l-15.0*f[84]-48.0*f[67]+30.0*f[64]-15.0*f[59]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]-12.0*f[38]+15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]+8.0*f[38]-10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l-5.0*f[50]-16.0*f[42]+10.0*f[39]+4.0*f[38]-5.0*f[37])+1.732050807568877*((-36.0*f[41]*vcut_lR5)+((-45.0*f[106])-45.0*f[87])*vcut_lR4+(20.0*f[48]+40.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_lR3+(30.0*f[106]+30.0*f[87])*vcut_lR2+((-20.0*f[48])-20.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]+16.0*f[41]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[10]*vcut_lR4)+120.0*f[8]*vcut_lR3+60.0*f[10]*vcut_lR2-120.0*f[8]*vcut_l+30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]+270.0*f[24])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]-120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]-180.0*f[24])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]+120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]-18.0*f[91]+4.0*f[50]+8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[41])*vcut_lR3+(12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87])*vcut_lR2+((-8.0*f[48])+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-12.0*f[106]-12.0*f[97]+15.0*f[96]+15.0*f[87]-8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[67])*vcut_lR3+((-12.0*f[84])-30.0*f[76]-12.0*f[75]+15.0*f[74]-30.0*f[64]+15.0*f[59]-18.0*f[29]-10.0*f[4])*vcut_lR2+(24.0*f[82]-30.0*f[79]+24.0*f[71]-30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l+12.0*f[84]+24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]+24.0*f[71]-30.0*f[70]+30.0*f[64]-15.0*f[59]-30.0*f[56]+18.0*f[29]+36.0*f[27]+10.0*f[4]+20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+((-36.0*f[13])-20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]-30.0*f[11]-20.0*f[0])+((-90.0*f[78])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[10])*vcut_lR2+(60.0*f[14]+60.0*f[8])*vcut_l+30.0*f[15]+60.0*f[14]+30.0*f[10]+60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]+90.0*f[30]+90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]-180.0*f[73]+90.0*f[68]-60.0*f[62]+75.0*f[61]-90.0*f[30]-90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2+135.0*f[102]+360.0*f[99]-180.0*f[94]-270.0*f[91]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+((-144.0*f[106])-144.0*f[97]+180.0*f[96]+180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[97]+180.0*f[96]+180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+225.0*f[19])*vcut_lR4+(540.0*f[107]-240.0*f[85]-240.0*f[62]+300.0*f[61]-360.0*f[30]-360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2+540.0*f[107]-240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]-240.0*f[62]+300.0*f[61]-360.0*f[30]-360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+((-540.0*f[14])-540.0*f[8])*vcut_lR2+360.0*f[15]+540.0*f[14]+360.0*f[10]+540.0*f[8])+((-2025.0*f[79])-2025.0*f[67])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-600.0*f[11])*vcut_lR3+(540.0*f[13]+300.0*f[0])*vcut_lR2-1080.0*f[55]-540.0*f[13]-600.0*f[11]-300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]+1080.0*f[29]+600.0*f[4])*vcut_lR3+((-1080.0*f[82])+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]+1350.0*f[67]+1350.0*f[56]-1620.0*f[27]-900.0*f[3])*vcut_lR2+720.0*f[84]+1080.0*f[82]+675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1080.0*f[71]-1350.0*f[70]+675.0*f[67]+1800.0*f[64]-900.0*f[59]-1350.0*f[56]+1080.0*f[29]+1620.0*f[27]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l+144.0*f[102]+90.0*f[99]-45.0*f[94]+20.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[41])*vcut_lR5+(180.0*f[106]+180.0*f[97]-225.0*f[96]-225.0*f[87])*vcut_lR4+((-80.0*f[48])+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+((-120.0*f[106])-120.0*f[97]+150.0*f[96]+150.0*f[87])*vcut_lR2+(80.0*f[48]-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l-60.0*f[106]-60.0*f[97]+75.0*f[96]+75.0*f[87]-80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[67])*vcut_lR5+((-180.0*f[84])-450.0*f[76]-180.0*f[75]+225.0*f[74]-450.0*f[64]+225.0*f[59]-270.0*f[29]-150.0*f[4])*vcut_lR4+(240.0*f[82]-600.0*f[79]+240.0*f[71]-300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+(120.0*f[84]+300.0*f[76]+120.0*f[75]-150.0*f[74]+300.0*f[64]-150.0*f[59]+180.0*f[29]+100.0*f[4])*vcut_lR2+((-240.0*f[82])+300.0*f[79]-240.0*f[71]+300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l+60.0*f[84]+240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]+240.0*f[67]+150.0*f[64]-75.0*f[59]+90.0*f[29]+50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+((-360.0*f[13])-200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+(360.0*f[13]+200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+((-1620.0*f[78])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[10])*vcut_lR4+(600.0*f[14]+600.0*f[8])*vcut_lR3+(300.0*f[15]+300.0*f[10])*vcut_lR2+((-600.0*f[14])-600.0*f[8])*vcut_l+150.0*f[15]+150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]+1350.0*f[30]+1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]-900.0*f[30]-900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]-720.0*f[78]-300.0*f[62]+375.0*f[61]-450.0*f[30]-450.0*f[24]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+((-18.0*f[99])+9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+18.0*f[99]-9.0*f[94]+18.0*f[91]+4.0*f[50]-8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[41])*vcut_lR3+(12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87])*vcut_lR2+((-8.0*f[48])+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-12.0*f[106]-12.0*f[97]+15.0*f[96]+15.0*f[87]+8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[67])*vcut_lR3+((-12.0*f[84])-30.0*f[76]-12.0*f[75]+15.0*f[74]-30.0*f[64]+15.0*f[59]-18.0*f[29]-10.0*f[4])*vcut_lR2+(24.0*f[82]-30.0*f[79]+24.0*f[71]-30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l+12.0*f[84]-24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]-24.0*f[71]+30.0*f[70]+30.0*f[64]-15.0*f[59]+30.0*f[56]+18.0*f[29]-36.0*f[27]+10.0*f[4]-20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+((-36.0*f[13])-20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]-30.0*f[11]+20.0*f[0])+((-90.0*f[78])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[10])*vcut_lR2+(60.0*f[14]+60.0*f[8])*vcut_l+30.0*f[15]-60.0*f[14]+30.0*f[10]-60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]+90.0*f[30]+90.0*f[24])*vcut_lR2+(90.0*f[78]-180.0*f[73]+90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]+180.0*f[73]-90.0*f[68]-60.0*f[62]+75.0*f[61]-90.0*f[30]-90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2+135.0*f[102]-360.0*f[99]+180.0*f[94]-270.0*f[91]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+((-144.0*f[106])-144.0*f[97]+180.0*f[96]+180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+225.0*f[19])*vcut_lR4+(540.0*f[107]-240.0*f[85]-240.0*f[62]+300.0*f[61]-360.0*f[30]-360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2-540.0*f[107]+240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]+240.0*f[62]-300.0*f[61]+360.0*f[30]+360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+((-540.0*f[14])-540.0*f[8])*vcut_lR2-360.0*f[15]+540.0*f[14]-360.0*f[10]+540.0*f[8])+((-2025.0*f[79])-2025.0*f[67])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-600.0*f[11])*vcut_lR3+(540.0*f[13]+300.0*f[0])*vcut_lR2+1080.0*f[55]-540.0*f[13]+600.0*f[11]-300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]+1080.0*f[29]+600.0*f[4])*vcut_lR3+((-1080.0*f[82])+1350.0*f[79]-1080.0*f[71]+1350.0*f[70]+1350.0*f[67]+1350.0*f[56]-1620.0*f[27]-900.0*f[3])*vcut_lR2-720.0*f[84]+1080.0*f[82]+675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]+1080.0*f[71]-1350.0*f[70]+675.0*f[67]-1800.0*f[64]+900.0*f[59]-1350.0*f[56]-1080.0*f[29]+1620.0*f[27]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+((-270.0*f[99])+135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+(180.0*f[99]-90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l-144.0*f[102]+90.0*f[99]-45.0*f[94]+20.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[41])*vcut_lR5+(180.0*f[106]+180.0*f[97]-225.0*f[96]-225.0*f[87])*vcut_lR4+((-80.0*f[48])+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+((-120.0*f[106])-120.0*f[97]+150.0*f[96]+150.0*f[87])*vcut_lR2+(80.0*f[48]-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l-60.0*f[106]-60.0*f[97]+75.0*f[96]+75.0*f[87]+80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[67])*vcut_lR5+((-180.0*f[84])-450.0*f[76]-180.0*f[75]+225.0*f[74]-450.0*f[64]+225.0*f[59]-270.0*f[29]-150.0*f[4])*vcut_lR4+(240.0*f[82]-600.0*f[79]+240.0*f[71]-300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+(120.0*f[84]+300.0*f[76]+120.0*f[75]-150.0*f[74]+300.0*f[64]-150.0*f[59]+180.0*f[29]+100.0*f[4])*vcut_lR2+((-240.0*f[82])+300.0*f[79]-240.0*f[71]+300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l+60.0*f[84]-240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]-240.0*f[67]+150.0*f[64]-75.0*f[59]+90.0*f[29]+50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+((-360.0*f[13])-200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+(360.0*f[13]+200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+((-1620.0*f[78])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[10])*vcut_lR4+(600.0*f[14]+600.0*f[8])*vcut_lR3+(300.0*f[15]+300.0*f[10])*vcut_lR2+((-600.0*f[14])-600.0*f[8])*vcut_l+150.0*f[15]+150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]+1350.0*f[30]+1350.0*f[24])*vcut_lR4+(1800.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]-900.0*f[30]-900.0*f[24])*vcut_lR2+((-900.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]+720.0*f[78]-300.0*f[62]+375.0*f[61]-450.0*f[30]-450.0*f[24]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[5][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[5][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[5][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[5][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[5][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_6 
  vcutSq = -0.01*(2.23606797749979*(63.63961030678928*phiWall[19]-63.63961030678928*phi[19]-35.35533905932738*phiWall[9]+35.35533905932738*phi[9]-14.14213562373095*phiWall[8]+14.14213562373095*phi[8]-14.14213562373095*phiWall[7]+14.14213562373095*phi[7]+1.732050807568877*((-21.21320343559643*phiWall[6])+21.21320343559643*(phi[6]+phiWall[5])-21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*(phi[2]+phiWall[1])+21.21320343559643*phi[1])+1.732050807568877*(42.42640687119286*phiWall[18]-42.42640687119286*(phi[18]+phiWall[17])+42.42640687119286*phi[17]-63.63961030678928*phiWall[10]+63.63961030678928*phi[10]+35.35533905932738*phiWall[3]-35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*(phi[16]+phiWall[15])+7.071067811865476*phi[15]-2.828427124746191*phiWall[12]+2.828427124746191*(phi[12]+phiWall[11])-2.828427124746191*phi[11])+14.14213562373095*phiWall[14]-14.14213562373095*phi[14]+14.14213562373095*phiWall[13]-14.14213562373095*phi[13])+63.63961030678928*phiWall[4]-63.63961030678928*phi[4]-35.35533905932738*phiWall[0]+35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[6][0] = 0.0; 
  fReflSurfXY[6][1] = 0.0; 
  fReflSurfXY[6][2] = 0.0; 
  fReflSurfXY[6][3] = 0.0; 
  fReflSurfXY[6][4] = 0.0; 
  fReflSurfXY[6][5] = 0.0; 
  fReflSurfXY[6][6] = 0.0; 
  fReflSurfXY[6][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[6][0] = -0.01414213562373095*(11.18033988749895*(9.0*f[58]-1.0*(5.0*f[18]+2.0*(f[17]+f[16]))+5.196152422706631*(f[7]-1.0*f[8])+3.0*(f[2]-1.0*f[1]))+8.660254037844386*(3.0*(2.0*f[57]-1.0*(2.0*f[56]+3.0*f[21]))+5.0*f[3])+3.872983346207417*(3.872983346207417*(5.0*f[36]-1.0*(5.0*f[35]+2.0*f[32])+2.0*f[31])+10.0*(f[34]+f[33]))+5.0*(9.0*f[6]-5.0*f[0])); 
  fReflSurfXY[6][1] = -0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[89]-1.0*(5.0*f[39]+2.0*(f[38]+f[37])))+40.24922359499622*(f[88]-1.0*f[87]))+225.0*(f[64]-1.0*f[63])+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[23]-1.0*f[24]))+9.0*(f[10]-1.0*f[9]))+5.0*(9.0*(2.0*f[59]-2.0*f[60])+5.196152422706631*(5.0*f[11]-9.0*f[51])+3.0*(9.0*f[22]-5.0*f[4]))); 
  fReflSurfXY[6][2] = -0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[93]-1.0*(5.0*f[45]+2.0*(f[44]+f[43])))+40.24922359499622*(f[92]-1.0*f[91]))+225.0*(f[73]-1.0*f[72])+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[26]-1.0*f[27]))+9.0*(f[13]-1.0*f[12]))+5.0*(9.0*(2.0*f[68]-2.0*f[69])+5.196152422706631*(5.0*f[14]-9.0*f[52])+3.0*(9.0*f[25]-5.0*f[5]))); 
  fReflSurfXY[6][3] = -0.01414213562373095*(11.18033988749895*(9.0*f[109]-1.0*(5.0*f[76]+2.0*(f[75]+f[74]))+5.196152422706631*(f[54]-1.0*f[55])+3.0*(f[29]-1.0*f[28]))+8.660254037844386*(3.0*(2.0*f[108]-1.0*(2.0*f[107]+3.0*f[86]))+5.0*f[30])+3.872983346207417*(3.872983346207417*(5.0*f[99]-1.0*(5.0*f[98]+2.0*f[95])+2.0*f[94])+10.0*(f[97]+f[96]))+5.0*(9.0*f[53]-5.0*f[15])); 
  fReflSurfXY[6][4] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]-5.0*f[42])+8.660254037844386*(f[40]-1.0*f[41]))+58.09475019311126*(f[67]-1.0*f[66])+5.0*(5.0*f[19]-9.0*f[65])); 
  fReflSurfXY[6][5] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]-5.0*f[49])+8.660254037844386*(f[47]-1.0*f[48]))+58.09475019311126*(f[82]-1.0*f[81])+5.0*(5.0*f[20]-9.0*f[80])); 
  fReflSurfXY[6][6] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]-5.0*f[79])+8.660254037844386*(f[77]-1.0*f[78]))+58.09475019311126*(f[102]-1.0*f[101])+5.0*(5.0*f[46]-9.0*f[100])); 
  fReflSurfXY[6][7] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]-5.0*f[85])+8.660254037844386*(f[83]-1.0*f[84]))+58.09475019311126*(f[106]-1.0*f[105])+5.0*(5.0*f[50]-9.0*f[104])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]+30.0*f[83]-60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+60.0*f[57]-60.0*f[56]+45.0*f[29]-45.0*f[28]+90.0*f[27]-90.0*f[26]-45.0*f[22]-90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-36.0*f[92]+36.0*f[91]-45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]-30.0*f[88]+30.0*f[87]+20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+((-225.0*f[78])+225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]-75.0*f[15]-150.0*f[14]-75.0*f[10]+75.0*f[9]-150.0*f[8]+150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]+225.0*f[30]-270.0*f[25]+225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]+135.0*f[102]-135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-216.0*f[92]+216.0*f[91]-135.0*f[90]-360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]+216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]-360.0*f[15]-540.0*f[14]-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]+1080.0*f[51]-540.0*f[13]+540.0*f[12]-600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[29]-1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[27]+1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]-720.0*f[84]+720.0*f[83]-1080.0*f[82]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[29]-1080.0*f[28]+1620.0*f[27]-1620.0*f[26]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]-135.0*f[29]+135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[29]-90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]-30.0*f[84]+30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]+120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]-72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-72.0*f[90]-45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87]+40.0*f[46]+40.0*f[41]-40.0*f[40]))+((-810.0*f[78])+810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]+30.0*f[83]+60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-60.0*f[57]+60.0*f[56]+45.0*f[29]-45.0*f[28]-90.0*f[27]+90.0*f[26]-45.0*f[22]+90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]+90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+36.0*f[92]-36.0*f[91]-45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]-30.0*f[88]+30.0*f[87]-20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+((-225.0*f[78])+225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]-75.0*f[15]+150.0*f[14]-75.0*f[10]+75.0*f[9]+150.0*f[8]-150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]+225.0*f[30]+270.0*f[25]+225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]+135.0*f[102]-135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-216.0*f[92]+216.0*f[91]-135.0*f[90]+360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]+360.0*f[15]-540.0*f[14]+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]-1080.0*f[51]-540.0*f[13]+540.0*f[12]+600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[29]-1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[27]+1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]+720.0*f[84]-720.0*f[83]-1080.0*f[82]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[29]+1080.0*f[28]+1620.0*f[27]-1620.0*f[26]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]-135.0*f[29]+135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]+90.0*f[29]-90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]-30.0*f[84]+30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]-120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]+72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+72.0*f[90]-45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87]-40.0*f[46]-40.0*f[41]+40.0*f[40]))+((-810.0*f[78])+810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l-9.0*f[104]-18.0*f[103]+18.0*f[89]+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[41])*vcut_lR3+((-15.0*f[106])+15.0*f[105]-12.0*f[88]+12.0*f[87])*vcut_lR2+(10.0*f[48]-10.0*f[47]+10.0*f[41]-10.0*f[40]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31])*vcut_l+15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87]+10.0*f[48]-10.0*f[47]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[66])*vcut_lR3+(15.0*f[84]-15.0*f[83]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]-18.0*f[22]+10.0*f[4])*vcut_lR2+((-30.0*f[82])+30.0*f[81]-30.0*f[67]+30.0*f[66]-24.0*f[57]+24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l-15.0*f[84]+15.0*f[83]-30.0*f[82]+30.0*f[81]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]-24.0*f[57]+24.0*f[56]+18.0*f[22]+36.0*f[21]-10.0*f[4]-20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[6])*vcut_l-54.0*f[51]+30.0*f[11]-36.0*f[6]+20.0*f[0])+(50.0*f[19]-90.0*f[65])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[10])*vcut_lR2+(60.0*f[8]-60.0*f[7])*vcut_l+30.0*f[10]-30.0*f[9]+60.0*f[8]-60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]+90.0*f[24]-90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]+90.0*f[80]+60.0*f[62]+60.0*f[61]-180.0*f[58]-90.0*f[24]+90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[90])*vcut_lR4+((-180.0*f[104])+360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-180.0*f[104]-270.0*f[103]+135.0*f[90]+360.0*f[89]+100.0*f[50]+150.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+(180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]-225.0*f[19])*vcut_lR4+(540.0*f[111]-300.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2+540.0*f[111]-300.0*f[85]+270.0*f[80]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]-360.0*f[24]+360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[8])*vcut_lR2+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+(2025.0*f[66]-2025.0*f[67])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[51])*vcut_lR3+(540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[51]+600.0*f[11]-540.0*f[6]+300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(1350.0*f[82]-1350.0*f[81]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[21]+900.0*f[3])*vcut_lR2-900.0*f[84]+900.0*f[83]-1350.0*f[82]+1350.0*f[81]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l-45.0*f[104]+144.0*f[90]+90.0*f[89]+25.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[41])*vcut_lR5+((-225.0*f[106])+225.0*f[105]-180.0*f[88]+180.0*f[87])*vcut_lR4+(100.0*f[48]-100.0*f[47]+200.0*f[41]-200.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_lR3+(150.0*f[106]-150.0*f[105]+120.0*f[88]-120.0*f[87])*vcut_lR2+((-100.0*f[48])+100.0*f[47]-100.0*f[41]+100.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_l+75.0*f[106]-75.0*f[105]+60.0*f[88]-60.0*f[87]-80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[66])*vcut_lR5+(225.0*f[84]-225.0*f[83]-450.0*f[64]+450.0*f[63]+180.0*f[60]-180.0*f[59]-270.0*f[22]+150.0*f[4])*vcut_lR4+((-300.0*f[82])+300.0*f[81]-600.0*f[67]+600.0*f[66]-240.0*f[57]+240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+((-150.0*f[84])+150.0*f[83]+300.0*f[64]-300.0*f[63]-120.0*f[60]+120.0*f[59]+180.0*f[22]-100.0*f[4])*vcut_lR2+(300.0*f[82]-300.0*f[81]+300.0*f[67]-300.0*f[66]+240.0*f[57]-240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l-75.0*f[84]+75.0*f[83]+240.0*f[67]-240.0*f[66]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[22]-50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[6])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(360.0*f[6]-200.0*f[0])*vcut_l-270.0*f[51]+150.0*f[11])+(900.0*f[19]-1620.0*f[65])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[10])*vcut_lR4+(600.0*f[8]-600.0*f[7])*vcut_lR3+(300.0*f[10]-300.0*f[9])*vcut_lR2+(600.0*f[7]-600.0*f[8])*vcut_l+150.0*f[10]-150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]+1350.0*f[24]-1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]-900.0*f[24]+900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]-720.0*f[65]+300.0*f[62]+300.0*f[61]-450.0*f[24]+450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l-9.0*f[104]+18.0*f[103]+18.0*f[89]+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[41])*vcut_lR3+((-15.0*f[106])+15.0*f[105]-12.0*f[88]+12.0*f[87])*vcut_lR2+(10.0*f[48]-10.0*f[47]+10.0*f[41]-10.0*f[40]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31])*vcut_l+15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87]-10.0*f[48]+10.0*f[47]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[66])*vcut_lR3+(15.0*f[84]-15.0*f[83]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]-18.0*f[22]+10.0*f[4])*vcut_lR2+((-30.0*f[82])+30.0*f[81]-30.0*f[67]+30.0*f[66]-24.0*f[57]+24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l-15.0*f[84]+15.0*f[83]+30.0*f[82]-30.0*f[81]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]+24.0*f[57]-24.0*f[56]+18.0*f[22]-36.0*f[21]-10.0*f[4]+20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[6])*vcut_l-54.0*f[51]+30.0*f[11]+36.0*f[6]-20.0*f[0])+(50.0*f[19]-90.0*f[65])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[10])*vcut_lR2+(60.0*f[8]-60.0*f[7])*vcut_l+30.0*f[10]-30.0*f[9]-60.0*f[8]+60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]+90.0*f[24]-90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]-90.0*f[80]+60.0*f[62]+60.0*f[61]+180.0*f[58]-90.0*f[24]+90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[90])*vcut_lR4+((-180.0*f[104])+360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+180.0*f[104]-270.0*f[103]+135.0*f[90]-360.0*f[89]-100.0*f[50]+150.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+(180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]+180.0*f[105]-144.0*f[88]+144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]-225.0*f[19])*vcut_lR4+(540.0*f[111]-300.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2-540.0*f[111]+300.0*f[85]+270.0*f[80]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]+360.0*f[24]-360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[8])*vcut_lR2-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+(2025.0*f[66]-2025.0*f[67])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[51])*vcut_lR3+(540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[51]-600.0*f[11]-540.0*f[6]+300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(1350.0*f[82]-1350.0*f[81]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[21]+900.0*f[3])*vcut_lR2+900.0*f[84]-900.0*f[83]-1350.0*f[82]+1350.0*f[81]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l-45.0*f[104]-144.0*f[90]+90.0*f[89]+25.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[41])*vcut_lR5+((-225.0*f[106])+225.0*f[105]-180.0*f[88]+180.0*f[87])*vcut_lR4+(100.0*f[48]-100.0*f[47]+200.0*f[41]-200.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_lR3+(150.0*f[106]-150.0*f[105]+120.0*f[88]-120.0*f[87])*vcut_lR2+((-100.0*f[48])+100.0*f[47]-100.0*f[41]+100.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_l+75.0*f[106]-75.0*f[105]+60.0*f[88]-60.0*f[87]+80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[66])*vcut_lR5+(225.0*f[84]-225.0*f[83]-450.0*f[64]+450.0*f[63]+180.0*f[60]-180.0*f[59]-270.0*f[22]+150.0*f[4])*vcut_lR4+((-300.0*f[82])+300.0*f[81]-600.0*f[67]+600.0*f[66]-240.0*f[57]+240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+((-150.0*f[84])+150.0*f[83]+300.0*f[64]-300.0*f[63]-120.0*f[60]+120.0*f[59]+180.0*f[22]-100.0*f[4])*vcut_lR2+(300.0*f[82]-300.0*f[81]+300.0*f[67]-300.0*f[66]+240.0*f[57]-240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l-75.0*f[84]+75.0*f[83]-240.0*f[67]+240.0*f[66]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[22]-50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[6])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(360.0*f[6]-200.0*f[0])*vcut_l-270.0*f[51]+150.0*f[11])+(900.0*f[19]-1620.0*f[65])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[10])*vcut_lR4+(600.0*f[8]-600.0*f[7])*vcut_lR3+(300.0*f[10]-300.0*f[9])*vcut_lR2+(600.0*f[7]-600.0*f[8])*vcut_l+150.0*f[10]-150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]+1350.0*f[24]-1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]-900.0*f[24]+900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]+720.0*f[65]+300.0*f[62]+300.0*f[61]-450.0*f[24]+450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]-30.0*f[83]+60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-60.0*f[57]+60.0*f[56]+45.0*f[29]-45.0*f[28]+90.0*f[27]-90.0*f[26]+45.0*f[22]+90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]-90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-36.0*f[92]+36.0*f[91]+45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]+30.0*f[88]-30.0*f[87]-20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+((-225.0*f[78])+225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]-75.0*f[15]-150.0*f[14]+75.0*f[10]-75.0*f[9]+150.0*f[8]-150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]+225.0*f[30]-270.0*f[25]-225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]+135.0*f[102]-135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-216.0*f[92]+216.0*f[91]+135.0*f[90]+360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]-216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]-360.0*f[15]-540.0*f[14]+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-540.0*f[13]+540.0*f[12]+600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[29]-1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[27]+1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]+720.0*f[84]-720.0*f[83]+1080.0*f[82]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[29]-1080.0*f[28]+1620.0*f[27]-1620.0*f[26]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]-135.0*f[29]+135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[29]-90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]+30.0*f[84]-30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]-120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]-72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+72.0*f[90]+45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87]+40.0*f[46]-40.0*f[41]+40.0*f[40]))+((-810.0*f[78])+810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]-30.0*f[83]-60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+60.0*f[57]-60.0*f[56]+45.0*f[29]-45.0*f[28]-90.0*f[27]+90.0*f[26]+45.0*f[22]-90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])+90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+36.0*f[92]-36.0*f[91]+45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]+30.0*f[88]-30.0*f[87]+20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+((-225.0*f[78])+225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]-75.0*f[15]+150.0*f[14]+75.0*f[10]-75.0*f[9]-150.0*f[8]+150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]-225.0*f[77]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]+225.0*f[30]+270.0*f[25]-225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]+135.0*f[102]-135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-216.0*f[92]+216.0*f[91]+135.0*f[90]-360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])+540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]+360.0*f[15]-540.0*f[14]-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+((-3645.0*f[110])+2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-540.0*f[13]+540.0*f[12]-600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[29]-1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[27]+1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]-720.0*f[84]+720.0*f[83]+1080.0*f[82]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[29]+1080.0*f[28]+1620.0*f[27]-1620.0*f[26]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]-135.0*f[29]+135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]+90.0*f[29]-90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]+30.0*f[84]-30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]+120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]+135.0*f[98]+54.0*f[95]-54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]-90.0*f[98]-36.0*f[95]+36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]+72.0*f[101]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-72.0*f[90]+45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87]-40.0*f[46]+40.0*f[41]-40.0*f[40]))+((-810.0*f[78])+810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]-900.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]+450.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[6][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[6][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[6][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[6][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[6][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_7 
  vcutSq = 0.025*(1.732050807568877*(21.21320343559643*phiWall[18]-21.21320343559643*phi[18]-14.14213562373095*phiWall[3]+14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[15]-2.828427124746191*phi[15]-1.414213562373095*phiWall[12]+1.414213562373095*phi[12])+7.071067811865476*phiWall[14]-7.071067811865476*phi[14]-5.656854249492382*phiWall[13]+5.656854249492382*phi[13])+2.23606797749979*(14.14213562373095*phiWall[9]-14.14213562373095*phi[9]-7.071067811865476*phiWall[8]+7.071067811865476*phi[8]+5.656854249492382*phiWall[7]-5.656854249492382*phi[7]+1.732050807568877*(8.485281374238571*phi[5]-8.485281374238571*phiWall[5])+8.485281374238571*phiWall[1]-8.485281374238571*phi[1])+14.14213562373095*phiWall[0]-14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[7][0] = 0.0; 
  fReflSurfXY[7][1] = 0.0; 
  fReflSurfXY[7][2] = 0.0; 
  fReflSurfXY[7][3] = 0.0; 
  fReflSurfXY[7][4] = 0.0; 
  fReflSurfXY[7][5] = 0.0; 
  fReflSurfXY[7][6] = 0.0; 
  fReflSurfXY[7][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[7][0] = 0.03535533905932736*(8.660254037844386*(3.0*f[57]-2.0*f[3])+3.872983346207417*(3.872983346207417*(2.0*f[35]-1.0*f[32])+5.0*f[34]-4.0*f[33])+2.23606797749979*(5.0*(2.0*f[18]-1.0*f[17])+4.0*f[16]-10.39230484541326*f[7]+6.0*f[1])+10.0*f[0]); 
  fReflSurfXY[7][1] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[88]+1.732050807568877*(5.0*(2.0*f[39]-1.0*f[38])+4.0*f[37]))+90.0*f[63]+2.23606797749979*(5.196152422706631*(5.0*f[62]-1.0*(4.0*f[61]+6.0*f[23]))+18.0*f[9])+5.0*(6.0*f[4]-1.0*(9.0*f[60]+10.39230484541326*f[11]))); 
  fReflSurfXY[7][2] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[92]+1.732050807568877*(5.0*(2.0*f[45]-1.0*f[44])+4.0*f[43]))+90.0*f[72]+2.23606797749979*(5.196152422706631*(5.0*f[71]-1.0*(4.0*f[70]+6.0*f[26]))+18.0*f[12])+5.0*(6.0*f[5]-1.0*(9.0*f[69]+10.39230484541326*f[14]))); 
  fReflSurfXY[7][3] = 0.03535533905932736*(8.660254037844386*(3.0*f[108]-2.0*f[30])+3.872983346207417*(3.872983346207417*(2.0*f[98]-1.0*f[95])+5.0*f[97]-4.0*f[96])+2.23606797749979*(5.0*(2.0*f[76]-1.0*f[75])+4.0*f[74]-10.39230484541326*f[54]+6.0*f[28])+10.0*f[15]); 
  fReflSurfXY[7][4] = -0.07071067811865474*(11.61895003862225*f[66]+3.872983346207417*(2.23606797749979*f[42]-1.732050807568877*f[40])-5.0*f[19]); 
  fReflSurfXY[7][5] = -0.07071067811865474*(11.61895003862225*f[81]+3.872983346207417*(2.23606797749979*f[49]-1.732050807568877*f[47])-5.0*f[20]); 
  fReflSurfXY[7][6] = -0.07071067811865474*(11.61895003862225*f[101]+3.872983346207417*(2.23606797749979*f[79]-1.732050807568877*f[77])-5.0*f[46]); 
  fReflSurfXY[7][7] = -0.07071067811865474*(11.61895003862225*f[105]+3.872983346207417*(2.23606797749979*f[85]-1.732050807568877*f[83])-5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]-18.0*f[92]-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[46])*vcut_lR3+((-12.0*f[105])-15.0*f[97]+12.0*f[96]+15.0*f[88])*vcut_lR2+(8.0*f[47]+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88]+8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[66])*vcut_lR3+(12.0*f[83]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[63]-15.0*f[60]-18.0*f[28]+10.0*f[4])*vcut_lR2+((-24.0*f[81])-30.0*f[79]-30.0*f[71]+24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l-12.0*f[83]-24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[71]+24.0*f[70]-30.0*f[63]+15.0*f[60]+30.0*f[57]+18.0*f[28]+36.0*f[26]-10.0*f[4]-20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[12])*vcut_l-54.0*f[54]-36.0*f[12]+30.0*f[11]+20.0*f[0])+(50.0*f[19]-90.0*f[77])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[15])*vcut_lR2+(60.0*f[14]-60.0*f[7])*vcut_l+30.0*f[15]+60.0*f[14]-30.0*f[9]-60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[30]-90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]-180.0*f[72]+90.0*f[69]-75.0*f[62]+60.0*f[61]-90.0*f[30]+90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[101])*vcut_lR4+(360.0*f[98]-180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2+135.0*f[101]+360.0*f[98]-180.0*f[95]-270.0*f[92]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+(144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2+144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]-225.0*f[19])*vcut_lR4+(540.0*f[108]+240.0*f[85]-300.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2+540.0*f[108]+240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]-300.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[14])*vcut_lR2+360.0*f[15]+540.0*f[14]-360.0*f[9]-540.0*f[7])+(2025.0*f[66]-2025.0*f[79])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[54])*vcut_lR3+(540.0*f[12]-300.0*f[0])*vcut_lR2-1080.0*f[54]-540.0*f[12]+600.0*f[11]+300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]+1080.0*f[28]-600.0*f[4])*vcut_lR3+(1080.0*f[81]+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]-1350.0*f[66]-1350.0*f[57]-1620.0*f[26]+900.0*f[3])*vcut_lR2-720.0*f[83]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1350.0*f[71]+1080.0*f[70]-675.0*f[66]-1800.0*f[63]+900.0*f[60]+1350.0*f[57]+1080.0*f[28]+1620.0*f[26]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l+144.0*f[101]+90.0*f[98]-45.0*f[95]-20.0*f[50]-80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[46])*vcut_lR5+((-180.0*f[105])-225.0*f[97]+180.0*f[96]+225.0*f[88])*vcut_lR4+(80.0*f[47]+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+(120.0*f[105]+150.0*f[97]-120.0*f[96]-150.0*f[88])*vcut_lR2+((-80.0*f[47])-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l+60.0*f[105]+75.0*f[97]-60.0*f[96]-75.0*f[88]-80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[66])*vcut_lR5+(180.0*f[83]-450.0*f[76]+225.0*f[75]-180.0*f[74]+450.0*f[63]-225.0*f[60]-270.0*f[28]+150.0*f[4])*vcut_lR4+((-240.0*f[81])-600.0*f[79]-300.0*f[71]+240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+((-120.0*f[83])+300.0*f[76]-150.0*f[75]+120.0*f[74]-300.0*f[63]+150.0*f[60]+180.0*f[28]-100.0*f[4])*vcut_lR2+(240.0*f[81]+300.0*f[79]+300.0*f[71]-240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l-60.0*f[83]+240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]-240.0*f[66]-150.0*f[63]+75.0*f[60]+90.0*f[28]-50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[12])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(360.0*f[12]-200.0*f[0])*vcut_l-270.0*f[54]+150.0*f[11])+(900.0*f[19]-1620.0*f[77])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[15])*vcut_lR4+(600.0*f[14]-600.0*f[7])*vcut_lR3+(300.0*f[15]-300.0*f[9])*vcut_lR2+(600.0*f[7]-600.0*f[14])*vcut_l+150.0*f[15]-150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]+1350.0*f[30]-1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]-900.0*f[30]+900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]-720.0*f[77]-375.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]+18.0*f[92]-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[46])*vcut_lR3+((-12.0*f[105])-15.0*f[97]+12.0*f[96]+15.0*f[88])*vcut_lR2+(8.0*f[47]+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88]-8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[66])*vcut_lR3+(12.0*f[83]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[63]-15.0*f[60]-18.0*f[28]+10.0*f[4])*vcut_lR2+((-24.0*f[81])-30.0*f[79]-30.0*f[71]+24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l-12.0*f[83]+24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[71]-24.0*f[70]-30.0*f[63]+15.0*f[60]-30.0*f[57]+18.0*f[28]-36.0*f[26]-10.0*f[4]+20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(20.0*f[0]-36.0*f[12])*vcut_l-54.0*f[54]+36.0*f[12]+30.0*f[11]-20.0*f[0])+(50.0*f[19]-90.0*f[77])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[15])*vcut_lR2+(60.0*f[14]-60.0*f[7])*vcut_l+30.0*f[15]-60.0*f[14]-30.0*f[9]+60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[30]-90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]+180.0*f[72]-90.0*f[69]-75.0*f[62]+60.0*f[61]-90.0*f[30]+90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[101])*vcut_lR4+(360.0*f[98]-180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2+135.0*f[101]-360.0*f[98]+180.0*f[95]-270.0*f[92]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+(144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2-144.0*f[105]-180.0*f[97]+144.0*f[96]+180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]-225.0*f[19])*vcut_lR4+(540.0*f[108]+240.0*f[85]-300.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2-540.0*f[108]-240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]+300.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[7]-540.0*f[14])*vcut_lR2-360.0*f[15]+540.0*f[14]+360.0*f[9]-540.0*f[7])+(2025.0*f[66]-2025.0*f[79])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[54])*vcut_lR3+(540.0*f[12]-300.0*f[0])*vcut_lR2+1080.0*f[54]-540.0*f[12]-600.0*f[11]+300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]+1080.0*f[28]-600.0*f[4])*vcut_lR3+(1080.0*f[81]+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]-1350.0*f[66]-1350.0*f[57]-1620.0*f[26]+900.0*f[3])*vcut_lR2+720.0*f[83]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]-1350.0*f[71]+1080.0*f[70]-675.0*f[66]+1800.0*f[63]-900.0*f[60]+1350.0*f[57]-1080.0*f[28]+1620.0*f[26]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l-144.0*f[101]+90.0*f[98]-45.0*f[95]-20.0*f[50]+80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[46])*vcut_lR5+((-180.0*f[105])-225.0*f[97]+180.0*f[96]+225.0*f[88])*vcut_lR4+(80.0*f[47]+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+(120.0*f[105]+150.0*f[97]-120.0*f[96]-150.0*f[88])*vcut_lR2+((-80.0*f[47])-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l+60.0*f[105]+75.0*f[97]-60.0*f[96]-75.0*f[88]+80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[66])*vcut_lR5+(180.0*f[83]-450.0*f[76]+225.0*f[75]-180.0*f[74]+450.0*f[63]-225.0*f[60]-270.0*f[28]+150.0*f[4])*vcut_lR4+((-240.0*f[81])-600.0*f[79]-300.0*f[71]+240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+((-120.0*f[83])+300.0*f[76]-150.0*f[75]+120.0*f[74]-300.0*f[63]+150.0*f[60]+180.0*f[28]-100.0*f[4])*vcut_lR2+(240.0*f[81]+300.0*f[79]+300.0*f[71]-240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l-60.0*f[83]-240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]+240.0*f[66]-150.0*f[63]+75.0*f[60]+90.0*f[28]-50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(200.0*f[0]-360.0*f[12])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(360.0*f[12]-200.0*f[0])*vcut_l-270.0*f[54]+150.0*f[11])+(900.0*f[19]-1620.0*f[77])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[15])*vcut_lR4+(600.0*f[14]-600.0*f[7])*vcut_lR3+(300.0*f[15]-300.0*f[9])*vcut_lR2+(600.0*f[7]-600.0*f[14])*vcut_l+150.0*f[15]-150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]+1350.0*f[30]-1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]-900.0*f[30]+900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]+720.0*f[77]-375.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[66]*vcut_lR3+(15.0*f[83]-30.0*f[63]+15.0*f[60]-10.0*f[4])*vcut_lR2+((-30.0*f[81])-30.0*f[66]-30.0*f[57]+20.0*f[3])*vcut_l-15.0*f[83]-30.0*f[81]+30.0*f[63]-15.0*f[60]-30.0*f[57]+10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-5.0*f[50]-10.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((-10.0*f[40]*vcut_lR3)+((-15.0*f[105])-15.0*f[88])*vcut_lR2+(10.0*f[47]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]+10.0*f[47]-20.0*f[35]+10.0*f[32]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[9]*vcut_lR2)+60.0*f[7]*vcut_l+30.0*f[9]+60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]+90.0*f[23])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]+50.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-20.0*f[50])+40.0*f[39]-20.0*f[38]+16.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]+30.0*f[34]-24.0*f[33])*vcut_lR2-20.0*f[50]-30.0*f[49]+15.0*f[42]+40.0*f[39]-20.0*f[38]+16.0*f[37]-30.0*f[34]+24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+(36.0*f[105]+36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2+36.0*f[105]+36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(60.0*f[85]+60.0*f[62]-48.0*f[61]-72.0*f[23])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]+36.0*f[1])*vcut_lR2+60.0*f[85]+60.0*f[62]-48.0*f[61]-72.0*f[23]+30.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3-108.0*f[7]*vcut_lR2+72.0*f[9]+108.0*f[7])-405.0*f[66]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]+120.0*f[4])*vcut_lR3+(270.0*f[81]+270.0*f[66]+270.0*f[57]-180.0*f[3])*vcut_lR2-180.0*f[83]-270.0*f[81]+135.0*f[66]+360.0*f[63]-180.0*f[60]-270.0*f[57]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[66]*vcut_lR5+(45.0*f[83]-90.0*f[63]+45.0*f[60]-30.0*f[4])*vcut_lR4+((-60.0*f[81])-120.0*f[66]-60.0*f[57]+40.0*f[3])*vcut_lR3+((-30.0*f[83])+60.0*f[63]-30.0*f[60]+20.0*f[4])*vcut_lR2+(60.0*f[81]+60.0*f[66]+60.0*f[57]-40.0*f[3])*vcut_l-15.0*f[83]+48.0*f[66]+30.0*f[63]-15.0*f[60]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]-12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]+8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l-5.0*f[50]+16.0*f[42]+10.0*f[39]-5.0*f[38]+4.0*f[37])+1.732050807568877*((-36.0*f[40]*vcut_lR5)+((-45.0*f[105])-45.0*f[88])*vcut_lR4+(20.0*f[47]+40.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_lR3+(30.0*f[105]+30.0*f[88])*vcut_lR2+((-20.0*f[47])-20.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]-16.0*f[40]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[9]*vcut_lR4)+120.0*f[7]*vcut_lR3+60.0*f[9]*vcut_lR2-120.0*f[7]*vcut_l+30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]+270.0*f[23])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]-120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]-180.0*f[23])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]+120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]-80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[66]*vcut_lR3+(15.0*f[83]-30.0*f[63]+15.0*f[60]-10.0*f[4])*vcut_lR2+((-30.0*f[81])-30.0*f[66]-30.0*f[57]+20.0*f[3])*vcut_l-15.0*f[83]+30.0*f[81]+30.0*f[63]-15.0*f[60]+30.0*f[57]+10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2-20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+(5.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-5.0*f[50]+10.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((-10.0*f[40]*vcut_lR3)+((-15.0*f[105])-15.0*f[88])*vcut_lR2+(10.0*f[47]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]-10.0*f[47]+20.0*f[35]-10.0*f[32]))-50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[9]*vcut_lR2)+60.0*f[7]*vcut_l+30.0*f[9]-60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]+90.0*f[23])*vcut_lR2+(50.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]-50.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-20.0*f[50])+40.0*f[39]-20.0*f[38]+16.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]+30.0*f[34]-24.0*f[33])*vcut_lR2+20.0*f[50]-30.0*f[49]+15.0*f[42]-40.0*f[39]+20.0*f[38]-16.0*f[37]-30.0*f[34]+24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+(36.0*f[105]+36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2-36.0*f[105]-36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(60.0*f[85]+60.0*f[62]-48.0*f[61]-72.0*f[23])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]+36.0*f[1])*vcut_lR2-60.0*f[85]-60.0*f[62]+48.0*f[61]+72.0*f[23]+30.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3-108.0*f[7]*vcut_lR2-72.0*f[9]+108.0*f[7])-405.0*f[66]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]+120.0*f[4])*vcut_lR3+(270.0*f[81]+270.0*f[66]+270.0*f[57]-180.0*f[3])*vcut_lR2+180.0*f[83]-270.0*f[81]+135.0*f[66]-360.0*f[63]+180.0*f[60]-270.0*f[57]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[66]*vcut_lR5+(45.0*f[83]-90.0*f[63]+45.0*f[60]-30.0*f[4])*vcut_lR4+((-60.0*f[81])-120.0*f[66]-60.0*f[57]+40.0*f[3])*vcut_lR3+((-30.0*f[83])+60.0*f[63]-30.0*f[60]+20.0*f[4])*vcut_lR2+(60.0*f[81]+60.0*f[66]+60.0*f[57]-40.0*f[3])*vcut_l-15.0*f[83]-48.0*f[66]+30.0*f[63]-15.0*f[60]+10.0*f[4])+90.0*f[11]*vcut_lR4-40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2+40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+(15.0*f[50]-30.0*f[39]+15.0*f[38]-12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+((-10.0*f[50])+20.0*f[39]-10.0*f[38]+8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l-5.0*f[50]-16.0*f[42]+10.0*f[39]-5.0*f[38]+4.0*f[37])+1.732050807568877*((-36.0*f[40]*vcut_lR5)+((-45.0*f[105])-45.0*f[88])*vcut_lR4+(20.0*f[47]+40.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_lR3+(30.0*f[105]+30.0*f[88])*vcut_lR2+((-20.0*f[47])-20.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]+16.0*f[40]))-180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[9]*vcut_lR4)+120.0*f[7]*vcut_lR3+60.0*f[9]*vcut_lR2-120.0*f[7]*vcut_l+30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]+270.0*f[23])*vcut_lR4+(100.0*f[20]+200.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]-120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]-180.0*f[23])*vcut_lR2+((-100.0*f[20])-100.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]+120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]+80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]-18.0*f[92]+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[40])*vcut_lR3+(12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88])*vcut_lR2+((-8.0*f[47])+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-12.0*f[105]+15.0*f[97]-12.0*f[96]+15.0*f[88]-8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[66])*vcut_lR3+((-12.0*f[83])-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[63]+15.0*f[60]-18.0*f[28]-10.0*f[4])*vcut_lR2+(24.0*f[81]-30.0*f[79]-30.0*f[71]+24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l+12.0*f[83]+24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[71]+24.0*f[70]+30.0*f[63]-15.0*f[60]-30.0*f[57]+18.0*f[28]+36.0*f[26]+10.0*f[4]+20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+((-36.0*f[12])-20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]-30.0*f[11]-20.0*f[0])+((-90.0*f[77])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[9])*vcut_lR2+(60.0*f[14]+60.0*f[7])*vcut_l+30.0*f[15]+60.0*f[14]+30.0*f[9]+60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]+90.0*f[30]+90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]-180.0*f[72]+90.0*f[69]+75.0*f[62]-60.0*f[61]-90.0*f[30]-90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[101])-225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2+135.0*f[101]+360.0*f[98]-180.0*f[95]-270.0*f[92]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+((-144.0*f[105])+180.0*f[97]-144.0*f[96]+180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2-144.0*f[105]+180.0*f[97]-144.0*f[96]+180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]+225.0*f[19])*vcut_lR4+(540.0*f[108]-240.0*f[85]+300.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2+540.0*f[108]-240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]+300.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+((-540.0*f[14])-540.0*f[7])*vcut_lR2+360.0*f[15]+540.0*f[14]+360.0*f[9]+540.0*f[7])+((-2025.0*f[79])-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[54])-600.0*f[11])*vcut_lR3+(540.0*f[12]+300.0*f[0])*vcut_lR2-1080.0*f[54]-540.0*f[12]-600.0*f[11]-300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]+1080.0*f[28]+600.0*f[4])*vcut_lR3+((-1080.0*f[81])+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]+1350.0*f[66]+1350.0*f[57]-1620.0*f[26]-900.0*f[3])*vcut_lR2+720.0*f[83]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1350.0*f[71]+1080.0*f[70]+675.0*f[66]+1800.0*f[63]-900.0*f[60]-1350.0*f[57]+1080.0*f[28]+1620.0*f[26]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l+144.0*f[101]+90.0*f[98]-45.0*f[95]+20.0*f[50]+80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[40])*vcut_lR5+(180.0*f[105]-225.0*f[97]+180.0*f[96]-225.0*f[88])*vcut_lR4+((-80.0*f[47])+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+((-120.0*f[105])+150.0*f[97]-120.0*f[96]+150.0*f[88])*vcut_lR2+(80.0*f[47]-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l-60.0*f[105]+75.0*f[97]-60.0*f[96]+75.0*f[88]-80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[66])*vcut_lR5+((-180.0*f[83])-450.0*f[76]+225.0*f[75]-180.0*f[74]-450.0*f[63]+225.0*f[60]-270.0*f[28]-150.0*f[4])*vcut_lR4+(240.0*f[81]-600.0*f[79]-300.0*f[71]+240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+(120.0*f[83]+300.0*f[76]-150.0*f[75]+120.0*f[74]+300.0*f[63]-150.0*f[60]+180.0*f[28]+100.0*f[4])*vcut_lR2+((-240.0*f[81])+300.0*f[79]+300.0*f[71]-240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l+60.0*f[83]+240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]+240.0*f[66]+150.0*f[63]-75.0*f[60]+90.0*f[28]+50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+((-360.0*f[12])-200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+(360.0*f[12]+200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+((-1620.0*f[77])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[9])*vcut_lR4+(600.0*f[14]+600.0*f[7])*vcut_lR3+(300.0*f[15]+300.0*f[9])*vcut_lR2+((-600.0*f[14])-600.0*f[7])*vcut_l+150.0*f[15]+150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]+1350.0*f[30]+1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]-900.0*f[30]-900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]-720.0*f[77]+375.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+((-18.0*f[98])+9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+18.0*f[98]-9.0*f[95]+18.0*f[92]+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[40])*vcut_lR3+(12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88])*vcut_lR2+((-8.0*f[47])+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-12.0*f[105]+15.0*f[97]-12.0*f[96]+15.0*f[88]+8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[66])*vcut_lR3+((-12.0*f[83])-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[63]+15.0*f[60]-18.0*f[28]-10.0*f[4])*vcut_lR2+(24.0*f[81]-30.0*f[79]-30.0*f[71]+24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l+12.0*f[83]-24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[71]-24.0*f[70]+30.0*f[63]-15.0*f[60]+30.0*f[57]+18.0*f[28]-36.0*f[26]+10.0*f[4]-20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+((-36.0*f[12])-20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]-30.0*f[11]+20.0*f[0])+((-90.0*f[77])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[9])*vcut_lR2+(60.0*f[14]+60.0*f[7])*vcut_l+30.0*f[15]-60.0*f[14]+30.0*f[9]-60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]+90.0*f[30]+90.0*f[23])*vcut_lR2+(90.0*f[77]-180.0*f[72]+90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]+180.0*f[72]-90.0*f[69]+75.0*f[62]-60.0*f[61]-90.0*f[30]-90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[101])-225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2+135.0*f[101]-360.0*f[98]+180.0*f[95]-270.0*f[92]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+((-144.0*f[105])+180.0*f[97]-144.0*f[96]+180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2+144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]+225.0*f[19])*vcut_lR4+(540.0*f[108]-240.0*f[85]+300.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2-540.0*f[108]+240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]-300.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+((-540.0*f[14])-540.0*f[7])*vcut_lR2-360.0*f[15]+540.0*f[14]-360.0*f[9]+540.0*f[7])+((-2025.0*f[79])-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[54])-600.0*f[11])*vcut_lR3+(540.0*f[12]+300.0*f[0])*vcut_lR2+1080.0*f[54]-540.0*f[12]+600.0*f[11]-300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]+1080.0*f[28]+600.0*f[4])*vcut_lR3+((-1080.0*f[81])+1350.0*f[79]+1350.0*f[71]-1080.0*f[70]+1350.0*f[66]+1350.0*f[57]-1620.0*f[26]-900.0*f[3])*vcut_lR2-720.0*f[83]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]-1350.0*f[71]+1080.0*f[70]+675.0*f[66]-1800.0*f[63]+900.0*f[60]-1350.0*f[57]-1080.0*f[28]+1620.0*f[26]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+((-270.0*f[98])+135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+(180.0*f[98]-90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l-144.0*f[101]+90.0*f[98]-45.0*f[95]+20.0*f[50]-80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[40])*vcut_lR5+(180.0*f[105]-225.0*f[97]+180.0*f[96]-225.0*f[88])*vcut_lR4+((-80.0*f[47])+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+((-120.0*f[105])+150.0*f[97]-120.0*f[96]+150.0*f[88])*vcut_lR2+(80.0*f[47]-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l-60.0*f[105]+75.0*f[97]-60.0*f[96]+75.0*f[88]+80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[66])*vcut_lR5+((-180.0*f[83])-450.0*f[76]+225.0*f[75]-180.0*f[74]-450.0*f[63]+225.0*f[60]-270.0*f[28]-150.0*f[4])*vcut_lR4+(240.0*f[81]-600.0*f[79]-300.0*f[71]+240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+(120.0*f[83]+300.0*f[76]-150.0*f[75]+120.0*f[74]+300.0*f[63]-150.0*f[60]+180.0*f[28]+100.0*f[4])*vcut_lR2+((-240.0*f[81])+300.0*f[79]+300.0*f[71]-240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l+60.0*f[83]-240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]-240.0*f[66]+150.0*f[63]-75.0*f[60]+90.0*f[28]+50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+((-360.0*f[12])-200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+(360.0*f[12]+200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+((-1620.0*f[77])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[9])*vcut_lR4+(600.0*f[14]+600.0*f[7])*vcut_lR3+(300.0*f[15]+300.0*f[9])*vcut_lR2+((-600.0*f[14])-600.0*f[7])*vcut_l+150.0*f[15]+150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]+1350.0*f[30]+1350.0*f[23])*vcut_lR4+(1800.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]-900.0*f[30]-900.0*f[23])*vcut_lR2+((-900.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]+720.0*f[77]+375.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[7][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[7][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[7][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[7][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[7][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_8 
  vcutSq = 0.01*(2.23606797749979*(63.63961030678928*phiWall[19]-63.63961030678928*phi[19]+35.35533905932738*phiWall[9]-35.35533905932738*phi[9]+14.14213562373095*phiWall[8]-14.14213562373095*phi[8]+14.14213562373095*phiWall[7]-14.14213562373095*phi[7]+1.732050807568877*((-21.21320343559643*phiWall[6])+21.21320343559643*phi[6]-21.21320343559643*phiWall[5]+21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*phi[2]+21.21320343559643*phiWall[1]-21.21320343559643*phi[1])+1.732050807568877*((-42.42640687119286*phiWall[18])+42.42640687119286*phi[18]-42.42640687119286*phiWall[17]+42.42640687119286*phi[17]-63.63961030678928*phiWall[10]+63.63961030678928*phi[10]-35.35533905932738*phiWall[3]+35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*phi[16]+7.071067811865476*phiWall[15]-7.071067811865476*phi[15]+2.828427124746191*phiWall[12]-2.828427124746191*phi[12]+2.828427124746191*phiWall[11]-2.828427124746191*phi[11])-14.14213562373095*phiWall[14]+14.14213562373095*phi[14]-14.14213562373095*phiWall[13]+14.14213562373095*phi[13])+63.63961030678928*phiWall[4]-63.63961030678928*phi[4]+35.35533905932738*phiWall[0]-35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[8][0] = 0.0; 
  fReflSurfXY[8][1] = 0.0; 
  fReflSurfXY[8][2] = 0.0; 
  fReflSurfXY[8][3] = 0.0; 
  fReflSurfXY[8][4] = 0.0; 
  fReflSurfXY[8][5] = 0.0; 
  fReflSurfXY[8][6] = 0.0; 
  fReflSurfXY[8][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[8][0] = 0.01414213562373095*(11.18033988749895*(9.0*f[58]+5.0*f[18]+2.0*(f[17]+f[16])-5.196152422706631*(f[8]+f[7])+3.0*(f[2]+f[1]))-8.660254037844386*(3.0*(2.0*(f[57]+f[56])+3.0*f[21])+5.0*f[3])+3.872983346207417*(3.872983346207417*(5.0*(f[36]+f[35])+2.0*(f[32]+f[31]))-10.0*(f[34]+f[33]))+5.0*(9.0*f[6]+5.0*f[0])); 
  fReflSurfXY[8][1] = -0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[88]+f[87])-8.660254037844386*(9.0*f[89]+5.0*f[39]+2.0*(f[38]+f[37])))-225.0*(f[64]+f[63])+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[24]+f[23]))-9.0*(f[10]+f[9]))+5.0*((-18.0*(f[60]+f[59]))+5.196152422706631*(9.0*f[51]+5.0*f[11])-3.0*(9.0*f[22]+5.0*f[4]))); 
  fReflSurfXY[8][2] = -0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[92]+f[91])-8.660254037844386*(9.0*f[93]+5.0*f[45]+2.0*(f[44]+f[43])))-225.0*(f[73]+f[72])+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[27]+f[26]))-9.0*(f[13]+f[12]))+5.0*((-18.0*(f[69]+f[68]))+5.196152422706631*(9.0*f[52]+5.0*f[14])-3.0*(9.0*f[25]+5.0*f[5]))); 
  fReflSurfXY[8][3] = 0.01414213562373095*(11.18033988749895*(9.0*f[109]+5.0*f[76]+2.0*(f[75]+f[74])-5.196152422706631*(f[55]+f[54])+3.0*(f[29]+f[28]))-8.660254037844386*(3.0*(2.0*(f[108]+f[107])+3.0*f[86])+5.0*f[30])+3.872983346207417*(3.872983346207417*(5.0*(f[99]+f[98])+2.0*(f[95]+f[94]))-10.0*(f[97]+f[96]))+5.0*(9.0*f[53]+5.0*f[15])); 
  fReflSurfXY[8][4] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]+5.0*f[42])-8.660254037844386*(f[41]+f[40]))+58.09475019311126*(f[67]+f[66])-5.0*(9.0*f[65]+5.0*f[19])); 
  fReflSurfXY[8][5] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]+5.0*f[49])-8.660254037844386*(f[48]+f[47]))+58.09475019311126*(f[82]+f[81])-5.0*(9.0*f[80]+5.0*f[20])); 
  fReflSurfXY[8][6] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]+5.0*f[79])-8.660254037844386*(f[78]+f[77]))+58.09475019311126*(f[102]+f[101])-5.0*(9.0*f[100]+5.0*f[46])); 
  fReflSurfXY[8][7] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]+5.0*f[85])-8.660254037844386*(f[84]+f[83]))+58.09475019311126*(f[106]+f[105])-5.0*(9.0*f[104]+5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]-30.0*f[83]-60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-60.0*f[57]-60.0*f[56]+45.0*f[29]+45.0*f[28]+90.0*f[27]+90.0*f[26]-45.0*f[22]-90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]-90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+36.0*f[92]+36.0*f[91]-45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]+30.0*f[88]+30.0*f[87]+20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+((-225.0*f[78])-225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]+75.0*f[15]+150.0*f[14]-75.0*f[10]-75.0*f[9]-150.0*f[8]-150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]-225.0*f[30]-270.0*f[25]+225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]+135.0*f[102]+135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+216.0*f[92]+216.0*f[91]-135.0*f[90]-360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]+360.0*f[15]+540.0*f[14]-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-540.0*f[13]-540.0*f[12]+600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[29]+1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[27]-1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]-720.0*f[84]-720.0*f[83]-1080.0*f[82]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[29]+1080.0*f[28]+1620.0*f[27]+1620.0*f[26]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]-135.0*f[29]-135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[29]+90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]-30.0*f[84]-30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]-120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]+72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-72.0*f[90]-45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87]-40.0*f[46]+40.0*f[41]+40.0*f[40]))+((-810.0*f[78])-810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]-30.0*f[83]+60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+60.0*f[57]+60.0*f[56]+45.0*f[29]+45.0*f[28]-90.0*f[27]-90.0*f[26]-45.0*f[22]+90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-36.0*f[92]-36.0*f[91]-45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]+30.0*f[88]+30.0*f[87]-20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+((-225.0*f[78])-225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]+75.0*f[15]-150.0*f[14]-75.0*f[10]-75.0*f[9]+150.0*f[8]+150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]-225.0*f[30]+270.0*f[25]+225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]+135.0*f[102]+135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+216.0*f[92]+216.0*f[91]-135.0*f[90]+360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]+216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]-360.0*f[15]+540.0*f[14]+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-540.0*f[13]-540.0*f[12]-600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[29]+1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+(2430.0*f[110]+1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[27]-1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]+720.0*f[84]+720.0*f[83]-1080.0*f[82]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[29]-1080.0*f[28]+1620.0*f[27]+1620.0*f[26]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]-135.0*f[29]-135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]+90.0*f[29]+90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]-30.0*f[84]-30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]+120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]-72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+72.0*f[90]-45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87]+40.0*f[46]-40.0*f[41]-40.0*f[40]))+((-810.0*f[78])-810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l-9.0*f[104]-18.0*f[103]+18.0*f[89]-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*(((-10.0*f[41])-10.0*f[40])*vcut_lR3+((-15.0*f[106])-15.0*f[105]+12.0*f[88]+12.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[47]+10.0*f[41]+10.0*f[40]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31])*vcut_l+15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87]+10.0*f[48]+10.0*f[47]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]+30.0*f[66])*vcut_lR3+(15.0*f[84]+15.0*f[83]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]-18.0*f[22]-10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[81]-30.0*f[67]-30.0*f[66]+24.0*f[57]+24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l-15.0*f[84]-15.0*f[83]-30.0*f[82]-30.0*f[81]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]+24.0*f[57]+24.0*f[56]+18.0*f[22]+36.0*f[21]+10.0*f[4]+20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+((-36.0*f[6])-20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]-36.0*f[6]-20.0*f[0])+((-90.0*f[65])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[10])-30.0*f[9])*vcut_lR2+(60.0*f[8]+60.0*f[7])*vcut_l+30.0*f[10]+30.0*f[9]+60.0*f[8]+60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]+90.0*f[24]+90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]+90.0*f[80]-60.0*f[62]-60.0*f[61]-180.0*f[58]-90.0*f[24]-90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[90])-225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-180.0*f[104]-270.0*f[103]+135.0*f[90]+360.0*f[89]-100.0*f[50]-150.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+(180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]+225.0*f[19])*vcut_lR4+(540.0*f[111]+300.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2+540.0*f[111]+300.0*f[85]+270.0*f[80]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[24]-360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+((-540.0*f[8])-540.0*f[7])*vcut_lR2+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+((-2025.0*f[67])-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[51])-600.0*f[11])*vcut_lR3+(540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[51]-600.0*f[11]-540.0*f[6]-300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(1350.0*f[82]+1350.0*f[81]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[21]-900.0*f[3])*vcut_lR2-900.0*f[84]-900.0*f[83]-1350.0*f[82]-1350.0*f[81]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l-45.0*f[104]+144.0*f[90]+90.0*f[89]-25.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*(((-180.0*f[41])-180.0*f[40])*vcut_lR5+((-225.0*f[106])-225.0*f[105]+180.0*f[88]+180.0*f[87])*vcut_lR4+(100.0*f[48]+100.0*f[47]+200.0*f[41]+200.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_lR3+(150.0*f[106]+150.0*f[105]-120.0*f[88]-120.0*f[87])*vcut_lR2+((-100.0*f[48])-100.0*f[47]-100.0*f[41]-100.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_l+75.0*f[106]+75.0*f[105]-60.0*f[88]-60.0*f[87]-80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]+540.0*f[66])*vcut_lR5+(225.0*f[84]+225.0*f[83]-450.0*f[64]-450.0*f[63]-180.0*f[60]-180.0*f[59]-270.0*f[22]-150.0*f[4])*vcut_lR4+((-300.0*f[82])-300.0*f[81]-600.0*f[67]-600.0*f[66]+240.0*f[57]+240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+((-150.0*f[84])-150.0*f[83]+300.0*f[64]+300.0*f[63]+120.0*f[60]+120.0*f[59]+180.0*f[22]+100.0*f[4])*vcut_lR2+(300.0*f[82]+300.0*f[81]+300.0*f[67]+300.0*f[66]-240.0*f[57]-240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l-75.0*f[84]-75.0*f[83]+240.0*f[67]+240.0*f[66]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[22]+50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+((-360.0*f[6])-200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+(360.0*f[6]+200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+((-1620.0*f[65])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[10])-450.0*f[9])*vcut_lR4+(600.0*f[8]+600.0*f[7])*vcut_lR3+(300.0*f[10]+300.0*f[9])*vcut_lR2+((-600.0*f[8])-600.0*f[7])*vcut_l+150.0*f[10]+150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]+1350.0*f[24]+1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]-900.0*f[24]-900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]-720.0*f[65]-300.0*f[62]-300.0*f[61]-450.0*f[24]-450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+(9.0*f[104]-18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l-9.0*f[104]+18.0*f[103]+18.0*f[89]-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*(((-10.0*f[41])-10.0*f[40])*vcut_lR3+((-15.0*f[106])-15.0*f[105]+12.0*f[88]+12.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[47]+10.0*f[41]+10.0*f[40]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31])*vcut_l+15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87]-10.0*f[48]-10.0*f[47]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]+30.0*f[66])*vcut_lR3+(15.0*f[84]+15.0*f[83]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]-18.0*f[22]-10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[81]-30.0*f[67]-30.0*f[66]+24.0*f[57]+24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l-15.0*f[84]-15.0*f[83]+30.0*f[82]+30.0*f[81]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]-24.0*f[57]-24.0*f[56]+18.0*f[22]-36.0*f[21]+10.0*f[4]-20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+((-36.0*f[6])-20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]+36.0*f[6]+20.0*f[0])+((-90.0*f[65])-50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[10])-30.0*f[9])*vcut_lR2+(60.0*f[8]+60.0*f[7])*vcut_l+30.0*f[10]+30.0*f[9]-60.0*f[8]-60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]+90.0*f[24]+90.0*f[23])*vcut_lR2+(90.0*f[80]+90.0*f[65]-180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]-90.0*f[80]-60.0*f[62]-60.0*f[61]+180.0*f[58]-90.0*f[24]-90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[90])-225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+180.0*f[104]-270.0*f[103]+135.0*f[90]-360.0*f[89]+100.0*f[50]-150.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+(180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]-180.0*f[105]+144.0*f[88]+144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]+225.0*f[19])*vcut_lR4+(540.0*f[111]+300.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2-540.0*f[111]-300.0*f[85]+270.0*f[80]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[24]+360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+((-540.0*f[8])-540.0*f[7])*vcut_lR2-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+((-2025.0*f[67])-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[51])-600.0*f[11])*vcut_lR3+(540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[51]+600.0*f[11]-540.0*f[6]-300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(1350.0*f[82]+1350.0*f[81]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[21]-900.0*f[3])*vcut_lR2+900.0*f[84]+900.0*f[83]-1350.0*f[82]-1350.0*f[81]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+(135.0*f[104]-270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+((-90.0*f[104])+180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l-45.0*f[104]-144.0*f[90]+90.0*f[89]-25.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*(((-180.0*f[41])-180.0*f[40])*vcut_lR5+((-225.0*f[106])-225.0*f[105]+180.0*f[88]+180.0*f[87])*vcut_lR4+(100.0*f[48]+100.0*f[47]+200.0*f[41]+200.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_lR3+(150.0*f[106]+150.0*f[105]-120.0*f[88]-120.0*f[87])*vcut_lR2+((-100.0*f[48])-100.0*f[47]-100.0*f[41]-100.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_l+75.0*f[106]+75.0*f[105]-60.0*f[88]-60.0*f[87]+80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]+540.0*f[66])*vcut_lR5+(225.0*f[84]+225.0*f[83]-450.0*f[64]-450.0*f[63]-180.0*f[60]-180.0*f[59]-270.0*f[22]-150.0*f[4])*vcut_lR4+((-300.0*f[82])-300.0*f[81]-600.0*f[67]-600.0*f[66]+240.0*f[57]+240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+((-150.0*f[84])-150.0*f[83]+300.0*f[64]+300.0*f[63]+120.0*f[60]+120.0*f[59]+180.0*f[22]+100.0*f[4])*vcut_lR2+(300.0*f[82]+300.0*f[81]+300.0*f[67]+300.0*f[66]-240.0*f[57]-240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l-75.0*f[84]-75.0*f[83]-240.0*f[67]-240.0*f[66]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[22]+50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+((-360.0*f[6])-200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+(360.0*f[6]+200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+((-1620.0*f[65])-900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[10])-450.0*f[9])*vcut_lR4+(600.0*f[8]+600.0*f[7])*vcut_lR3+(300.0*f[10]+300.0*f[9])*vcut_lR2+((-600.0*f[8])-600.0*f[7])*vcut_l+150.0*f[10]+150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]+1350.0*f[24]+1350.0*f[23])*vcut_lR4+(900.0*f[80]+1800.0*f[65]-1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]-900.0*f[24]-900.0*f[23])*vcut_lR2+((-900.0*f[80])-900.0*f[65]+1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]+720.0*f[65]-300.0*f[62]-300.0*f[61]-450.0*f[24]-450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]+30.0*f[83]+60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+60.0*f[57]+60.0*f[56]+45.0*f[29]+45.0*f[28]+90.0*f[27]+90.0*f[26]+45.0*f[22]+90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+36.0*f[92]+36.0*f[91]+45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]-30.0*f[88]-30.0*f[87]-20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+((-225.0*f[78])-225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]+75.0*f[15]+150.0*f[14]+75.0*f[10]+75.0*f[9]+150.0*f[8]+150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]-225.0*f[30]-270.0*f[25]-225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]+135.0*f[102]+135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+216.0*f[92]+216.0*f[91]+135.0*f[90]+360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]+972.0*f[52]+360.0*f[15]+540.0*f[14]+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]-1080.0*f[51]-540.0*f[13]-540.0*f[12]-600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[29]+1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[27]-1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]+3240.0*f[109]+720.0*f[84]+720.0*f[83]+1080.0*f[82]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[29]+1080.0*f[28]+1620.0*f[27]+1620.0*f[26]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]-135.0*f[29]-135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[29]+90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]+30.0*f[84]+30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]+120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]+72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+72.0*f[90]+45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87]-40.0*f[46]-40.0*f[41]-40.0*f[40]))+((-810.0*f[78])-810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]+30.0*f[83]-60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-60.0*f[57]-60.0*f[56]+45.0*f[29]+45.0*f[28]-90.0*f[27]-90.0*f[26]+45.0*f[22]-90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+((-90.0*f[13])-90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]+90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-36.0*f[92]-36.0*f[91]+45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]-30.0*f[88]-30.0*f[87]+20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+((-225.0*f[78])-225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]+75.0*f[15]-150.0*f[14]+75.0*f[10]+75.0*f[9]-150.0*f[8]-150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])+225.0*f[78]+225.0*f[77]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]-225.0*f[30]+270.0*f[25]-225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]+135.0*f[102]+135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+216.0*f[92]+216.0*f[91]+135.0*f[90]-360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]-216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+((-972.0*f[52])-540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]+972.0*f[52]-360.0*f[15]+540.0*f[14]-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+((-3645.0*f[110])-2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]+1080.0*f[51]-540.0*f[13]-540.0*f[12]+600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[29]+1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+(2430.0*f[110]-1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[27]-1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2+1215.0*f[110]-3240.0*f[109]-720.0*f[84]-720.0*f[83]+1080.0*f[82]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[29]-1080.0*f[28]+1620.0*f[27]+1620.0*f[26]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]-135.0*f[29]-135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]+90.0*f[29]+90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]+30.0*f[84]+30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]-120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])-135.0*f[99]-135.0*f[98]-54.0*f[95]-54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]+90.0*f[99]+90.0*f[98]+36.0*f[95]+36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]-72.0*f[101]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-72.0*f[90]+45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87]+40.0*f[46]+40.0*f[41]+40.0*f[40]))+((-810.0*f[78])-810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])+900.0*f[78]+900.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]-450.0*f[78]-450.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[8][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[8][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[8][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[8][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[8][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  fRefl[0] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0])+8.0*(5.0*fReflSurfXY[5][0]+8.0*fReflSurfXY[4][0])+5.0*(8.0*fReflSurfXY[3][0]+5.0*fReflSurfXY[2][0]+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0])); 
  fRefl[1] = 0.05856069741052554*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0]-1.0*(5.0*fReflSurfXY[2][0]+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0])); 
  fRefl[2] = 0.05856069741052554*(5.0*(fReflSurfXY[8][0]-1.0*fReflSurfXY[6][0])+8.0*(fReflSurfXY[5][0]-1.0*fReflSurfXY[3][0])+5.0*(fReflSurfXY[2][0]-1.0*fReflSurfXY[0][0])); 
  fRefl[3] = 0.0; 
  fRefl[4] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1])+8.0*(5.0*fReflSurfXY[5][1]+8.0*fReflSurfXY[4][1])+5.0*(8.0*fReflSurfXY[3][1]+5.0*fReflSurfXY[2][1]+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1])); 
  fRefl[5] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2])+8.0*(5.0*fReflSurfXY[5][2]+8.0*fReflSurfXY[4][2])+5.0*(8.0*fReflSurfXY[3][2]+5.0*fReflSurfXY[2][2]+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2])); 
  fRefl[6] = 0.392837100659193*(fReflSurfXY[8][0]-1.0*(fReflSurfXY[6][0]+fReflSurfXY[2][0])+fReflSurfXY[0][0]); 
  fRefl[7] = 0.0; 
  fRefl[8] = 0.0; 
  fRefl[9] = 0.05856069741052554*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1]-1.0*(5.0*fReflSurfXY[2][1]+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1])); 
  fRefl[10] = 0.05856069741052554*(5.0*(fReflSurfXY[8][1]-1.0*fReflSurfXY[6][1])+8.0*(fReflSurfXY[5][1]-1.0*fReflSurfXY[3][1])+5.0*(fReflSurfXY[2][1]-1.0*fReflSurfXY[0][1])); 
  fRefl[11] = 0.0; 
  fRefl[12] = 0.05856069741052554*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2]-1.0*(5.0*fReflSurfXY[2][2]+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2])); 
  fRefl[13] = 0.05856069741052554*(5.0*(fReflSurfXY[8][2]-1.0*fReflSurfXY[6][2])+8.0*(fReflSurfXY[5][2]-1.0*fReflSurfXY[3][2])+5.0*(fReflSurfXY[2][2]-1.0*fReflSurfXY[0][2])); 
  fRefl[14] = 0.0; 
  fRefl[15] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3])+8.0*(5.0*fReflSurfXY[5][3]+8.0*fReflSurfXY[4][3])+5.0*(8.0*fReflSurfXY[3][3]+5.0*fReflSurfXY[2][3]+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3])); 
  fRefl[16] = 0.03904046494035036*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0]-2.0*(5.0*fReflSurfXY[5][0]+8.0*fReflSurfXY[4][0])+5.0*(fReflSurfXY[2][0]-2.0*fReflSurfXY[3][0])+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0]); 
  fRefl[17] = 0.03904046494035036*(5.0*(fReflSurfXY[8][0]-2.0*fReflSurfXY[7][0]+fReflSurfXY[6][0])+8.0*(fReflSurfXY[5][0]-2.0*fReflSurfXY[4][0]+fReflSurfXY[3][0])+5.0*(fReflSurfXY[2][0]-2.0*fReflSurfXY[1][0]+fReflSurfXY[0][0])); 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][4]+8.0*fReflSurfXY[7][4]+5.0*fReflSurfXY[6][4])+8.0*(5.0*fReflSurfXY[5][4]+8.0*fReflSurfXY[4][4])+5.0*(8.0*fReflSurfXY[3][4]+5.0*fReflSurfXY[2][4]+8.0*fReflSurfXY[1][4]+5.0*fReflSurfXY[0][4])); 
  fRefl[20] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][5]+8.0*fReflSurfXY[7][5]+5.0*fReflSurfXY[6][5])+8.0*(5.0*fReflSurfXY[5][5]+8.0*fReflSurfXY[4][5])+5.0*(8.0*fReflSurfXY[3][5]+5.0*fReflSurfXY[2][5]+8.0*fReflSurfXY[1][5]+5.0*fReflSurfXY[0][5])); 
  fRefl[21] = 0.0; 
  fRefl[22] = 0.392837100659193*(fReflSurfXY[8][1]-1.0*(fReflSurfXY[6][1]+fReflSurfXY[2][1])+fReflSurfXY[0][1]); 
  fRefl[23] = 0.0; 
  fRefl[24] = 0.0; 
  fRefl[25] = 0.392837100659193*(fReflSurfXY[8][2]-1.0*(fReflSurfXY[6][2]+fReflSurfXY[2][2])+fReflSurfXY[0][2]); 
  fRefl[26] = 0.0; 
  fRefl[27] = 0.0; 
  fRefl[28] = 0.05856069741052554*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3]-1.0*(5.0*fReflSurfXY[2][3]+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3])); 
  fRefl[29] = 0.05856069741052554*(5.0*(fReflSurfXY[8][3]-1.0*fReflSurfXY[6][3])+8.0*(fReflSurfXY[5][3]-1.0*fReflSurfXY[3][3])+5.0*(fReflSurfXY[2][3]-1.0*fReflSurfXY[0][3])); 
  fRefl[30] = 0.0; 
  fRefl[31] = 0.2618914004394622*(fReflSurfXY[8][0]-1.0*fReflSurfXY[6][0]+2.0*(fReflSurfXY[3][0]-1.0*fReflSurfXY[5][0])+fReflSurfXY[2][0]-1.0*fReflSurfXY[0][0]); 
  fRefl[32] = 0.2618914004394622*(fReflSurfXY[8][0]-2.0*fReflSurfXY[7][0]+fReflSurfXY[6][0]-1.0*fReflSurfXY[2][0]+2.0*fReflSurfXY[1][0]-1.0*fReflSurfXY[0][0]); 
  fRefl[33] = 0.0; 
  fRefl[34] = 0.0; 
  fRefl[35] = 0.0; 
  fRefl[36] = 0.0; 
  fRefl[37] = 0.03904046494035038*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1]-2.0*(5.0*fReflSurfXY[5][1]+8.0*fReflSurfXY[4][1])+5.0*(fReflSurfXY[2][1]-2.0*fReflSurfXY[3][1])+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1]); 
  fRefl[38] = 0.03904046494035038*(5.0*(fReflSurfXY[8][1]-2.0*fReflSurfXY[7][1]+fReflSurfXY[6][1])+8.0*(fReflSurfXY[5][1]-2.0*fReflSurfXY[4][1]+fReflSurfXY[3][1])+5.0*(fReflSurfXY[2][1]-2.0*fReflSurfXY[1][1]+fReflSurfXY[0][1])); 
  fRefl[39] = 0.0; 
  fRefl[40] = 0.05856069741052556*(5.0*fReflSurfXY[8][4]+8.0*fReflSurfXY[7][4]+5.0*fReflSurfXY[6][4]-1.0*(5.0*fReflSurfXY[2][4]+8.0*fReflSurfXY[1][4]+5.0*fReflSurfXY[0][4])); 
  fRefl[41] = 0.05856069741052556*(5.0*(fReflSurfXY[8][4]-1.0*fReflSurfXY[6][4])+8.0*(fReflSurfXY[5][4]-1.0*fReflSurfXY[3][4])+5.0*(fReflSurfXY[2][4]-1.0*fReflSurfXY[0][4])); 
  fRefl[42] = 0.0; 
  fRefl[43] = 0.03904046494035038*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2]-2.0*(5.0*fReflSurfXY[5][2]+8.0*fReflSurfXY[4][2])+5.0*(fReflSurfXY[2][2]-2.0*fReflSurfXY[3][2])+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2]); 
  fRefl[44] = 0.03904046494035038*(5.0*(fReflSurfXY[8][2]-2.0*fReflSurfXY[7][2]+fReflSurfXY[6][2])+8.0*(fReflSurfXY[5][2]-2.0*fReflSurfXY[4][2]+fReflSurfXY[3][2])+5.0*(fReflSurfXY[2][2]-2.0*fReflSurfXY[1][2]+fReflSurfXY[0][2])); 
  fRefl[45] = 0.0; 
  fRefl[46] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][6]+8.0*fReflSurfXY[7][6]+5.0*fReflSurfXY[6][6])+8.0*(5.0*fReflSurfXY[5][6]+8.0*fReflSurfXY[4][6])+5.0*(8.0*fReflSurfXY[3][6]+5.0*fReflSurfXY[2][6]+8.0*fReflSurfXY[1][6]+5.0*fReflSurfXY[0][6])); 
  fRefl[47] = 0.05856069741052556*(5.0*fReflSurfXY[8][5]+8.0*fReflSurfXY[7][5]+5.0*fReflSurfXY[6][5]-1.0*(5.0*fReflSurfXY[2][5]+8.0*fReflSurfXY[1][5]+5.0*fReflSurfXY[0][5])); 
  fRefl[48] = 0.05856069741052556*(5.0*(fReflSurfXY[8][5]-1.0*fReflSurfXY[6][5])+8.0*(fReflSurfXY[5][5]-1.0*fReflSurfXY[3][5])+5.0*(fReflSurfXY[2][5]-1.0*fReflSurfXY[0][5])); 
  fRefl[49] = 0.0; 
  fRefl[50] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][7]+8.0*fReflSurfXY[7][7]+5.0*fReflSurfXY[6][7])+8.0*(5.0*fReflSurfXY[5][7]+8.0*fReflSurfXY[4][7])+5.0*(8.0*fReflSurfXY[3][7]+5.0*fReflSurfXY[2][7]+8.0*fReflSurfXY[1][7]+5.0*fReflSurfXY[0][7])); 
  fRefl[51] = 0.0; 
  fRefl[52] = 0.0; 
  fRefl[53] = 0.392837100659193*(fReflSurfXY[8][3]-1.0*(fReflSurfXY[6][3]+fReflSurfXY[2][3])+fReflSurfXY[0][3]); 
  fRefl[54] = 0.0; 
  fRefl[55] = 0.0; 
  fRefl[56] = 0.0; 
  fRefl[57] = 0.0; 
  fRefl[58] = 0.0; 
  fRefl[59] = 0.2618914004394621*(fReflSurfXY[8][1]-1.0*fReflSurfXY[6][1]+2.0*(fReflSurfXY[3][1]-1.0*fReflSurfXY[5][1])+fReflSurfXY[2][1]-1.0*fReflSurfXY[0][1]); 
  fRefl[60] = 0.2618914004394621*(fReflSurfXY[8][1]-2.0*fReflSurfXY[7][1]+fReflSurfXY[6][1]-1.0*fReflSurfXY[2][1]+2.0*fReflSurfXY[1][1]-1.0*fReflSurfXY[0][1]); 
  fRefl[61] = 0.0; 
  fRefl[62] = 0.0; 
  fRefl[63] = 0.0; 
  fRefl[64] = 0.0; 
  fRefl[65] = 0.392837100659193*(fReflSurfXY[8][4]-1.0*(fReflSurfXY[6][4]+fReflSurfXY[2][4])+fReflSurfXY[0][4]); 
  fRefl[66] = 0.0; 
  fRefl[67] = 0.0; 
  fRefl[68] = 0.2618914004394621*(fReflSurfXY[8][2]-1.0*fReflSurfXY[6][2]+2.0*(fReflSurfXY[3][2]-1.0*fReflSurfXY[5][2])+fReflSurfXY[2][2]-1.0*fReflSurfXY[0][2]); 
  fRefl[69] = 0.2618914004394621*(fReflSurfXY[8][2]-2.0*fReflSurfXY[7][2]+fReflSurfXY[6][2]-1.0*fReflSurfXY[2][2]+2.0*fReflSurfXY[1][2]-1.0*fReflSurfXY[0][2]); 
  fRefl[70] = 0.0; 
  fRefl[71] = 0.0; 
  fRefl[72] = 0.0; 
  fRefl[73] = 0.0; 
  fRefl[74] = 0.03904046494035036*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3]-2.0*(5.0*fReflSurfXY[5][3]+8.0*fReflSurfXY[4][3])+5.0*(fReflSurfXY[2][3]-2.0*fReflSurfXY[3][3])+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3]); 
  fRefl[75] = 0.03904046494035036*(5.0*(fReflSurfXY[8][3]-2.0*fReflSurfXY[7][3]+fReflSurfXY[6][3])+8.0*(fReflSurfXY[5][3]-2.0*fReflSurfXY[4][3]+fReflSurfXY[3][3])+5.0*(fReflSurfXY[2][3]-2.0*fReflSurfXY[1][3]+fReflSurfXY[0][3])); 
  fRefl[76] = 0.0; 
  fRefl[77] = 0.05856069741052556*(5.0*fReflSurfXY[8][6]+8.0*fReflSurfXY[7][6]+5.0*fReflSurfXY[6][6]-1.0*(5.0*fReflSurfXY[2][6]+8.0*fReflSurfXY[1][6]+5.0*fReflSurfXY[0][6])); 
  fRefl[78] = 0.05856069741052556*(5.0*(fReflSurfXY[8][6]-1.0*fReflSurfXY[6][6])+8.0*(fReflSurfXY[5][6]-1.0*fReflSurfXY[3][6])+5.0*(fReflSurfXY[2][6]-1.0*fReflSurfXY[0][6])); 
  fRefl[79] = 0.0; 
  fRefl[80] = 0.392837100659193*(fReflSurfXY[8][5]-1.0*(fReflSurfXY[6][5]+fReflSurfXY[2][5])+fReflSurfXY[0][5]); 
  fRefl[81] = 0.0; 
  fRefl[82] = 0.0; 
  fRefl[83] = 0.05856069741052556*(5.0*fReflSurfXY[8][7]+8.0*fReflSurfXY[7][7]+5.0*fReflSurfXY[6][7]-1.0*(5.0*fReflSurfXY[2][7]+8.0*fReflSurfXY[1][7]+5.0*fReflSurfXY[0][7])); 
  fRefl[84] = 0.05856069741052556*(5.0*(fReflSurfXY[8][7]-1.0*fReflSurfXY[6][7])+8.0*(fReflSurfXY[5][7]-1.0*fReflSurfXY[3][7])+5.0*(fReflSurfXY[2][7]-1.0*fReflSurfXY[0][7])); 
  fRefl[85] = 0.0; 
  fRefl[86] = 0.0; 
  fRefl[87] = 0.0; 
  fRefl[88] = 0.0; 
  fRefl[89] = 0.0; 
  fRefl[90] = 0.0; 
  fRefl[91] = 0.0; 
  fRefl[92] = 0.0; 
  fRefl[93] = 0.0; 
  fRefl[94] = 0.2618914004394622*(fReflSurfXY[8][3]-1.0*fReflSurfXY[6][3]+2.0*(fReflSurfXY[3][3]-1.0*fReflSurfXY[5][3])+fReflSurfXY[2][3]-1.0*fReflSurfXY[0][3]); 
  fRefl[95] = 0.2618914004394622*(fReflSurfXY[8][3]-2.0*fReflSurfXY[7][3]+fReflSurfXY[6][3]-1.0*fReflSurfXY[2][3]+2.0*fReflSurfXY[1][3]-1.0*fReflSurfXY[0][3]); 
  fRefl[96] = 0.0; 
  fRefl[97] = 0.0; 
  fRefl[98] = 0.0; 
  fRefl[99] = 0.0; 
  fRefl[100] = 0.392837100659193*(fReflSurfXY[8][6]-1.0*(fReflSurfXY[6][6]+fReflSurfXY[2][6])+fReflSurfXY[0][6]); 
  fRefl[101] = 0.0; 
  fRefl[102] = 0.0; 
  fRefl[103] = 0.0; 
  fRefl[104] = 0.392837100659193*(fReflSurfXY[8][7]-1.0*(fReflSurfXY[6][7]+fReflSurfXY[2][7])+fReflSurfXY[0][7]); 
  fRefl[105] = 0.0; 
  fRefl[106] = 0.0; 
  fRefl[107] = 0.0; 
  fRefl[108] = 0.0; 
  fRefl[109] = 0.0; 
  fRefl[110] = 0.0; 
  fRefl[111] = 0.0; 
}

GKYL_CU_DH void bc_sheath_gyrokinetic_reflectedf_upper_3x2v_ser_p2(double wv, double dv, double vlowerSq, double vupperSq, double q2Dm, const double *phi, const double *phiWall, const double *f, double *fRefl) 
{ 
  double vcutSq;
  double fReflSurfXY[9][8] = {0.}; 
  // node (x,y)_0 
  vcutSq = -0.01*(2.23606797749979*((-63.63961030678928*phiWall[19])+63.63961030678928*phi[19]-35.35533905932738*phiWall[9]+35.35533905932738*phi[9]-14.14213562373095*phiWall[8]+14.14213562373095*phi[8]-14.14213562373095*phiWall[7]+14.14213562373095*phi[7]+1.732050807568877*(21.21320343559643*phiWall[6]-21.21320343559643*phi[6]+21.21320343559643*phiWall[5]-21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*phi[2]+21.21320343559643*phiWall[1]-21.21320343559643*phi[1])+1.732050807568877*(42.42640687119286*phiWall[18]-42.42640687119286*phi[18]+42.42640687119286*phiWall[17]-42.42640687119286*phi[17]-63.63961030678928*phiWall[10]+63.63961030678928*phi[10]-35.35533905932738*phiWall[3]+35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*phi[16]+7.071067811865476*phiWall[15]-7.071067811865476*phi[15]+2.828427124746191*phiWall[12]-2.828427124746191*phi[12]+2.828427124746191*phiWall[11]-2.828427124746191*phi[11])-14.14213562373095*phiWall[14]+14.14213562373095*phi[14]-14.14213562373095*phiWall[13]+14.14213562373095*phi[13])-63.63961030678928*phiWall[4]+63.63961030678928*phi[4]-35.35533905932738*phiWall[0]+35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[0][0] = 0.0; 
  fReflSurfXY[0][1] = 0.0; 
  fReflSurfXY[0][2] = 0.0; 
  fReflSurfXY[0][3] = 0.0; 
  fReflSurfXY[0][4] = 0.0; 
  fReflSurfXY[0][5] = 0.0; 
  fReflSurfXY[0][6] = 0.0; 
  fReflSurfXY[0][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[0][0] = 0.01414213562373095*(11.18033988749895*(9.0*f[58]+5.0*f[18]+2.0*(f[17]+f[16])-1.0*(5.196152422706631*(f[8]+f[7])+3.0*(f[2]+f[1])))-1.0*(8.660254037844386*(6.0*(f[57]+f[56])-1.0*(9.0*f[21]+5.0*f[3]))+3.872983346207417*(3.872983346207417*(5.0*(f[36]+f[35])+2.0*(f[32]+f[31]))-10.0*(f[34]+f[33])))+5.0*(9.0*f[6]+5.0*f[0])); 
  fReflSurfXY[0][1] = -0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[88]+f[87])-8.660254037844386*(9.0*f[89]+5.0*f[39]+2.0*(f[38]+f[37])))+225.0*(f[64]+f[63])-11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])-3.0*(f[24]+f[23]))-9.0*(f[10]+f[9]))+5.0*(18.0*(f[60]+f[59])-1.0*(5.196152422706631*(9.0*f[51]+5.0*f[11])+3.0*(9.0*f[22]+5.0*f[4])))); 
  fReflSurfXY[0][2] = -0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[92]+f[91])-8.660254037844386*(9.0*f[93]+5.0*f[45]+2.0*(f[44]+f[43])))+225.0*(f[73]+f[72])-11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])-3.0*(f[27]+f[26]))-9.0*(f[13]+f[12]))+5.0*(18.0*(f[69]+f[68])-1.0*(5.196152422706631*(9.0*f[52]+5.0*f[14])+3.0*(9.0*f[25]+5.0*f[5])))); 
  fReflSurfXY[0][3] = 0.01414213562373095*(11.18033988749895*(9.0*f[109]+5.0*f[76]+2.0*(f[75]+f[74])-1.0*(5.196152422706631*(f[55]+f[54])+3.0*(f[29]+f[28])))-1.0*(8.660254037844386*(6.0*(f[108]+f[107])-1.0*(9.0*f[86]+5.0*f[30]))+3.872983346207417*(3.872983346207417*(5.0*(f[99]+f[98])+2.0*(f[95]+f[94]))-10.0*(f[97]+f[96])))+5.0*(9.0*f[53]+5.0*f[15])); 
  fReflSurfXY[0][4] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]+5.0*f[42])-8.660254037844386*(f[41]+f[40]))-58.09475019311126*(f[67]+f[66])+5.0*(9.0*f[65]+5.0*f[19])); 
  fReflSurfXY[0][5] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]+5.0*f[49])-8.660254037844386*(f[48]+f[47]))-58.09475019311126*(f[82]+f[81])+5.0*(9.0*f[80]+5.0*f[20])); 
  fReflSurfXY[0][6] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]+5.0*f[79])-8.660254037844386*(f[78]+f[77]))-58.09475019311126*(f[102]+f[101])+5.0*(9.0*f[100]+5.0*f[46])); 
  fReflSurfXY[0][7] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]+5.0*f[85])-8.660254037844386*(f[84]+f[83]))-58.09475019311126*(f[106]+f[105])+5.0*(9.0*f[104]+5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]+30.0*f[83]-60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-60.0*f[57]-60.0*f[56]-45.0*f[29]-45.0*f[28]+90.0*f[27]+90.0*f[26]-45.0*f[22]+90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]+90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+36.0*f[92]+36.0*f[91]-45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]+30.0*f[88]+30.0*f[87]-20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+(225.0*f[78]+225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]+75.0*f[15]-150.0*f[14]+75.0*f[10]+75.0*f[9]-150.0*f[8]-150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]+225.0*f[30]-270.0*f[25]+225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]+135.0*f[102]+135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+216.0*f[92]+216.0*f[91]+135.0*f[90]-360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]+216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]+360.0*f[15]-540.0*f[14]+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+(3645.0*f[110]+2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+540.0*f[13]+540.0*f[12]-600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[29]-1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[27]-1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]+720.0*f[84]+720.0*f[83]-1080.0*f[82]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[29]-1080.0*f[28]+1620.0*f[27]+1620.0*f[26]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]+135.0*f[29]+135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[29]-90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]+30.0*f[84]+30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]-120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]+72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+72.0*f[90]-45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87]-40.0*f[46]-40.0*f[41]-40.0*f[40]))+(810.0*f[78]+810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]+30.0*f[83]+60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+60.0*f[57]+60.0*f[56]-45.0*f[29]-45.0*f[28]-90.0*f[27]-90.0*f[26]-45.0*f[22]-90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-36.0*f[92]-36.0*f[91]-45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]+30.0*f[88]+30.0*f[87]+20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+(225.0*f[78]+225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]+75.0*f[15]+150.0*f[14]+75.0*f[10]+75.0*f[9]+150.0*f[8]+150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]+225.0*f[30]+270.0*f[25]+225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]+135.0*f[102]+135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+216.0*f[92]+216.0*f[91]+135.0*f[90]+360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]+216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]-360.0*f[15]-540.0*f[14]-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+(3645.0*f[110]+2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+540.0*f[13]+540.0*f[12]+600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[29]-1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[27]-1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]-720.0*f[84]-720.0*f[83]-1080.0*f[82]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[29]+1080.0*f[28]+1620.0*f[27]+1620.0*f[26]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]+135.0*f[29]+135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[29]-90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]+30.0*f[84]+30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]+120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]-72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-72.0*f[90]-45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87]+40.0*f[46]+40.0*f[41]+40.0*f[40]))+(810.0*f[78]+810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l+9.0*f[104]-18.0*f[103]-18.0*f[89]+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*(((-10.0*f[41])-10.0*f[40])*vcut_lR3+(15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[47]+10.0*f[41]+10.0*f[40]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31])*vcut_l-15.0*f[106]-15.0*f[105]+12.0*f[88]+12.0*f[87]+10.0*f[48]+10.0*f[47]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[67])-30.0*f[66])*vcut_lR3+(15.0*f[84]+15.0*f[83]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]+18.0*f[22]+10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[81]+30.0*f[67]+30.0*f[66]-24.0*f[57]-24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l-15.0*f[84]-15.0*f[83]+30.0*f[82]+30.0*f[81]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]-24.0*f[57]-24.0*f[56]-18.0*f[22]+36.0*f[21]-10.0*f[4]+20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+(36.0*f[6]+20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]+36.0*f[6]+20.0*f[0])+(90.0*f[65]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[10])-30.0*f[9])*vcut_lR2+((-60.0*f[8])-60.0*f[7])*vcut_l+30.0*f[10]+30.0*f[9]-60.0*f[8]-60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]-90.0*f[24]-90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]-90.0*f[80]-60.0*f[62]-60.0*f[61]+180.0*f[58]+90.0*f[24]+90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[90])-225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+180.0*f[104]-270.0*f[103]+135.0*f[90]-360.0*f[89]+100.0*f[50]-150.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+((-180.0*f[106])-180.0*f[105]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]-180.0*f[105]+144.0*f[88]+144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[65])-225.0*f[19])*vcut_lR4+(540.0*f[111]+300.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[24]+360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2+540.0*f[111]+300.0*f[85]-270.0*f[80]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[24]+360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+(540.0*f[8]+540.0*f[7])*vcut_lR2+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+(2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[51])-600.0*f[11])*vcut_lR3+((-540.0*f[6])-300.0*f[0])*vcut_lR2-1080.0*f[51]-600.0*f[11]+540.0*f[6]+300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-1350.0*f[82])-1350.0*f[81]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[21]-900.0*f[3])*vcut_lR2-900.0*f[84]-900.0*f[83]+1350.0*f[82]+1350.0*f[81]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l+45.0*f[104]+144.0*f[90]-90.0*f[89]+25.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*(((-180.0*f[41])-180.0*f[40])*vcut_lR5+(225.0*f[106]+225.0*f[105]-180.0*f[88]-180.0*f[87])*vcut_lR4+(100.0*f[48]+100.0*f[47]+200.0*f[41]+200.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_lR3+((-150.0*f[106])-150.0*f[105]+120.0*f[88]+120.0*f[87])*vcut_lR2+((-100.0*f[48])-100.0*f[47]-100.0*f[41]-100.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_l-75.0*f[106]-75.0*f[105]+60.0*f[88]+60.0*f[87]-80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[67])-540.0*f[66])*vcut_lR5+(225.0*f[84]+225.0*f[83]-450.0*f[64]-450.0*f[63]-180.0*f[60]-180.0*f[59]+270.0*f[22]+150.0*f[4])*vcut_lR4+(300.0*f[82]+300.0*f[81]+600.0*f[67]+600.0*f[66]-240.0*f[57]-240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+((-150.0*f[84])-150.0*f[83]+300.0*f[64]+300.0*f[63]+120.0*f[60]+120.0*f[59]-180.0*f[22]-100.0*f[4])*vcut_lR2+((-300.0*f[82])-300.0*f[81]-300.0*f[67]-300.0*f[66]+240.0*f[57]+240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l-75.0*f[84]-75.0*f[83]-240.0*f[67]-240.0*f[66]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[22]-50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+(360.0*f[6]+200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+((-360.0*f[6])-200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+(1620.0*f[65]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[10])-450.0*f[9])*vcut_lR4+((-600.0*f[8])-600.0*f[7])*vcut_lR3+(300.0*f[10]+300.0*f[9])*vcut_lR2+(600.0*f[8]+600.0*f[7])*vcut_l+150.0*f[10]+150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]-1350.0*f[24]-1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]+900.0*f[24]+900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]+720.0*f[65]-300.0*f[62]-300.0*f[61]+450.0*f[24]+450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l+9.0*f[104]+18.0*f[103]-18.0*f[89]+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*(((-10.0*f[41])-10.0*f[40])*vcut_lR3+(15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[47]+10.0*f[41]+10.0*f[40]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31])*vcut_l-15.0*f[106]-15.0*f[105]+12.0*f[88]+12.0*f[87]-10.0*f[48]-10.0*f[47]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[67])-30.0*f[66])*vcut_lR3+(15.0*f[84]+15.0*f[83]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]+18.0*f[22]+10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[81]+30.0*f[67]+30.0*f[66]-24.0*f[57]-24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l-15.0*f[84]-15.0*f[83]-30.0*f[82]-30.0*f[81]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]+24.0*f[57]+24.0*f[56]-18.0*f[22]-36.0*f[21]-10.0*f[4]-20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+(36.0*f[6]+20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]-36.0*f[6]-20.0*f[0])+(90.0*f[65]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[10])-30.0*f[9])*vcut_lR2+((-60.0*f[8])-60.0*f[7])*vcut_l+30.0*f[10]+30.0*f[9]+60.0*f[8]+60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]-90.0*f[24]-90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]+90.0*f[80]-60.0*f[62]-60.0*f[61]-180.0*f[58]+90.0*f[24]+90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[90])-225.0*f[42])*vcut_lR4+(180.0*f[104]-360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-180.0*f[104]-270.0*f[103]+135.0*f[90]+360.0*f[89]-100.0*f[50]-150.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+((-180.0*f[106])-180.0*f[105]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[65])-225.0*f[19])*vcut_lR4+(540.0*f[111]+300.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[24]+360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2-540.0*f[111]-300.0*f[85]-270.0*f[80]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[24]-360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+(540.0*f[8]+540.0*f[7])*vcut_lR2-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+(2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[51])-600.0*f[11])*vcut_lR3+((-540.0*f[6])-300.0*f[0])*vcut_lR2+1080.0*f[51]+600.0*f[11]+540.0*f[6]+300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-1350.0*f[82])-1350.0*f[81]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]-1620.0*f[21]-900.0*f[3])*vcut_lR2+900.0*f[84]+900.0*f[83]+1350.0*f[82]+1350.0*f[81]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l+45.0*f[104]-144.0*f[90]-90.0*f[89]+25.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*(((-180.0*f[41])-180.0*f[40])*vcut_lR5+(225.0*f[106]+225.0*f[105]-180.0*f[88]-180.0*f[87])*vcut_lR4+(100.0*f[48]+100.0*f[47]+200.0*f[41]+200.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_lR3+((-150.0*f[106])-150.0*f[105]+120.0*f[88]+120.0*f[87])*vcut_lR2+((-100.0*f[48])-100.0*f[47]-100.0*f[41]-100.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_l-75.0*f[106]-75.0*f[105]+60.0*f[88]+60.0*f[87]+80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[67])-540.0*f[66])*vcut_lR5+(225.0*f[84]+225.0*f[83]-450.0*f[64]-450.0*f[63]-180.0*f[60]-180.0*f[59]+270.0*f[22]+150.0*f[4])*vcut_lR4+(300.0*f[82]+300.0*f[81]+600.0*f[67]+600.0*f[66]-240.0*f[57]-240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+((-150.0*f[84])-150.0*f[83]+300.0*f[64]+300.0*f[63]+120.0*f[60]+120.0*f[59]-180.0*f[22]-100.0*f[4])*vcut_lR2+((-300.0*f[82])-300.0*f[81]-300.0*f[67]-300.0*f[66]+240.0*f[57]+240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l-75.0*f[84]-75.0*f[83]+240.0*f[67]+240.0*f[66]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[22]-50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+(360.0*f[6]+200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+((-360.0*f[6])-200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+(1620.0*f[65]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[10])-450.0*f[9])*vcut_lR4+((-600.0*f[8])-600.0*f[7])*vcut_lR3+(300.0*f[10]+300.0*f[9])*vcut_lR2+(600.0*f[8]+600.0*f[7])*vcut_l+150.0*f[10]+150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]-1350.0*f[24]-1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]+900.0*f[24]+900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]-720.0*f[65]-300.0*f[62]-300.0*f[61]+450.0*f[24]+450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]-30.0*f[83]+60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+60.0*f[57]+60.0*f[56]-45.0*f[29]-45.0*f[28]+90.0*f[27]+90.0*f[26]+45.0*f[22]-90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+36.0*f[92]+36.0*f[91]+45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]-30.0*f[88]-30.0*f[87]+20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+(225.0*f[78]+225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]+75.0*f[15]-150.0*f[14]-75.0*f[10]-75.0*f[9]+150.0*f[8]+150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]+225.0*f[30]-270.0*f[25]-225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]+135.0*f[102]+135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+216.0*f[92]+216.0*f[91]-135.0*f[90]+360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]-216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]+360.0*f[15]-540.0*f[14]-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+(3645.0*f[110]+2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]+1080.0*f[51]+540.0*f[13]+540.0*f[12]+600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[29]-1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[27]-1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]-720.0*f[84]-720.0*f[83]+1080.0*f[82]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[29]-1080.0*f[28]+1620.0*f[27]+1620.0*f[26]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]+135.0*f[29]+135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[29]-90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]-30.0*f[84]-30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]+120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]+72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-72.0*f[90]+45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87]-40.0*f[46]+40.0*f[41]+40.0*f[40]))+(810.0*f[78]+810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])-75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]-30.0*f[83]-60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-60.0*f[57]-60.0*f[56]-45.0*f[29]-45.0*f[28]-90.0*f[27]-90.0*f[26]+45.0*f[22]+90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]-90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-36.0*f[92]-36.0*f[91]+45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])-25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]-30.0*f[88]-30.0*f[87]-20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+(225.0*f[78]+225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])-75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])-150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]+75.0*f[15]+150.0*f[14]-75.0*f[10]-75.0*f[9]-150.0*f[8]-150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]+225.0*f[30]+270.0*f[25]-225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]+270.0*f[101]-216.0*f[92]-216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]+135.0*f[102]+135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+216.0*f[92]+216.0*f[91]-135.0*f[90]-360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]+270.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]-216.0*f[80]+135.0*f[78]+135.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]-360.0*f[15]-540.0*f[14]+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+(3645.0*f[110]+2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])-540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]-1080.0*f[51]+540.0*f[13]+540.0*f[12]-600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[29]-1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]-1620.0*f[27]-1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]+720.0*f[84]+720.0*f[83]+1080.0*f[82]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[29]+1080.0*f[28]+1620.0*f[27]+1620.0*f[26]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])-270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]+135.0*f[29]+135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[29]-90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]-30.0*f[84]-30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]-120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]-72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+72.0*f[90]+45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])-90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87]+40.0*f[46]-40.0*f[41]-40.0*f[40]))+(810.0*f[78]+810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])-225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]+150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[0][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[0][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[0][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[0][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[0][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[0][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_1 
  vcutSq = -0.025*(1.732050807568877*((-21.21320343559643*phiWall[18])+21.21320343559643*phi[18]-14.14213562373095*phiWall[3]+14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[15]-2.828427124746191*phi[15]-1.414213562373095*phiWall[12]+1.414213562373095*phi[12])+7.071067811865476*phiWall[14]-7.071067811865476*phi[14]-5.656854249492382*phiWall[13]+5.656854249492382*phi[13])+2.23606797749979*((-14.14213562373095*phiWall[9])+14.14213562373095*phi[9]+7.071067811865476*phiWall[8]-7.071067811865476*phi[8]-5.656854249492382*phiWall[7]+5.656854249492382*phi[7]+1.732050807568877*(8.485281374238571*phiWall[5]-8.485281374238571*phi[5])+8.485281374238571*phiWall[1]-8.485281374238571*phi[1])-14.14213562373095*phiWall[0]+14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[1][0] = 0.0; 
  fReflSurfXY[1][1] = 0.0; 
  fReflSurfXY[1][2] = 0.0; 
  fReflSurfXY[1][3] = 0.0; 
  fReflSurfXY[1][4] = 0.0; 
  fReflSurfXY[1][5] = 0.0; 
  fReflSurfXY[1][6] = 0.0; 
  fReflSurfXY[1][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[1][0] = 0.03535533905932736*(8.660254037844386*(3.0*f[57]+2.0*f[3])-3.872983346207417*(3.872983346207417*(2.0*f[35]-1.0*f[32])+5.0*f[34]-4.0*f[33])+2.23606797749979*(5.0*(2.0*f[18]-1.0*f[17])+4.0*f[16]-2.0*(5.196152422706631*f[7]+2.0*f[1]))+10.0*f[0]); 
  fReflSurfXY[1][1] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[88]+1.732050807568877*(5.0*(2.0*f[39]-1.0*f[38])+4.0*f[37]))-1.0*(90.0*f[63]+2.23606797749979*(5.196152422706631*(5.0*f[62]-4.0*f[61]+6.0*f[23])+18.0*f[9]))+5.0*(9.0*f[60]+2.0*(5.196152422706631*f[11]+2.0*f[4]))); 
  fReflSurfXY[1][2] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[92]+1.732050807568877*(5.0*(2.0*f[45]-1.0*f[44])+4.0*f[43]))-1.0*(90.0*f[72]+2.23606797749979*(5.196152422706631*(5.0*f[71]-4.0*f[70]+6.0*f[26])+18.0*f[12]))+5.0*(9.0*f[69]+2.0*(5.196152422706631*f[14]+2.0*f[5]))); 
  fReflSurfXY[1][3] = 0.03535533905932736*(8.660254037844386*(3.0*f[108]+2.0*f[30])-3.872983346207417*(3.872983346207417*(2.0*f[98]-1.0*f[95])+5.0*f[97]-4.0*f[96])+2.23606797749979*(5.0*(2.0*f[76]-1.0*f[75])+4.0*f[74]-2.0*(5.196152422706631*f[54]+2.0*f[28]))+10.0*f[15]); 
  fReflSurfXY[1][4] = -0.07071067811865474*(11.61895003862225*f[66]-1.0*(3.872983346207417*(2.23606797749979*f[42]-1.732050807568877*f[40])+5.0*f[19])); 
  fReflSurfXY[1][5] = -0.07071067811865474*(11.61895003862225*f[81]-1.0*(3.872983346207417*(2.23606797749979*f[49]-1.732050807568877*f[47])+5.0*f[20])); 
  fReflSurfXY[1][6] = -0.07071067811865474*(11.61895003862225*f[101]-1.0*(3.872983346207417*(2.23606797749979*f[79]-1.732050807568877*f[77])+5.0*f[46])); 
  fReflSurfXY[1][7] = -0.07071067811865474*(11.61895003862225*f[105]-1.0*(3.872983346207417*(2.23606797749979*f[85]-1.732050807568877*f[83])+5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]-18.0*f[92]-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[40])*vcut_lR3+((-12.0*f[105])+15.0*f[97]-12.0*f[96]+15.0*f[88])*vcut_lR2+((-8.0*f[47])+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88]-8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[66])*vcut_lR3+((-12.0*f[83])-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[63]+15.0*f[60]+18.0*f[28]+10.0*f[4])*vcut_lR2+((-24.0*f[81])+30.0*f[79]+30.0*f[71]-24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l+12.0*f[83]-24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[71]-24.0*f[70]+30.0*f[63]-15.0*f[60]+30.0*f[57]-18.0*f[28]+36.0*f[26]-10.0*f[4]+20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+(36.0*f[12]+20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]-30.0*f[11]+20.0*f[0])+(90.0*f[77]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[9])*vcut_lR2+((-60.0*f[14])-60.0*f[7])*vcut_l+30.0*f[15]-60.0*f[14]+30.0*f[9]-60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]-90.0*f[30]-90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]+180.0*f[72]-90.0*f[69]+75.0*f[62]-60.0*f[61]+90.0*f[30]+90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[101])-225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2+135.0*f[101]-360.0*f[98]+180.0*f[95]-270.0*f[92]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+(144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2+144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*(((-405.0*f[77])-225.0*f[19])*vcut_lR4+(540.0*f[108]-240.0*f[85]+300.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2+540.0*f[108]-240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]+300.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+(540.0*f[14]+540.0*f[7])*vcut_lR2+360.0*f[15]-540.0*f[14]+360.0*f[9]-540.0*f[7])+(2025.0*f[79]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[54])-600.0*f[11])*vcut_lR3+((-540.0*f[12])-300.0*f[0])*vcut_lR2-1080.0*f[54]+540.0*f[12]-600.0*f[11]+300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]-1080.0*f[28]-600.0*f[4])*vcut_lR3+(1080.0*f[81]-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]-1350.0*f[66]-1350.0*f[57]-1620.0*f[26]-900.0*f[3])*vcut_lR2+720.0*f[83]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1350.0*f[71]-1080.0*f[70]-675.0*f[66]+1800.0*f[63]-900.0*f[60]+1350.0*f[57]-1080.0*f[28]+1620.0*f[26]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l+144.0*f[101]-90.0*f[98]+45.0*f[95]-20.0*f[50]+80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[40])*vcut_lR5+((-180.0*f[105])+225.0*f[97]-180.0*f[96]+225.0*f[88])*vcut_lR4+((-80.0*f[47])+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+(120.0*f[105]-150.0*f[97]+120.0*f[96]-150.0*f[88])*vcut_lR2+(80.0*f[47]-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l+60.0*f[105]-75.0*f[97]+60.0*f[96]-75.0*f[88]-80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[66])*vcut_lR5+((-180.0*f[83])-450.0*f[76]+225.0*f[75]-180.0*f[74]-450.0*f[63]+225.0*f[60]+270.0*f[28]+150.0*f[4])*vcut_lR4+((-240.0*f[81])+600.0*f[79]+300.0*f[71]-240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+(120.0*f[83]+300.0*f[76]-150.0*f[75]+120.0*f[74]+300.0*f[63]-150.0*f[60]-180.0*f[28]-100.0*f[4])*vcut_lR2+(240.0*f[81]-300.0*f[79]-300.0*f[71]+240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l+60.0*f[83]-240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]-240.0*f[66]+150.0*f[63]-75.0*f[60]-90.0*f[28]-50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+(360.0*f[12]+200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+((-360.0*f[12])-200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+(1620.0*f[77]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[9])*vcut_lR4+((-600.0*f[14])-600.0*f[7])*vcut_lR3+(300.0*f[15]+300.0*f[9])*vcut_lR2+(600.0*f[14]+600.0*f[7])*vcut_l+150.0*f[15]+150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]-1350.0*f[30]-1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]+900.0*f[30]+900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]+720.0*f[77]+375.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]+18.0*f[92]-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[40])*vcut_lR3+((-12.0*f[105])+15.0*f[97]-12.0*f[96]+15.0*f[88])*vcut_lR2+((-8.0*f[47])+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88]+8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[66])*vcut_lR3+((-12.0*f[83])-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[63]+15.0*f[60]+18.0*f[28]+10.0*f[4])*vcut_lR2+((-24.0*f[81])+30.0*f[79]+30.0*f[71]-24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l+12.0*f[83]+24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[71]+24.0*f[70]+30.0*f[63]-15.0*f[60]-30.0*f[57]-18.0*f[28]-36.0*f[26]-10.0*f[4]-20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+(36.0*f[12]+20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]-30.0*f[11]-20.0*f[0])+(90.0*f[77]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[9])*vcut_lR2+((-60.0*f[14])-60.0*f[7])*vcut_l+30.0*f[15]+60.0*f[14]+30.0*f[9]+60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]-90.0*f[30]-90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]-180.0*f[72]+90.0*f[69]+75.0*f[62]-60.0*f[61]+90.0*f[30]+90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[101])-225.0*f[42])*vcut_lR4+((-360.0*f[98])+180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2+135.0*f[101]+360.0*f[98]-180.0*f[95]-270.0*f[92]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+(144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2-144.0*f[105]+180.0*f[97]-144.0*f[96]+180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*(((-405.0*f[77])-225.0*f[19])*vcut_lR4+(540.0*f[108]-240.0*f[85]+300.0*f[62]-240.0*f[61]+360.0*f[30]+360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2-540.0*f[108]+240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]-300.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+(540.0*f[14]+540.0*f[7])*vcut_lR2-360.0*f[15]-540.0*f[14]-360.0*f[9]-540.0*f[7])+(2025.0*f[79]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[54])-600.0*f[11])*vcut_lR3+((-540.0*f[12])-300.0*f[0])*vcut_lR2+1080.0*f[54]+540.0*f[12]+600.0*f[11]+300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]-1080.0*f[28]-600.0*f[4])*vcut_lR3+(1080.0*f[81]-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]-1350.0*f[66]-1350.0*f[57]-1620.0*f[26]-900.0*f[3])*vcut_lR2-720.0*f[83]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]+1350.0*f[71]-1080.0*f[70]-675.0*f[66]-1800.0*f[63]+900.0*f[60]+1350.0*f[57]+1080.0*f[28]+1620.0*f[26]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l-144.0*f[101]-90.0*f[98]+45.0*f[95]-20.0*f[50]-80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[40])*vcut_lR5+((-180.0*f[105])+225.0*f[97]-180.0*f[96]+225.0*f[88])*vcut_lR4+((-80.0*f[47])+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+(120.0*f[105]-150.0*f[97]+120.0*f[96]-150.0*f[88])*vcut_lR2+(80.0*f[47]-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l+60.0*f[105]-75.0*f[97]+60.0*f[96]-75.0*f[88]+80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[66])*vcut_lR5+((-180.0*f[83])-450.0*f[76]+225.0*f[75]-180.0*f[74]-450.0*f[63]+225.0*f[60]+270.0*f[28]+150.0*f[4])*vcut_lR4+((-240.0*f[81])+600.0*f[79]+300.0*f[71]-240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+(120.0*f[83]+300.0*f[76]-150.0*f[75]+120.0*f[74]+300.0*f[63]-150.0*f[60]-180.0*f[28]-100.0*f[4])*vcut_lR2+(240.0*f[81]-300.0*f[79]-300.0*f[71]+240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l+60.0*f[83]+240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]+240.0*f[66]+150.0*f[63]-75.0*f[60]-90.0*f[28]-50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+(360.0*f[12]+200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+((-360.0*f[12])-200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+(1620.0*f[77]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[9])*vcut_lR4+((-600.0*f[14])-600.0*f[7])*vcut_lR3+(300.0*f[15]+300.0*f[9])*vcut_lR2+(600.0*f[14]+600.0*f[7])*vcut_l+150.0*f[15]+150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]-1350.0*f[30]-1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]+900.0*f[30]+900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]-720.0*f[77]+375.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[66]*vcut_lR3)+(15.0*f[83]-30.0*f[63]+15.0*f[60]+10.0*f[4])*vcut_lR2+(30.0*f[81]+30.0*f[66]+30.0*f[57]+20.0*f[3])*vcut_l-15.0*f[83]+30.0*f[81]+30.0*f[63]-15.0*f[60]+30.0*f[57]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+5.0*f[50]-10.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((-10.0*f[40]*vcut_lR3)+(15.0*f[105]+15.0*f[88])*vcut_lR2+(10.0*f[47]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]+10.0*f[47]-20.0*f[35]+10.0*f[32]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[9]*vcut_lR2)-60.0*f[7]*vcut_l+30.0*f[9]-60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]-90.0*f[23])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]-50.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+(20.0*f[50]-40.0*f[39]+20.0*f[38]-16.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]+30.0*f[34]-24.0*f[33])*vcut_lR2+20.0*f[50]-30.0*f[49]+15.0*f[42]-40.0*f[39]+20.0*f[38]-16.0*f[37]-30.0*f[34]+24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+((-36.0*f[105])-36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2-36.0*f[105]-36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(60.0*f[85]+60.0*f[62]-48.0*f[61]+72.0*f[23])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]+36.0*f[1])*vcut_lR2+60.0*f[85]+60.0*f[62]-48.0*f[61]+72.0*f[23]-30.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3+108.0*f[7]*vcut_lR2+72.0*f[9]-108.0*f[7])+405.0*f[66]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]-120.0*f[4])*vcut_lR3+((-270.0*f[81])-270.0*f[66]-270.0*f[57]-180.0*f[3])*vcut_lR2-180.0*f[83]+270.0*f[81]-135.0*f[66]+360.0*f[63]-180.0*f[60]+270.0*f[57]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[66]*vcut_lR5)+(45.0*f[83]-90.0*f[63]+45.0*f[60]+30.0*f[4])*vcut_lR4+(60.0*f[81]+120.0*f[66]+60.0*f[57]+40.0*f[3])*vcut_lR3+((-30.0*f[83])+60.0*f[63]-30.0*f[60]-20.0*f[4])*vcut_lR2+((-60.0*f[81])-60.0*f[66]-60.0*f[57]-40.0*f[3])*vcut_l-15.0*f[83]-48.0*f[66]+30.0*f[63]-15.0*f[60]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]+12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]-8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l+5.0*f[50]+16.0*f[42]-10.0*f[39]+5.0*f[38]-4.0*f[37])+1.732050807568877*((-36.0*f[40]*vcut_lR5)+(45.0*f[105]+45.0*f[88])*vcut_lR4+(20.0*f[47]+40.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_lR3+((-30.0*f[105])-30.0*f[88])*vcut_lR2+((-20.0*f[47])-20.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]-16.0*f[40]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[9]*vcut_lR4)-120.0*f[7]*vcut_lR3+60.0*f[9]*vcut_lR2+120.0*f[7]*vcut_l+30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]-270.0*f[23])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]-120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]+180.0*f[23])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]+120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[66]*vcut_lR3)+(15.0*f[83]-30.0*f[63]+15.0*f[60]+10.0*f[4])*vcut_lR2+(30.0*f[81]+30.0*f[66]+30.0*f[57]+20.0*f[3])*vcut_l-15.0*f[83]-30.0*f[81]+30.0*f[63]-15.0*f[60]-30.0*f[57]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+5.0*f[50]+10.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((-10.0*f[40]*vcut_lR3)+(15.0*f[105]+15.0*f[88])*vcut_lR2+(10.0*f[47]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]-10.0*f[47]+20.0*f[35]-10.0*f[32]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[9]*vcut_lR2)-60.0*f[7]*vcut_l+30.0*f[9]+60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]-90.0*f[23])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]+50.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+(20.0*f[50]-40.0*f[39]+20.0*f[38]-16.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]+30.0*f[34]-24.0*f[33])*vcut_lR2-20.0*f[50]-30.0*f[49]+15.0*f[42]+40.0*f[39]-20.0*f[38]+16.0*f[37]-30.0*f[34]+24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+((-36.0*f[105])-36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2+36.0*f[105]+36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(60.0*f[85]+60.0*f[62]-48.0*f[61]+72.0*f[23])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]+36.0*f[1])*vcut_lR2-60.0*f[85]-60.0*f[62]+48.0*f[61]-72.0*f[23]-30.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3+108.0*f[7]*vcut_lR2-72.0*f[9]-108.0*f[7])+405.0*f[66]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]-120.0*f[4])*vcut_lR3+((-270.0*f[81])-270.0*f[66]-270.0*f[57]-180.0*f[3])*vcut_lR2+180.0*f[83]+270.0*f[81]-135.0*f[66]-360.0*f[63]+180.0*f[60]+270.0*f[57]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[66]*vcut_lR5)+(45.0*f[83]-90.0*f[63]+45.0*f[60]+30.0*f[4])*vcut_lR4+(60.0*f[81]+120.0*f[66]+60.0*f[57]+40.0*f[3])*vcut_lR3+((-30.0*f[83])+60.0*f[63]-30.0*f[60]-20.0*f[4])*vcut_lR2+((-60.0*f[81])-60.0*f[66]-60.0*f[57]-40.0*f[3])*vcut_l-15.0*f[83]+48.0*f[66]+30.0*f[63]-15.0*f[60]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]+12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]-8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l+5.0*f[50]-16.0*f[42]-10.0*f[39]+5.0*f[38]-4.0*f[37])+1.732050807568877*((-36.0*f[40]*vcut_lR5)+(45.0*f[105]+45.0*f[88])*vcut_lR4+(20.0*f[47]+40.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_lR3+((-30.0*f[105])-30.0*f[88])*vcut_lR2+((-20.0*f[47])-20.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_l-15.0*f[105]-15.0*f[88]+16.0*f[40]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[9]*vcut_lR4)-120.0*f[7]*vcut_lR3+60.0*f[9]*vcut_lR2+120.0*f[7]*vcut_l+30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]-270.0*f[23])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]-120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]+180.0*f[23])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]+120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[23]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]-18.0*f[92]+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[46])*vcut_lR3+(12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88])*vcut_lR2+(8.0*f[47]+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-12.0*f[105]-15.0*f[97]+12.0*f[96]+15.0*f[88]+8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[79])*vcut_lR3+(12.0*f[83]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[63]-15.0*f[60]+18.0*f[28]-10.0*f[4])*vcut_lR2+(24.0*f[81]+30.0*f[79]+30.0*f[71]-24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l-12.0*f[83]+24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[71]-24.0*f[70]-30.0*f[63]+15.0*f[60]-30.0*f[57]-18.0*f[28]+36.0*f[26]+10.0*f[4]-20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(36.0*f[12]-20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]+30.0*f[11]-20.0*f[0])+(90.0*f[77]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[15])*vcut_lR2+(60.0*f[7]-60.0*f[14])*vcut_l+30.0*f[15]-60.0*f[14]-30.0*f[9]+60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[30]+90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]+180.0*f[72]-90.0*f[69]-75.0*f[62]+60.0*f[61]+90.0*f[30]-90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[101])*vcut_lR4+((-360.0*f[98])+180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2+135.0*f[101]-360.0*f[98]+180.0*f[95]-270.0*f[92]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+((-144.0*f[105])-180.0*f[97]+144.0*f[96]+180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2-144.0*f[105]-180.0*f[97]+144.0*f[96]+180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[77])*vcut_lR4+(540.0*f[108]+240.0*f[85]-300.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2+540.0*f[108]+240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]-300.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[14]-540.0*f[7])*vcut_lR2+360.0*f[15]-540.0*f[14]-360.0*f[9]+540.0*f[7])+(2025.0*f[79]-2025.0*f[66])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[54])*vcut_lR3+(300.0*f[0]-540.0*f[12])*vcut_lR2-1080.0*f[54]+540.0*f[12]+600.0*f[11]-300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]-1080.0*f[28]+600.0*f[4])*vcut_lR3+((-1080.0*f[81])-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]+1350.0*f[66]+1350.0*f[57]-1620.0*f[26]+900.0*f[3])*vcut_lR2-720.0*f[83]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1350.0*f[71]-1080.0*f[70]+675.0*f[66]-1800.0*f[63]+900.0*f[60]-1350.0*f[57]-1080.0*f[28]+1620.0*f[26]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l+144.0*f[101]-90.0*f[98]+45.0*f[95]+20.0*f[50]-80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[46])*vcut_lR5+(180.0*f[105]+225.0*f[97]-180.0*f[96]-225.0*f[88])*vcut_lR4+(80.0*f[47]+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+((-120.0*f[105])-150.0*f[97]+120.0*f[96]+150.0*f[88])*vcut_lR2+((-80.0*f[47])-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l-60.0*f[105]-75.0*f[97]+60.0*f[96]+75.0*f[88]-80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[79])*vcut_lR5+(180.0*f[83]-450.0*f[76]+225.0*f[75]-180.0*f[74]+450.0*f[63]-225.0*f[60]+270.0*f[28]-150.0*f[4])*vcut_lR4+(240.0*f[81]+600.0*f[79]+300.0*f[71]-240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+((-120.0*f[83])+300.0*f[76]-150.0*f[75]+120.0*f[74]-300.0*f[63]+150.0*f[60]-180.0*f[28]+100.0*f[4])*vcut_lR2+((-240.0*f[81])-300.0*f[79]-300.0*f[71]+240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l-60.0*f[83]-240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]+240.0*f[66]-150.0*f[63]+75.0*f[60]-90.0*f[28]+50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(360.0*f[12]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(200.0*f[0]-360.0*f[12])*vcut_l-270.0*f[54]+150.0*f[11])+(1620.0*f[77]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[15])*vcut_lR4+(600.0*f[7]-600.0*f[14])*vcut_lR3+(300.0*f[15]-300.0*f[9])*vcut_lR2+(600.0*f[14]-600.0*f[7])*vcut_l+150.0*f[15]-150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]-1350.0*f[30]+1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]+900.0*f[30]-900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]+720.0*f[77]-375.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]+18.0*f[92]+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[46])*vcut_lR3+(12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88])*vcut_lR2+(8.0*f[47]+10.0*f[46]-20.0*f[45]+10.0*f[44]-8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-12.0*f[105]-15.0*f[97]+12.0*f[96]+15.0*f[88]-8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[79])*vcut_lR3+(12.0*f[83]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[63]-15.0*f[60]+18.0*f[28]-10.0*f[4])*vcut_lR2+(24.0*f[81]+30.0*f[79]+30.0*f[71]-24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l-12.0*f[83]-24.0*f[81]+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[71]+24.0*f[70]-30.0*f[63]+15.0*f[60]+30.0*f[57]-18.0*f[28]-36.0*f[26]+10.0*f[4]+20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(36.0*f[12]-20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]+30.0*f[11]+20.0*f[0])+(90.0*f[77]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[15])*vcut_lR2+(60.0*f[7]-60.0*f[14])*vcut_l+30.0*f[15]+60.0*f[14]-30.0*f[9]-60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[30]+90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]-180.0*f[72]+90.0*f[69]-75.0*f[62]+60.0*f[61]+90.0*f[30]-90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[101])*vcut_lR4+((-360.0*f[98])+180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[101]+270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2+135.0*f[101]+360.0*f[98]-180.0*f[95]-270.0*f[92]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+((-144.0*f[105])-180.0*f[97]+144.0*f[96]+180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2+144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[77])*vcut_lR4+(540.0*f[108]+240.0*f[85]-300.0*f[62]+240.0*f[61]+360.0*f[30]-360.0*f[23])*vcut_lR3+(270.0*f[77]-540.0*f[72]+270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2-540.0*f[108]-240.0*f[85]+135.0*f[77]+540.0*f[72]-270.0*f[69]+300.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[14]-540.0*f[7])*vcut_lR2-360.0*f[15]-540.0*f[14]+360.0*f[9]+540.0*f[7])+(2025.0*f[79]-2025.0*f[66])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[54])*vcut_lR3+(300.0*f[0]-540.0*f[12])*vcut_lR2+1080.0*f[54]+540.0*f[12]-600.0*f[11]-300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]-1080.0*f[28]+600.0*f[4])*vcut_lR3+((-1080.0*f[81])-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]+1350.0*f[66]+1350.0*f[57]-1620.0*f[26]+900.0*f[3])*vcut_lR2+720.0*f[83]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]+1350.0*f[71]-1080.0*f[70]+675.0*f[66]+1800.0*f[63]-900.0*f[60]-1350.0*f[57]+1080.0*f[28]+1620.0*f[26]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l-144.0*f[101]-90.0*f[98]+45.0*f[95]+20.0*f[50]+80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[46])*vcut_lR5+(180.0*f[105]+225.0*f[97]-180.0*f[96]-225.0*f[88])*vcut_lR4+(80.0*f[47]+200.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+((-120.0*f[105])-150.0*f[97]+120.0*f[96]+150.0*f[88])*vcut_lR2+((-80.0*f[47])-100.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l-60.0*f[105]-75.0*f[97]+60.0*f[96]+75.0*f[88]+80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[79])*vcut_lR5+(180.0*f[83]-450.0*f[76]+225.0*f[75]-180.0*f[74]+450.0*f[63]-225.0*f[60]+270.0*f[28]-150.0*f[4])*vcut_lR4+(240.0*f[81]+600.0*f[79]+300.0*f[71]-240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+((-120.0*f[83])+300.0*f[76]-150.0*f[75]+120.0*f[74]-300.0*f[63]+150.0*f[60]-180.0*f[28]+100.0*f[4])*vcut_lR2+((-240.0*f[81])-300.0*f[79]-300.0*f[71]+240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l-60.0*f[83]+240.0*f[79]+150.0*f[76]-75.0*f[75]+60.0*f[74]-240.0*f[66]-150.0*f[63]+75.0*f[60]-90.0*f[28]+50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(360.0*f[12]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(200.0*f[0]-360.0*f[12])*vcut_l-270.0*f[54]+150.0*f[11])+(1620.0*f[77]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[15])*vcut_lR4+(600.0*f[7]-600.0*f[14])*vcut_lR3+(300.0*f[15]-300.0*f[9])*vcut_lR2+(600.0*f[14]-600.0*f[7])*vcut_l+150.0*f[15]-150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]-1350.0*f[30]+1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]+900.0*f[30]-900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]-720.0*f[77]-375.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[1][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[1][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[1][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[1][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[1][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[1][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_2 
  vcutSq = 0.01*(2.23606797749979*((-63.63961030678928*phiWall[19])+63.63961030678928*phi[19]+35.35533905932738*phiWall[9]-35.35533905932738*phi[9]+14.14213562373095*phiWall[8]-14.14213562373095*phi[8]+14.14213562373095*phiWall[7]-14.14213562373095*phi[7]+1.732050807568877*(21.21320343559643*phiWall[6]-21.21320343559643*(phi[6]+phiWall[5])+21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*(phi[2]+phiWall[1])+21.21320343559643*phi[1])+1.732050807568877*((-42.42640687119286*phiWall[18])+42.42640687119286*(phi[18]+phiWall[17])-42.42640687119286*phi[17]-63.63961030678928*phiWall[10]+63.63961030678928*phi[10]+35.35533905932738*phiWall[3]-35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*(phi[16]+phiWall[15])+7.071067811865476*phi[15]-2.828427124746191*phiWall[12]+2.828427124746191*(phi[12]+phiWall[11])-2.828427124746191*phi[11])+14.14213562373095*phiWall[14]-14.14213562373095*phi[14]+14.14213562373095*phiWall[13]-14.14213562373095*phi[13])-63.63961030678928*phiWall[4]+63.63961030678928*phi[4]+35.35533905932738*phiWall[0]-35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[2][0] = 0.0; 
  fReflSurfXY[2][1] = 0.0; 
  fReflSurfXY[2][2] = 0.0; 
  fReflSurfXY[2][3] = 0.0; 
  fReflSurfXY[2][4] = 0.0; 
  fReflSurfXY[2][5] = 0.0; 
  fReflSurfXY[2][6] = 0.0; 
  fReflSurfXY[2][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[2][0] = -0.01414213562373095*(11.18033988749895*(9.0*f[58]-1.0*(5.0*f[18]+2.0*(f[17]+f[16])+5.196152422706631*(f[8]-1.0*f[7]))+3.0*(f[1]-1.0*f[2]))+8.660254037844386*(3.0*(2.0*f[57]+3.0*f[21])-5.0*f[3])-3.872983346207417*(3.872983346207417*(5.0*f[36]-1.0*(5.0*f[35]+2.0*f[32])+2.0*f[31])+10.0*(f[34]+f[33]))+5.0*(9.0*f[6]-5.0*f[0])); 
  fReflSurfXY[2][1] = -0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[89]-1.0*(5.0*f[39]+2.0*(f[38]+f[37])))+40.24922359499622*(f[88]-1.0*f[87]))+225.0*(f[63]-1.0*f[64])-11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[24]-1.0*f[23]))+9.0*(f[10]-1.0*f[9]))+5.0*(18.0*f[60]+5.196152422706631*(9.0*f[51]-5.0*f[11])+3.0*(9.0*f[22]-5.0*f[4]))); 
  fReflSurfXY[2][2] = -0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[93]-1.0*(5.0*f[45]+2.0*(f[44]+f[43])))+40.24922359499622*(f[92]-1.0*f[91]))+225.0*(f[72]-1.0*f[73])-11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[27]-1.0*f[26]))+9.0*(f[13]-1.0*f[12]))+5.0*(18.0*f[69]+5.196152422706631*(9.0*f[52]-5.0*f[14])+3.0*(9.0*f[25]-5.0*f[5]))); 
  fReflSurfXY[2][3] = -0.01414213562373095*(11.18033988749895*(9.0*f[109]-1.0*(5.0*f[76]+2.0*(f[75]+f[74])+5.196152422706631*(f[55]-1.0*f[54]))+3.0*(f[28]-1.0*f[29]))+8.660254037844386*(3.0*(2.0*f[108]+3.0*f[86])-5.0*f[30])-3.872983346207417*(3.872983346207417*(5.0*f[99]-1.0*(5.0*f[98]+2.0*f[95])+2.0*f[94])+10.0*(f[97]+f[96]))+5.0*(9.0*f[53]-5.0*f[15])); 
  fReflSurfXY[2][4] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]-5.0*f[42])+8.660254037844386*(f[40]-1.0*f[41]))+58.09475019311126*(f[66]-1.0*f[67])+5.0*(9.0*f[65]-5.0*f[19])); 
  fReflSurfXY[2][5] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]-5.0*f[49])+8.660254037844386*(f[47]-1.0*f[48]))+58.09475019311126*(f[81]-1.0*f[82])+5.0*(9.0*f[80]-5.0*f[20])); 
  fReflSurfXY[2][6] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]-5.0*f[79])+8.660254037844386*(f[77]-1.0*f[78]))+58.09475019311126*(f[101]-1.0*f[102])+5.0*(9.0*f[100]-5.0*f[46])); 
  fReflSurfXY[2][7] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]-5.0*f[85])+8.660254037844386*(f[83]-1.0*f[84]))+58.09475019311126*(f[105]-1.0*f[106])+5.0*(9.0*f[104]-5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]-30.0*f[83]-60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+60.0*f[57]-60.0*f[56]-45.0*f[29]+45.0*f[28]+90.0*f[27]-90.0*f[26]-45.0*f[22]+90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-36.0*f[92]+36.0*f[91]-45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]-30.0*f[88]+30.0*f[87]-20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+(225.0*f[78]-225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]-75.0*f[15]+150.0*f[14]+75.0*f[10]-75.0*f[9]-150.0*f[8]+150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]-225.0*f[30]-270.0*f[25]+225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]+135.0*f[102]-135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-216.0*f[92]+216.0*f[91]+135.0*f[90]-360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]-360.0*f[15]+540.0*f[14]+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+(3645.0*f[110]-2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]-1080.0*f[51]+540.0*f[13]-540.0*f[12]+600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[29]+1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[27]+1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]+720.0*f[84]-720.0*f[83]-1080.0*f[82]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[29]+1080.0*f[28]+1620.0*f[27]-1620.0*f[26]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]+135.0*f[29]-135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[29]+90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]+30.0*f[84]-30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]+120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]-72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+72.0*f[90]-45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87]+40.0*f[46]-40.0*f[41]+40.0*f[40]))+(810.0*f[78]-810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]+360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+((-135.0*f[109])-30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+(135.0*f[110]-60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l+135.0*f[109]+30.0*f[84]-30.0*f[83]+60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-60.0*f[57]+60.0*f[56]-45.0*f[29]+45.0*f[28]-90.0*f[27]+90.0*f[26]-45.0*f[22]-90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]-90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+36.0*f[92]-36.0*f[91]-45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]-20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]-30.0*f[88]+30.0*f[87]+20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+(225.0*f[78]-225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]-75.0*f[15]-150.0*f[14]+75.0*f[10]-75.0*f[9]+150.0*f[8]-150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]-405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]-270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]-225.0*f[30]+270.0*f[25]+225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]+135.0*f[102]-135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-216.0*f[92]+216.0*f[91]+135.0*f[90]+360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]-432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]-240.0*f[85]+216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]+360.0*f[15]+540.0*f[14]-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+(3645.0*f[110]-2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]+1080.0*f[51]+540.0*f[13]-540.0*f[12]-600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[29]+1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[27]+1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]-720.0*f[84]+720.0*f[83]-1080.0*f[82]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[29]-1080.0*f[28]+1620.0*f[27]-1620.0*f[26]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+((-405.0*f[109])-90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]+135.0*f[29]-135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+(540.0*f[110]-120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+(270.0*f[109]+60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[29]+90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+((-270.0*f[110])+120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]+30.0*f[84]-30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]-120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]+72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-72.0*f[90]-45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87]-40.0*f[46]+40.0*f[41]-40.0*f[40]))+(810.0*f[78]-810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]-1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]+810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]+150.0*f[85]-360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l+9.0*f[104]-18.0*f[103]-18.0*f[89]-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[41])*vcut_lR3+(15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87])*vcut_lR2+(10.0*f[48]-10.0*f[47]+10.0*f[41]-10.0*f[40]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31])*vcut_l-15.0*f[106]+15.0*f[105]-12.0*f[88]+12.0*f[87]+10.0*f[48]-10.0*f[47]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[67])*vcut_lR3+(15.0*f[84]-15.0*f[83]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]+18.0*f[22]-10.0*f[4])*vcut_lR2+(30.0*f[82]-30.0*f[81]+30.0*f[67]-30.0*f[66]+24.0*f[57]-24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l-15.0*f[84]+15.0*f[83]+30.0*f[82]-30.0*f[81]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]+24.0*f[57]-24.0*f[56]-18.0*f[22]+36.0*f[21]+10.0*f[4]-20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(36.0*f[6]-20.0*f[0])*vcut_l-54.0*f[51]+30.0*f[11]+36.0*f[6]-20.0*f[0])+(90.0*f[65]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[10])*vcut_lR2+(60.0*f[7]-60.0*f[8])*vcut_l+30.0*f[10]-30.0*f[9]-60.0*f[8]+60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]-90.0*f[24]+90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]-90.0*f[80]+60.0*f[62]+60.0*f[61]+180.0*f[58]+90.0*f[24]-90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[90])*vcut_lR4+(180.0*f[104]-360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+180.0*f[104]-270.0*f[103]+135.0*f[90]-360.0*f[89]-100.0*f[50]+150.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+((-180.0*f[106])+180.0*f[105]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]+180.0*f[105]-144.0*f[88]+144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[65])*vcut_lR4+(540.0*f[111]-300.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[24]-360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2+540.0*f[111]-300.0*f[85]-270.0*f[80]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]+360.0*f[24]-360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[8]-540.0*f[7])*vcut_lR2+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+(2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[51])*vcut_lR3+(300.0*f[0]-540.0*f[6])*vcut_lR2-1080.0*f[51]+600.0*f[11]+540.0*f[6]-300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-1350.0*f[82])+1350.0*f[81]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[21]+900.0*f[3])*vcut_lR2-900.0*f[84]+900.0*f[83]+1350.0*f[82]-1350.0*f[81]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l+45.0*f[104]+144.0*f[90]-90.0*f[89]-25.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[41])*vcut_lR5+(225.0*f[106]-225.0*f[105]+180.0*f[88]-180.0*f[87])*vcut_lR4+(100.0*f[48]-100.0*f[47]+200.0*f[41]-200.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_lR3+((-150.0*f[106])+150.0*f[105]-120.0*f[88]+120.0*f[87])*vcut_lR2+((-100.0*f[48])+100.0*f[47]-100.0*f[41]+100.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_l-75.0*f[106]+75.0*f[105]-60.0*f[88]+60.0*f[87]-80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[67])*vcut_lR5+(225.0*f[84]-225.0*f[83]-450.0*f[64]+450.0*f[63]+180.0*f[60]-180.0*f[59]+270.0*f[22]-150.0*f[4])*vcut_lR4+(300.0*f[82]-300.0*f[81]+600.0*f[67]-600.0*f[66]+240.0*f[57]-240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+((-150.0*f[84])+150.0*f[83]+300.0*f[64]-300.0*f[63]-120.0*f[60]+120.0*f[59]-180.0*f[22]+100.0*f[4])*vcut_lR2+((-300.0*f[82])+300.0*f[81]-300.0*f[67]+300.0*f[66]-240.0*f[57]+240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l-75.0*f[84]+75.0*f[83]-240.0*f[67]+240.0*f[66]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[22]+50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(360.0*f[6]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(200.0*f[0]-360.0*f[6])*vcut_l-270.0*f[51]+150.0*f[11])+(1620.0*f[65]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[10])*vcut_lR4+(600.0*f[7]-600.0*f[8])*vcut_lR3+(300.0*f[10]-300.0*f[9])*vcut_lR2+(600.0*f[8]-600.0*f[7])*vcut_l+150.0*f[10]-150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]-1350.0*f[24]+1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]+900.0*f[24]-900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]+720.0*f[65]+300.0*f[62]+300.0*f[61]+450.0*f[24]-450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l+9.0*f[104]+18.0*f[103]-18.0*f[89]-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[40]-10.0*f[41])*vcut_lR3+(15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87])*vcut_lR2+(10.0*f[48]-10.0*f[47]+10.0*f[41]-10.0*f[40]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31])*vcut_l-15.0*f[106]+15.0*f[105]-12.0*f[88]+12.0*f[87]-10.0*f[48]+10.0*f[47]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[66]-30.0*f[67])*vcut_lR3+(15.0*f[84]-15.0*f[83]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]+18.0*f[22]-10.0*f[4])*vcut_lR2+(30.0*f[82]-30.0*f[81]+30.0*f[67]-30.0*f[66]+24.0*f[57]-24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l-15.0*f[84]+15.0*f[83]-30.0*f[82]+30.0*f[81]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]-24.0*f[57]+24.0*f[56]-18.0*f[22]-36.0*f[21]+10.0*f[4]+20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(36.0*f[6]-20.0*f[0])*vcut_l-54.0*f[51]+30.0*f[11]-36.0*f[6]+20.0*f[0])+(90.0*f[65]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[9]-30.0*f[10])*vcut_lR2+(60.0*f[7]-60.0*f[8])*vcut_l+30.0*f[10]-30.0*f[9]+60.0*f[8]-60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]-90.0*f[24]+90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]+90.0*f[80]+60.0*f[62]+60.0*f[61]-180.0*f[58]+90.0*f[24]-90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[90])*vcut_lR4+(180.0*f[104]-360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(270.0*f[103]+270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-180.0*f[104]-270.0*f[103]+135.0*f[90]+360.0*f[89]+100.0*f[50]+150.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+((-180.0*f[106])+180.0*f[105]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[65])*vcut_lR4+(540.0*f[111]-300.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[24]-360.0*f[23])*vcut_lR3+(270.0*f[80]+270.0*f[65]-540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2-540.0*f[111]+300.0*f[85]-270.0*f[80]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]-360.0*f[24]+360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[8]-540.0*f[7])*vcut_lR2-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+(2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[51])*vcut_lR3+(300.0*f[0]-540.0*f[6])*vcut_lR2+1080.0*f[51]-600.0*f[11]+540.0*f[6]-300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-1350.0*f[82])+1350.0*f[81]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]-1620.0*f[21]+900.0*f[3])*vcut_lR2+900.0*f[84]-900.0*f[83]+1350.0*f[82]-1350.0*f[81]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l+45.0*f[104]-144.0*f[90]-90.0*f[89]-25.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[40]-180.0*f[41])*vcut_lR5+(225.0*f[106]-225.0*f[105]+180.0*f[88]-180.0*f[87])*vcut_lR4+(100.0*f[48]-100.0*f[47]+200.0*f[41]-200.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_lR3+((-150.0*f[106])+150.0*f[105]-120.0*f[88]+120.0*f[87])*vcut_lR2+((-100.0*f[48])+100.0*f[47]-100.0*f[41]+100.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_l-75.0*f[106]+75.0*f[105]-60.0*f[88]+60.0*f[87]+80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[66]-540.0*f[67])*vcut_lR5+(225.0*f[84]-225.0*f[83]-450.0*f[64]+450.0*f[63]+180.0*f[60]-180.0*f[59]+270.0*f[22]-150.0*f[4])*vcut_lR4+(300.0*f[82]-300.0*f[81]+600.0*f[67]-600.0*f[66]+240.0*f[57]-240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+((-150.0*f[84])+150.0*f[83]+300.0*f[64]-300.0*f[63]-120.0*f[60]+120.0*f[59]-180.0*f[22]+100.0*f[4])*vcut_lR2+((-300.0*f[82])+300.0*f[81]-300.0*f[67]+300.0*f[66]-240.0*f[57]+240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l-75.0*f[84]+75.0*f[83]+240.0*f[67]-240.0*f[66]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[22]+50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(360.0*f[6]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(200.0*f[0]-360.0*f[6])*vcut_l-270.0*f[51]+150.0*f[11])+(1620.0*f[65]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[9]-450.0*f[10])*vcut_lR4+(600.0*f[7]-600.0*f[8])*vcut_lR3+(300.0*f[10]-300.0*f[9])*vcut_lR2+(600.0*f[8]-600.0*f[7])*vcut_l+150.0*f[10]-150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]-1350.0*f[24]+1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]+900.0*f[24]-900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]-720.0*f[65]+300.0*f[62]+300.0*f[61]+450.0*f[24]-450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]+30.0*f[83]+60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-60.0*f[57]+60.0*f[56]-45.0*f[29]+45.0*f[28]+90.0*f[27]-90.0*f[26]+45.0*f[22]-90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]+90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-36.0*f[92]+36.0*f[91]+45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]+30.0*f[88]-30.0*f[87]+20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+(225.0*f[78]-225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]-270.0*f[52]-75.0*f[15]+150.0*f[14]-75.0*f[10]+75.0*f[9]+150.0*f[8]-150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]-225.0*f[30]-270.0*f[25]-225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]+135.0*f[102]-135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]-216.0*f[92]+216.0*f[91]-135.0*f[90]+360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]-360.0*f[15]+540.0*f[14]-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+(3645.0*f[110]-2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+540.0*f[13]-540.0*f[12]-600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[29]+1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[27]+1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]-720.0*f[84]+720.0*f[83]+1080.0*f[82]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[29]+1080.0*f[28]+1620.0*f[27]-1620.0*f[26]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]+135.0*f[29]-135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[29]+90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]+135.0*f[109]-30.0*f[84]+30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]-120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]-72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-72.0*f[90]+45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87]+40.0*f[46]+40.0*f[41]-40.0*f[40]))+(810.0*f[78]-810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*(((-135.0*f[110])+75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+((-135.0*f[109])+30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+(135.0*f[110]+60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l+135.0*f[109]-30.0*f[84]+30.0*f[83]-60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+60.0*f[57]-60.0*f[56]-45.0*f[29]+45.0*f[28]-90.0*f[27]+90.0*f[26]+45.0*f[22]+90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+36.0*f[92]-36.0*f[91]+45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*(((-45.0*f[100])+25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+(45.0*f[100]-90.0*f[93]+20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]+30.0*f[88]-30.0*f[87]-20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+(225.0*f[78]-225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*(((-135.0*f[53])+75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+((-270.0*f[52])+150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l+135.0*f[53]+270.0*f[52]-75.0*f[15]-150.0*f[14]-75.0*f[10]+75.0*f[9]-150.0*f[8]+150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]-405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]-270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]+180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]-225.0*f[30]+270.0*f[25]-225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])+405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]+270.0*f[102]-270.0*f[101]+216.0*f[92]-216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]+135.0*f[102]-135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-216.0*f[92]+216.0*f[91]-135.0*f[90]-360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])+405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]-432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]+270.0*f[78]-270.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]+432.0*f[107]-648.0*f[86]+240.0*f[85]-216.0*f[80]+135.0*f[78]-135.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]+360.0*f[15]+540.0*f[14]+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+(3645.0*f[110]-2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])+1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+((-540.0*f[13])+540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+540.0*f[13]-540.0*f[12]+600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[29]+1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]-1620.0*f[27]+1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]+720.0*f[84]-720.0*f[83]+1080.0*f[82]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[29]-1080.0*f[28]+1620.0*f[27]-1620.0*f[26]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*(((-486.0*f[110])+270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+((-405.0*f[109])+90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]+135.0*f[29]-135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+(540.0*f[110]+120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+(270.0*f[109]-60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[29]+90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+((-270.0*f[110])-120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]+135.0*f[109]-30.0*f[84]+30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]+120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]+72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+72.0*f[90]+45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*(((-162.0*f[100])+90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+(180.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+((-90.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87]-40.0*f[46]-40.0*f[41]+40.0*f[40]))+(810.0*f[78]-810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*(((-405.0*f[53])+225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+(270.0*f[53]-150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l+135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]-1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]+810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]+405.0*f[86]-150.0*f[85]-360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[2][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[2][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[2][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[2][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[2][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[2][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_3 
  vcutSq = -0.025*(1.732050807568877*((-21.21320343559643*phiWall[17])+21.21320343559643*phi[17]-14.14213562373095*phiWall[3]+14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[16]-2.828427124746191*phi[16]-1.414213562373095*phiWall[11]+1.414213562373095*phi[11])-5.656854249492382*phiWall[14]+5.656854249492382*phi[14]+7.071067811865476*phiWall[13]-7.071067811865476*phi[13])+2.23606797749979*((-14.14213562373095*phiWall[9])+14.14213562373095*phi[9]-5.656854249492382*phiWall[8]+5.656854249492382*phi[8]+7.071067811865476*phiWall[7]-7.071067811865476*phi[7]+1.732050807568877*(8.485281374238571*phiWall[6]-8.485281374238571*phi[6])+8.485281374238571*phiWall[2]-8.485281374238571*phi[2])-14.14213562373095*phiWall[0]+14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[3][0] = 0.0; 
  fReflSurfXY[3][1] = 0.0; 
  fReflSurfXY[3][2] = 0.0; 
  fReflSurfXY[3][3] = 0.0; 
  fReflSurfXY[3][4] = 0.0; 
  fReflSurfXY[3][5] = 0.0; 
  fReflSurfXY[3][6] = 0.0; 
  fReflSurfXY[3][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[3][0] = 0.03535533905932736*(8.660254037844386*(3.0*f[56]+2.0*f[3])-3.872983346207417*(3.872983346207417*(2.0*f[36]-1.0*f[31])-4.0*f[34]+5.0*f[33])+2.23606797749979*(2.0*(5.0*f[18]+2.0*f[17])-1.0*(5.0*f[16]+2.0*(5.196152422706631*f[8]+2.0*f[2])))+10.0*f[0]); 
  fReflSurfXY[3][1] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[87]+1.732050807568877*(2.0*(5.0*f[39]+2.0*f[38])-5.0*f[37]))-90.0*f[64]+2.23606797749979*(5.196152422706631*(4.0*f[62]-1.0*(5.0*f[61]+6.0*f[24]))-18.0*f[10])+5.0*(9.0*f[59]+2.0*(5.196152422706631*f[11]+2.0*f[4]))); 
  fReflSurfXY[3][2] = 0.01178511301977579*(3.872983346207417*(20.12461179749811*f[91]+1.732050807568877*(2.0*(5.0*f[45]+2.0*f[44])-5.0*f[43]))-90.0*f[73]+2.23606797749979*(5.196152422706631*(4.0*f[71]-1.0*(5.0*f[70]+6.0*f[27]))-18.0*f[13])+5.0*(9.0*f[68]+2.0*(5.196152422706631*f[14]+2.0*f[5]))); 
  fReflSurfXY[3][3] = 0.03535533905932736*(8.660254037844386*(3.0*f[107]+2.0*f[30])-3.872983346207417*(3.872983346207417*(2.0*f[99]-1.0*f[94])-4.0*f[97]+5.0*f[96])+2.23606797749979*(2.0*(5.0*f[76]+2.0*f[75])-1.0*(5.0*f[74]+2.0*(5.196152422706631*f[55]+2.0*f[29])))+10.0*f[15]); 
  fReflSurfXY[3][4] = -0.07071067811865474*(11.61895003862225*f[67]-1.0*(3.872983346207417*(2.23606797749979*f[42]-1.732050807568877*f[41])+5.0*f[19])); 
  fReflSurfXY[3][5] = -0.07071067811865474*(11.61895003862225*f[82]-1.0*(3.872983346207417*(2.23606797749979*f[49]-1.732050807568877*f[48])+5.0*f[20])); 
  fReflSurfXY[3][6] = -0.07071067811865474*(11.61895003862225*f[102]-1.0*(3.872983346207417*(2.23606797749979*f[79]-1.732050807568877*f[78])+5.0*f[46])); 
  fReflSurfXY[3][7] = -0.07071067811865474*(11.61895003862225*f[106]-1.0*(3.872983346207417*(2.23606797749979*f[85]-1.732050807568877*f[84])+5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]-18.0*f[91]-4.0*f[50]+8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[41])*vcut_lR3+((-12.0*f[106])-12.0*f[97]+15.0*f[96]+15.0*f[87])*vcut_lR2+((-8.0*f[48])+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87]-8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[67])*vcut_lR3+((-12.0*f[84])-30.0*f[76]-12.0*f[75]+15.0*f[74]-30.0*f[64]+15.0*f[59]+18.0*f[29]+10.0*f[4])*vcut_lR2+((-24.0*f[82])+30.0*f[79]-24.0*f[71]+30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l+12.0*f[84]-24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]-24.0*f[71]+30.0*f[70]+30.0*f[64]-15.0*f[59]+30.0*f[56]-18.0*f[29]+36.0*f[27]-10.0*f[4]+20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+(36.0*f[13]+20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]-30.0*f[11]+20.0*f[0])+(90.0*f[78]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[10])*vcut_lR2+((-60.0*f[14])-60.0*f[8])*vcut_l+30.0*f[15]-60.0*f[14]+30.0*f[10]-60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]-90.0*f[30]-90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]+180.0*f[73]-90.0*f[68]-60.0*f[62]+75.0*f[61]+90.0*f[30]+90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2+135.0*f[102]-360.0*f[99]+180.0*f[94]-270.0*f[91]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+(144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-225.0*f[19])*vcut_lR4+(540.0*f[107]-240.0*f[85]-240.0*f[62]+300.0*f[61]+360.0*f[30]+360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2+540.0*f[107]-240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]-240.0*f[62]+300.0*f[61]+360.0*f[30]+360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+(540.0*f[14]+540.0*f[8])*vcut_lR2+360.0*f[15]-540.0*f[14]+360.0*f[10]-540.0*f[8])+(2025.0*f[79]+2025.0*f[67])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-600.0*f[11])*vcut_lR3+((-540.0*f[13])-300.0*f[0])*vcut_lR2-1080.0*f[55]+540.0*f[13]-600.0*f[11]+300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]-1080.0*f[29]-600.0*f[4])*vcut_lR3+(1080.0*f[82]-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]-1350.0*f[67]-1350.0*f[56]-1620.0*f[27]-900.0*f[3])*vcut_lR2+720.0*f[84]-1080.0*f[82]-675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1080.0*f[71]+1350.0*f[70]-675.0*f[67]+1800.0*f[64]-900.0*f[59]+1350.0*f[56]-1080.0*f[29]+1620.0*f[27]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l+144.0*f[102]-90.0*f[99]+45.0*f[94]-20.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[41])*vcut_lR5+((-180.0*f[106])-180.0*f[97]+225.0*f[96]+225.0*f[87])*vcut_lR4+((-80.0*f[48])+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+(120.0*f[106]+120.0*f[97]-150.0*f[96]-150.0*f[87])*vcut_lR2+(80.0*f[48]-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l+60.0*f[106]+60.0*f[97]-75.0*f[96]-75.0*f[87]-80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[67])*vcut_lR5+((-180.0*f[84])-450.0*f[76]-180.0*f[75]+225.0*f[74]-450.0*f[64]+225.0*f[59]+270.0*f[29]+150.0*f[4])*vcut_lR4+((-240.0*f[82])+600.0*f[79]-240.0*f[71]+300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+(120.0*f[84]+300.0*f[76]+120.0*f[75]-150.0*f[74]+300.0*f[64]-150.0*f[59]-180.0*f[29]-100.0*f[4])*vcut_lR2+(240.0*f[82]-300.0*f[79]+240.0*f[71]-300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l+60.0*f[84]-240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]-240.0*f[67]+150.0*f[64]-75.0*f[59]-90.0*f[29]-50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+(360.0*f[13]+200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+((-360.0*f[13])-200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+(1620.0*f[78]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[10])*vcut_lR4+((-600.0*f[14])-600.0*f[8])*vcut_lR3+(300.0*f[15]+300.0*f[10])*vcut_lR2+(600.0*f[14]+600.0*f[8])*vcut_l+150.0*f[15]+150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]-1350.0*f[30]-1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]+900.0*f[30]+900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]+720.0*f[78]-300.0*f[62]+375.0*f[61]+450.0*f[30]+450.0*f[24]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]+18.0*f[91]-4.0*f[50]-8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*(((-10.0*f[46])-10.0*f[41])*vcut_lR3+((-12.0*f[106])-12.0*f[97]+15.0*f[96]+15.0*f[87])*vcut_lR2+((-8.0*f[48])+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87]+8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*(((-30.0*f[79])-30.0*f[67])*vcut_lR3+((-12.0*f[84])-30.0*f[76]-12.0*f[75]+15.0*f[74]-30.0*f[64]+15.0*f[59]+18.0*f[29]+10.0*f[4])*vcut_lR2+((-24.0*f[82])+30.0*f[79]-24.0*f[71]+30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l+12.0*f[84]+24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]+24.0*f[71]-30.0*f[70]+30.0*f[64]-15.0*f[59]-30.0*f[56]-18.0*f[29]-36.0*f[27]-10.0*f[4]-20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+(36.0*f[13]+20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]-30.0*f[11]-20.0*f[0])+(90.0*f[78]+50.0*f[19])*vcut_lR3+1.732050807568877*(((-30.0*f[15])-30.0*f[10])*vcut_lR2+((-60.0*f[14])-60.0*f[8])*vcut_l+30.0*f[15]+60.0*f[14]+30.0*f[10]+60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]-90.0*f[30]-90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]-180.0*f[73]+90.0*f[68]-60.0*f[62]+75.0*f[61]+90.0*f[30]+90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*(((-405.0*f[102])-225.0*f[42])*vcut_lR4+((-360.0*f[99])+180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2+135.0*f[102]+360.0*f[99]-180.0*f[94]-270.0*f[91]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+(144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[97]+180.0*f[96]+180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*(((-405.0*f[78])-225.0*f[19])*vcut_lR4+(540.0*f[107]-240.0*f[85]-240.0*f[62]+300.0*f[61]+360.0*f[30]+360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2-540.0*f[107]+240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]+240.0*f[62]-300.0*f[61]-360.0*f[30]-360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+(540.0*f[14]+540.0*f[8])*vcut_lR2-360.0*f[15]-540.0*f[14]-360.0*f[10]-540.0*f[8])+(2025.0*f[79]+2025.0*f[67])*vcut_lR4+1.732050807568877*(((-1080.0*f[55])-600.0*f[11])*vcut_lR3+((-540.0*f[13])-300.0*f[0])*vcut_lR2+1080.0*f[55]+540.0*f[13]+600.0*f[11]+300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]-1080.0*f[29]-600.0*f[4])*vcut_lR3+(1080.0*f[82]-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]-1350.0*f[67]-1350.0*f[56]-1620.0*f[27]-900.0*f[3])*vcut_lR2-720.0*f[84]-1080.0*f[82]-675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]-1080.0*f[71]+1350.0*f[70]-675.0*f[67]-1800.0*f[64]+900.0*f[59]+1350.0*f[56]+1080.0*f[29]+1620.0*f[27]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l-144.0*f[102]-90.0*f[99]+45.0*f[94]-20.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*(((-180.0*f[46])-180.0*f[41])*vcut_lR5+((-180.0*f[106])-180.0*f[97]+225.0*f[96]+225.0*f[87])*vcut_lR4+((-80.0*f[48])+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+(120.0*f[106]+120.0*f[97]-150.0*f[96]-150.0*f[87])*vcut_lR2+(80.0*f[48]-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l+60.0*f[106]+60.0*f[97]-75.0*f[96]-75.0*f[87]+80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*(((-540.0*f[79])-540.0*f[67])*vcut_lR5+((-180.0*f[84])-450.0*f[76]-180.0*f[75]+225.0*f[74]-450.0*f[64]+225.0*f[59]+270.0*f[29]+150.0*f[4])*vcut_lR4+((-240.0*f[82])+600.0*f[79]-240.0*f[71]+300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+(120.0*f[84]+300.0*f[76]+120.0*f[75]-150.0*f[74]+300.0*f[64]-150.0*f[59]-180.0*f[29]-100.0*f[4])*vcut_lR2+(240.0*f[82]-300.0*f[79]+240.0*f[71]-300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l+60.0*f[84]+240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]+240.0*f[67]+150.0*f[64]-75.0*f[59]-90.0*f[29]-50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+(360.0*f[13]+200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+((-360.0*f[13])-200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+(1620.0*f[78]+900.0*f[19])*vcut_lR5+1.732050807568877*(((-450.0*f[15])-450.0*f[10])*vcut_lR4+((-600.0*f[14])-600.0*f[8])*vcut_lR3+(300.0*f[15]+300.0*f[10])*vcut_lR2+(600.0*f[14]+600.0*f[8])*vcut_l+150.0*f[15]+150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]-1350.0*f[30]-1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]+900.0*f[30]+900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]-720.0*f[78]-300.0*f[62]+375.0*f[61]+450.0*f[30]+450.0*f[24]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[67]*vcut_lR3)+(15.0*f[84]-30.0*f[64]+15.0*f[59]+10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[67]+30.0*f[56]+20.0*f[3])*vcut_l-15.0*f[84]+30.0*f[82]+30.0*f[64]-15.0*f[59]+30.0*f[56]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((-10.0*f[41]*vcut_lR3)+(15.0*f[106]+15.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]+10.0*f[48]-20.0*f[36]+10.0*f[31]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[10]*vcut_lR2)-60.0*f[8]*vcut_l+30.0*f[10]-60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]-90.0*f[24])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]-50.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[2]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+(20.0*f[50]-40.0*f[39]-16.0*f[38]+20.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]-24.0*f[34]+30.0*f[33])*vcut_lR2+20.0*f[50]-30.0*f[49]+15.0*f[42]-40.0*f[39]-16.0*f[38]+20.0*f[37]+24.0*f[34]-30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+((-36.0*f[106])-36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2-36.0*f[106]-36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(60.0*f[85]-48.0*f[62]+60.0*f[61]+72.0*f[24])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]+36.0*f[2])*vcut_lR2+60.0*f[85]-48.0*f[62]+60.0*f[61]+72.0*f[24]-30.0*f[20]+15.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3+108.0*f[8]*vcut_lR2+72.0*f[10]-108.0*f[8])+405.0*f[67]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]-120.0*f[4])*vcut_lR3+((-270.0*f[82])-270.0*f[67]-270.0*f[56]-180.0*f[3])*vcut_lR2-180.0*f[84]+270.0*f[82]-135.0*f[67]+360.0*f[64]-180.0*f[59]+270.0*f[56]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[67]*vcut_lR5)+(45.0*f[84]-90.0*f[64]+45.0*f[59]+30.0*f[4])*vcut_lR4+(60.0*f[82]+120.0*f[67]+60.0*f[56]+40.0*f[3])*vcut_lR3+((-30.0*f[84])+60.0*f[64]-30.0*f[59]-20.0*f[4])*vcut_lR2+((-60.0*f[82])-60.0*f[67]-60.0*f[56]-40.0*f[3])*vcut_l-15.0*f[84]-48.0*f[67]+30.0*f[64]-15.0*f[59]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]+12.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]-8.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]+16.0*f[42]-10.0*f[39]-4.0*f[38]+5.0*f[37])+1.732050807568877*((-36.0*f[41]*vcut_lR5)+(45.0*f[106]+45.0*f[87])*vcut_lR4+(20.0*f[48]+40.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_lR3+((-30.0*f[106])-30.0*f[87])*vcut_lR2+((-20.0*f[48])-20.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]-16.0*f[41]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[10]*vcut_lR4)-120.0*f[8]*vcut_lR3+60.0*f[10]*vcut_lR2+120.0*f[8]*vcut_l+30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]-270.0*f[24])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]-120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]+180.0*f[24])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]+120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[67]*vcut_lR3)+(15.0*f[84]-30.0*f[64]+15.0*f[59]+10.0*f[4])*vcut_lR2+(30.0*f[82]+30.0*f[67]+30.0*f[56]+20.0*f[3])*vcut_l-15.0*f[84]-30.0*f[82]+30.0*f[64]-15.0*f[59]-30.0*f[56]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((-10.0*f[41]*vcut_lR3)+(15.0*f[106]+15.0*f[87])*vcut_lR2+(10.0*f[48]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]-10.0*f[48]+20.0*f[36]-10.0*f[31]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[10]*vcut_lR2)-60.0*f[8]*vcut_l+30.0*f[10]+60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]-90.0*f[24])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]+50.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[2]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*((-45.0*f[42]*vcut_lR4)+(20.0*f[50]-40.0*f[39]-16.0*f[38]+20.0*f[37])*vcut_lR3+(30.0*f[49]+30.0*f[42]-24.0*f[34]+30.0*f[33])*vcut_lR2-20.0*f[50]-30.0*f[49]+15.0*f[42]+40.0*f[39]+16.0*f[38]-20.0*f[37]+24.0*f[34]-30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+((-36.0*f[106])-36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2+36.0*f[106]+36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+(60.0*f[85]-48.0*f[62]+60.0*f[61]+72.0*f[24])*vcut_lR3+(30.0*f[20]+30.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]+36.0*f[2])*vcut_lR2-60.0*f[85]+48.0*f[62]-60.0*f[61]-72.0*f[24]-30.0*f[20]+15.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3+108.0*f[8]*vcut_lR2-72.0*f[10]-108.0*f[8])+405.0*f[67]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]-120.0*f[4])*vcut_lR3+((-270.0*f[82])-270.0*f[67]-270.0*f[56]-180.0*f[3])*vcut_lR2+180.0*f[84]+270.0*f[82]-135.0*f[67]-360.0*f[64]+180.0*f[59]+270.0*f[56]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[67]*vcut_lR5)+(45.0*f[84]-90.0*f[64]+45.0*f[59]+30.0*f[4])*vcut_lR4+(60.0*f[82]+120.0*f[67]+60.0*f[56]+40.0*f[3])*vcut_lR3+((-30.0*f[84])+60.0*f[64]-30.0*f[59]-20.0*f[4])*vcut_lR2+((-60.0*f[82])-60.0*f[67]-60.0*f[56]-40.0*f[3])*vcut_l-15.0*f[84]+48.0*f[67]+30.0*f[64]-15.0*f[59]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]+12.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]-8.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]-16.0*f[42]-10.0*f[39]-4.0*f[38]+5.0*f[37])+1.732050807568877*((-36.0*f[41]*vcut_lR5)+(45.0*f[106]+45.0*f[87])*vcut_lR4+(20.0*f[48]+40.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_lR3+((-30.0*f[106])-30.0*f[87])*vcut_lR2+((-20.0*f[48])-20.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_l-15.0*f[106]-15.0*f[87]+16.0*f[41]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[10]*vcut_lR4)-120.0*f[8]*vcut_lR3+60.0*f[10]*vcut_lR2+120.0*f[8]*vcut_l+30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]-270.0*f[24])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]-120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]+180.0*f[24])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]+120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[24]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]-18.0*f[91]+4.0*f[50]-8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[46])*vcut_lR3+(12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87])*vcut_lR2+(8.0*f[48]+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-12.0*f[106]+12.0*f[97]-15.0*f[96]+15.0*f[87]+8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[79])*vcut_lR3+(12.0*f[84]-30.0*f[76]-12.0*f[75]+15.0*f[74]+30.0*f[64]-15.0*f[59]+18.0*f[29]-10.0*f[4])*vcut_lR2+(24.0*f[82]+30.0*f[79]-24.0*f[71]+30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l-12.0*f[84]+24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]-24.0*f[71]+30.0*f[70]-30.0*f[64]+15.0*f[59]-30.0*f[56]-18.0*f[29]+36.0*f[27]+10.0*f[4]-20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(36.0*f[13]-20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]+30.0*f[11]-20.0*f[0])+(90.0*f[78]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[15])*vcut_lR2+(60.0*f[8]-60.0*f[14])*vcut_l+30.0*f[15]-60.0*f[14]-30.0*f[10]+60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[30]+90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]+180.0*f[73]-90.0*f[68]+60.0*f[62]-75.0*f[61]+90.0*f[30]-90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[102])*vcut_lR4+((-360.0*f[99])+180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2+135.0*f[102]-360.0*f[99]+180.0*f[94]-270.0*f[91]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+((-144.0*f[106])+144.0*f[97]-180.0*f[96]+180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[97]-180.0*f[96]+180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[78])*vcut_lR4+(540.0*f[107]+240.0*f[85]+240.0*f[62]-300.0*f[61]+360.0*f[30]-360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2+540.0*f[107]+240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]+240.0*f[62]-300.0*f[61]+360.0*f[30]-360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[14]-540.0*f[8])*vcut_lR2+360.0*f[15]-540.0*f[14]-360.0*f[10]+540.0*f[8])+(2025.0*f[79]-2025.0*f[67])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[55])*vcut_lR3+(300.0*f[0]-540.0*f[13])*vcut_lR2-1080.0*f[55]+540.0*f[13]+600.0*f[11]-300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]-1080.0*f[29]+600.0*f[4])*vcut_lR3+((-1080.0*f[82])-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]+1350.0*f[67]+1350.0*f[56]-1620.0*f[27]+900.0*f[3])*vcut_lR2-720.0*f[84]+1080.0*f[82]-675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1080.0*f[71]+1350.0*f[70]+675.0*f[67]-1800.0*f[64]+900.0*f[59]-1350.0*f[56]-1080.0*f[29]+1620.0*f[27]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l+144.0*f[102]-90.0*f[99]+45.0*f[94]+20.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[46])*vcut_lR5+(180.0*f[106]-180.0*f[97]+225.0*f[96]-225.0*f[87])*vcut_lR4+(80.0*f[48]+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+((-120.0*f[106])+120.0*f[97]-150.0*f[96]+150.0*f[87])*vcut_lR2+((-80.0*f[48])-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l-60.0*f[106]+60.0*f[97]-75.0*f[96]+75.0*f[87]-80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[79])*vcut_lR5+(180.0*f[84]-450.0*f[76]-180.0*f[75]+225.0*f[74]+450.0*f[64]-225.0*f[59]+270.0*f[29]-150.0*f[4])*vcut_lR4+(240.0*f[82]+600.0*f[79]-240.0*f[71]+300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+((-120.0*f[84])+300.0*f[76]+120.0*f[75]-150.0*f[74]-300.0*f[64]+150.0*f[59]-180.0*f[29]+100.0*f[4])*vcut_lR2+((-240.0*f[82])-300.0*f[79]+240.0*f[71]-300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l-60.0*f[84]-240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]+240.0*f[67]-150.0*f[64]+75.0*f[59]-90.0*f[29]+50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(360.0*f[13]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(200.0*f[0]-360.0*f[13])*vcut_l-270.0*f[55]+150.0*f[11])+(1620.0*f[78]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[15])*vcut_lR4+(600.0*f[8]-600.0*f[14])*vcut_lR3+(300.0*f[15]-300.0*f[10])*vcut_lR2+(600.0*f[14]-600.0*f[8])*vcut_l+150.0*f[15]-150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]-1350.0*f[30]+1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]+900.0*f[30]-900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]+720.0*f[78]+300.0*f[62]-375.0*f[61]+450.0*f[30]-450.0*f[24]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]+18.0*f[91]+4.0*f[50]+8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[46])*vcut_lR3+(12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87])*vcut_lR2+(8.0*f[48]+10.0*f[46]-20.0*f[45]-8.0*f[44]+10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-12.0*f[106]+12.0*f[97]-15.0*f[96]+15.0*f[87]-8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[79])*vcut_lR3+(12.0*f[84]-30.0*f[76]-12.0*f[75]+15.0*f[74]+30.0*f[64]-15.0*f[59]+18.0*f[29]-10.0*f[4])*vcut_lR2+(24.0*f[82]+30.0*f[79]-24.0*f[71]+30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l-12.0*f[84]-24.0*f[82]+30.0*f[76]+12.0*f[75]-15.0*f[74]+24.0*f[71]-30.0*f[70]-30.0*f[64]+15.0*f[59]+30.0*f[56]-18.0*f[29]-36.0*f[27]+10.0*f[4]+20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(36.0*f[13]-20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]+30.0*f[11]+20.0*f[0])+(90.0*f[78]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[15])*vcut_lR2+(60.0*f[8]-60.0*f[14])*vcut_l+30.0*f[15]+60.0*f[14]-30.0*f[10]-60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[30]+90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]-180.0*f[73]+90.0*f[68]+60.0*f[62]-75.0*f[61]+90.0*f[30]-90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((225.0*f[42]-405.0*f[102])*vcut_lR4+((-360.0*f[99])+180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+(270.0*f[102]+270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2+135.0*f[102]+360.0*f[99]-180.0*f[94]-270.0*f[91]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+((-144.0*f[106])+144.0*f[97]-180.0*f[96]+180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((225.0*f[19]-405.0*f[78])*vcut_lR4+(540.0*f[107]+240.0*f[85]+240.0*f[62]-300.0*f[61]+360.0*f[30]-360.0*f[24])*vcut_lR3+(270.0*f[78]-540.0*f[73]+270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2-540.0*f[107]-240.0*f[85]+135.0*f[78]+540.0*f[73]-270.0*f[68]-240.0*f[62]+300.0*f[61]-360.0*f[30]+360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[14]-540.0*f[8])*vcut_lR2-360.0*f[15]-540.0*f[14]+360.0*f[10]+540.0*f[8])+(2025.0*f[79]-2025.0*f[67])*vcut_lR4+1.732050807568877*((600.0*f[11]-1080.0*f[55])*vcut_lR3+(300.0*f[0]-540.0*f[13])*vcut_lR2+1080.0*f[55]+540.0*f[13]-600.0*f[11]-300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]-1080.0*f[29]+600.0*f[4])*vcut_lR3+((-1080.0*f[82])-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]+1350.0*f[67]+1350.0*f[56]-1620.0*f[27]+900.0*f[3])*vcut_lR2+720.0*f[84]+1080.0*f[82]-675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]-1080.0*f[71]+1350.0*f[70]+675.0*f[67]+1800.0*f[64]-900.0*f[59]-1350.0*f[56]+1080.0*f[29]+1620.0*f[27]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l-144.0*f[102]-90.0*f[99]+45.0*f[94]+20.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[46])*vcut_lR5+(180.0*f[106]-180.0*f[97]+225.0*f[96]-225.0*f[87])*vcut_lR4+(80.0*f[48]+200.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+((-120.0*f[106])+120.0*f[97]-150.0*f[96]+150.0*f[87])*vcut_lR2+((-80.0*f[48])-100.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l-60.0*f[106]+60.0*f[97]-75.0*f[96]+75.0*f[87]+80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[79])*vcut_lR5+(180.0*f[84]-450.0*f[76]-180.0*f[75]+225.0*f[74]+450.0*f[64]-225.0*f[59]+270.0*f[29]-150.0*f[4])*vcut_lR4+(240.0*f[82]+600.0*f[79]-240.0*f[71]+300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+((-120.0*f[84])+300.0*f[76]+120.0*f[75]-150.0*f[74]-300.0*f[64]+150.0*f[59]-180.0*f[29]+100.0*f[4])*vcut_lR2+((-240.0*f[82])-300.0*f[79]+240.0*f[71]-300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l-60.0*f[84]+240.0*f[79]+150.0*f[76]+60.0*f[75]-75.0*f[74]-240.0*f[67]-150.0*f[64]+75.0*f[59]-90.0*f[29]+50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(360.0*f[13]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(200.0*f[0]-360.0*f[13])*vcut_l-270.0*f[55]+150.0*f[11])+(1620.0*f[78]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[15])*vcut_lR4+(600.0*f[8]-600.0*f[14])*vcut_lR3+(300.0*f[15]-300.0*f[10])*vcut_lR2+(600.0*f[14]-600.0*f[8])*vcut_l+150.0*f[15]-150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]-1350.0*f[30]+1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]+900.0*f[30]-900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]-720.0*f[78]+300.0*f[62]-375.0*f[61]+450.0*f[30]-450.0*f[24]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[3][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[3][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[3][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[3][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[3][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[3][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_4 
  vcutSq = -0.125*(3.872983346207417*(1.414213562373095*phiWall[14]-1.414213562373095*phi[14]+1.414213562373095*phiWall[13]-1.414213562373095*phi[13])+2.23606797749979*((-2.828427124746191*phiWall[9])+2.828427124746191*phi[9]+1.414213562373095*phiWall[8]-1.414213562373095*phi[8]+1.414213562373095*phiWall[7]-1.414213562373095*phi[7])+1.732050807568877*(2.828427124746191*phi[3]-2.828427124746191*phiWall[3])-2.828427124746191*phiWall[0]+2.828427124746191*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[4][0] = 0.0; 
  fReflSurfXY[4][1] = 0.0; 
  fReflSurfXY[4][2] = 0.0; 
  fReflSurfXY[4][3] = 0.0; 
  fReflSurfXY[4][4] = 0.0; 
  fReflSurfXY[4][5] = 0.0; 
  fReflSurfXY[4][6] = 0.0; 
  fReflSurfXY[4][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[4][0] = -0.1767766952966368*(3.872983346207417*(f[34]+f[33])-1.0*(2.23606797749979*(2.0*f[18]-1.0*(f[17]+f[16]))+2.0*(1.732050807568877*f[3]+f[0]))); 
  fReflSurfXY[4][1] = -0.05892556509887893*(11.61895003862225*(f[62]+f[61])-1.0*(6.708203932499369*(2.0*f[39]-1.0*(f[38]+f[37]))+2.0*(5.196152422706631*f[11]+2.0*f[4]))); 
  fReflSurfXY[4][2] = -0.05892556509887893*(11.61895003862225*(f[71]+f[70])-1.0*(6.708203932499369*(2.0*f[45]-1.0*(f[44]+f[43]))+2.0*(5.196152422706631*f[14]+2.0*f[5]))); 
  fReflSurfXY[4][3] = -0.1767766952966368*(3.872983346207417*(f[97]+f[96])-1.0*(2.23606797749979*(2.0*f[76]-1.0*(f[75]+f[74]))+2.0*(1.732050807568877*f[30]+f[15]))); 
  fReflSurfXY[4][4] = 0.07071067811865474*(8.660254037844387*f[42]+5.0*f[19]); 
  fReflSurfXY[4][5] = 0.07071067811865474*(8.660254037844387*f[49]+5.0*f[20]); 
  fReflSurfXY[4][6] = 0.07071067811865474*(8.660254037844387*f[79]+5.0*f[46]); 
  fReflSurfXY[4][7] = 0.07071067811865474*(8.660254037844387*f[85]+5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[79]*vcut_lR3)+((-30.0*f[76])+15.0*f[75]+15.0*f[74]+10.0*f[4])*vcut_lR2+(30.0*f[79]+30.0*f[71]+30.0*f[70]+20.0*f[3])*vcut_l+30.0*f[76]-15.0*f[75]-15.0*f[74]+30.0*f[71]+30.0*f[70]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(1.732050807568877*((-10.0*f[46]*vcut_lR3)+(15.0*f[97]+15.0*f[96])*vcut_lR2+(10.0*f[46]-20.0*f[45]+10.0*f[44]+10.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]-20.0*f[45]+10.0*f[44]+10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+(4.0*f[50]+10.0*f[39]-5.0*f[38]-5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]+5.0*f[37]-10.0*f[34]-10.0*f[33]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[15]*vcut_lR2)-60.0*f[14]*vcut_l+30.0*f[15]-60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]-90.0*f[30])*vcut_lR2+(40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]-50.0*f[16]-60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]+40.0*f[20]+100.0*f[18]-50.0*f[17]-50.0*f[16]-60.0*f[5]); 
  fReflSurfXYMu[0][1] = -0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+((-36.0*f[97])-36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2-36.0*f[97]-36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-16.0*f[50])-40.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR3+((-24.0*f[49])+30.0*f[42]+30.0*f[34]+30.0*f[33])*vcut_lR2-16.0*f[50]+24.0*f[49]+15.0*f[42]-40.0*f[39]+20.0*f[38]+20.0*f[37]-30.0*f[34]-30.0*f[33]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-48.0*f[85])+60.0*f[62]+60.0*f[61]+72.0*f[30])*vcut_lR3+((-24.0*f[20])+30.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]+36.0*f[5])*vcut_lR2-48.0*f[85]+60.0*f[62]+60.0*f[61]+72.0*f[30]+24.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3+108.0*f[14]*vcut_lR2+72.0*f[15]-108.0*f[14])+405.0*f[79]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2-120.0*f[11]+60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]-120.0*f[4])*vcut_lR3+((-270.0*f[79])-270.0*f[71]-270.0*f[70]-180.0*f[3])*vcut_lR2-135.0*f[79]+360.0*f[76]-180.0*f[75]-180.0*f[74]+270.0*f[71]+270.0*f[70]-120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[0][2] = 0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[79]*vcut_lR5)+((-90.0*f[76])+45.0*f[75]+45.0*f[74]+30.0*f[4])*vcut_lR4+(120.0*f[79]+60.0*f[71]+60.0*f[70]+40.0*f[3])*vcut_lR3+(60.0*f[76]-30.0*f[75]-30.0*f[74]-20.0*f[4])*vcut_lR2+((-60.0*f[79])-60.0*f[71]-60.0*f[70]-40.0*f[3])*vcut_l-48.0*f[79]+30.0*f[76]-15.0*f[75]-15.0*f[74]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*((-36.0*f[46]*vcut_lR5)+(45.0*f[97]+45.0*f[96])*vcut_lR4+(40.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_lR3+((-30.0*f[97])-30.0*f[96])*vcut_lR2+((-20.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]-16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+(12.0*f[50]+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-8.0*f[50])-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-4.0*f[50]+16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[15]*vcut_lR4)-120.0*f[14]*vcut_lR3+60.0*f[15]*vcut_lR2+120.0*f[14]*vcut_l+30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]-270.0*f[30])*vcut_lR4+(80.0*f[20]-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]-120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]+180.0*f[30])*vcut_lR2+((-80.0*f[20])+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]+120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*((-30.0*f[79]*vcut_lR3)+((-30.0*f[76])+15.0*f[75]+15.0*f[74]+10.0*f[4])*vcut_lR2+(30.0*f[79]+30.0*f[71]+30.0*f[70]+20.0*f[3])*vcut_l+30.0*f[76]-15.0*f[75]-15.0*f[74]-30.0*f[71]-30.0*f[70]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(1.732050807568877*((-10.0*f[46]*vcut_lR3)+(15.0*f[97]+15.0*f[96])*vcut_lR2+(10.0*f[46]-20.0*f[45]+10.0*f[44]+10.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]+20.0*f[45]-10.0*f[44]-10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+(4.0*f[50]+10.0*f[39]-5.0*f[38]-5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]+5.0*f[37]+10.0*f[34]+10.0*f[33]))+50.0*f[19]*vcut_lR3+1.732050807568877*((-30.0*f[15]*vcut_lR2)-60.0*f[14]*vcut_l+30.0*f[15]+60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]-90.0*f[30])*vcut_lR2+(40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]-50.0*f[16]-60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]-40.0*f[20]-100.0*f[18]+50.0*f[17]+50.0*f[16]+60.0*f[5]); 
  fReflSurfXYMu[0][1] = 0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+((-36.0*f[97])-36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2+36.0*f[97]+36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*((-45.0*f[42]*vcut_lR4)+((-16.0*f[50])-40.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR3+((-24.0*f[49])+30.0*f[42]+30.0*f[34]+30.0*f[33])*vcut_lR2+16.0*f[50]+24.0*f[49]+15.0*f[42]+40.0*f[39]-20.0*f[38]-20.0*f[37]-30.0*f[34]-30.0*f[33]))+2.23606797749979*(1.732050807568877*((-45.0*f[19]*vcut_lR4)+((-48.0*f[85])+60.0*f[62]+60.0*f[61]+72.0*f[30])*vcut_lR3+((-24.0*f[20])+30.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]+36.0*f[5])*vcut_lR2+48.0*f[85]-60.0*f[62]-60.0*f[61]-72.0*f[30]+24.0*f[20]+15.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3+108.0*f[14]*vcut_lR2-72.0*f[15]-108.0*f[14])+405.0*f[79]*vcut_lR4+1.732050807568877*((-120.0*f[11]*vcut_lR3)-60.0*f[0]*vcut_lR2+120.0*f[11]+60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]-120.0*f[4])*vcut_lR3+((-270.0*f[79])-270.0*f[71]-270.0*f[70]-180.0*f[3])*vcut_lR2-135.0*f[79]-360.0*f[76]+180.0*f[75]+180.0*f[74]+270.0*f[71]+270.0*f[70]+120.0*f[4]+180.0*f[3]); 
  fReflSurfXYMu[0][2] = -0.0015625*(2.23606797749979*(1.732050807568877*((-108.0*f[79]*vcut_lR5)+((-90.0*f[76])+45.0*f[75]+45.0*f[74]+30.0*f[4])*vcut_lR4+(120.0*f[79]+60.0*f[71]+60.0*f[70]+40.0*f[3])*vcut_lR3+(60.0*f[76]-30.0*f[75]-30.0*f[74]-20.0*f[4])*vcut_lR2+((-60.0*f[79])-60.0*f[71]-60.0*f[70]-40.0*f[3])*vcut_l+48.0*f[79]+30.0*f[76]-15.0*f[75]-15.0*f[74]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*((-36.0*f[46]*vcut_lR5)+(45.0*f[97]+45.0*f[96])*vcut_lR4+(40.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_lR3+((-30.0*f[97])-30.0*f[96])*vcut_lR2+((-20.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_l-15.0*f[97]-15.0*f[96]+16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+(12.0*f[50]+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-8.0*f[50])-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-4.0*f[50]-16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37]))+180.0*f[19]*vcut_lR5+1.732050807568877*((-90.0*f[15]*vcut_lR4)-120.0*f[14]*vcut_lR3+60.0*f[15]*vcut_lR2+120.0*f[14]*vcut_l+30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]-270.0*f[30])*vcut_lR4+(80.0*f[20]-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]-120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]+180.0*f[30])*vcut_lR2+((-80.0*f[20])+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]+120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]+90.0*f[30]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.01397542485937369*(8.660254037844387*(2.0*f[42]*vcut_lR3+((-1.0*f[50])+2.0*f[39]-1.0*f[38]-1.0*f[37])*vcut_lR2+((-2.0*f[49])-2.0*f[42]-2.0*f[34]-2.0*f[33])*vcut_l+f[50]-2.0*f[49]-2.0*f[39]+f[38]+f[37]-2.0*f[34]-2.0*f[33])+10.0*f[19]*vcut_lR3+2.23606797749979*(1.732050807568877*(2.0*f[4]*vcut_lR2+4.0*f[3]*vcut_l-2.0*f[4]+4.0*f[3])+6.0*f[11]*vcut_lR2+4.0*f[0]*vcut_l-6.0*f[11]+4.0*f[0])+((-15.0*f[85])-15.0*f[62]-15.0*f[61])*vcut_lR2+((-10.0*f[20])-10.0*f[19]+20.0*f[18]-10.0*f[17]-10.0*f[16])*vcut_l+15.0*f[85]+15.0*f[62]+15.0*f[61]-10.0*f[20]+20.0*f[18]-10.0*f[17]-10.0*f[16]); 
  fReflSurfXYMu[1][1] = 0.005208333333333333*(6.708203932499369*(9.0*f[42]*vcut_lR4+((-4.0*f[50])+8.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR3+((-6.0*f[49])-6.0*f[42]-6.0*f[34]-6.0*f[33])*vcut_lR2-4.0*f[50]+6.0*f[49]-3.0*f[42]+8.0*f[39]-4.0*f[38]-4.0*f[37]+6.0*f[34]+6.0*f[33])+3.872983346207417*(9.0*f[19]*vcut_lR4+((-12.0*f[85])-12.0*f[62]-12.0*f[61])*vcut_lR3+((-6.0*f[20])-6.0*f[19]+12.0*f[18]-6.0*f[17]-6.0*f[16])*vcut_lR2-12.0*f[85]-12.0*f[62]-12.0*f[61]+6.0*f[20]-3.0*f[19]-12.0*f[18]+6.0*f[17]+6.0*f[16])+1.732050807568877*(24.0*f[11]*vcut_lR3+12.0*f[0]*vcut_lR2+24.0*f[11]-12.0*f[0])+24.0*f[4]*vcut_lR3+36.0*f[3]*vcut_lR2+24.0*f[4]-36.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(8.660254037844387*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]+16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37])+180.0*f[19]*vcut_lR5+2.23606797749979*(1.732050807568877*(30.0*f[4]*vcut_lR4+40.0*f[3]*vcut_lR3-20.0*f[4]*vcut_lR2-40.0*f[3]*vcut_l-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+((-225.0*f[85])-225.0*f[62]-225.0*f[61])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16])*vcut_lR3+(150.0*f[85]+150.0*f[62]+150.0*f[61])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16])*vcut_l+75.0*f[85]+75.0*f[62]+75.0*f[61]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.01397542485937369*(8.660254037844387*(2.0*f[42]*vcut_lR3+((-1.0*f[50])+2.0*f[39]-1.0*f[38]-1.0*f[37])*vcut_lR2+((-2.0*f[49])-2.0*f[42]-2.0*f[34]-2.0*f[33])*vcut_l+f[50]+2.0*f[49]-2.0*f[39]+f[38]+f[37]+2.0*f[34]+2.0*f[33])+10.0*f[19]*vcut_lR3+2.23606797749979*(1.732050807568877*(2.0*f[4]*vcut_lR2+4.0*f[3]*vcut_l-2.0*f[4]-4.0*f[3])+6.0*f[11]*vcut_lR2+4.0*f[0]*vcut_l-6.0*f[11]-4.0*f[0])+((-15.0*f[85])-15.0*f[62]-15.0*f[61])*vcut_lR2+((-10.0*f[20])-10.0*f[19]+20.0*f[18]-10.0*f[17]-10.0*f[16])*vcut_l+15.0*f[85]+15.0*f[62]+15.0*f[61]+10.0*f[20]-20.0*f[18]+10.0*f[17]+10.0*f[16]); 
  fReflSurfXYMu[1][1] = -0.005208333333333333*(6.708203932499369*(9.0*f[42]*vcut_lR4+((-4.0*f[50])+8.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR3+((-6.0*f[49])-6.0*f[42]-6.0*f[34]-6.0*f[33])*vcut_lR2+4.0*f[50]+6.0*f[49]-3.0*f[42]-8.0*f[39]+4.0*f[38]+4.0*f[37]+6.0*f[34]+6.0*f[33])+3.872983346207417*(9.0*f[19]*vcut_lR4+((-12.0*f[85])-12.0*f[62]-12.0*f[61])*vcut_lR3+((-6.0*f[20])-6.0*f[19]+12.0*f[18]-6.0*f[17]-6.0*f[16])*vcut_lR2+12.0*f[85]+12.0*f[62]+12.0*f[61]+6.0*f[20]-3.0*f[19]-12.0*f[18]+6.0*f[17]+6.0*f[16])+1.732050807568877*(24.0*f[11]*vcut_lR3+12.0*f[0]*vcut_lR2-24.0*f[11]-12.0*f[0])+24.0*f[4]*vcut_lR3+36.0*f[3]*vcut_lR2-24.0*f[4]-36.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(8.660254037844387*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]-16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37])+180.0*f[19]*vcut_lR5+2.23606797749979*(1.732050807568877*(30.0*f[4]*vcut_lR4+40.0*f[3]*vcut_lR3-20.0*f[4]*vcut_lR2-40.0*f[3]*vcut_l-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+((-225.0*f[85])-225.0*f[62]-225.0*f[61])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16])*vcut_lR3+(150.0*f[85]+150.0*f[62]+150.0*f[61])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16])*vcut_l+75.0*f[85]+75.0*f[62]+75.0*f[61]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[79]*vcut_lR3+(30.0*f[76]-15.0*f[75]-15.0*f[74]+10.0*f[4])*vcut_lR2+((-30.0*f[79])-30.0*f[71]-30.0*f[70]+20.0*f[3])*vcut_l-30.0*f[76]+15.0*f[75]+15.0*f[74]-30.0*f[71]-30.0*f[70]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(1.732050807568877*(10.0*f[46]*vcut_lR3+((-15.0*f[97])-15.0*f[96])*vcut_lR2+((-10.0*f[46])+20.0*f[45]-10.0*f[44]-10.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]+20.0*f[45]-10.0*f[44]-10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+(4.0*f[50]+10.0*f[39]-5.0*f[38]-5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]+5.0*f[37]-10.0*f[34]-10.0*f[33]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[15]*vcut_lR2+60.0*f[14]*vcut_l-30.0*f[15]+60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]+90.0*f[30])*vcut_lR2+(40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]-50.0*f[16]+60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]+40.0*f[20]+100.0*f[18]-50.0*f[17]-50.0*f[16]+60.0*f[5]); 
  fReflSurfXYMu[2][1] = 0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+((-36.0*f[97])-36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2-36.0*f[97]-36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*(45.0*f[42]*vcut_lR4+(16.0*f[50]+40.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR3+(24.0*f[49]-30.0*f[42]-30.0*f[34]-30.0*f[33])*vcut_lR2+16.0*f[50]-24.0*f[49]-15.0*f[42]+40.0*f[39]-20.0*f[38]-20.0*f[37]+30.0*f[34]+30.0*f[33]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(48.0*f[85]-60.0*f[62]-60.0*f[61]+72.0*f[30])*vcut_lR3+(24.0*f[20]-30.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]+36.0*f[5])*vcut_lR2+48.0*f[85]-60.0*f[62]-60.0*f[61]+72.0*f[30]-24.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3+108.0*f[14]*vcut_lR2+72.0*f[15]-108.0*f[14])+405.0*f[79]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]+120.0*f[4])*vcut_lR3+((-270.0*f[79])-270.0*f[71]-270.0*f[70]+180.0*f[3])*vcut_lR2-135.0*f[79]+360.0*f[76]-180.0*f[75]-180.0*f[74]+270.0*f[71]+270.0*f[70]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[2][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[79]*vcut_lR5+(90.0*f[76]-45.0*f[75]-45.0*f[74]+30.0*f[4])*vcut_lR4+((-120.0*f[79])-60.0*f[71]-60.0*f[70]+40.0*f[3])*vcut_lR3+((-60.0*f[76])+30.0*f[75]+30.0*f[74]-20.0*f[4])*vcut_lR2+(60.0*f[79]+60.0*f[71]+60.0*f[70]-40.0*f[3])*vcut_l+48.0*f[79]-30.0*f[76]+15.0*f[75]+15.0*f[74]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*(36.0*f[46]*vcut_lR5+((-45.0*f[97])-45.0*f[96])*vcut_lR4+((-40.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_lR3+(30.0*f[97]+30.0*f[96])*vcut_lR2+(20.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]+16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+(12.0*f[50]+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-8.0*f[50])-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-4.0*f[50]+16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[15]*vcut_lR4+120.0*f[14]*vcut_lR3-60.0*f[15]*vcut_lR2-120.0*f[14]*vcut_l-30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]+270.0*f[30])*vcut_lR4+(80.0*f[20]-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]+120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]-180.0*f[30])*vcut_lR2+((-80.0*f[20])+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]-120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[79]*vcut_lR3+(30.0*f[76]-15.0*f[75]-15.0*f[74]+10.0*f[4])*vcut_lR2+((-30.0*f[79])-30.0*f[71]-30.0*f[70]+20.0*f[3])*vcut_l-30.0*f[76]+15.0*f[75]+15.0*f[74]+30.0*f[71]+30.0*f[70]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(1.732050807568877*(10.0*f[46]*vcut_lR3+((-15.0*f[97])-15.0*f[96])*vcut_lR2+((-10.0*f[46])+20.0*f[45]-10.0*f[44]-10.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]-20.0*f[45]+10.0*f[44]+10.0*f[43])+2.23606797749979*(10.0*f[42]*vcut_lR3+(4.0*f[50]+10.0*f[39]-5.0*f[38]-5.0*f[37])*vcut_lR2+(8.0*f[49]-10.0*f[42]-10.0*f[34]-10.0*f[33])*vcut_l-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]+5.0*f[37]+10.0*f[34]+10.0*f[33]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[15]*vcut_lR2+60.0*f[14]*vcut_l-30.0*f[15]-60.0*f[14])+(60.0*f[85]-75.0*f[62]-75.0*f[61]+90.0*f[30])*vcut_lR2+(40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]-50.0*f[16]+60.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]-40.0*f[20]-100.0*f[18]+50.0*f[17]+50.0*f[16]-60.0*f[5]); 
  fReflSurfXYMu[2][1] = -0.001041666666666667*(3.872983346207417*(2.23606797749979*(27.0*f[46]*vcut_lR4+((-36.0*f[97])-36.0*f[96])*vcut_lR3+((-18.0*f[46])+36.0*f[45]-18.0*f[44]-18.0*f[43])*vcut_lR2+36.0*f[97]+36.0*f[96]-9.0*f[46]-36.0*f[45]+18.0*f[44]+18.0*f[43])+1.732050807568877*(45.0*f[42]*vcut_lR4+(16.0*f[50]+40.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR3+(24.0*f[49]-30.0*f[42]-30.0*f[34]-30.0*f[33])*vcut_lR2-16.0*f[50]-24.0*f[49]-15.0*f[42]-40.0*f[39]+20.0*f[38]+20.0*f[37]+30.0*f[34]+30.0*f[33]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+(48.0*f[85]-60.0*f[62]-60.0*f[61]+72.0*f[30])*vcut_lR3+(24.0*f[20]-30.0*f[19]+60.0*f[18]-30.0*f[17]-30.0*f[16]+36.0*f[5])*vcut_lR2-48.0*f[85]+60.0*f[62]+60.0*f[61]-72.0*f[30]-24.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]+30.0*f[16]-36.0*f[5])+72.0*f[15]*vcut_lR3+108.0*f[14]*vcut_lR2-72.0*f[15]-108.0*f[14])+405.0*f[79]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+(360.0*f[76]-180.0*f[75]-180.0*f[74]+120.0*f[4])*vcut_lR3+((-270.0*f[79])-270.0*f[71]-270.0*f[70]+180.0*f[3])*vcut_lR2-135.0*f[79]-360.0*f[76]+180.0*f[75]+180.0*f[74]+270.0*f[71]+270.0*f[70]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[2][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[79]*vcut_lR5+(90.0*f[76]-45.0*f[75]-45.0*f[74]+30.0*f[4])*vcut_lR4+((-120.0*f[79])-60.0*f[71]-60.0*f[70]+40.0*f[3])*vcut_lR3+((-60.0*f[76])+30.0*f[75]+30.0*f[74]-20.0*f[4])*vcut_lR2+(60.0*f[79]+60.0*f[71]+60.0*f[70]-40.0*f[3])*vcut_l-48.0*f[79]-30.0*f[76]+15.0*f[75]+15.0*f[74]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(1.732050807568877*(36.0*f[46]*vcut_lR5+((-45.0*f[97])-45.0*f[96])*vcut_lR4+((-40.0*f[46])+40.0*f[45]-20.0*f[44]-20.0*f[43])*vcut_lR3+(30.0*f[97]+30.0*f[96])*vcut_lR2+(20.0*f[46]-40.0*f[45]+20.0*f[44]+20.0*f[43])*vcut_l+15.0*f[97]+15.0*f[96]-16.0*f[46])+2.23606797749979*(36.0*f[42]*vcut_lR5+(12.0*f[50]+30.0*f[39]-15.0*f[38]-15.0*f[37])*vcut_lR4+(16.0*f[49]-40.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_lR3+((-8.0*f[50])-20.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-16.0*f[49])+20.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-4.0*f[50]-16.0*f[42]-10.0*f[39]+5.0*f[38]+5.0*f[37]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[15]*vcut_lR4+120.0*f[14]*vcut_lR3-60.0*f[15]*vcut_lR2-120.0*f[14]*vcut_l-30.0*f[15])+(180.0*f[85]-225.0*f[62]-225.0*f[61]+270.0*f[30])*vcut_lR4+(80.0*f[20]-200.0*f[19]+200.0*f[18]-100.0*f[17]-100.0*f[16]+120.0*f[5])*vcut_lR3+((-120.0*f[85])+150.0*f[62]+150.0*f[61]-180.0*f[30])*vcut_lR2+((-80.0*f[20])+100.0*f[19]-200.0*f[18]+100.0*f[17]+100.0*f[16]-120.0*f[5])*vcut_l-60.0*f[85]+75.0*f[62]+75.0*f[61]-90.0*f[30]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[4][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[4][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[4][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[4][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[4][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[4][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_5 
  vcutSq = 0.025*(1.732050807568877*((-21.21320343559643*phiWall[17])+21.21320343559643*phi[17]+14.14213562373095*phiWall[3]-14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[16]-2.828427124746191*phi[16]-1.414213562373095*phiWall[11]+1.414213562373095*phi[11])+5.656854249492382*phiWall[14]-5.656854249492382*phi[14]-7.071067811865476*phiWall[13]+7.071067811865476*phi[13])+2.23606797749979*(14.14213562373095*phiWall[9]-14.14213562373095*phi[9]+5.656854249492382*phiWall[8]-5.656854249492382*phi[8]-7.071067811865476*phiWall[7]+7.071067811865476*phi[7]+1.732050807568877*(8.485281374238571*phiWall[6]-8.485281374238571*phi[6])+8.485281374238571*phiWall[2]-8.485281374238571*phi[2])+14.14213562373095*phiWall[0]-14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[5][0] = 0.0; 
  fReflSurfXY[5][1] = 0.0; 
  fReflSurfXY[5][2] = 0.0; 
  fReflSurfXY[5][3] = 0.0; 
  fReflSurfXY[5][4] = 0.0; 
  fReflSurfXY[5][5] = 0.0; 
  fReflSurfXY[5][6] = 0.0; 
  fReflSurfXY[5][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[5][0] = 0.03535533905932736*(8.660254037844386*(2.0*f[3]-3.0*f[56])+3.872983346207417*(3.872983346207417*(2.0*f[36]-1.0*f[31])+4.0*f[34]-5.0*f[33])+2.23606797749979*(2.0*(5.0*f[18]+2.0*f[17])-5.0*f[16]+2.0*(5.196152422706631*f[8]+2.0*f[2]))+10.0*f[0]); 
  fReflSurfXY[5][1] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[87]-1.732050807568877*(2.0*(5.0*f[39]+2.0*f[38])-5.0*f[37]))-1.0*(90.0*f[64]+2.23606797749979*(5.196152422706631*(4.0*f[62]-5.0*f[61]+6.0*f[24])+18.0*f[10]))+5.0*(9.0*f[59]-2.0*(5.196152422706631*f[11]+2.0*f[4]))); 
  fReflSurfXY[5][2] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[91]-1.732050807568877*(2.0*(5.0*f[45]+2.0*f[44])-5.0*f[43]))-1.0*(90.0*f[73]+2.23606797749979*(5.196152422706631*(4.0*f[71]-5.0*f[70]+6.0*f[27])+18.0*f[13]))+5.0*(9.0*f[68]-2.0*(5.196152422706631*f[14]+2.0*f[5]))); 
  fReflSurfXY[5][3] = 0.03535533905932736*(8.660254037844386*(2.0*f[30]-3.0*f[107])+3.872983346207417*(3.872983346207417*(2.0*f[99]-1.0*f[94])+4.0*f[97]-5.0*f[96])+2.23606797749979*(2.0*(5.0*f[76]+2.0*f[75])-5.0*f[74]+2.0*(5.196152422706631*f[55]+2.0*f[29]))+10.0*f[15]); 
  fReflSurfXY[5][4] = 0.07071067811865474*(11.61895003862225*f[67]+3.872983346207417*(2.23606797749979*f[42]+1.732050807568877*f[41])+5.0*f[19]); 
  fReflSurfXY[5][5] = 0.07071067811865474*(11.61895003862225*f[82]+3.872983346207417*(2.23606797749979*f[49]+1.732050807568877*f[48])+5.0*f[20]); 
  fReflSurfXY[5][6] = 0.07071067811865474*(11.61895003862225*f[102]+3.872983346207417*(2.23606797749979*f[79]+1.732050807568877*f[78])+5.0*f[46]); 
  fReflSurfXY[5][7] = 0.07071067811865474*(11.61895003862225*f[106]+3.872983346207417*(2.23606797749979*f[85]+1.732050807568877*f[84])+5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]-18.0*f[91]+4.0*f[50]-8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[41])*vcut_lR3+((-12.0*f[106])+12.0*f[97]-15.0*f[96]+15.0*f[87])*vcut_lR2+((-8.0*f[48])-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87]-8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[67])*vcut_lR3+((-12.0*f[84])+30.0*f[76]+12.0*f[75]-15.0*f[74]-30.0*f[64]+15.0*f[59]+18.0*f[29]-10.0*f[4])*vcut_lR2+((-24.0*f[82])-30.0*f[79]+24.0*f[71]-30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l+12.0*f[84]-24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]+24.0*f[71]-30.0*f[70]+30.0*f[64]-15.0*f[59]+30.0*f[56]-18.0*f[29]+36.0*f[27]+10.0*f[4]-20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(36.0*f[13]-20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]+30.0*f[11]-20.0*f[0])+(90.0*f[78]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[10])*vcut_lR2+(60.0*f[14]-60.0*f[8])*vcut_l-30.0*f[15]+60.0*f[14]+30.0*f[10]-60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[30]-90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]+180.0*f[73]-90.0*f[68]+60.0*f[62]-75.0*f[61]-90.0*f[30]+90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2-135.0*f[102]+360.0*f[99]-180.0*f[94]+270.0*f[91]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+((-144.0*f[106])+144.0*f[97]-180.0*f[96]+180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[97]-180.0*f[96]+180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-225.0*f[19])*vcut_lR4+((-540.0*f[107])-240.0*f[85]-240.0*f[62]+300.0*f[61]+360.0*f[30]-360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2-540.0*f[107]-240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]-240.0*f[62]+300.0*f[61]+360.0*f[30]-360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[14]-540.0*f[8])*vcut_lR2+360.0*f[15]-540.0*f[14]-360.0*f[10]+540.0*f[8])+(2025.0*f[79]-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]-600.0*f[11])*vcut_lR3+(540.0*f[13]-300.0*f[0])*vcut_lR2+1080.0*f[55]-540.0*f[13]-600.0*f[11]+300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]+1080.0*f[29]-600.0*f[4])*vcut_lR3+((-1080.0*f[82])-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]+1350.0*f[67]+1350.0*f[56]+1620.0*f[27]-900.0*f[3])*vcut_lR2-720.0*f[84]+1080.0*f[82]-675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1080.0*f[71]+1350.0*f[70]+675.0*f[67]-1800.0*f[64]+900.0*f[59]-1350.0*f[56]+1080.0*f[29]-1620.0*f[27]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l+144.0*f[102]-90.0*f[99]+45.0*f[94]+20.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[41])*vcut_lR5+((-180.0*f[106])+180.0*f[97]-225.0*f[96]+225.0*f[87])*vcut_lR4+((-80.0*f[48])-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+(120.0*f[106]-120.0*f[97]+150.0*f[96]-150.0*f[87])*vcut_lR2+(80.0*f[48]+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l+60.0*f[106]-60.0*f[97]+75.0*f[96]-75.0*f[87]+80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[67])*vcut_lR5+((-180.0*f[84])+450.0*f[76]+180.0*f[75]-225.0*f[74]-450.0*f[64]+225.0*f[59]+270.0*f[29]-150.0*f[4])*vcut_lR4+((-240.0*f[82])-600.0*f[79]+240.0*f[71]-300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+(120.0*f[84]-300.0*f[76]-120.0*f[75]+150.0*f[74]+300.0*f[64]-150.0*f[59]-180.0*f[29]+100.0*f[4])*vcut_lR2+(240.0*f[82]+300.0*f[79]-240.0*f[71]+300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l+60.0*f[84]+240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]-240.0*f[67]+150.0*f[64]-75.0*f[59]-90.0*f[29]+50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(360.0*f[13]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(200.0*f[0]-360.0*f[13])*vcut_l-270.0*f[55]+150.0*f[11])+(1620.0*f[78]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[10])*vcut_lR4+(600.0*f[14]-600.0*f[8])*vcut_lR3+(300.0*f[10]-300.0*f[15])*vcut_lR2+(600.0*f[8]-600.0*f[14])*vcut_l-150.0*f[15]+150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]+1350.0*f[30]-1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]-900.0*f[30]+900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]+720.0*f[78]+300.0*f[62]-375.0*f[61]-450.0*f[30]+450.0*f[24]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]-10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]-4.0*f[50]-10.0*f[39]-4.0*f[38]+5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]-8.0*f[49]+10.0*f[42]-8.0*f[34]+10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]+18.0*f[91]+4.0*f[50]+8.0*f[49]+10.0*f[39]+4.0*f[38]-5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[41])*vcut_lR3+((-12.0*f[106])+12.0*f[97]-15.0*f[96]+15.0*f[87])*vcut_lR2+((-8.0*f[48])-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]+10.0*f[41]-20.0*f[36]+10.0*f[31])*vcut_l+12.0*f[106]-12.0*f[97]+15.0*f[96]-15.0*f[87]+8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[67])*vcut_lR3+((-12.0*f[84])+30.0*f[76]+12.0*f[75]-15.0*f[74]-30.0*f[64]+15.0*f[59]+18.0*f[29]-10.0*f[4])*vcut_lR2+((-24.0*f[82])-30.0*f[79]+24.0*f[71]-30.0*f[70]+30.0*f[67]+30.0*f[56]+36.0*f[27]-20.0*f[3])*vcut_l+12.0*f[84]+24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]-24.0*f[71]+30.0*f[70]+30.0*f[64]-15.0*f[59]-30.0*f[56]-18.0*f[29]-36.0*f[27]+10.0*f[4]+20.0*f[3])+(54.0*f[55]-30.0*f[11])*vcut_lR2+(36.0*f[13]-20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]+30.0*f[11]+20.0*f[0])+(90.0*f[78]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[10])*vcut_lR2+(60.0*f[14]-60.0*f[8])*vcut_l-30.0*f[15]-60.0*f[14]+30.0*f[10]+60.0*f[8])+((-135.0*f[107])-60.0*f[85]-60.0*f[62]+75.0*f[61]+90.0*f[30]-90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]-40.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]+50.0*f[16]+60.0*f[5]-60.0*f[2])*vcut_l+135.0*f[107]+60.0*f[85]-180.0*f[73]+90.0*f[68]+60.0*f[62]-75.0*f[61]-90.0*f[30]+90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]-60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]-80.0*f[50]-200.0*f[39]-80.0*f[38]+100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]-120.0*f[49]+150.0*f[42]-120.0*f[34]+150.0*f[33])*vcut_lR2-135.0*f[102]-360.0*f[99]+180.0*f[94]+270.0*f[91]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]+120.0*f[34]-150.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[41])*vcut_lR4+((-144.0*f[106])+144.0*f[97]-180.0*f[96]+180.0*f[87])*vcut_lR3+((-72.0*f[48])-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]+90.0*f[41]-180.0*f[36]+90.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[97]+180.0*f[96]-180.0*f[87]+72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]+45.0*f[41]+180.0*f[36]-90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-225.0*f[19])*vcut_lR4+((-540.0*f[107])-240.0*f[85]-240.0*f[62]+300.0*f[61]+360.0*f[30]-360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]+180.0*f[5]-180.0*f[2])*vcut_lR2+540.0*f[107]+240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]+240.0*f[62]-300.0*f[61]-360.0*f[30]+360.0*f[24]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]-180.0*f[5]+180.0*f[2])+(360.0*f[15]-360.0*f[10])*vcut_lR3+(540.0*f[14]-540.0*f[8])*vcut_lR2-360.0*f[15]-540.0*f[14]+360.0*f[10]+540.0*f[8])+(2025.0*f[79]-2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]-600.0*f[11])*vcut_lR3+(540.0*f[13]-300.0*f[0])*vcut_lR2-1080.0*f[55]-540.0*f[13]+600.0*f[11]+300.0*f[0])+((-720.0*f[84])+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1800.0*f[64]+900.0*f[59]+1080.0*f[29]-600.0*f[4])*vcut_lR3+((-1080.0*f[82])-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]+1350.0*f[67]+1350.0*f[56]+1620.0*f[27]-900.0*f[3])*vcut_lR2+720.0*f[84]+1080.0*f[82]-675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]-1080.0*f[71]+1350.0*f[70]+675.0*f[67]+1800.0*f[64]-900.0*f[59]-1350.0*f[56]-1080.0*f[29]-1620.0*f[27]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]-180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]-60.0*f[50]-150.0*f[39]-60.0*f[38]+75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]-80.0*f[49]+200.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]+40.0*f[50]+100.0*f[39]+40.0*f[38]-50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]+80.0*f[49]-100.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_l-144.0*f[102]-90.0*f[99]+45.0*f[94]+20.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]-25.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[41])*vcut_lR5+((-180.0*f[106])+180.0*f[97]-225.0*f[96]+225.0*f[87])*vcut_lR4+((-80.0*f[48])-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]+200.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_lR3+(120.0*f[106]-120.0*f[97]+150.0*f[96]-150.0*f[87])*vcut_lR2+(80.0*f[48]+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]-100.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_l+60.0*f[106]-60.0*f[97]+75.0*f[96]-75.0*f[87]-80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[67])*vcut_lR5+((-180.0*f[84])+450.0*f[76]+180.0*f[75]-225.0*f[74]-450.0*f[64]+225.0*f[59]+270.0*f[29]-150.0*f[4])*vcut_lR4+((-240.0*f[82])-600.0*f[79]+240.0*f[71]-300.0*f[70]+600.0*f[67]+300.0*f[56]+360.0*f[27]-200.0*f[3])*vcut_lR3+(120.0*f[84]-300.0*f[76]-120.0*f[75]+150.0*f[74]+300.0*f[64]-150.0*f[59]-180.0*f[29]+100.0*f[4])*vcut_lR2+(240.0*f[82]+300.0*f[79]-240.0*f[71]+300.0*f[70]-300.0*f[67]-300.0*f[56]-360.0*f[27]+200.0*f[3])*vcut_l+60.0*f[84]-240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]+240.0*f[67]+150.0*f[64]-75.0*f[59]-90.0*f[29]+50.0*f[4])+(810.0*f[55]-450.0*f[11])*vcut_lR4+(360.0*f[13]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[55])*vcut_lR2+(200.0*f[0]-360.0*f[13])*vcut_l-270.0*f[55]+150.0*f[11])+(1620.0*f[78]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[10])*vcut_lR4+(600.0*f[14]-600.0*f[8])*vcut_lR3+(300.0*f[10]-300.0*f[15])*vcut_lR2+(600.0*f[8]-600.0*f[14])*vcut_l-150.0*f[15]+150.0*f[10])+((-2025.0*f[107])-900.0*f[85]-900.0*f[62]+1125.0*f[61]+1350.0*f[30]-1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]+600.0*f[5]-600.0*f[2])*vcut_lR3+(1350.0*f[107]+600.0*f[85]+600.0*f[62]-750.0*f[61]-900.0*f[30]+900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]+400.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]-600.0*f[5]+600.0*f[2])*vcut_l+675.0*f[107]+300.0*f[85]-720.0*f[78]+300.0*f[62]-375.0*f[61]-450.0*f[30]+450.0*f[24]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[67]*vcut_lR3+((-15.0*f[84])+30.0*f[64]-15.0*f[59]+10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[67]-30.0*f[56]+20.0*f[3])*vcut_l+15.0*f[84]-30.0*f[82]-30.0*f[64]+15.0*f[59]-30.0*f[56]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*(10.0*f[41]*vcut_lR3+((-15.0*f[106])-15.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]-10.0*f[48]+20.0*f[36]-10.0*f[31]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[10]*vcut_lR2+60.0*f[8]*vcut_l-30.0*f[10]+60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]+90.0*f[24])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]-50.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[2]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+((-20.0*f[50])+40.0*f[39]+16.0*f[38]-20.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]+24.0*f[34]-30.0*f[33])*vcut_lR2-20.0*f[50]+30.0*f[49]-15.0*f[42]+40.0*f[39]+16.0*f[38]-20.0*f[37]-24.0*f[34]+30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+((-36.0*f[106])-36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2-36.0*f[106]-36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-60.0*f[85])+48.0*f[62]-60.0*f[61]+72.0*f[24])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]+36.0*f[2])*vcut_lR2-60.0*f[85]+48.0*f[62]-60.0*f[61]+72.0*f[24]+30.0*f[20]-15.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3+108.0*f[8]*vcut_lR2+72.0*f[10]-108.0*f[8])+405.0*f[67]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]+120.0*f[4])*vcut_lR3+((-270.0*f[82])-270.0*f[67]-270.0*f[56]+180.0*f[3])*vcut_lR2-180.0*f[84]+270.0*f[82]-135.0*f[67]+360.0*f[64]-180.0*f[59]+270.0*f[56]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[67]*vcut_lR5+((-45.0*f[84])+90.0*f[64]-45.0*f[59]+30.0*f[4])*vcut_lR4+((-60.0*f[82])-120.0*f[67]-60.0*f[56]+40.0*f[3])*vcut_lR3+(30.0*f[84]-60.0*f[64]+30.0*f[59]-20.0*f[4])*vcut_lR2+(60.0*f[82]+60.0*f[67]+60.0*f[56]-40.0*f[3])*vcut_l+15.0*f[84]+48.0*f[67]-30.0*f[64]+15.0*f[59]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]+12.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]-8.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]+16.0*f[42]-10.0*f[39]-4.0*f[38]+5.0*f[37])+1.732050807568877*(36.0*f[41]*vcut_lR5+((-45.0*f[106])-45.0*f[87])*vcut_lR4+((-20.0*f[48])-40.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_lR3+(30.0*f[106]+30.0*f[87])*vcut_lR2+(20.0*f[48]+20.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]+16.0*f[41]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[10]*vcut_lR4+120.0*f[8]*vcut_lR3-60.0*f[10]*vcut_lR2-120.0*f[8]*vcut_l-30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]+270.0*f[24])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]+120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]-180.0*f[24])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]-120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[67]*vcut_lR3+((-15.0*f[84])+30.0*f[64]-15.0*f[59]+10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[67]-30.0*f[56]+20.0*f[3])*vcut_l+15.0*f[84]+30.0*f[82]-30.0*f[64]+15.0*f[59]+30.0*f[56]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*(10.0*f[41]*vcut_lR3+((-15.0*f[106])-15.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]+10.0*f[48]-20.0*f[36]+10.0*f[31]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[10]*vcut_lR2+60.0*f[8]*vcut_l-30.0*f[10]-60.0*f[8])+((-75.0*f[85])+60.0*f[62]-75.0*f[61]+90.0*f[24])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]+50.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[2]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+((-20.0*f[50])+40.0*f[39]+16.0*f[38]-20.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]+24.0*f[34]-30.0*f[33])*vcut_lR2+20.0*f[50]+30.0*f[49]-15.0*f[42]-40.0*f[39]-16.0*f[38]+20.0*f[37]-24.0*f[34]+30.0*f[33])+2.23606797749979*(27.0*f[41]*vcut_lR4+((-36.0*f[106])-36.0*f[87])*vcut_lR3+((-18.0*f[48])-18.0*f[41]+36.0*f[36]-18.0*f[31])*vcut_lR2+36.0*f[106]+36.0*f[87]+18.0*f[48]-9.0*f[41]-36.0*f[36]+18.0*f[31]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-60.0*f[85])+48.0*f[62]-60.0*f[61]+72.0*f[24])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]+24.0*f[17]-30.0*f[16]+36.0*f[2])*vcut_lR2+60.0*f[85]-48.0*f[62]+60.0*f[61]-72.0*f[24]+30.0*f[20]-15.0*f[19]-60.0*f[18]-24.0*f[17]+30.0*f[16]-36.0*f[2])+72.0*f[10]*vcut_lR3+108.0*f[8]*vcut_lR2-72.0*f[10]-108.0*f[8])+405.0*f[67]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+((-180.0*f[84])+360.0*f[64]-180.0*f[59]+120.0*f[4])*vcut_lR3+((-270.0*f[82])-270.0*f[67]-270.0*f[56]+180.0*f[3])*vcut_lR2+180.0*f[84]+270.0*f[82]-135.0*f[67]-360.0*f[64]+180.0*f[59]+270.0*f[56]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[67]*vcut_lR5+((-45.0*f[84])+90.0*f[64]-45.0*f[59]+30.0*f[4])*vcut_lR4+((-60.0*f[82])-120.0*f[67]-60.0*f[56]+40.0*f[3])*vcut_lR3+(30.0*f[84]-60.0*f[64]+30.0*f[59]-20.0*f[4])*vcut_lR2+(60.0*f[82]+60.0*f[67]+60.0*f[56]-40.0*f[3])*vcut_l+15.0*f[84]-48.0*f[67]-30.0*f[64]+15.0*f[59]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]+12.0*f[38]-15.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]+16.0*f[34]-20.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]-8.0*f[38]+10.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]-16.0*f[34]+20.0*f[33])*vcut_l+5.0*f[50]-16.0*f[42]-10.0*f[39]-4.0*f[38]+5.0*f[37])+1.732050807568877*(36.0*f[41]*vcut_lR5+((-45.0*f[106])-45.0*f[87])*vcut_lR4+((-20.0*f[48])-40.0*f[41]+40.0*f[36]-20.0*f[31])*vcut_lR3+(30.0*f[106]+30.0*f[87])*vcut_lR2+(20.0*f[48]+20.0*f[41]-40.0*f[36]+20.0*f[31])*vcut_l+15.0*f[106]+15.0*f[87]-16.0*f[41]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[10]*vcut_lR4+120.0*f[8]*vcut_lR3-60.0*f[10]*vcut_lR2-120.0*f[8]*vcut_l-30.0*f[10])+((-225.0*f[85])+180.0*f[62]-225.0*f[61]+270.0*f[24])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]+80.0*f[17]-100.0*f[16]+120.0*f[2])*vcut_lR3+(150.0*f[85]-120.0*f[62]+150.0*f[61]-180.0*f[24])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]-80.0*f[17]+100.0*f[16]-120.0*f[2])*vcut_l+75.0*f[85]-60.0*f[62]+75.0*f[61]-90.0*f[24]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]-18.0*f[91]-4.0*f[50]+8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]+8.0*f[34]-10.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[41])*vcut_lR3+(12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87])*vcut_lR2+(8.0*f[48]-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-12.0*f[106]-12.0*f[97]+15.0*f[96]+15.0*f[87]+8.0*f[48]+20.0*f[45]+8.0*f[44]-10.0*f[43]+20.0*f[36]-10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[67])*vcut_lR3+(12.0*f[84]+30.0*f[76]+12.0*f[75]-15.0*f[74]+30.0*f[64]-15.0*f[59]+18.0*f[29]+10.0*f[4])*vcut_lR2+(24.0*f[82]-30.0*f[79]+24.0*f[71]-30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l-12.0*f[84]+24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]+24.0*f[71]-30.0*f[70]-30.0*f[64]+15.0*f[59]-30.0*f[56]-18.0*f[29]+36.0*f[27]-10.0*f[4]+20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+(36.0*f[13]+20.0*f[0])*vcut_l-54.0*f[55]+36.0*f[13]-30.0*f[11]+20.0*f[0])+(90.0*f[78]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[10])*vcut_lR2+(60.0*f[14]+60.0*f[8])*vcut_l-30.0*f[15]+60.0*f[14]-30.0*f[10]+60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]+90.0*f[30]+90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]+180.0*f[73]-90.0*f[68]-60.0*f[62]+75.0*f[61]-90.0*f[30]-90.0*f[24]+40.0*f[20]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]+60.0*f[2]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2-135.0*f[102]+360.0*f[99]-180.0*f[94]+270.0*f[91]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]-100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+(144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+225.0*f[19])*vcut_lR4+((-540.0*f[107])+240.0*f[85]+240.0*f[62]-300.0*f[61]+360.0*f[30]+360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2-540.0*f[107]+240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]+240.0*f[62]-300.0*f[61]+360.0*f[30]+360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+(540.0*f[14]+540.0*f[8])*vcut_lR2+360.0*f[15]-540.0*f[14]+360.0*f[10]-540.0*f[8])+(2025.0*f[79]+2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]+600.0*f[11])*vcut_lR3+(540.0*f[13]+300.0*f[0])*vcut_lR2+1080.0*f[55]-540.0*f[13]+600.0*f[11]-300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]+1080.0*f[29]+600.0*f[4])*vcut_lR3+(1080.0*f[82]-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]-1350.0*f[67]-1350.0*f[56]+1620.0*f[27]+900.0*f[3])*vcut_lR2+720.0*f[84]-1080.0*f[82]-675.0*f[79]+1800.0*f[76]+720.0*f[75]-900.0*f[74]-1080.0*f[71]+1350.0*f[70]-675.0*f[67]+1800.0*f[64]-900.0*f[59]+1350.0*f[56]+1080.0*f[29]-1620.0*f[27]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l+144.0*f[102]-90.0*f[99]+45.0*f[94]-20.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[41])*vcut_lR5+(180.0*f[106]+180.0*f[97]-225.0*f[96]-225.0*f[87])*vcut_lR4+(80.0*f[48]-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+((-120.0*f[106])-120.0*f[97]+150.0*f[96]+150.0*f[87])*vcut_lR2+((-80.0*f[48])+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l-60.0*f[106]-60.0*f[97]+75.0*f[96]+75.0*f[87]+80.0*f[46]+80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[67])*vcut_lR5+(180.0*f[84]+450.0*f[76]+180.0*f[75]-225.0*f[74]+450.0*f[64]-225.0*f[59]+270.0*f[29]+150.0*f[4])*vcut_lR4+(240.0*f[82]-600.0*f[79]+240.0*f[71]-300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+((-120.0*f[84])-300.0*f[76]-120.0*f[75]+150.0*f[74]-300.0*f[64]+150.0*f[59]-180.0*f[29]-100.0*f[4])*vcut_lR2+((-240.0*f[82])+300.0*f[79]-240.0*f[71]+300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l-60.0*f[84]+240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]+240.0*f[67]-150.0*f[64]+75.0*f[59]-90.0*f[29]-50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+(360.0*f[13]+200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+((-360.0*f[13])-200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+(1620.0*f[78]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[10])*vcut_lR4+(600.0*f[14]+600.0*f[8])*vcut_lR3+((-300.0*f[15])-300.0*f[10])*vcut_lR2+((-600.0*f[14])-600.0*f[8])*vcut_l-150.0*f[15]-150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]+1350.0*f[30]+1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]-900.0*f[30]-900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]+720.0*f[78]-300.0*f[62]+375.0*f[61]-450.0*f[30]-450.0*f[24]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[102]+10.0*f[42])*vcut_lR3+(18.0*f[99]-9.0*f[94]+4.0*f[50]+10.0*f[39]+4.0*f[38]-5.0*f[37])*vcut_lR2+((-18.0*f[102])-18.0*f[91]+8.0*f[49]-10.0*f[42]+8.0*f[34]-10.0*f[33])*vcut_l-18.0*f[99]+9.0*f[94]+18.0*f[91]-4.0*f[50]-8.0*f[49]-10.0*f[39]-4.0*f[38]+5.0*f[37]-8.0*f[34]+10.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[41])*vcut_lR3+(12.0*f[106]+12.0*f[97]-15.0*f[96]-15.0*f[87])*vcut_lR2+(8.0*f[48]-10.0*f[46]+20.0*f[45]+8.0*f[44]-10.0*f[43]-10.0*f[41]+20.0*f[36]-10.0*f[31])*vcut_l-12.0*f[106]-12.0*f[97]+15.0*f[96]+15.0*f[87]-8.0*f[48]-20.0*f[45]-8.0*f[44]+10.0*f[43]-20.0*f[36]+10.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[67])*vcut_lR3+(12.0*f[84]+30.0*f[76]+12.0*f[75]-15.0*f[74]+30.0*f[64]-15.0*f[59]+18.0*f[29]+10.0*f[4])*vcut_lR2+(24.0*f[82]-30.0*f[79]+24.0*f[71]-30.0*f[70]-30.0*f[67]-30.0*f[56]+36.0*f[27]+20.0*f[3])*vcut_l-12.0*f[84]-24.0*f[82]-30.0*f[76]-12.0*f[75]+15.0*f[74]-24.0*f[71]+30.0*f[70]-30.0*f[64]+15.0*f[59]+30.0*f[56]-18.0*f[29]-36.0*f[27]-10.0*f[4]-20.0*f[3])+(54.0*f[55]+30.0*f[11])*vcut_lR2+(36.0*f[13]+20.0*f[0])*vcut_l-54.0*f[55]-36.0*f[13]-30.0*f[11]-20.0*f[0])+(90.0*f[78]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[10])*vcut_lR2+(60.0*f[14]+60.0*f[8])*vcut_l-30.0*f[15]-60.0*f[14]-30.0*f[10]-60.0*f[8])+((-135.0*f[107])+60.0*f[85]+60.0*f[62]-75.0*f[61]+90.0*f[30]+90.0*f[24])*vcut_lR2+((-90.0*f[78])+180.0*f[73]-90.0*f[68]+40.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]-50.0*f[16]+60.0*f[5]+60.0*f[2])*vcut_l+135.0*f[107]-60.0*f[85]-180.0*f[73]+90.0*f[68]-60.0*f[62]+75.0*f[61]-90.0*f[30]-90.0*f[24]-40.0*f[20]-100.0*f[18]-40.0*f[17]+50.0*f[16]-60.0*f[5]-60.0*f[2]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+225.0*f[42])*vcut_lR4+(360.0*f[99]-180.0*f[94]+80.0*f[50]+200.0*f[39]+80.0*f[38]-100.0*f[37])*vcut_lR3+((-270.0*f[102])-270.0*f[91]+120.0*f[49]-150.0*f[42]+120.0*f[34]-150.0*f[33])*vcut_lR2-135.0*f[102]-360.0*f[99]+180.0*f[94]+270.0*f[91]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]+100.0*f[37]-120.0*f[34]+150.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[41])*vcut_lR4+(144.0*f[106]+144.0*f[97]-180.0*f[96]-180.0*f[87])*vcut_lR3+(72.0*f[48]-90.0*f[46]+180.0*f[45]+72.0*f[44]-90.0*f[43]-90.0*f[41]+180.0*f[36]-90.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[97]+180.0*f[96]+180.0*f[87]-72.0*f[48]-45.0*f[46]-180.0*f[45]-72.0*f[44]+90.0*f[43]-45.0*f[41]-180.0*f[36]+90.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+225.0*f[19])*vcut_lR4+((-540.0*f[107])+240.0*f[85]+240.0*f[62]-300.0*f[61]+360.0*f[30]+360.0*f[24])*vcut_lR3+((-270.0*f[78])+540.0*f[73]-270.0*f[68]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]-150.0*f[16]+180.0*f[5]+180.0*f[2])*vcut_lR2+540.0*f[107]-240.0*f[85]-135.0*f[78]-540.0*f[73]+270.0*f[68]-240.0*f[62]+300.0*f[61]-360.0*f[30]-360.0*f[24]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]+150.0*f[16]-180.0*f[5]-180.0*f[2])+(360.0*f[15]+360.0*f[10])*vcut_lR3+(540.0*f[14]+540.0*f[8])*vcut_lR2-360.0*f[15]-540.0*f[14]-360.0*f[10]-540.0*f[8])+(2025.0*f[79]+2025.0*f[67])*vcut_lR4+1.732050807568877*((1080.0*f[55]+600.0*f[11])*vcut_lR3+(540.0*f[13]+300.0*f[0])*vcut_lR2-1080.0*f[55]-540.0*f[13]-600.0*f[11]-300.0*f[0])+(720.0*f[84]+1800.0*f[76]+720.0*f[75]-900.0*f[74]+1800.0*f[64]-900.0*f[59]+1080.0*f[29]+600.0*f[4])*vcut_lR3+(1080.0*f[82]-1350.0*f[79]+1080.0*f[71]-1350.0*f[70]-1350.0*f[67]-1350.0*f[56]+1620.0*f[27]+900.0*f[3])*vcut_lR2-720.0*f[84]-1080.0*f[82]-675.0*f[79]-1800.0*f[76]-720.0*f[75]+900.0*f[74]-1080.0*f[71]+1350.0*f[70]-675.0*f[67]-1800.0*f[64]+900.0*f[59]+1350.0*f[56]-1080.0*f[29]-1620.0*f[27]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[102]+180.0*f[42])*vcut_lR5+(270.0*f[99]-135.0*f[94]+60.0*f[50]+150.0*f[39]+60.0*f[38]-75.0*f[37])*vcut_lR4+((-360.0*f[102])-180.0*f[91]+80.0*f[49]-200.0*f[42]+80.0*f[34]-100.0*f[33])*vcut_lR3+((-180.0*f[99])+90.0*f[94]-40.0*f[50]-100.0*f[39]-40.0*f[38]+50.0*f[37])*vcut_lR2+(180.0*f[102]+180.0*f[91]-80.0*f[49]+100.0*f[42]-80.0*f[34]+100.0*f[33])*vcut_l-144.0*f[102]-90.0*f[99]+45.0*f[94]-20.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]+25.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[41])*vcut_lR5+(180.0*f[106]+180.0*f[97]-225.0*f[96]-225.0*f[87])*vcut_lR4+(80.0*f[48]-200.0*f[46]+200.0*f[45]+80.0*f[44]-100.0*f[43]-200.0*f[41]+200.0*f[36]-100.0*f[31])*vcut_lR3+((-120.0*f[106])-120.0*f[97]+150.0*f[96]+150.0*f[87])*vcut_lR2+((-80.0*f[48])+100.0*f[46]-200.0*f[45]-80.0*f[44]+100.0*f[43]+100.0*f[41]-200.0*f[36]+100.0*f[31])*vcut_l-60.0*f[106]-60.0*f[97]+75.0*f[96]+75.0*f[87]-80.0*f[46]-80.0*f[41]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[67])*vcut_lR5+(180.0*f[84]+450.0*f[76]+180.0*f[75]-225.0*f[74]+450.0*f[64]-225.0*f[59]+270.0*f[29]+150.0*f[4])*vcut_lR4+(240.0*f[82]-600.0*f[79]+240.0*f[71]-300.0*f[70]-600.0*f[67]-300.0*f[56]+360.0*f[27]+200.0*f[3])*vcut_lR3+((-120.0*f[84])-300.0*f[76]-120.0*f[75]+150.0*f[74]-300.0*f[64]+150.0*f[59]-180.0*f[29]-100.0*f[4])*vcut_lR2+((-240.0*f[82])+300.0*f[79]-240.0*f[71]+300.0*f[70]+300.0*f[67]+300.0*f[56]-360.0*f[27]-200.0*f[3])*vcut_l-60.0*f[84]-240.0*f[79]-150.0*f[76]-60.0*f[75]+75.0*f[74]-240.0*f[67]-150.0*f[64]+75.0*f[59]-90.0*f[29]-50.0*f[4])+(810.0*f[55]+450.0*f[11])*vcut_lR4+(360.0*f[13]+200.0*f[0])*vcut_lR3+((-540.0*f[55])-300.0*f[11])*vcut_lR2+((-360.0*f[13])-200.0*f[0])*vcut_l-270.0*f[55]-150.0*f[11])+(1620.0*f[78]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[10])*vcut_lR4+(600.0*f[14]+600.0*f[8])*vcut_lR3+((-300.0*f[15])-300.0*f[10])*vcut_lR2+((-600.0*f[14])-600.0*f[8])*vcut_l-150.0*f[15]-150.0*f[10])+((-2025.0*f[107])+900.0*f[85]+900.0*f[62]-1125.0*f[61]+1350.0*f[30]+1350.0*f[24])*vcut_lR4+((-1800.0*f[78])+1800.0*f[73]-900.0*f[68]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]-500.0*f[16]+600.0*f[5]+600.0*f[2])*vcut_lR3+(1350.0*f[107]-600.0*f[85]-600.0*f[62]+750.0*f[61]-900.0*f[30]-900.0*f[24])*vcut_lR2+(900.0*f[78]-1800.0*f[73]+900.0*f[68]-400.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]+500.0*f[16]-600.0*f[5]-600.0*f[2])*vcut_l+675.0*f[107]-300.0*f[85]-720.0*f[78]-300.0*f[62]+375.0*f[61]-450.0*f[30]-450.0*f[24]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[5][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[5][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[5][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[5][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[5][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[5][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_6 
  vcutSq = -0.01*(2.23606797749979*(63.63961030678928*phiWall[19]-63.63961030678928*phi[19]-35.35533905932738*phiWall[9]+35.35533905932738*phi[9]-14.14213562373095*phiWall[8]+14.14213562373095*phi[8]-14.14213562373095*phiWall[7]+14.14213562373095*phi[7]+1.732050807568877*(21.21320343559643*phiWall[6]-21.21320343559643*(phi[6]+phiWall[5])+21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*(phi[2]+phiWall[1])+21.21320343559643*phi[1])+1.732050807568877*((-42.42640687119286*phiWall[18])+42.42640687119286*(phi[18]+phiWall[17])-42.42640687119286*phi[17]+63.63961030678928*phiWall[10]-63.63961030678928*phi[10]-35.35533905932738*phiWall[3]+35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*(phi[16]+phiWall[15])+7.071067811865476*phi[15]-2.828427124746191*phiWall[12]+2.828427124746191*(phi[12]+phiWall[11])-2.828427124746191*phi[11])-14.14213562373095*phiWall[14]+14.14213562373095*phi[14]-14.14213562373095*phiWall[13]+14.14213562373095*phi[13])+63.63961030678928*phiWall[4]-63.63961030678928*phi[4]-35.35533905932738*phiWall[0]+35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[6][0] = 0.0; 
  fReflSurfXY[6][1] = 0.0; 
  fReflSurfXY[6][2] = 0.0; 
  fReflSurfXY[6][3] = 0.0; 
  fReflSurfXY[6][4] = 0.0; 
  fReflSurfXY[6][5] = 0.0; 
  fReflSurfXY[6][6] = 0.0; 
  fReflSurfXY[6][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[6][0] = -0.01414213562373095*(11.18033988749895*(9.0*f[58]-1.0*(5.0*f[18]+2.0*(f[17]+f[16]))+5.196152422706631*(f[8]-1.0*f[7])+3.0*(f[2]-1.0*f[1]))-8.660254037844386*(3.0*(2.0*f[57]-1.0*(2.0*f[56]+3.0*f[21]))+5.0*f[3])+3.872983346207417*(3.872983346207417*(5.0*f[36]-1.0*(5.0*f[35]+2.0*f[32])+2.0*f[31])-10.0*(f[34]+f[33]))+5.0*(9.0*f[6]-5.0*f[0])); 
  fReflSurfXY[6][1] = 0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[88]-1.0*f[87])-8.660254037844386*(9.0*f[89]-1.0*(5.0*f[39]+2.0*(f[38]+f[37]))))+225.0*(f[63]-1.0*f[64])+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[23]-1.0*f[24]))+9.0*(f[9]-1.0*f[10]))+5.0*(18.0*f[60]+5.196152422706631*(5.0*f[11]-9.0*f[51])+3.0*(5.0*f[4]-9.0*f[22]))); 
  fReflSurfXY[6][2] = 0.004714045207910316*(3.872983346207417*(40.24922359499622*(f[92]-1.0*f[91])-8.660254037844386*(9.0*f[93]-1.0*(5.0*f[45]+2.0*(f[44]+f[43]))))+225.0*(f[72]-1.0*f[73])+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[26]-1.0*f[27]))+9.0*(f[12]-1.0*f[13]))+5.0*(18.0*f[69]+5.196152422706631*(5.0*f[14]-9.0*f[52])+3.0*(5.0*f[5]-9.0*f[25]))); 
  fReflSurfXY[6][3] = -0.01414213562373095*(11.18033988749895*(9.0*f[109]-1.0*(5.0*f[76]+2.0*(f[75]+f[74]))+5.196152422706631*(f[55]-1.0*f[54])+3.0*(f[29]-1.0*f[28]))-8.660254037844386*(3.0*(2.0*f[108]-1.0*(2.0*f[107]+3.0*f[86]))+5.0*f[30])+3.872983346207417*(3.872983346207417*(5.0*f[99]-1.0*(5.0*f[98]+2.0*f[95])+2.0*f[94])-10.0*(f[97]+f[96]))+5.0*(9.0*f[53]-5.0*f[15])); 
  fReflSurfXY[6][4] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]-5.0*f[42])+8.660254037844386*(f[41]-1.0*f[40]))+58.09475019311126*(f[67]-1.0*f[66])+5.0*(9.0*f[65]-5.0*f[19])); 
  fReflSurfXY[6][5] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]-5.0*f[49])+8.660254037844386*(f[48]-1.0*f[47]))+58.09475019311126*(f[82]-1.0*f[81])+5.0*(9.0*f[80]-5.0*f[20])); 
  fReflSurfXY[6][6] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]-5.0*f[79])+8.660254037844386*(f[78]-1.0*f[77]))+58.09475019311126*(f[102]-1.0*f[101])+5.0*(9.0*f[100]-5.0*f[46])); 
  fReflSurfXY[6][7] = -0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]-5.0*f[85])+8.660254037844386*(f[84]-1.0*f[83]))+58.09475019311126*(f[106]-1.0*f[105])+5.0*(9.0*f[104]-5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]-30.0*f[83]-60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+60.0*f[57]-60.0*f[56]-45.0*f[29]+45.0*f[28]+90.0*f[27]-90.0*f[26]+45.0*f[22]-90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]+90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-36.0*f[92]+36.0*f[91]+45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]-30.0*f[88]+30.0*f[87]-20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+(225.0*f[78]-225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]+75.0*f[15]-150.0*f[14]+75.0*f[10]-75.0*f[9]-150.0*f[8]+150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]+225.0*f[30]+270.0*f[25]+225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]-135.0*f[102]+135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+216.0*f[92]-216.0*f[91]+135.0*f[90]-360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]-360.0*f[15]+540.0*f[14]-360.0*f[10]+360.0*f[9]+540.0*f[8]-540.0*f[7])+(3645.0*f[110]-2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]-1080.0*f[51]-540.0*f[13]+540.0*f[12]+600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[29]-1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[27]-1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]-720.0*f[84]+720.0*f[83]+1080.0*f[82]-1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]-675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]-1080.0*f[57]+1080.0*f[56]+1080.0*f[29]-1080.0*f[28]-1620.0*f[27]+1620.0*f[26]-1080.0*f[22]+1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]+135.0*f[29]-135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[29]+90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]+30.0*f[84]-30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]+120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]-72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-72.0*f[90]+45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87]-40.0*f[46]-40.0*f[41]+40.0*f[40]))+(810.0*f[78]-810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]+75.0*f[10]-75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]-75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]+30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+45.0*f[29]-45.0*f[28]-45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]+60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]+75.0*f[67]-75.0*f[66]+60.0*f[57]-60.0*f[56]+90.0*f[27]-90.0*f[26]-90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]-30.0*f[83]+60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-60.0*f[57]+60.0*f[56]-45.0*f[29]+45.0*f[28]-90.0*f[27]+90.0*f[26]+45.0*f[22]+90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]-135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]-90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]-45.0*f[90]+25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]-45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]+45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+36.0*f[92]-36.0*f[91]+45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]-25.0*f[41]+25.0*f[40])*vcut_lR3+((-30.0*f[106])+30.0*f[105]-30.0*f[97]-30.0*f[96]+30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]+20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]+25.0*f[41]-25.0*f[40]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]-30.0*f[88]+30.0*f[87]+20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+(225.0*f[78]-225.0*f[77]-225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]-75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]-150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]+75.0*f[15]+150.0*f[14]+75.0*f[10]-75.0*f[9]+150.0*f[8]-150.0*f[7])+((-270.0*f[111])-270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]-225.0*f[30]-225.0*f[24]+225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]-150.0*f[2]+150.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]+225.0*f[30]-270.0*f[25]+225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]-405.0*f[90]+225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]-360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]+270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]-135.0*f[102]+135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+216.0*f[92]-216.0*f[91]+135.0*f[90]+360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]-135.0*f[41]+135.0*f[40])*vcut_lR4+((-144.0*f[106])+144.0*f[105]-144.0*f[97]-144.0*f[96]+144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]+72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+90.0*f[41]-90.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]+72.0*f[48]-72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+45.0*f[41]-45.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]-405.0*f[65]+225.0*f[19])*vcut_lR4+((-432.0*f[111])-432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]-360.0*f[30]-360.0*f[24]+360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]-180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]+216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]+180.0*f[2]-180.0*f[1])+(648.0*f[53]-360.0*f[15]-360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]-540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]+360.0*f[15]+540.0*f[14]+360.0*f[10]-360.0*f[9]+540.0*f[8]-540.0*f[7])+(3645.0*f[110]-2025.0*f[79]-2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]-1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]-540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]+1080.0*f[51]-540.0*f[13]+540.0*f[12]-600.0*f[11]+540.0*f[6]-300.0*f[0])+(3240.0*f[109]-720.0*f[84]+720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[29]-1080.0*f[28]-1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]+1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]+1350.0*f[67]-1350.0*f[66]+1080.0*f[57]-1080.0*f[56]+1620.0*f[27]-1620.0*f[26]-1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]+720.0*f[84]-720.0*f[83]+1080.0*f[82]-1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]+675.0*f[67]-675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]-1080.0*f[57]+1080.0*f[56]-1080.0*f[29]+1080.0*f[28]-1620.0*f[27]+1620.0*f[26]+1080.0*f[22]+1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]-270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]+90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]-225.0*f[64]+225.0*f[63]+90.0*f[60]-90.0*f[59]+135.0*f[29]-135.0*f[28]-135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]+120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]+300.0*f[67]-300.0*f[66]+120.0*f[57]-120.0*f[56]+180.0*f[27]-180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]-60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]+150.0*f[64]-150.0*f[63]-60.0*f[60]+60.0*f[59]-90.0*f[29]+90.0*f[28]+90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]-120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]-150.0*f[67]+150.0*f[66]-120.0*f[57]+120.0*f[56]-180.0*f[27]+180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]+30.0*f[84]-30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]-120.0*f[66]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]-45.0*f[29]+45.0*f[28]+45.0*f[22]-25.0*f[4])+(405.0*f[55]-405.0*f[54]-405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]+270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]+135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]-162.0*f[90]+90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]-135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]+180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]+90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]-90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]+72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+72.0*f[90]+45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]-90.0*f[41]+90.0*f[40])*vcut_lR5+((-90.0*f[106])+90.0*f[105]-90.0*f[97]-90.0*f[96]+90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]+40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+100.0*f[41]-100.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]-60.0*f[105]+60.0*f[97]+60.0*f[96]-60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]-40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-50.0*f[41]+50.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]-30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]-30.0*f[88]+30.0*f[87]+40.0*f[46]+40.0*f[41]-40.0*f[40]))+(810.0*f[78]-810.0*f[77]-810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]-225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]+150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]+75.0*f[10]-75.0*f[9])+((-810.0*f[111])-810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]-675.0*f[30]-675.0*f[24]+675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_lR3+(540.0*f[111]+540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]+450.0*f[30]+450.0*f[24]-450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_l+270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]+225.0*f[30]+225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l+9.0*f[104]-18.0*f[103]-18.0*f[89]-5.0*f[50]+10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[40])*vcut_lR3+((-15.0*f[106])+15.0*f[105]-12.0*f[88]+12.0*f[87])*vcut_lR2+((-10.0*f[48])+10.0*f[47]-10.0*f[41]+10.0*f[40]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31])*vcut_l+15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87]-10.0*f[48]+10.0*f[47]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[66])*vcut_lR3+((-15.0*f[84])+15.0*f[83]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]+18.0*f[22]-10.0*f[4])*vcut_lR2+((-30.0*f[82])+30.0*f[81]-30.0*f[67]+30.0*f[66]-24.0*f[57]+24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l+15.0*f[84]-15.0*f[83]-30.0*f[82]+30.0*f[81]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]-24.0*f[57]+24.0*f[56]-18.0*f[22]+36.0*f[21]+10.0*f[4]-20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(36.0*f[6]-20.0*f[0])*vcut_l-54.0*f[51]+30.0*f[11]+36.0*f[6]-20.0*f[0])+(90.0*f[65]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[9])*vcut_lR2+(60.0*f[8]-60.0*f[7])*vcut_l-30.0*f[10]+30.0*f[9]+60.0*f[8]-60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]+90.0*f[24]-90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]-90.0*f[80]+60.0*f[62]+60.0*f[61]+180.0*f[58]-90.0*f[24]+90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]-225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-180.0*f[104]+270.0*f[103]-135.0*f[90]+360.0*f[89]+100.0*f[50]-150.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+((-180.0*f[106])+180.0*f[105]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]+180.0*f[105]-144.0*f[88]+144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]-225.0*f[19])*vcut_lR4+((-540.0*f[111])+300.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2-540.0*f[111]+300.0*f[85]+270.0*f[80]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]+360.0*f[24]-360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[8]-540.0*f[7])*vcut_lR2+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+(2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[51]-600.0*f[11]-540.0*f[6]+300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-1350.0*f[82])+1350.0*f[81]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[21]-900.0*f[3])*vcut_lR2-900.0*f[84]+900.0*f[83]+1350.0*f[82]-1350.0*f[81]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l+45.0*f[104]+144.0*f[90]-90.0*f[89]-25.0*f[50]-80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[40])*vcut_lR5+((-225.0*f[106])+225.0*f[105]-180.0*f[88]+180.0*f[87])*vcut_lR4+((-100.0*f[48])+100.0*f[47]-200.0*f[41]+200.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_lR3+(150.0*f[106]-150.0*f[105]+120.0*f[88]-120.0*f[87])*vcut_lR2+(100.0*f[48]-100.0*f[47]+100.0*f[41]-100.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_l+75.0*f[106]-75.0*f[105]+60.0*f[88]-60.0*f[87]+80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[66])*vcut_lR5+((-225.0*f[84])+225.0*f[83]+450.0*f[64]-450.0*f[63]-180.0*f[60]+180.0*f[59]+270.0*f[22]-150.0*f[4])*vcut_lR4+((-300.0*f[82])+300.0*f[81]-600.0*f[67]+600.0*f[66]-240.0*f[57]+240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+(150.0*f[84]-150.0*f[83]-300.0*f[64]+300.0*f[63]+120.0*f[60]-120.0*f[59]-180.0*f[22]+100.0*f[4])*vcut_lR2+(300.0*f[82]-300.0*f[81]+300.0*f[67]-300.0*f[66]+240.0*f[57]-240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l+75.0*f[84]-75.0*f[83]+240.0*f[67]-240.0*f[66]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[22]+50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(360.0*f[6]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(200.0*f[0]-360.0*f[6])*vcut_l-270.0*f[51]+150.0*f[11])+(1620.0*f[65]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[9])*vcut_lR4+(600.0*f[8]-600.0*f[7])*vcut_lR3+(300.0*f[9]-300.0*f[10])*vcut_lR2+(600.0*f[7]-600.0*f[8])*vcut_l-150.0*f[10]+150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]+1350.0*f[24]-1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]-900.0*f[24]+900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]+720.0*f[65]+300.0*f[62]+300.0*f[61]-450.0*f[24]+450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]-10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]+5.0*f[50]-10.0*f[39]-4.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]+10.0*f[49]+10.0*f[42]-8.0*f[34]-8.0*f[33])*vcut_l+9.0*f[104]+18.0*f[103]-18.0*f[89]-5.0*f[50]-10.0*f[49]+10.0*f[39]+4.0*f[38]+4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[41]-10.0*f[40])*vcut_lR3+((-15.0*f[106])+15.0*f[105]-12.0*f[88]+12.0*f[87])*vcut_lR2+((-10.0*f[48])+10.0*f[47]-10.0*f[41]+10.0*f[40]+20.0*f[36]-20.0*f[35]-8.0*f[32]+8.0*f[31])*vcut_l+15.0*f[106]-15.0*f[105]+12.0*f[88]-12.0*f[87]+10.0*f[48]-10.0*f[47]-20.0*f[36]+20.0*f[35]+8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]-30.0*f[66])*vcut_lR3+((-15.0*f[84])+15.0*f[83]+30.0*f[64]-30.0*f[63]-12.0*f[60]+12.0*f[59]+18.0*f[22]-10.0*f[4])*vcut_lR2+((-30.0*f[82])+30.0*f[81]-30.0*f[67]+30.0*f[66]-24.0*f[57]+24.0*f[56]+36.0*f[21]-20.0*f[3])*vcut_l+15.0*f[84]-15.0*f[83]+30.0*f[82]-30.0*f[81]-30.0*f[64]+30.0*f[63]+12.0*f[60]-12.0*f[59]+24.0*f[57]-24.0*f[56]-18.0*f[22]-36.0*f[21]+10.0*f[4]+20.0*f[3])+(54.0*f[51]-30.0*f[11])*vcut_lR2+(36.0*f[6]-20.0*f[0])*vcut_l-54.0*f[51]+30.0*f[11]-36.0*f[6]+20.0*f[0])+(90.0*f[65]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]-30.0*f[9])*vcut_lR2+(60.0*f[8]-60.0*f[7])*vcut_l-30.0*f[10]+30.0*f[9]-60.0*f[8]+60.0*f[7])+((-135.0*f[111])+75.0*f[85]-60.0*f[62]-60.0*f[61]+90.0*f[24]-90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]+50.0*f[20]+50.0*f[19]-100.0*f[18]-40.0*f[17]-40.0*f[16]+60.0*f[2]-60.0*f[1])*vcut_l+135.0*f[111]-75.0*f[85]+90.0*f[80]+60.0*f[62]+60.0*f[61]-180.0*f[58]-90.0*f[24]+90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]-60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]-225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]+100.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]+150.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+180.0*f[104]+270.0*f[103]-135.0*f[90]-360.0*f[89]-100.0*f[50]-150.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[41]-135.0*f[40])*vcut_lR4+((-180.0*f[106])+180.0*f[105]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])+90.0*f[47]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]-180.0*f[105]+144.0*f[88]-144.0*f[87]+90.0*f[48]-90.0*f[47]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]-225.0*f[19])*vcut_lR4+((-540.0*f[111])+300.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[24]-360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]+150.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[2]-180.0*f[1])*vcut_lR2+540.0*f[111]-300.0*f[85]+270.0*f[80]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]-360.0*f[24]+360.0*f[23]-150.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[2]+180.0*f[1])+(360.0*f[10]-360.0*f[9])*vcut_lR3+(540.0*f[8]-540.0*f[7])*vcut_lR2-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+(2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[51]+600.0*f[11]-540.0*f[6]+300.0*f[0])+((-900.0*f[84])+900.0*f[83]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-1350.0*f[82])+1350.0*f[81]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[21]-900.0*f[3])*vcut_lR2+900.0*f[84]-900.0*f[83]+1350.0*f[82]-1350.0*f[81]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]-180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]+75.0*f[50]-150.0*f[39]-60.0*f[38]-60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]+100.0*f[49]+200.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]-50.0*f[50]+100.0*f[39]+40.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]-100.0*f[49]-100.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_l+45.0*f[104]-144.0*f[90]-90.0*f[89]-25.0*f[50]+80.0*f[42]+50.0*f[39]+20.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[41]-180.0*f[40])*vcut_lR5+((-225.0*f[106])+225.0*f[105]-180.0*f[88]+180.0*f[87])*vcut_lR4+((-100.0*f[48])+100.0*f[47]-200.0*f[41]+200.0*f[40]+200.0*f[36]-200.0*f[35]-80.0*f[32]+80.0*f[31])*vcut_lR3+(150.0*f[106]-150.0*f[105]+120.0*f[88]-120.0*f[87])*vcut_lR2+(100.0*f[48]-100.0*f[47]+100.0*f[41]-100.0*f[40]-200.0*f[36]+200.0*f[35]+80.0*f[32]-80.0*f[31])*vcut_l+75.0*f[106]-75.0*f[105]+60.0*f[88]-60.0*f[87]-80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]-540.0*f[66])*vcut_lR5+((-225.0*f[84])+225.0*f[83]+450.0*f[64]-450.0*f[63]-180.0*f[60]+180.0*f[59]+270.0*f[22]-150.0*f[4])*vcut_lR4+((-300.0*f[82])+300.0*f[81]-600.0*f[67]+600.0*f[66]-240.0*f[57]+240.0*f[56]+360.0*f[21]-200.0*f[3])*vcut_lR3+(150.0*f[84]-150.0*f[83]-300.0*f[64]+300.0*f[63]+120.0*f[60]-120.0*f[59]-180.0*f[22]+100.0*f[4])*vcut_lR2+(300.0*f[82]-300.0*f[81]+300.0*f[67]-300.0*f[66]+240.0*f[57]-240.0*f[56]-360.0*f[21]+200.0*f[3])*vcut_l+75.0*f[84]-75.0*f[83]-240.0*f[67]+240.0*f[66]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[22]+50.0*f[4])+(810.0*f[51]-450.0*f[11])*vcut_lR4+(360.0*f[6]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[51])*vcut_lR2+(200.0*f[0]-360.0*f[6])*vcut_l-270.0*f[51]+150.0*f[11])+(1620.0*f[65]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]-450.0*f[9])*vcut_lR4+(600.0*f[8]-600.0*f[7])*vcut_lR3+(300.0*f[9]-300.0*f[10])*vcut_lR2+(600.0*f[7]-600.0*f[8])*vcut_l-150.0*f[10]+150.0*f[9])+((-2025.0*f[111])+1125.0*f[85]-900.0*f[62]-900.0*f[61]+1350.0*f[24]-1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]+500.0*f[20]+1000.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]+600.0*f[2]-600.0*f[1])*vcut_lR3+(1350.0*f[111]-750.0*f[85]+600.0*f[62]+600.0*f[61]-900.0*f[24]+900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]-500.0*f[20]-500.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]-600.0*f[2]+600.0*f[1])*vcut_l+675.0*f[111]-375.0*f[85]-720.0*f[65]+300.0*f[62]+300.0*f[61]-450.0*f[24]+450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]+30.0*f[83]+60.0*f[82]-60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-60.0*f[57]+60.0*f[56]-45.0*f[29]+45.0*f[28]+90.0*f[27]-90.0*f[26]-45.0*f[22]+90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-36.0*f[92]+36.0*f[91]-45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+90.0*f[93]+30.0*f[88]-30.0*f[87]+20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31]))+(225.0*f[78]-225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]+75.0*f[15]-150.0*f[14]-75.0*f[10]+75.0*f[9]+150.0*f[8]-150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+180.0*f[80]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]+225.0*f[30]+270.0*f[25]-225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]-135.0*f[102]+135.0*f[101]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+216.0*f[92]-216.0*f[91]-135.0*f[90]+360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]+144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]-360.0*f[15]+540.0*f[14]+360.0*f[10]-360.0*f[9]-540.0*f[8]+540.0*f[7])+(3645.0*f[110]-2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-540.0*f[13]+540.0*f[12]-600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[29]-1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[27]-1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]+720.0*f[84]-720.0*f[83]-1080.0*f[82]+1080.0*f[81]+675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]+675.0*f[66]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[57]-1080.0*f[56]+1080.0*f[29]-1080.0*f[28]-1620.0*f[27]+1620.0*f[26]+1080.0*f[22]-1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]+135.0*f[29]-135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[29]+90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]-30.0*f[84]+30.0*f[83]-120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]+120.0*f[67]-120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]-72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+72.0*f[90]-45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87]-40.0*f[46]+40.0*f[41]-40.0*f[40]))+(810.0*f[78]-810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]-75.0*f[10]+75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]-75.0*f[79]+75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]-30.0*f[83]-75.0*f[76]-30.0*f[75]-30.0*f[74]+75.0*f[64]-75.0*f[63]-30.0*f[60]+30.0*f[59]+45.0*f[29]-45.0*f[28]+45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]-60.0*f[81]+75.0*f[79]-60.0*f[71]-60.0*f[70]-75.0*f[67]+75.0*f[66]-60.0*f[57]+60.0*f[56]+90.0*f[27]-90.0*f[26]+90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]+30.0*f[83]-60.0*f[82]+60.0*f[81]+75.0*f[76]+30.0*f[75]+30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]+60.0*f[57]-60.0*f[56]-45.0*f[29]+45.0*f[28]-90.0*f[27]+90.0*f[26]-45.0*f[22]-90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]-135.0*f[54]+135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]-90.0*f[12]+90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]-90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]-45.0*f[101]+45.0*f[90]-25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]-45.0*f[98]-18.0*f[95]+18.0*f[94]+45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]+45.0*f[101]-36.0*f[92]+36.0*f[91]-45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]+36.0*f[92]-36.0*f[91]-45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]-25.0*f[46]+25.0*f[41]-25.0*f[40])*vcut_lR3+(30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]-20.0*f[47]+25.0*f[46]-50.0*f[45]-20.0*f[44]-20.0*f[43]-25.0*f[41]+25.0*f[40]+50.0*f[36]-50.0*f[35]-20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]-90.0*f[93]+30.0*f[88]-30.0*f[87]-20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]+50.0*f[35]+20.0*f[32]-20.0*f[31]))+(225.0*f[78]-225.0*f[77]+225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]-75.0*f[15]+75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]-150.0*f[14]+150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]+75.0*f[15]+150.0*f[14]-75.0*f[10]+75.0*f[9]-150.0*f[8]+150.0*f[7])+(270.0*f[111]-270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]-225.0*f[30]+225.0*f[24]-225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]+225.0*f[77]+450.0*f[73]-450.0*f[72]-180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]+150.0*f[2]-150.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-180.0*f[80]-450.0*f[73]+450.0*f[72]+180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]+225.0*f[30]-270.0*f[25]-225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]-150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]-405.0*f[101]+405.0*f[90]-225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]-360.0*f[98]-144.0*f[95]+144.0*f[94]+360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]+270.0*f[101]-216.0*f[92]+216.0*f[91]-270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]-135.0*f[102]+135.0*f[101]-360.0*f[99]+360.0*f[98]+144.0*f[95]-144.0*f[94]+216.0*f[92]-216.0*f[91]-135.0*f[90]-360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]-135.0*f[46]+135.0*f[41]-135.0*f[40])*vcut_lR4+(144.0*f[106]-144.0*f[105]-144.0*f[97]-144.0*f[96]-144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]-72.0*f[47]+90.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-90.0*f[41]+90.0*f[40]+180.0*f[36]-180.0*f[35]-72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]-144.0*f[87]-72.0*f[48]+72.0*f[47]+45.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-45.0*f[41]+45.0*f[40]-180.0*f[36]+180.0*f[35]+72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]-405.0*f[77]+405.0*f[65]-225.0*f[19])*vcut_lR4+(432.0*f[111]-432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]-360.0*f[30]+360.0*f[24]-360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]+270.0*f[77]+540.0*f[73]-540.0*f[72]-216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]+180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]-216.0*f[80]-135.0*f[78]+135.0*f[77]-540.0*f[73]+540.0*f[72]+216.0*f[69]-216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]-180.0*f[2]+180.0*f[1])+(648.0*f[53]-360.0*f[15]+360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]-540.0*f[14]+540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]+360.0*f[15]+540.0*f[14]-360.0*f[10]+360.0*f[9]-540.0*f[8]+540.0*f[7])+(3645.0*f[110]-2025.0*f[79]+2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]-540.0*f[12]+540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-540.0*f[13]+540.0*f[12]+600.0*f[11]-540.0*f[6]+300.0*f[0])+(3240.0*f[109]+720.0*f[84]-720.0*f[83]-1800.0*f[76]-720.0*f[75]-720.0*f[74]+1800.0*f[64]-1800.0*f[63]-720.0*f[60]+720.0*f[59]+1080.0*f[29]-1080.0*f[28]+1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]-1080.0*f[81]+1350.0*f[79]-1080.0*f[71]-1080.0*f[70]-1350.0*f[67]+1350.0*f[66]-1080.0*f[57]+1080.0*f[56]+1620.0*f[27]-1620.0*f[26]+1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]-720.0*f[84]+720.0*f[83]-1080.0*f[82]+1080.0*f[81]+675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1080.0*f[71]+1080.0*f[70]-675.0*f[67]+675.0*f[66]-1800.0*f[64]+1800.0*f[63]+720.0*f[60]-720.0*f[59]+1080.0*f[57]-1080.0*f[56]-1080.0*f[29]+1080.0*f[28]-1620.0*f[27]+1620.0*f[26]-1080.0*f[22]-1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]-270.0*f[79]+270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]-90.0*f[83]-225.0*f[76]-90.0*f[75]-90.0*f[74]+225.0*f[64]-225.0*f[63]-90.0*f[60]+90.0*f[59]+135.0*f[29]-135.0*f[28]+135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]-120.0*f[81]+300.0*f[79]-120.0*f[71]-120.0*f[70]-300.0*f[67]+300.0*f[66]-120.0*f[57]+120.0*f[56]+180.0*f[27]-180.0*f[26]+180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]+60.0*f[83]+150.0*f[76]+60.0*f[75]+60.0*f[74]-150.0*f[64]+150.0*f[63]+60.0*f[60]-60.0*f[59]-90.0*f[29]+90.0*f[28]-90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]+120.0*f[81]-150.0*f[79]+120.0*f[71]+120.0*f[70]+150.0*f[67]-150.0*f[66]+120.0*f[57]-120.0*f[56]-180.0*f[27]+180.0*f[26]-180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]-30.0*f[84]+30.0*f[83]+120.0*f[79]+75.0*f[76]+30.0*f[75]+30.0*f[74]-120.0*f[67]+120.0*f[66]-75.0*f[64]+75.0*f[63]+30.0*f[60]-30.0*f[59]-45.0*f[29]+45.0*f[28]-45.0*f[22]+25.0*f[4])+(405.0*f[55]-405.0*f[54]+405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]-180.0*f[12]+180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])+270.0*f[54]-270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])+180.0*f[12]-180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]+135.0*f[54]-135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]-162.0*f[101]+162.0*f[90]-90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]-135.0*f[98]-54.0*f[95]+54.0*f[94]+135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]+180.0*f[101]-72.0*f[92]+72.0*f[91]-180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]+90.0*f[98]+36.0*f[95]-36.0*f[94]-90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]-90.0*f[101]+72.0*f[92]-72.0*f[91]+90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]+72.0*f[101]-45.0*f[99]+45.0*f[98]+18.0*f[95]-18.0*f[94]-72.0*f[90]-45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]-90.0*f[46]+90.0*f[41]-90.0*f[40])*vcut_lR5+(90.0*f[106]-90.0*f[105]-90.0*f[97]-90.0*f[96]-90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]-40.0*f[47]+100.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-100.0*f[41]+100.0*f[40]+100.0*f[36]-100.0*f[35]-40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])+60.0*f[105]+60.0*f[97]+60.0*f[96]+60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]+40.0*f[47]-50.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+50.0*f[41]-50.0*f[40]-100.0*f[36]+100.0*f[35]+40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]+30.0*f[105]-72.0*f[100]+30.0*f[97]+30.0*f[96]+30.0*f[88]-30.0*f[87]+40.0*f[46]-40.0*f[41]+40.0*f[40]))+(810.0*f[78]-810.0*f[77]+810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]-225.0*f[15]+225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]-300.0*f[14]+300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])+150.0*f[15]-150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])+300.0*f[14]-300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]+75.0*f[15]-75.0*f[10]+75.0*f[9])+(810.0*f[111]-810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]-675.0*f[30]+675.0*f[24]-675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]+900.0*f[77]+900.0*f[73]-900.0*f[72]-360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]+300.0*f[2]-300.0*f[1])*vcut_lR3+((-540.0*f[111])+540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]+450.0*f[30]-450.0*f[24]+450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]-450.0*f[77]-900.0*f[73]+900.0*f[72]+360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]-300.0*f[2]+300.0*f[1])*vcut_l-270.0*f[111]+270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]+225.0*f[30]-225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[6][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[6][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[6][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[6][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[6][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[6][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_7 
  vcutSq = 0.025*(1.732050807568877*((-21.21320343559643*phiWall[18])+21.21320343559643*phi[18]+14.14213562373095*phiWall[3]-14.14213562373095*phi[3])+3.872983346207417*(3.872983346207417*(2.828427124746191*phiWall[15]-2.828427124746191*phi[15]-1.414213562373095*phiWall[12]+1.414213562373095*phi[12])-7.071067811865476*phiWall[14]+7.071067811865476*phi[14]+5.656854249492382*phiWall[13]-5.656854249492382*phi[13])+2.23606797749979*(14.14213562373095*phiWall[9]-14.14213562373095*phi[9]-7.071067811865476*phiWall[8]+7.071067811865476*phi[8]+5.656854249492382*phiWall[7]-5.656854249492382*phi[7]+1.732050807568877*(8.485281374238571*phiWall[5]-8.485281374238571*phi[5])+8.485281374238571*phiWall[1]-8.485281374238571*phi[1])+14.14213562373095*phiWall[0]-14.14213562373095*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[7][0] = 0.0; 
  fReflSurfXY[7][1] = 0.0; 
  fReflSurfXY[7][2] = 0.0; 
  fReflSurfXY[7][3] = 0.0; 
  fReflSurfXY[7][4] = 0.0; 
  fReflSurfXY[7][5] = 0.0; 
  fReflSurfXY[7][6] = 0.0; 
  fReflSurfXY[7][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[7][0] = 0.03535533905932736*(8.660254037844386*(2.0*f[3]-3.0*f[57])+3.872983346207417*(3.872983346207417*(2.0*f[35]-1.0*f[32])-5.0*f[34]+4.0*f[33])+2.23606797749979*(5.0*(2.0*f[18]-1.0*f[17])+4.0*f[16]+2.0*(5.196152422706631*f[7]+2.0*f[1]))+10.0*f[0]); 
  fReflSurfXY[7][1] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[88]-1.732050807568877*(5.0*(2.0*f[39]-1.0*f[38])+4.0*f[37]))-90.0*f[63]+2.23606797749979*(5.196152422706631*(5.0*f[62]-1.0*(4.0*f[61]+6.0*f[23]))-18.0*f[9])+5.0*(9.0*f[60]-2.0*(5.196152422706631*f[11]+2.0*f[4]))); 
  fReflSurfXY[7][2] = -0.01178511301977579*(3.872983346207417*(20.12461179749811*f[92]-1.732050807568877*(5.0*(2.0*f[45]-1.0*f[44])+4.0*f[43]))-90.0*f[72]+2.23606797749979*(5.196152422706631*(5.0*f[71]-1.0*(4.0*f[70]+6.0*f[26]))-18.0*f[12])+5.0*(9.0*f[69]-2.0*(5.196152422706631*f[14]+2.0*f[5]))); 
  fReflSurfXY[7][3] = 0.03535533905932736*(8.660254037844386*(2.0*f[30]-3.0*f[108])+3.872983346207417*(3.872983346207417*(2.0*f[98]-1.0*f[95])-5.0*f[97]+4.0*f[96])+2.23606797749979*(5.0*(2.0*f[76]-1.0*f[75])+4.0*f[74]+2.0*(5.196152422706631*f[54]+2.0*f[28]))+10.0*f[15]); 
  fReflSurfXY[7][4] = 0.07071067811865474*(11.61895003862225*f[66]+3.872983346207417*(2.23606797749979*f[42]+1.732050807568877*f[40])+5.0*f[19]); 
  fReflSurfXY[7][5] = 0.07071067811865474*(11.61895003862225*f[81]+3.872983346207417*(2.23606797749979*f[49]+1.732050807568877*f[47])+5.0*f[20]); 
  fReflSurfXY[7][6] = 0.07071067811865474*(11.61895003862225*f[101]+3.872983346207417*(2.23606797749979*f[79]+1.732050807568877*f[77])+5.0*f[46]); 
  fReflSurfXY[7][7] = 0.07071067811865474*(11.61895003862225*f[105]+3.872983346207417*(2.23606797749979*f[85]+1.732050807568877*f[83])+5.0*f[50]); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]-18.0*f[92]+4.0*f[50]-8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[40])*vcut_lR3+((-12.0*f[105])-15.0*f[97]+12.0*f[96]+15.0*f[88])*vcut_lR2+((-8.0*f[47])-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88]-8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[66])*vcut_lR3+((-12.0*f[83])+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[63]+15.0*f[60]+18.0*f[28]-10.0*f[4])*vcut_lR2+((-24.0*f[81])-30.0*f[79]-30.0*f[71]+24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l+12.0*f[83]-24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[71]+24.0*f[70]+30.0*f[63]-15.0*f[60]+30.0*f[57]-18.0*f[28]+36.0*f[26]+10.0*f[4]-20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(36.0*f[12]-20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]+30.0*f[11]-20.0*f[0])+(90.0*f[77]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[9])*vcut_lR2+(60.0*f[14]-60.0*f[7])*vcut_l-30.0*f[15]+60.0*f[14]+30.0*f[9]-60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[30]-90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]+180.0*f[72]-90.0*f[69]-75.0*f[62]+60.0*f[61]-90.0*f[30]+90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]-225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2-135.0*f[101]+360.0*f[98]-180.0*f[95]+270.0*f[92]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+((-144.0*f[105])-180.0*f[97]+144.0*f[96]+180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2-144.0*f[105]-180.0*f[97]+144.0*f[96]+180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]-225.0*f[19])*vcut_lR4+((-540.0*f[108])-240.0*f[85]+300.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2-540.0*f[108]-240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]+300.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[14]-540.0*f[7])*vcut_lR2+360.0*f[15]-540.0*f[14]-360.0*f[9]+540.0*f[7])+(2025.0*f[79]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]-600.0*f[11])*vcut_lR3+(540.0*f[12]-300.0*f[0])*vcut_lR2+1080.0*f[54]-540.0*f[12]-600.0*f[11]+300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]+1080.0*f[28]-600.0*f[4])*vcut_lR3+((-1080.0*f[81])-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]+1350.0*f[66]+1350.0*f[57]+1620.0*f[26]-900.0*f[3])*vcut_lR2-720.0*f[83]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1350.0*f[71]-1080.0*f[70]+675.0*f[66]-1800.0*f[63]+900.0*f[60]-1350.0*f[57]+1080.0*f[28]-1620.0*f[26]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l+144.0*f[101]-90.0*f[98]+45.0*f[95]+20.0*f[50]-80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[40])*vcut_lR5+((-180.0*f[105])-225.0*f[97]+180.0*f[96]+225.0*f[88])*vcut_lR4+((-80.0*f[47])-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+(120.0*f[105]+150.0*f[97]-120.0*f[96]-150.0*f[88])*vcut_lR2+(80.0*f[47]+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l+60.0*f[105]+75.0*f[97]-60.0*f[96]-75.0*f[88]+80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[66])*vcut_lR5+((-180.0*f[83])+450.0*f[76]-225.0*f[75]+180.0*f[74]-450.0*f[63]+225.0*f[60]+270.0*f[28]-150.0*f[4])*vcut_lR4+((-240.0*f[81])-600.0*f[79]-300.0*f[71]+240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+(120.0*f[83]-300.0*f[76]+150.0*f[75]-120.0*f[74]+300.0*f[63]-150.0*f[60]-180.0*f[28]+100.0*f[4])*vcut_lR2+(240.0*f[81]+300.0*f[79]+300.0*f[71]-240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l+60.0*f[83]+240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]-240.0*f[66]+150.0*f[63]-75.0*f[60]-90.0*f[28]+50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(360.0*f[12]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(200.0*f[0]-360.0*f[12])*vcut_l-270.0*f[54]+150.0*f[11])+(1620.0*f[77]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[9])*vcut_lR4+(600.0*f[14]-600.0*f[7])*vcut_lR3+(300.0*f[9]-300.0*f[15])*vcut_lR2+(600.0*f[7]-600.0*f[14])*vcut_l-150.0*f[15]+150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]+1350.0*f[30]-1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]-900.0*f[30]+900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]+720.0*f[77]-375.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[23]-400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]-10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]-4.0*f[50]-10.0*f[39]+5.0*f[38]-4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]-8.0*f[49]+10.0*f[42]+10.0*f[34]-8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]+18.0*f[92]+4.0*f[50]+8.0*f[49]+10.0*f[39]-5.0*f[38]+4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[46]-10.0*f[40])*vcut_lR3+((-12.0*f[105])-15.0*f[97]+12.0*f[96]+15.0*f[88])*vcut_lR2+((-8.0*f[47])-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]+10.0*f[40]-20.0*f[35]+10.0*f[32])*vcut_l+12.0*f[105]+15.0*f[97]-12.0*f[96]-15.0*f[88]+8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]-30.0*f[66])*vcut_lR3+((-12.0*f[83])+30.0*f[76]-15.0*f[75]+12.0*f[74]-30.0*f[63]+15.0*f[60]+18.0*f[28]-10.0*f[4])*vcut_lR2+((-24.0*f[81])-30.0*f[79]-30.0*f[71]+24.0*f[70]+30.0*f[66]+30.0*f[57]+36.0*f[26]-20.0*f[3])*vcut_l+12.0*f[83]+24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[71]-24.0*f[70]+30.0*f[63]-15.0*f[60]-30.0*f[57]-18.0*f[28]-36.0*f[26]+10.0*f[4]+20.0*f[3])+(54.0*f[54]-30.0*f[11])*vcut_lR2+(36.0*f[12]-20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]+30.0*f[11]+20.0*f[0])+(90.0*f[77]-50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]-30.0*f[9])*vcut_lR2+(60.0*f[14]-60.0*f[7])*vcut_l-30.0*f[15]-60.0*f[14]+30.0*f[9]+60.0*f[7])+((-135.0*f[108])-60.0*f[85]+75.0*f[62]-60.0*f[61]+90.0*f[30]-90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]-40.0*f[20]+50.0*f[19]-100.0*f[18]+50.0*f[17]-40.0*f[16]+60.0*f[5]-60.0*f[1])*vcut_l+135.0*f[108]+60.0*f[85]-180.0*f[72]+90.0*f[69]-75.0*f[62]+60.0*f[61]-90.0*f[30]+90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]-60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]-225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]-80.0*f[50]-200.0*f[39]+100.0*f[38]-80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]-120.0*f[49]+150.0*f[42]+150.0*f[34]-120.0*f[33])*vcut_lR2-135.0*f[101]-360.0*f[98]+180.0*f[95]+270.0*f[92]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]-150.0*f[34]+120.0*f[33])+2.23606797749979*((135.0*f[46]-135.0*f[40])*vcut_lR4+((-144.0*f[105])-180.0*f[97]+144.0*f[96]+180.0*f[88])*vcut_lR3+((-72.0*f[47])-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]+90.0*f[40]-180.0*f[35]+90.0*f[32])*vcut_lR2+144.0*f[105]+180.0*f[97]-144.0*f[96]-180.0*f[88]+72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]+45.0*f[40]+180.0*f[35]-90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]-225.0*f[19])*vcut_lR4+((-540.0*f[108])-240.0*f[85]+300.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]-120.0*f[20]+150.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[1])*vcut_lR2+540.0*f[108]+240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]-300.0*f[62]+240.0*f[61]-360.0*f[30]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[1])+(360.0*f[15]-360.0*f[9])*vcut_lR3+(540.0*f[14]-540.0*f[7])*vcut_lR2-360.0*f[15]-540.0*f[14]+360.0*f[9]+540.0*f[7])+(2025.0*f[79]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]-600.0*f[11])*vcut_lR3+(540.0*f[12]-300.0*f[0])*vcut_lR2-1080.0*f[54]-540.0*f[12]+600.0*f[11]+300.0*f[0])+((-720.0*f[83])+1800.0*f[76]-900.0*f[75]+720.0*f[74]-1800.0*f[63]+900.0*f[60]+1080.0*f[28]-600.0*f[4])*vcut_lR3+((-1080.0*f[81])-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]+1350.0*f[66]+1350.0*f[57]+1620.0*f[26]-900.0*f[3])*vcut_lR2+720.0*f[83]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]+1350.0*f[71]-1080.0*f[70]+675.0*f[66]+1800.0*f[63]-900.0*f[60]-1350.0*f[57]-1080.0*f[28]-1620.0*f[26]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]-180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]-60.0*f[50]-150.0*f[39]+75.0*f[38]-60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]-80.0*f[49]+200.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]+40.0*f[50]+100.0*f[39]-50.0*f[38]+40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]+80.0*f[49]-100.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_l-144.0*f[101]-90.0*f[98]+45.0*f[95]+20.0*f[50]+80.0*f[42]+50.0*f[39]-25.0*f[38]+20.0*f[37])+1.732050807568877*((180.0*f[46]-180.0*f[40])*vcut_lR5+((-180.0*f[105])-225.0*f[97]+180.0*f[96]+225.0*f[88])*vcut_lR4+((-80.0*f[47])-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]+200.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_lR3+(120.0*f[105]+150.0*f[97]-120.0*f[96]-150.0*f[88])*vcut_lR2+(80.0*f[47]+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]-100.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_l+60.0*f[105]+75.0*f[97]-60.0*f[96]-75.0*f[88]-80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]-540.0*f[66])*vcut_lR5+((-180.0*f[83])+450.0*f[76]-225.0*f[75]+180.0*f[74]-450.0*f[63]+225.0*f[60]+270.0*f[28]-150.0*f[4])*vcut_lR4+((-240.0*f[81])-600.0*f[79]-300.0*f[71]+240.0*f[70]+600.0*f[66]+300.0*f[57]+360.0*f[26]-200.0*f[3])*vcut_lR3+(120.0*f[83]-300.0*f[76]+150.0*f[75]-120.0*f[74]+300.0*f[63]-150.0*f[60]-180.0*f[28]+100.0*f[4])*vcut_lR2+(240.0*f[81]+300.0*f[79]+300.0*f[71]-240.0*f[70]-300.0*f[66]-300.0*f[57]-360.0*f[26]+200.0*f[3])*vcut_l+60.0*f[83]-240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]+240.0*f[66]+150.0*f[63]-75.0*f[60]-90.0*f[28]+50.0*f[4])+(810.0*f[54]-450.0*f[11])*vcut_lR4+(360.0*f[12]-200.0*f[0])*vcut_lR3+(300.0*f[11]-540.0*f[54])*vcut_lR2+(200.0*f[0]-360.0*f[12])*vcut_l-270.0*f[54]+150.0*f[11])+(1620.0*f[77]-900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]-450.0*f[9])*vcut_lR4+(600.0*f[14]-600.0*f[7])*vcut_lR3+(300.0*f[9]-300.0*f[15])*vcut_lR2+(600.0*f[7]-600.0*f[14])*vcut_l-150.0*f[15]+150.0*f[9])+((-2025.0*f[108])-900.0*f[85]+1125.0*f[62]-900.0*f[61]+1350.0*f[30]-1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]-400.0*f[20]+1000.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]+600.0*f[5]-600.0*f[1])*vcut_lR3+(1350.0*f[108]+600.0*f[85]-750.0*f[62]+600.0*f[61]-900.0*f[30]+900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]+400.0*f[20]-500.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]-600.0*f[5]+600.0*f[1])*vcut_l+675.0*f[108]+300.0*f[85]-720.0*f[77]-375.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[23]+400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[66]*vcut_lR3+((-15.0*f[83])+30.0*f[63]-15.0*f[60]+10.0*f[4])*vcut_lR2+((-30.0*f[81])-30.0*f[66]-30.0*f[57]+20.0*f[3])*vcut_l+15.0*f[83]-30.0*f[81]-30.0*f[63]+15.0*f[60]-30.0*f[57]-10.0*f[4]+20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]+20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+5.0*f[50]-10.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*(10.0*f[40]*vcut_lR3+((-15.0*f[105])-15.0*f[88])*vcut_lR2+((-10.0*f[47])-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]-10.0*f[47]+20.0*f[35]-10.0*f[32]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[9]*vcut_lR2+60.0*f[7]*vcut_l-30.0*f[9]+60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]+90.0*f[23])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]-50.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+((-20.0*f[50])+40.0*f[39]-20.0*f[38]+16.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]-30.0*f[34]+24.0*f[33])*vcut_lR2-20.0*f[50]+30.0*f[49]-15.0*f[42]+40.0*f[39]-20.0*f[38]+16.0*f[37]+30.0*f[34]-24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+((-36.0*f[105])-36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2-36.0*f[105]-36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-60.0*f[85])-60.0*f[62]+48.0*f[61]+72.0*f[23])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]+36.0*f[1])*vcut_lR2-60.0*f[85]-60.0*f[62]+48.0*f[61]+72.0*f[23]+30.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3+108.0*f[7]*vcut_lR2+72.0*f[9]-108.0*f[7])+405.0*f[66]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2+120.0*f[11]-60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]+120.0*f[4])*vcut_lR3+((-270.0*f[81])-270.0*f[66]-270.0*f[57]+180.0*f[3])*vcut_lR2-180.0*f[83]+270.0*f[81]-135.0*f[66]+360.0*f[63]-180.0*f[60]+270.0*f[57]+120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = 0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[66]*vcut_lR5+((-45.0*f[83])+90.0*f[63]-45.0*f[60]+30.0*f[4])*vcut_lR4+((-60.0*f[81])-120.0*f[66]-60.0*f[57]+40.0*f[3])*vcut_lR3+(30.0*f[83]-60.0*f[63]+30.0*f[60]-20.0*f[4])*vcut_lR2+(60.0*f[81]+60.0*f[66]+60.0*f[57]-40.0*f[3])*vcut_l+15.0*f[83]+48.0*f[66]-30.0*f[63]+15.0*f[60]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]+12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]-8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l+5.0*f[50]+16.0*f[42]-10.0*f[39]+5.0*f[38]-4.0*f[37])+1.732050807568877*(36.0*f[40]*vcut_lR5+((-45.0*f[105])-45.0*f[88])*vcut_lR4+((-20.0*f[47])-40.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_lR3+(30.0*f[105]+30.0*f[88])*vcut_lR2+(20.0*f[47]+20.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]+16.0*f[40]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[9]*vcut_lR4+120.0*f[7]*vcut_lR3-60.0*f[9]*vcut_lR2-120.0*f[7]*vcut_l-30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]+270.0*f[23])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]+120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]-180.0*f[23])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]-120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]+80.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(2.23606797749979*(1.732050807568877*(30.0*f[66]*vcut_lR3+((-15.0*f[83])+30.0*f[63]-15.0*f[60]+10.0*f[4])*vcut_lR2+((-30.0*f[81])-30.0*f[66]-30.0*f[57]+20.0*f[3])*vcut_l+15.0*f[83]+30.0*f[81]-30.0*f[63]+15.0*f[60]+30.0*f[57]-10.0*f[4]-20.0*f[3])+30.0*f[11]*vcut_lR2+20.0*f[0]*vcut_l-30.0*f[11]-20.0*f[0])+3.872983346207417*(2.23606797749979*(10.0*f[42]*vcut_lR3+((-5.0*f[50])+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-10.0*f[49])-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l+5.0*f[50]+10.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*(10.0*f[40]*vcut_lR3+((-15.0*f[105])-15.0*f[88])*vcut_lR2+((-10.0*f[47])-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]+10.0*f[47]-20.0*f[35]+10.0*f[32]))+50.0*f[19]*vcut_lR3+1.732050807568877*(30.0*f[9]*vcut_lR2+60.0*f[7]*vcut_l-30.0*f[9]-60.0*f[7])+((-75.0*f[85])-75.0*f[62]+60.0*f[61]+90.0*f[23])*vcut_lR2+((-50.0*f[20])-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]+50.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -0.001041666666666667*(3.872983346207417*(1.732050807568877*(45.0*f[42]*vcut_lR4+((-20.0*f[50])+40.0*f[39]-20.0*f[38]+16.0*f[37])*vcut_lR3+((-30.0*f[49])-30.0*f[42]-30.0*f[34]+24.0*f[33])*vcut_lR2+20.0*f[50]+30.0*f[49]-15.0*f[42]-40.0*f[39]+20.0*f[38]-16.0*f[37]+30.0*f[34]-24.0*f[33])+2.23606797749979*(27.0*f[40]*vcut_lR4+((-36.0*f[105])-36.0*f[88])*vcut_lR3+((-18.0*f[47])-18.0*f[40]+36.0*f[35]-18.0*f[32])*vcut_lR2+36.0*f[105]+36.0*f[88]+18.0*f[47]-9.0*f[40]-36.0*f[35]+18.0*f[32]))+2.23606797749979*(1.732050807568877*(45.0*f[19]*vcut_lR4+((-60.0*f[85])-60.0*f[62]+48.0*f[61]+72.0*f[23])*vcut_lR3+((-30.0*f[20])-30.0*f[19]+60.0*f[18]-30.0*f[17]+24.0*f[16]+36.0*f[1])*vcut_lR2+60.0*f[85]+60.0*f[62]-48.0*f[61]-72.0*f[23]+30.0*f[20]-15.0*f[19]-60.0*f[18]+30.0*f[17]-24.0*f[16]-36.0*f[1])+72.0*f[9]*vcut_lR3+108.0*f[7]*vcut_lR2-72.0*f[9]-108.0*f[7])+405.0*f[66]*vcut_lR4+1.732050807568877*(120.0*f[11]*vcut_lR3+60.0*f[0]*vcut_lR2-120.0*f[11]-60.0*f[0])+((-180.0*f[83])+360.0*f[63]-180.0*f[60]+120.0*f[4])*vcut_lR3+((-270.0*f[81])-270.0*f[66]-270.0*f[57]+180.0*f[3])*vcut_lR2+180.0*f[83]+270.0*f[81]-135.0*f[66]-360.0*f[63]+180.0*f[60]+270.0*f[57]-120.0*f[4]-180.0*f[3]); 
  fReflSurfXYMu[1][2] = -0.0015625*(2.23606797749979*(1.732050807568877*(108.0*f[66]*vcut_lR5+((-45.0*f[83])+90.0*f[63]-45.0*f[60]+30.0*f[4])*vcut_lR4+((-60.0*f[81])-120.0*f[66]-60.0*f[57]+40.0*f[3])*vcut_lR3+(30.0*f[83]-60.0*f[63]+30.0*f[60]-20.0*f[4])*vcut_lR2+(60.0*f[81]+60.0*f[66]+60.0*f[57]-40.0*f[3])*vcut_l+15.0*f[83]-48.0*f[66]-30.0*f[63]+15.0*f[60]-10.0*f[4])+90.0*f[11]*vcut_lR4+40.0*f[0]*vcut_lR3-60.0*f[11]*vcut_lR2-40.0*f[0]*vcut_l-30.0*f[11])+3.872983346207417*(2.23606797749979*(36.0*f[42]*vcut_lR5+((-15.0*f[50])+30.0*f[39]-15.0*f[38]+12.0*f[37])*vcut_lR4+((-20.0*f[49])-40.0*f[42]-20.0*f[34]+16.0*f[33])*vcut_lR3+(10.0*f[50]-20.0*f[39]+10.0*f[38]-8.0*f[37])*vcut_lR2+(20.0*f[49]+20.0*f[42]+20.0*f[34]-16.0*f[33])*vcut_l+5.0*f[50]-16.0*f[42]-10.0*f[39]+5.0*f[38]-4.0*f[37])+1.732050807568877*(36.0*f[40]*vcut_lR5+((-45.0*f[105])-45.0*f[88])*vcut_lR4+((-20.0*f[47])-40.0*f[40]+40.0*f[35]-20.0*f[32])*vcut_lR3+(30.0*f[105]+30.0*f[88])*vcut_lR2+(20.0*f[47]+20.0*f[40]-40.0*f[35]+20.0*f[32])*vcut_l+15.0*f[105]+15.0*f[88]-16.0*f[40]))+180.0*f[19]*vcut_lR5+1.732050807568877*(90.0*f[9]*vcut_lR4+120.0*f[7]*vcut_lR3-60.0*f[9]*vcut_lR2-120.0*f[7]*vcut_l-30.0*f[9])+((-225.0*f[85])-225.0*f[62]+180.0*f[61]+270.0*f[23])*vcut_lR4+((-100.0*f[20])-200.0*f[19]+200.0*f[18]-100.0*f[17]+80.0*f[16]+120.0*f[1])*vcut_lR3+(150.0*f[85]+150.0*f[62]-120.0*f[61]-180.0*f[23])*vcut_lR2+(100.0*f[20]+100.0*f[19]-200.0*f[18]+100.0*f[17]-80.0*f[16]-120.0*f[1])*vcut_l+75.0*f[85]+75.0*f[62]-60.0*f[61]-90.0*f[23]-80.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]-18.0*f[92]-4.0*f[50]+8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]-10.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[40])*vcut_lR3+(12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88])*vcut_lR2+(8.0*f[47]-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-12.0*f[105]+15.0*f[97]-12.0*f[96]+15.0*f[88]+8.0*f[47]+20.0*f[45]-10.0*f[44]+8.0*f[43]+20.0*f[35]-10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[66])*vcut_lR3+(12.0*f[83]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[63]-15.0*f[60]+18.0*f[28]+10.0*f[4])*vcut_lR2+(24.0*f[81]-30.0*f[79]-30.0*f[71]+24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l-12.0*f[83]+24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]-30.0*f[71]+24.0*f[70]-30.0*f[63]+15.0*f[60]-30.0*f[57]-18.0*f[28]+36.0*f[26]-10.0*f[4]+20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+(36.0*f[12]+20.0*f[0])*vcut_l-54.0*f[54]+36.0*f[12]-30.0*f[11]+20.0*f[0])+(90.0*f[77]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[9])*vcut_lR2+(60.0*f[14]+60.0*f[7])*vcut_l-30.0*f[15]+60.0*f[14]-30.0*f[9]+60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]+90.0*f[30]+90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]+180.0*f[72]-90.0*f[69]+75.0*f[62]-60.0*f[61]-90.0*f[30]-90.0*f[23]+40.0*f[20]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]+60.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]+225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2-135.0*f[101]+360.0*f[98]-180.0*f[95]+270.0*f[92]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]-100.0*f[38]+80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+(144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2+144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]+225.0*f[19])*vcut_lR4+((-540.0*f[108])+240.0*f[85]-300.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2-540.0*f[108]+240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]-300.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+(540.0*f[14]+540.0*f[7])*vcut_lR2+360.0*f[15]-540.0*f[14]+360.0*f[9]-540.0*f[7])+(2025.0*f[79]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]+600.0*f[11])*vcut_lR3+(540.0*f[12]+300.0*f[0])*vcut_lR2+1080.0*f[54]-540.0*f[12]+600.0*f[11]-300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]+1080.0*f[28]+600.0*f[4])*vcut_lR3+(1080.0*f[81]-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]-1350.0*f[66]-1350.0*f[57]+1620.0*f[26]+900.0*f[3])*vcut_lR2+720.0*f[83]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1350.0*f[71]-1080.0*f[70]-675.0*f[66]+1800.0*f[63]-900.0*f[60]+1350.0*f[57]+1080.0*f[28]-1620.0*f[26]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l+144.0*f[101]-90.0*f[98]+45.0*f[95]-20.0*f[50]+80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[40])*vcut_lR5+(180.0*f[105]-225.0*f[97]+180.0*f[96]-225.0*f[88])*vcut_lR4+(80.0*f[47]-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+((-120.0*f[105])+150.0*f[97]-120.0*f[96]+150.0*f[88])*vcut_lR2+((-80.0*f[47])+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l-60.0*f[105]+75.0*f[97]-60.0*f[96]+75.0*f[88]+80.0*f[46]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[66])*vcut_lR5+(180.0*f[83]+450.0*f[76]-225.0*f[75]+180.0*f[74]+450.0*f[63]-225.0*f[60]+270.0*f[28]+150.0*f[4])*vcut_lR4+(240.0*f[81]-600.0*f[79]-300.0*f[71]+240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+((-120.0*f[83])-300.0*f[76]+150.0*f[75]-120.0*f[74]-300.0*f[63]+150.0*f[60]-180.0*f[28]-100.0*f[4])*vcut_lR2+((-240.0*f[81])+300.0*f[79]+300.0*f[71]-240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l-60.0*f[83]+240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]+240.0*f[66]-150.0*f[63]+75.0*f[60]-90.0*f[28]-50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+(360.0*f[12]+200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+((-360.0*f[12])-200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+(1620.0*f[77]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[9])*vcut_lR4+(600.0*f[14]+600.0*f[7])*vcut_lR3+((-300.0*f[15])-300.0*f[9])*vcut_lR2+((-600.0*f[14])-600.0*f[7])*vcut_l-150.0*f[15]-150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]+1350.0*f[30]+1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]-900.0*f[30]-900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]+720.0*f[77]+375.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[101]+10.0*f[42])*vcut_lR3+(18.0*f[98]-9.0*f[95]+4.0*f[50]+10.0*f[39]-5.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[101])-18.0*f[92]+8.0*f[49]-10.0*f[42]-10.0*f[34]+8.0*f[33])*vcut_l-18.0*f[98]+9.0*f[95]+18.0*f[92]-4.0*f[50]-8.0*f[49]-10.0*f[39]+5.0*f[38]-4.0*f[37]+10.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[46]+10.0*f[40])*vcut_lR3+(12.0*f[105]-15.0*f[97]+12.0*f[96]-15.0*f[88])*vcut_lR2+(8.0*f[47]-10.0*f[46]+20.0*f[45]-10.0*f[44]+8.0*f[43]-10.0*f[40]+20.0*f[35]-10.0*f[32])*vcut_l-12.0*f[105]+15.0*f[97]-12.0*f[96]+15.0*f[88]-8.0*f[47]-20.0*f[45]+10.0*f[44]-8.0*f[43]-20.0*f[35]+10.0*f[32]))+2.23606797749979*(1.732050807568877*((30.0*f[79]+30.0*f[66])*vcut_lR3+(12.0*f[83]+30.0*f[76]-15.0*f[75]+12.0*f[74]+30.0*f[63]-15.0*f[60]+18.0*f[28]+10.0*f[4])*vcut_lR2+(24.0*f[81]-30.0*f[79]-30.0*f[71]+24.0*f[70]-30.0*f[66]-30.0*f[57]+36.0*f[26]+20.0*f[3])*vcut_l-12.0*f[83]-24.0*f[81]-30.0*f[76]+15.0*f[75]-12.0*f[74]+30.0*f[71]-24.0*f[70]-30.0*f[63]+15.0*f[60]+30.0*f[57]-18.0*f[28]-36.0*f[26]-10.0*f[4]-20.0*f[3])+(54.0*f[54]+30.0*f[11])*vcut_lR2+(36.0*f[12]+20.0*f[0])*vcut_l-54.0*f[54]-36.0*f[12]-30.0*f[11]-20.0*f[0])+(90.0*f[77]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[15]+30.0*f[9])*vcut_lR2+(60.0*f[14]+60.0*f[7])*vcut_l-30.0*f[15]-60.0*f[14]-30.0*f[9]-60.0*f[7])+((-135.0*f[108])+60.0*f[85]-75.0*f[62]+60.0*f[61]+90.0*f[30]+90.0*f[23])*vcut_lR2+((-90.0*f[77])+180.0*f[72]-90.0*f[69]+40.0*f[20]-50.0*f[19]+100.0*f[18]-50.0*f[17]+40.0*f[16]+60.0*f[5]+60.0*f[1])*vcut_l+135.0*f[108]-60.0*f[85]-180.0*f[72]+90.0*f[69]+75.0*f[62]-60.0*f[61]-90.0*f[30]-90.0*f[23]-40.0*f[20]-100.0*f[18]+50.0*f[17]-40.0*f[16]-60.0*f[5]-60.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[101]+225.0*f[42])*vcut_lR4+(360.0*f[98]-180.0*f[95]+80.0*f[50]+200.0*f[39]-100.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[101])-270.0*f[92]+120.0*f[49]-150.0*f[42]-150.0*f[34]+120.0*f[33])*vcut_lR2-135.0*f[101]-360.0*f[98]+180.0*f[95]+270.0*f[92]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]+100.0*f[38]-80.0*f[37]+150.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[46]+135.0*f[40])*vcut_lR4+(144.0*f[105]-180.0*f[97]+144.0*f[96]-180.0*f[88])*vcut_lR3+(72.0*f[47]-90.0*f[46]+180.0*f[45]-90.0*f[44]+72.0*f[43]-90.0*f[40]+180.0*f[35]-90.0*f[32])*vcut_lR2-144.0*f[105]+180.0*f[97]-144.0*f[96]+180.0*f[88]-72.0*f[47]-45.0*f[46]-180.0*f[45]+90.0*f[44]-72.0*f[43]-45.0*f[40]-180.0*f[35]+90.0*f[32]))+2.23606797749979*(1.732050807568877*((405.0*f[77]+225.0*f[19])*vcut_lR4+((-540.0*f[108])+240.0*f[85]-300.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[23])*vcut_lR3+((-270.0*f[77])+540.0*f[72]-270.0*f[69]+120.0*f[20]-150.0*f[19]+300.0*f[18]-150.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[1])*vcut_lR2+540.0*f[108]-240.0*f[85]-135.0*f[77]-540.0*f[72]+270.0*f[69]+300.0*f[62]-240.0*f[61]-360.0*f[30]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]+150.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[1])+(360.0*f[15]+360.0*f[9])*vcut_lR3+(540.0*f[14]+540.0*f[7])*vcut_lR2-360.0*f[15]-540.0*f[14]-360.0*f[9]-540.0*f[7])+(2025.0*f[79]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[54]+600.0*f[11])*vcut_lR3+(540.0*f[12]+300.0*f[0])*vcut_lR2-1080.0*f[54]-540.0*f[12]-600.0*f[11]-300.0*f[0])+(720.0*f[83]+1800.0*f[76]-900.0*f[75]+720.0*f[74]+1800.0*f[63]-900.0*f[60]+1080.0*f[28]+600.0*f[4])*vcut_lR3+(1080.0*f[81]-1350.0*f[79]-1350.0*f[71]+1080.0*f[70]-1350.0*f[66]-1350.0*f[57]+1620.0*f[26]+900.0*f[3])*vcut_lR2-720.0*f[83]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]+900.0*f[75]-720.0*f[74]+1350.0*f[71]-1080.0*f[70]-675.0*f[66]-1800.0*f[63]+900.0*f[60]+1350.0*f[57]-1080.0*f[28]-1620.0*f[26]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[101]+180.0*f[42])*vcut_lR5+(270.0*f[98]-135.0*f[95]+60.0*f[50]+150.0*f[39]-75.0*f[38]+60.0*f[37])*vcut_lR4+((-360.0*f[101])-180.0*f[92]+80.0*f[49]-200.0*f[42]-100.0*f[34]+80.0*f[33])*vcut_lR3+((-180.0*f[98])+90.0*f[95]-40.0*f[50]-100.0*f[39]+50.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[101]+180.0*f[92]-80.0*f[49]+100.0*f[42]+100.0*f[34]-80.0*f[33])*vcut_l-144.0*f[101]-90.0*f[98]+45.0*f[95]-20.0*f[50]-80.0*f[42]-50.0*f[39]+25.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[46]+180.0*f[40])*vcut_lR5+(180.0*f[105]-225.0*f[97]+180.0*f[96]-225.0*f[88])*vcut_lR4+(80.0*f[47]-200.0*f[46]+200.0*f[45]-100.0*f[44]+80.0*f[43]-200.0*f[40]+200.0*f[35]-100.0*f[32])*vcut_lR3+((-120.0*f[105])+150.0*f[97]-120.0*f[96]+150.0*f[88])*vcut_lR2+((-80.0*f[47])+100.0*f[46]-200.0*f[45]+100.0*f[44]-80.0*f[43]+100.0*f[40]-200.0*f[35]+100.0*f[32])*vcut_l-60.0*f[105]+75.0*f[97]-60.0*f[96]+75.0*f[88]-80.0*f[46]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[79]+540.0*f[66])*vcut_lR5+(180.0*f[83]+450.0*f[76]-225.0*f[75]+180.0*f[74]+450.0*f[63]-225.0*f[60]+270.0*f[28]+150.0*f[4])*vcut_lR4+(240.0*f[81]-600.0*f[79]-300.0*f[71]+240.0*f[70]-600.0*f[66]-300.0*f[57]+360.0*f[26]+200.0*f[3])*vcut_lR3+((-120.0*f[83])-300.0*f[76]+150.0*f[75]-120.0*f[74]-300.0*f[63]+150.0*f[60]-180.0*f[28]-100.0*f[4])*vcut_lR2+((-240.0*f[81])+300.0*f[79]+300.0*f[71]-240.0*f[70]+300.0*f[66]+300.0*f[57]-360.0*f[26]-200.0*f[3])*vcut_l-60.0*f[83]-240.0*f[79]-150.0*f[76]+75.0*f[75]-60.0*f[74]-240.0*f[66]-150.0*f[63]+75.0*f[60]-90.0*f[28]-50.0*f[4])+(810.0*f[54]+450.0*f[11])*vcut_lR4+(360.0*f[12]+200.0*f[0])*vcut_lR3+((-540.0*f[54])-300.0*f[11])*vcut_lR2+((-360.0*f[12])-200.0*f[0])*vcut_l-270.0*f[54]-150.0*f[11])+(1620.0*f[77]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[15]+450.0*f[9])*vcut_lR4+(600.0*f[14]+600.0*f[7])*vcut_lR3+((-300.0*f[15])-300.0*f[9])*vcut_lR2+((-600.0*f[14])-600.0*f[7])*vcut_l-150.0*f[15]-150.0*f[9])+((-2025.0*f[108])+900.0*f[85]-1125.0*f[62]+900.0*f[61]+1350.0*f[30]+1350.0*f[23])*vcut_lR4+((-1800.0*f[77])+1800.0*f[72]-900.0*f[69]+400.0*f[20]-1000.0*f[19]+1000.0*f[18]-500.0*f[17]+400.0*f[16]+600.0*f[5]+600.0*f[1])*vcut_lR3+(1350.0*f[108]-600.0*f[85]+750.0*f[62]-600.0*f[61]-900.0*f[30]-900.0*f[23])*vcut_lR2+(900.0*f[77]-1800.0*f[72]+900.0*f[69]-400.0*f[20]+500.0*f[19]-1000.0*f[18]+500.0*f[17]-400.0*f[16]-600.0*f[5]-600.0*f[1])*vcut_l+675.0*f[108]-300.0*f[85]-720.0*f[77]+375.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[7][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[7][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[7][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[7][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[7][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[7][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  // node (x,y)_8 
  vcutSq = 0.01*(2.23606797749979*(63.63961030678928*phiWall[19]-63.63961030678928*phi[19]+35.35533905932738*phiWall[9]-35.35533905932738*phi[9]+14.14213562373095*phiWall[8]-14.14213562373095*phi[8]+14.14213562373095*phiWall[7]-14.14213562373095*phi[7]+1.732050807568877*(21.21320343559643*phiWall[6]-21.21320343559643*phi[6]+21.21320343559643*phiWall[5]-21.21320343559643*phi[5])+21.21320343559643*phiWall[2]-21.21320343559643*phi[2]+21.21320343559643*phiWall[1]-21.21320343559643*phi[1])+1.732050807568877*(42.42640687119286*phiWall[18]-42.42640687119286*phi[18]+42.42640687119286*phiWall[17]-42.42640687119286*phi[17]+63.63961030678928*phiWall[10]-63.63961030678928*phi[10]+35.35533905932738*phiWall[3]-35.35533905932738*phi[3])+3.872983346207417*(3.872983346207417*(7.071067811865476*phiWall[16]-7.071067811865476*phi[16]+7.071067811865476*phiWall[15]-7.071067811865476*phi[15]+2.828427124746191*phiWall[12]-2.828427124746191*phi[12]+2.828427124746191*phiWall[11]-2.828427124746191*phi[11])+14.14213562373095*phiWall[14]-14.14213562373095*phi[14]+14.14213562373095*phiWall[13]-14.14213562373095*phi[13])+63.63961030678928*phiWall[4]-63.63961030678928*phi[4]+35.35533905932738*phiWall[0]-35.35533905932738*phi[0])*q2Dm;

  if (vcutSq <= vlowerSq) { // absorb (no reflection)

  fReflSurfXY[8][0] = 0.0; 
  fReflSurfXY[8][1] = 0.0; 
  fReflSurfXY[8][2] = 0.0; 
  fReflSurfXY[8][3] = 0.0; 
  fReflSurfXY[8][4] = 0.0; 
  fReflSurfXY[8][5] = 0.0; 
  fReflSurfXY[8][6] = 0.0; 
  fReflSurfXY[8][7] = 0.0; 

  } else if (vcutSq > vupperSq) { // full reflection

  fReflSurfXY[8][0] = 0.01414213562373095*(11.18033988749895*(9.0*f[58]+5.0*f[18]+2.0*(f[17]+f[16])+5.196152422706631*(f[8]+f[7])+3.0*(f[2]+f[1]))+8.660254037844386*(3.0*(2.0*(f[57]+f[56])+3.0*f[21])+5.0*f[3])+3.872983346207417*(3.872983346207417*(5.0*(f[36]+f[35])+2.0*(f[32]+f[31]))+10.0*(f[34]+f[33]))+5.0*(9.0*f[6]+5.0*f[0])); 
  fReflSurfXY[8][1] = 0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[89]+5.0*f[39]+2.0*(f[38]+f[37]))+40.24922359499622*(f[88]+f[87]))+225.0*(f[64]+f[63])+11.18033988749895*(5.196152422706631*(2.0*(f[62]+f[61])+3.0*(f[24]+f[23]))+9.0*(f[10]+f[9]))+5.0*(18.0*(f[60]+f[59])+5.196152422706631*(9.0*f[51]+5.0*f[11])+3.0*(9.0*f[22]+5.0*f[4]))); 
  fReflSurfXY[8][2] = 0.004714045207910316*(3.872983346207417*(8.660254037844386*(9.0*f[93]+5.0*f[45]+2.0*(f[44]+f[43]))+40.24922359499622*(f[92]+f[91]))+225.0*(f[73]+f[72])+11.18033988749895*(5.196152422706631*(2.0*(f[71]+f[70])+3.0*(f[27]+f[26]))+9.0*(f[13]+f[12]))+5.0*(18.0*(f[69]+f[68])+5.196152422706631*(9.0*f[52]+5.0*f[14])+3.0*(9.0*f[25]+5.0*f[5]))); 
  fReflSurfXY[8][3] = 0.01414213562373095*(11.18033988749895*(9.0*f[109]+5.0*f[76]+2.0*(f[75]+f[74])+5.196152422706631*(f[55]+f[54])+3.0*(f[29]+f[28]))+8.660254037844386*(3.0*(2.0*(f[108]+f[107])+3.0*f[86])+5.0*f[30])+3.872983346207417*(3.872983346207417*(5.0*(f[99]+f[98])+2.0*(f[95]+f[94]))+10.0*(f[97]+f[96]))+5.0*(9.0*f[53]+5.0*f[15])); 
  fReflSurfXY[8][4] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[90]+5.0*f[42])+8.660254037844386*(f[41]+f[40]))+58.09475019311126*(f[67]+f[66])+5.0*(9.0*f[65]+5.0*f[19])); 
  fReflSurfXY[8][5] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[103]+5.0*f[49])+8.660254037844386*(f[48]+f[47]))+58.09475019311126*(f[82]+f[81])+5.0*(9.0*f[80]+5.0*f[20])); 
  fReflSurfXY[8][6] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[110]+5.0*f[79])+8.660254037844386*(f[78]+f[77]))+58.09475019311126*(f[102]+f[101])+5.0*(9.0*f[100]+5.0*f[46])); 
  fReflSurfXY[8][7] = 0.01414213562373095*(3.872983346207417*(2.23606797749979*(9.0*f[111]+5.0*f[85])+8.660254037844386*(f[84]+f[83]))+58.09475019311126*(f[106]+f[105])+5.0*(9.0*f[104]+5.0*f[50])); 

  } else { // partial reflection

    double xBar, xSqBar;
    double fReflSurfXYMu[3][8] = {0.}; 

    // node (mu)_0 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]+30.0*f[83]-60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-60.0*f[57]-60.0*f[56]-45.0*f[29]-45.0*f[28]+90.0*f[27]+90.0*f[26]+45.0*f[22]-90.0*f[21]+25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+90.0*f[13]+90.0*f[12]+75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]-36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+36.0*f[92]+36.0*f[91]+45.0*f[89]+10.0*f[50]-20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]+30.0*f[88]+30.0*f[87]-20.0*f[48]-20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+(225.0*f[78]+225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]-75.0*f[15]+150.0*f[14]+75.0*f[10]+75.0*f[9]-150.0*f[8]-150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+150.0*f[62]+150.0*f[61]-450.0*f[58]-225.0*f[30]+270.0*f[25]+225.0*f[24]+225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[0][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2-144.0*f[104]+216.0*f[103]-135.0*f[102]-135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-216.0*f[92]-216.0*f[91]+135.0*f[90]-360.0*f[89]-80.0*f[50]+120.0*f[49]+75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2-432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]+216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+135.0*f[65]-240.0*f[62]-240.0*f[61]+540.0*f[58]+360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]+360.0*f[15]-540.0*f[14]-360.0*f[10]-360.0*f[9]+540.0*f[8]+540.0*f[7])+(3645.0*f[110]+2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-540.0*f[13]-540.0*f[12]-600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[29]+1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[27]+1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]-720.0*f[84]-720.0*f[83]+1080.0*f[82]+1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]+675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[57]+1080.0*f[56]+1080.0*f[29]+1080.0*f[28]-1620.0*f[27]-1620.0*f[26]-1080.0*f[22]+1620.0*f[21]-600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]+135.0*f[29]+135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[29]-90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]+30.0*f[84]+30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]-120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]+72.0*f[102]+72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-72.0*f[90]+45.0*f[89]+10.0*f[50]-40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87]+40.0*f[46]-40.0*f[41]-40.0*f[40]))+(810.0*f[78]+810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]+75.0*f[10]+75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+360.0*f[78]+360.0*f[77]-360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23]-200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[0][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]-75.0*f[67]-75.0*f[66])*vcut_lR3+(135.0*f[109]-30.0*f[84]-30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+45.0*f[29]+45.0*f[28]-45.0*f[22]-25.0*f[4])*vcut_lR2+((-135.0*f[110])-60.0*f[82]-60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]+75.0*f[67]+75.0*f[66]-60.0*f[57]-60.0*f[56]+90.0*f[27]+90.0*f[26]-90.0*f[21]-50.0*f[3])*vcut_l-135.0*f[109]+30.0*f[84]+30.0*f[83]+60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+60.0*f[57]+60.0*f[56]-45.0*f[29]-45.0*f[28]-90.0*f[27]-90.0*f[26]+45.0*f[22]+90.0*f[21]+25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]-135.0*f[51]-75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]-90.0*f[6]-50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]-90.0*f[13]-90.0*f[12]+75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]-45.0*f[90]-25.0*f[42])*vcut_lR3+((-18.0*f[104])+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]-45.0*f[89]-10.0*f[50]-25.0*f[39]-10.0*f[38]-10.0*f[37])*vcut_lR2+((-36.0*f[103])-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]+45.0*f[90]-20.0*f[49]+25.0*f[42]-20.0*f[34]-20.0*f[33])*vcut_l+18.0*f[104]+36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-36.0*f[92]-36.0*f[91]+45.0*f[89]+10.0*f[50]+20.0*f[49]+25.0*f[39]+10.0*f[38]+10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]-25.0*f[41]-25.0*f[40])*vcut_lR3+((-30.0*f[106])-30.0*f[105]+30.0*f[97]+30.0*f[96]-30.0*f[88]-30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]-20.0*f[48]-20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]+25.0*f[41]+25.0*f[40]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]+30.0*f[88]+30.0*f[87]+20.0*f[48]+20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+(225.0*f[78]+225.0*f[77]-225.0*f[65]-125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]-75.0*f[10]-75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]-150.0*f[8]-150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]-75.0*f[15]-150.0*f[14]+75.0*f[10]+75.0*f[9]+150.0*f[8]+150.0*f[7])+((-270.0*f[111])+270.0*f[108]+270.0*f[107]+405.0*f[86]-150.0*f[85]-150.0*f[62]-150.0*f[61]+225.0*f[30]-225.0*f[24]-225.0*f[23])*vcut_lR2+((-180.0*f[80])-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]+225.0*f[65]-450.0*f[58]+270.0*f[25]-100.0*f[20]+125.0*f[19]-250.0*f[18]-100.0*f[17]-100.0*f[16]+150.0*f[5]-150.0*f[2]-150.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]+180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]+150.0*f[62]+150.0*f[61]+450.0*f[58]-225.0*f[30]-270.0*f[25]+225.0*f[24]+225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]-150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[0][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]-405.0*f[90]-225.0*f[42])*vcut_lR4+((-144.0*f[104])+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-360.0*f[89]-80.0*f[50]-200.0*f[39]-80.0*f[38]-80.0*f[37])*vcut_lR3+((-216.0*f[103])-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]+270.0*f[90]-120.0*f[49]+150.0*f[42]-120.0*f[34]-120.0*f[33])*vcut_lR2+144.0*f[104]+216.0*f[103]-135.0*f[102]-135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-216.0*f[92]-216.0*f[91]+135.0*f[90]+360.0*f[89]+80.0*f[50]+120.0*f[49]+75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]+120.0*f[34]+120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]-135.0*f[41]-135.0*f[40])*vcut_lR4+((-144.0*f[106])-144.0*f[105]+144.0*f[97]+144.0*f[96]-144.0*f[88]-144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]-72.0*f[48]-72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]+90.0*f[41]+90.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]+72.0*f[48]+72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]+45.0*f[41]+45.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]-405.0*f[65]-225.0*f[19])*vcut_lR4+((-432.0*f[111])+432.0*f[108]+432.0*f[107]+648.0*f[86]-240.0*f[85]-240.0*f[62]-240.0*f[61]+360.0*f[30]-360.0*f[24]-360.0*f[23])*vcut_lR3+((-216.0*f[80])-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]+270.0*f[65]-540.0*f[58]+324.0*f[25]-120.0*f[20]+150.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]+180.0*f[5]-180.0*f[2]-180.0*f[1])*vcut_lR2+432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]+240.0*f[85]+216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]+135.0*f[65]+240.0*f[62]+240.0*f[61]+540.0*f[58]-360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]+120.0*f[20]+75.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]-180.0*f[5]+180.0*f[2]+180.0*f[1])+(648.0*f[53]+360.0*f[15]-360.0*f[10]-360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]-540.0*f[8]-540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]-360.0*f[15]-540.0*f[14]+360.0*f[10]+360.0*f[9]+540.0*f[8]+540.0*f[7])+(3645.0*f[110]+2025.0*f[79]-2025.0*f[67]-2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]-1080.0*f[51]-600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]-540.0*f[6]-300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]+1080.0*f[51]-540.0*f[13]-540.0*f[12]+600.0*f[11]+540.0*f[6]+300.0*f[0])+(3240.0*f[109]-720.0*f[84]-720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]+1080.0*f[29]+1080.0*f[28]-1080.0*f[22]-600.0*f[4])*vcut_lR3+((-2430.0*f[110])-1080.0*f[82]-1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]+1350.0*f[67]+1350.0*f[66]-1080.0*f[57]-1080.0*f[56]+1620.0*f[27]+1620.0*f[26]-1620.0*f[21]-900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]+720.0*f[84]+720.0*f[83]+1080.0*f[82]+1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]+675.0*f[67]+675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[57]+1080.0*f[56]-1080.0*f[29]-1080.0*f[28]-1620.0*f[27]-1620.0*f[26]+1080.0*f[22]+1620.0*f[21]+600.0*f[4]+900.0*f[3]); 
  fReflSurfXYMu[0][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]-270.0*f[67]-270.0*f[66])*vcut_lR5+(405.0*f[109]-90.0*f[84]-90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]-225.0*f[64]-225.0*f[63]-90.0*f[60]-90.0*f[59]+135.0*f[29]+135.0*f[28]-135.0*f[22]-75.0*f[4])*vcut_lR4+((-540.0*f[110])-120.0*f[82]-120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]+300.0*f[67]+300.0*f[66]-120.0*f[57]-120.0*f[56]+180.0*f[27]+180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_lR3+((-270.0*f[109])+60.0*f[84]+60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]+150.0*f[64]+150.0*f[63]+60.0*f[60]+60.0*f[59]-90.0*f[29]-90.0*f[28]+90.0*f[22]+50.0*f[4])*vcut_lR2+(270.0*f[110]+120.0*f[82]+120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]-150.0*f[67]-150.0*f[66]+120.0*f[57]+120.0*f[56]-180.0*f[27]-180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]+30.0*f[84]+30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]+120.0*f[66]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]-45.0*f[29]-45.0*f[28]+45.0*f[22]+25.0*f[4])+(405.0*f[55]+405.0*f[54]-405.0*f[51]-225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]+270.0*f[51]+150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]+135.0*f[51]+75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]-162.0*f[90]-90.0*f[42])*vcut_lR5+((-54.0*f[104])+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]-135.0*f[89]-30.0*f[50]-75.0*f[39]-30.0*f[38]-30.0*f[37])*vcut_lR4+((-72.0*f[103])-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]+180.0*f[90]-40.0*f[49]+100.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_lR3+(36.0*f[104]-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]+90.0*f[89]+20.0*f[50]+50.0*f[39]+20.0*f[38]+20.0*f[37])*vcut_lR2+(72.0*f[103]+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]-90.0*f[90]+40.0*f[49]-50.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_l+18.0*f[104]-72.0*f[102]-72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+72.0*f[90]+45.0*f[89]+10.0*f[50]+40.0*f[42]+25.0*f[39]+10.0*f[38]+10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]-90.0*f[41]-90.0*f[40])*vcut_lR5+((-90.0*f[106])-90.0*f[105]+90.0*f[97]+90.0*f[96]-90.0*f[88]-90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]-40.0*f[48]-40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]+100.0*f[41]+100.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_lR3+(60.0*f[106]+60.0*f[105]-60.0*f[97]-60.0*f[96]+60.0*f[88]+60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]+40.0*f[48]+40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]-50.0*f[41]-50.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_l+30.0*f[106]+30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]+30.0*f[88]+30.0*f[87]-40.0*f[46]+40.0*f[41]+40.0*f[40]))+(810.0*f[78]+810.0*f[77]-810.0*f[65]-450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]-225.0*f[10]-225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]+150.0*f[10]+150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]+75.0*f[10]+75.0*f[9])+((-810.0*f[111])+810.0*f[108]+810.0*f[107]+1215.0*f[86]-450.0*f[85]-450.0*f[62]-450.0*f[61]+675.0*f[30]-675.0*f[24]-675.0*f[23])*vcut_lR4+((-360.0*f[80])-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]+900.0*f[65]-900.0*f[58]+540.0*f[25]-200.0*f[20]+500.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]+300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_lR3+(540.0*f[111]-540.0*f[108]-540.0*f[107]-810.0*f[86]+300.0*f[85]+300.0*f[62]+300.0*f[61]-450.0*f[30]+450.0*f[24]+450.0*f[23])*vcut_lR2+(360.0*f[80]+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]-450.0*f[65]+900.0*f[58]-540.0*f[25]+200.0*f[20]-250.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]-300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_l+270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]+150.0*f[85]-360.0*f[78]-360.0*f[77]+360.0*f[65]+150.0*f[62]+150.0*f[61]-225.0*f[30]+225.0*f[24]+225.0*f[23]+200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[0][1])/fReflSurfXYMu[0][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[0][2]+5.0*fReflSurfXYMu[0][0]))/fReflSurfXYMu[0][0];
  if (fReflSurfXYMu[0][0]<0.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[0][0] = 0.0; 
  fReflSurfXYMu[0][1] = 0.0; 
  fReflSurfXYMu[0][2] = 0.0; 
  }

    // node (mu)_1 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = 0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l+9.0*f[104]-18.0*f[103]-18.0*f[89]+5.0*f[50]-10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]+8.0*f[34]+8.0*f[33])+1.732050807568877*((10.0*f[41]+10.0*f[40])*vcut_lR3+((-15.0*f[106])-15.0*f[105]+12.0*f[88]+12.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[47]-10.0*f[41]-10.0*f[40]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31])*vcut_l+15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87]-10.0*f[48]-10.0*f[47]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]+30.0*f[66])*vcut_lR3+((-15.0*f[84])-15.0*f[83]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]+18.0*f[22]+10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[81]-30.0*f[67]-30.0*f[66]+24.0*f[57]+24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l+15.0*f[84]+15.0*f[83]-30.0*f[82]-30.0*f[81]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]+24.0*f[57]+24.0*f[56]-18.0*f[22]+36.0*f[21]-10.0*f[4]+20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+(36.0*f[6]+20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]+36.0*f[6]+20.0*f[0])+(90.0*f[65]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]+30.0*f[9])*vcut_lR2+(60.0*f[8]+60.0*f[7])*vcut_l-30.0*f[10]-30.0*f[9]+60.0*f[8]+60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]+90.0*f[24]+90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]-90.0*f[80]-60.0*f[62]-60.0*f[61]+180.0*f[58]-90.0*f[24]-90.0*f[23]-50.0*f[20]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]+60.0*f[1]); 
  fReflSurfXYMu[1][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]+225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-180.0*f[104]+270.0*f[103]-135.0*f[90]+360.0*f[89]-100.0*f[50]+150.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+((-180.0*f[106])-180.0*f[105]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-180.0*f[106]-180.0*f[105]+144.0*f[88]+144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]+225.0*f[19])*vcut_lR4+((-540.0*f[111])-300.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2-540.0*f[111]-300.0*f[85]+270.0*f[80]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[24]+360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+(540.0*f[8]+540.0*f[7])*vcut_lR2+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+(2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[51]+600.0*f[11]-540.0*f[6]-300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-1350.0*f[82])-1350.0*f[81]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[21]+900.0*f[3])*vcut_lR2-900.0*f[84]-900.0*f[83]+1350.0*f[82]+1350.0*f[81]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = 3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l+45.0*f[104]+144.0*f[90]-90.0*f[89]+25.0*f[50]+80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[41]+180.0*f[40])*vcut_lR5+((-225.0*f[106])-225.0*f[105]+180.0*f[88]+180.0*f[87])*vcut_lR4+((-100.0*f[48])-100.0*f[47]-200.0*f[41]-200.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_lR3+(150.0*f[106]+150.0*f[105]-120.0*f[88]-120.0*f[87])*vcut_lR2+(100.0*f[48]+100.0*f[47]+100.0*f[41]+100.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_l+75.0*f[106]+75.0*f[105]-60.0*f[88]-60.0*f[87]+80.0*f[41]+80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]+540.0*f[66])*vcut_lR5+((-225.0*f[84])-225.0*f[83]+450.0*f[64]+450.0*f[63]+180.0*f[60]+180.0*f[59]+270.0*f[22]+150.0*f[4])*vcut_lR4+((-300.0*f[82])-300.0*f[81]-600.0*f[67]-600.0*f[66]+240.0*f[57]+240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+(150.0*f[84]+150.0*f[83]-300.0*f[64]-300.0*f[63]-120.0*f[60]-120.0*f[59]-180.0*f[22]-100.0*f[4])*vcut_lR2+(300.0*f[82]+300.0*f[81]+300.0*f[67]+300.0*f[66]-240.0*f[57]-240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l+75.0*f[84]+75.0*f[83]+240.0*f[67]+240.0*f[66]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[22]-50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+(360.0*f[6]+200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+((-360.0*f[6])-200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+(1620.0*f[65]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]+450.0*f[9])*vcut_lR4+(600.0*f[8]+600.0*f[7])*vcut_lR3+((-300.0*f[10])-300.0*f[9])*vcut_lR2+((-600.0*f[8])-600.0*f[7])*vcut_l-150.0*f[10]-150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]+1350.0*f[24]+1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]-900.0*f[24]-900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]+720.0*f[65]-300.0*f[62]-300.0*f[61]-450.0*f[24]-450.0*f[23]+400.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[1][0] = -0.002795084971874737*(3.872983346207417*(2.23606797749979*((18.0*f[90]+10.0*f[42])*vcut_lR3+((-9.0*f[104])+18.0*f[89]-5.0*f[50]+10.0*f[39]+4.0*f[38]+4.0*f[37])*vcut_lR2+((-18.0*f[103])-18.0*f[90]-10.0*f[49]-10.0*f[42]+8.0*f[34]+8.0*f[33])*vcut_l+9.0*f[104]+18.0*f[103]-18.0*f[89]+5.0*f[50]+10.0*f[49]-10.0*f[39]-4.0*f[38]-4.0*f[37]-8.0*f[34]-8.0*f[33])+1.732050807568877*((10.0*f[41]+10.0*f[40])*vcut_lR3+((-15.0*f[106])-15.0*f[105]+12.0*f[88]+12.0*f[87])*vcut_lR2+((-10.0*f[48])-10.0*f[47]-10.0*f[41]-10.0*f[40]+20.0*f[36]+20.0*f[35]+8.0*f[32]+8.0*f[31])*vcut_l+15.0*f[106]+15.0*f[105]-12.0*f[88]-12.0*f[87]+10.0*f[48]+10.0*f[47]-20.0*f[36]-20.0*f[35]-8.0*f[32]-8.0*f[31]))+2.23606797749979*(1.732050807568877*((30.0*f[67]+30.0*f[66])*vcut_lR3+((-15.0*f[84])-15.0*f[83]+30.0*f[64]+30.0*f[63]+12.0*f[60]+12.0*f[59]+18.0*f[22]+10.0*f[4])*vcut_lR2+((-30.0*f[82])-30.0*f[81]-30.0*f[67]-30.0*f[66]+24.0*f[57]+24.0*f[56]+36.0*f[21]+20.0*f[3])*vcut_l+15.0*f[84]+15.0*f[83]+30.0*f[82]+30.0*f[81]-30.0*f[64]-30.0*f[63]-12.0*f[60]-12.0*f[59]-24.0*f[57]-24.0*f[56]-18.0*f[22]-36.0*f[21]-10.0*f[4]-20.0*f[3])+(54.0*f[51]+30.0*f[11])*vcut_lR2+(36.0*f[6]+20.0*f[0])*vcut_l-54.0*f[51]-30.0*f[11]-36.0*f[6]-20.0*f[0])+(90.0*f[65]+50.0*f[19])*vcut_lR3+1.732050807568877*((30.0*f[10]+30.0*f[9])*vcut_lR2+(60.0*f[8]+60.0*f[7])*vcut_l-30.0*f[10]-30.0*f[9]-60.0*f[8]-60.0*f[7])+((-135.0*f[111])-75.0*f[85]+60.0*f[62]+60.0*f[61]+90.0*f[24]+90.0*f[23])*vcut_lR2+((-90.0*f[80])-90.0*f[65]+180.0*f[58]-50.0*f[20]-50.0*f[19]+100.0*f[18]+40.0*f[17]+40.0*f[16]+60.0*f[2]+60.0*f[1])*vcut_l+135.0*f[111]+75.0*f[85]+90.0*f[80]-60.0*f[62]-60.0*f[61]-180.0*f[58]-90.0*f[24]-90.0*f[23]+50.0*f[20]-100.0*f[18]-40.0*f[17]-40.0*f[16]-60.0*f[2]-60.0*f[1]); 
  fReflSurfXYMu[1][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[90]+225.0*f[42])*vcut_lR4+((-180.0*f[104])+360.0*f[89]-100.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+((-270.0*f[103])-270.0*f[90]-150.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+180.0*f[104]+270.0*f[103]-135.0*f[90]-360.0*f[89]+100.0*f[50]+150.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((135.0*f[41]+135.0*f[40])*vcut_lR4+((-180.0*f[106])-180.0*f[105]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-90.0*f[48])-90.0*f[47]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+180.0*f[106]+180.0*f[105]-144.0*f[88]-144.0*f[87]+90.0*f[48]+90.0*f[47]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[65]+225.0*f[19])*vcut_lR4+((-540.0*f[111])-300.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[24]+360.0*f[23])*vcut_lR3+((-270.0*f[80])-270.0*f[65]+540.0*f[58]-150.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[2]+180.0*f[1])*vcut_lR2+540.0*f[111]+300.0*f[85]+270.0*f[80]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[24]-360.0*f[23]+150.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[2]-180.0*f[1])+(360.0*f[10]+360.0*f[9])*vcut_lR3+(540.0*f[8]+540.0*f[7])*vcut_lR2-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+(2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[51]-600.0*f[11]-540.0*f[6]-300.0*f[0])+((-900.0*f[84])-900.0*f[83]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-1350.0*f[82])-1350.0*f[81]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[21]+900.0*f[3])*vcut_lR2+900.0*f[84]+900.0*f[83]+1350.0*f[82]+1350.0*f[81]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[1][2] = -3.125e-4*(3.872983346207417*(2.23606797749979*((324.0*f[90]+180.0*f[42])*vcut_lR5+((-135.0*f[104])+270.0*f[89]-75.0*f[50]+150.0*f[39]+60.0*f[38]+60.0*f[37])*vcut_lR4+((-180.0*f[103])-360.0*f[90]-100.0*f[49]-200.0*f[42]+80.0*f[34]+80.0*f[33])*vcut_lR3+(90.0*f[104]-180.0*f[89]+50.0*f[50]-100.0*f[39]-40.0*f[38]-40.0*f[37])*vcut_lR2+(180.0*f[103]+180.0*f[90]+100.0*f[49]+100.0*f[42]-80.0*f[34]-80.0*f[33])*vcut_l+45.0*f[104]-144.0*f[90]-90.0*f[89]+25.0*f[50]-80.0*f[42]-50.0*f[39]-20.0*f[38]-20.0*f[37])+1.732050807568877*((180.0*f[41]+180.0*f[40])*vcut_lR5+((-225.0*f[106])-225.0*f[105]+180.0*f[88]+180.0*f[87])*vcut_lR4+((-100.0*f[48])-100.0*f[47]-200.0*f[41]-200.0*f[40]+200.0*f[36]+200.0*f[35]+80.0*f[32]+80.0*f[31])*vcut_lR3+(150.0*f[106]+150.0*f[105]-120.0*f[88]-120.0*f[87])*vcut_lR2+(100.0*f[48]+100.0*f[47]+100.0*f[41]+100.0*f[40]-200.0*f[36]-200.0*f[35]-80.0*f[32]-80.0*f[31])*vcut_l+75.0*f[106]+75.0*f[105]-60.0*f[88]-60.0*f[87]-80.0*f[41]-80.0*f[40]))+2.23606797749979*(1.732050807568877*((540.0*f[67]+540.0*f[66])*vcut_lR5+((-225.0*f[84])-225.0*f[83]+450.0*f[64]+450.0*f[63]+180.0*f[60]+180.0*f[59]+270.0*f[22]+150.0*f[4])*vcut_lR4+((-300.0*f[82])-300.0*f[81]-600.0*f[67]-600.0*f[66]+240.0*f[57]+240.0*f[56]+360.0*f[21]+200.0*f[3])*vcut_lR3+(150.0*f[84]+150.0*f[83]-300.0*f[64]-300.0*f[63]-120.0*f[60]-120.0*f[59]-180.0*f[22]-100.0*f[4])*vcut_lR2+(300.0*f[82]+300.0*f[81]+300.0*f[67]+300.0*f[66]-240.0*f[57]-240.0*f[56]-360.0*f[21]-200.0*f[3])*vcut_l+75.0*f[84]+75.0*f[83]-240.0*f[67]-240.0*f[66]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[22]-50.0*f[4])+(810.0*f[51]+450.0*f[11])*vcut_lR4+(360.0*f[6]+200.0*f[0])*vcut_lR3+((-540.0*f[51])-300.0*f[11])*vcut_lR2+((-360.0*f[6])-200.0*f[0])*vcut_l-270.0*f[51]-150.0*f[11])+(1620.0*f[65]+900.0*f[19])*vcut_lR5+1.732050807568877*((450.0*f[10]+450.0*f[9])*vcut_lR4+(600.0*f[8]+600.0*f[7])*vcut_lR3+((-300.0*f[10])-300.0*f[9])*vcut_lR2+((-600.0*f[8])-600.0*f[7])*vcut_l-150.0*f[10]-150.0*f[9])+((-2025.0*f[111])-1125.0*f[85]+900.0*f[62]+900.0*f[61]+1350.0*f[24]+1350.0*f[23])*vcut_lR4+((-900.0*f[80])-1800.0*f[65]+1800.0*f[58]-500.0*f[20]-1000.0*f[19]+1000.0*f[18]+400.0*f[17]+400.0*f[16]+600.0*f[2]+600.0*f[1])*vcut_lR3+(1350.0*f[111]+750.0*f[85]-600.0*f[62]-600.0*f[61]-900.0*f[24]-900.0*f[23])*vcut_lR2+(900.0*f[80]+900.0*f[65]-1800.0*f[58]+500.0*f[20]+500.0*f[19]-1000.0*f[18]-400.0*f[17]-400.0*f[16]-600.0*f[2]-600.0*f[1])*vcut_l+675.0*f[111]+375.0*f[85]-720.0*f[65]-300.0*f[62]-300.0*f[61]-450.0*f[24]-450.0*f[23]-400.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[1][1])/fReflSurfXYMu[1][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[1][0]))/fReflSurfXYMu[1][0];
  if (fReflSurfXYMu[1][0]<0.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[1][0] = 0.0; 
  fReflSurfXYMu[1][1] = 0.0; 
  fReflSurfXYMu[1][2] = 0.0; 
  }

    // node (mu)_2 
    if (wv > 0.) {
      // vcut in logical space.
      double vcut_l = 2.*(sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = 0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]-30.0*f[83]+60.0*f[82]+60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]+60.0*f[71]+60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]+60.0*f[57]+60.0*f[56]-45.0*f[29]-45.0*f[28]+90.0*f[27]+90.0*f[26]-45.0*f[22]+90.0*f[21]-25.0*f[4]+50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]+90.0*f[13]+90.0*f[12]-75.0*f[11]+90.0*f[6]+50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]+36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+36.0*f[92]+36.0*f[91]-45.0*f[89]-10.0*f[50]+20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]+20.0*f[34]+20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]+90.0*f[93]-30.0*f[88]-30.0*f[87]+20.0*f[48]+20.0*f[47]+50.0*f[45]+20.0*f[44]+20.0*f[43]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31]))+(225.0*f[78]+225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]+270.0*f[52]-75.0*f[15]+150.0*f[14]-75.0*f[10]-75.0*f[9]+150.0*f[8]+150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+180.0*f[80]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-150.0*f[62]-150.0*f[61]+450.0*f[58]-225.0*f[30]+270.0*f[25]-225.0*f[24]-225.0*f[23]+100.0*f[20]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1]); 
  fReflSurfXYMu[2][1] = 2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2+144.0*f[104]-216.0*f[103]-135.0*f[102]-135.0*f[101]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]-216.0*f[92]-216.0*f[91]-135.0*f[90]+360.0*f[89]+80.0*f[50]-120.0*f[49]-75.0*f[42]+200.0*f[39]+80.0*f[38]+80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2+144.0*f[106]+144.0*f[105]-81.0*f[100]+144.0*f[97]+144.0*f[96]-324.0*f[93]+144.0*f[88]+144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2+432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]-216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-135.0*f[65]+240.0*f[62]+240.0*f[61]-540.0*f[58]+360.0*f[30]-324.0*f[25]+360.0*f[24]+360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2+648.0*f[53]-972.0*f[52]+360.0*f[15]-540.0*f[14]+360.0*f[10]+360.0*f[9]-540.0*f[8]-540.0*f[7])+(3645.0*f[110]+2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2+1080.0*f[55]+1080.0*f[54]+1080.0*f[51]-540.0*f[13]-540.0*f[12]+600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[29]+1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[27]+1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]+3240.0*f[109]+720.0*f[84]+720.0*f[83]-1080.0*f[82]-1080.0*f[81]-675.0*f[79]+1800.0*f[76]+720.0*f[75]+720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]-675.0*f[66]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]-1080.0*f[57]-1080.0*f[56]+1080.0*f[29]+1080.0*f[28]-1620.0*f[27]-1620.0*f[26]+1080.0*f[22]-1620.0*f[21]+600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = 6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]+135.0*f[29]+135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[29]-90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l+216.0*f[110]-135.0*f[109]-30.0*f[84]-30.0*f[83]+120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]+120.0*f[67]+120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]+72.0*f[102]+72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]+72.0*f[90]-45.0*f[89]-10.0*f[50]+40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]+72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87]+40.0*f[46]+40.0*f[41]+40.0*f[40]))+(810.0*f[78]+810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]-75.0*f[10]-75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]+360.0*f[78]+360.0*f[77]+360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23]+200.0*f[19]); 

    } else {
      // vcut in logical space.
      double vcut_l = 2.*(-sqrt(vcutSq)-wv)/dv;

  const double vcut_lR2 = pow(vcut_l,2);
  const double vcut_lR3 = pow(vcut_l,3);
  const double vcut_lR4 = pow(vcut_l,4);
  const double vcut_lR5 = pow(vcut_l,5);

  fReflSurfXYMu[2][0] = -0.001118033988749895*(2.23606797749979*(1.732050807568877*((135.0*f[110]+75.0*f[79]+75.0*f[67]+75.0*f[66])*vcut_lR3+(135.0*f[109]+30.0*f[84]+30.0*f[83]+75.0*f[76]+30.0*f[75]+30.0*f[74]+75.0*f[64]+75.0*f[63]+30.0*f[60]+30.0*f[59]+45.0*f[29]+45.0*f[28]+45.0*f[22]+25.0*f[4])*vcut_lR2+((-135.0*f[110])+60.0*f[82]+60.0*f[81]-75.0*f[79]+60.0*f[71]+60.0*f[70]-75.0*f[67]-75.0*f[66]+60.0*f[57]+60.0*f[56]+90.0*f[27]+90.0*f[26]+90.0*f[21]+50.0*f[3])*vcut_l-135.0*f[109]-30.0*f[84]-30.0*f[83]-60.0*f[82]-60.0*f[81]-75.0*f[76]-30.0*f[75]-30.0*f[74]-60.0*f[71]-60.0*f[70]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-60.0*f[57]-60.0*f[56]-45.0*f[29]-45.0*f[28]-90.0*f[27]-90.0*f[26]-45.0*f[22]-90.0*f[21]-25.0*f[4]-50.0*f[3])+(135.0*f[55]+135.0*f[54]+135.0*f[51]+75.0*f[11])*vcut_lR2+(90.0*f[13]+90.0*f[12]+90.0*f[6]+50.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-90.0*f[13]-90.0*f[12]-75.0*f[11]-90.0*f[6]-50.0*f[0])+3.872983346207417*(2.23606797749979*((45.0*f[102]+45.0*f[101]+45.0*f[90]+25.0*f[42])*vcut_lR3+(18.0*f[104]+45.0*f[99]+45.0*f[98]+18.0*f[95]+18.0*f[94]+45.0*f[89]+10.0*f[50]+25.0*f[39]+10.0*f[38]+10.0*f[37])*vcut_lR2+(36.0*f[103]-45.0*f[102]-45.0*f[101]+36.0*f[92]+36.0*f[91]-45.0*f[90]+20.0*f[49]-25.0*f[42]+20.0*f[34]+20.0*f[33])*vcut_l-18.0*f[104]-36.0*f[103]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-36.0*f[92]-36.0*f[91]-45.0*f[89]-10.0*f[50]-20.0*f[49]-25.0*f[39]-10.0*f[38]-10.0*f[37]-20.0*f[34]-20.0*f[33])+1.732050807568877*((45.0*f[100]+25.0*f[46]+25.0*f[41]+25.0*f[40])*vcut_lR3+(30.0*f[106]+30.0*f[105]+30.0*f[97]+30.0*f[96]+30.0*f[88]+30.0*f[87])*vcut_lR2+((-45.0*f[100])+90.0*f[93]+20.0*f[48]+20.0*f[47]-25.0*f[46]+50.0*f[45]+20.0*f[44]+20.0*f[43]-25.0*f[41]-25.0*f[40]+50.0*f[36]+50.0*f[35]+20.0*f[32]+20.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-30.0*f[97]-30.0*f[96]-90.0*f[93]-30.0*f[88]-30.0*f[87]-20.0*f[48]-20.0*f[47]-50.0*f[45]-20.0*f[44]-20.0*f[43]-50.0*f[36]-50.0*f[35]-20.0*f[32]-20.0*f[31]))+(225.0*f[78]+225.0*f[77]+225.0*f[65]+125.0*f[19])*vcut_lR3+1.732050807568877*((135.0*f[53]+75.0*f[15]+75.0*f[10]+75.0*f[9])*vcut_lR2+(270.0*f[52]+150.0*f[14]+150.0*f[8]+150.0*f[7])*vcut_l-135.0*f[53]-270.0*f[52]-75.0*f[15]-150.0*f[14]-75.0*f[10]-75.0*f[9]-150.0*f[8]-150.0*f[7])+(270.0*f[111]+270.0*f[108]+270.0*f[107]+405.0*f[86]+150.0*f[85]+150.0*f[62]+150.0*f[61]+225.0*f[30]+225.0*f[24]+225.0*f[23])*vcut_lR2+(180.0*f[80]-225.0*f[78]-225.0*f[77]+450.0*f[73]+450.0*f[72]+180.0*f[69]+180.0*f[68]-225.0*f[65]+450.0*f[58]+270.0*f[25]+100.0*f[20]-125.0*f[19]+250.0*f[18]+100.0*f[17]+100.0*f[16]+150.0*f[5]+150.0*f[2]+150.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-180.0*f[80]-450.0*f[73]-450.0*f[72]-180.0*f[69]-180.0*f[68]-150.0*f[62]-150.0*f[61]-450.0*f[58]-225.0*f[30]-270.0*f[25]-225.0*f[24]-225.0*f[23]-100.0*f[20]-250.0*f[18]-100.0*f[17]-100.0*f[16]-150.0*f[5]-150.0*f[2]-150.0*f[1]); 
  fReflSurfXYMu[2][1] = -2.083333333333333e-4*(3.872983346207417*(1.732050807568877*((405.0*f[102]+405.0*f[101]+405.0*f[90]+225.0*f[42])*vcut_lR4+(144.0*f[104]+360.0*f[99]+360.0*f[98]+144.0*f[95]+144.0*f[94]+360.0*f[89]+80.0*f[50]+200.0*f[39]+80.0*f[38]+80.0*f[37])*vcut_lR3+(216.0*f[103]-270.0*f[102]-270.0*f[101]+216.0*f[92]+216.0*f[91]-270.0*f[90]+120.0*f[49]-150.0*f[42]+120.0*f[34]+120.0*f[33])*vcut_lR2-144.0*f[104]-216.0*f[103]-135.0*f[102]-135.0*f[101]-360.0*f[99]-360.0*f[98]-144.0*f[95]-144.0*f[94]-216.0*f[92]-216.0*f[91]-135.0*f[90]-360.0*f[89]-80.0*f[50]-120.0*f[49]-75.0*f[42]-200.0*f[39]-80.0*f[38]-80.0*f[37]-120.0*f[34]-120.0*f[33])+2.23606797749979*((243.0*f[100]+135.0*f[46]+135.0*f[41]+135.0*f[40])*vcut_lR4+(144.0*f[106]+144.0*f[105]+144.0*f[97]+144.0*f[96]+144.0*f[88]+144.0*f[87])*vcut_lR3+((-162.0*f[100])+324.0*f[93]+72.0*f[48]+72.0*f[47]-90.0*f[46]+180.0*f[45]+72.0*f[44]+72.0*f[43]-90.0*f[41]-90.0*f[40]+180.0*f[36]+180.0*f[35]+72.0*f[32]+72.0*f[31])*vcut_lR2-144.0*f[106]-144.0*f[105]-81.0*f[100]-144.0*f[97]-144.0*f[96]-324.0*f[93]-144.0*f[88]-144.0*f[87]-72.0*f[48]-72.0*f[47]-45.0*f[46]-180.0*f[45]-72.0*f[44]-72.0*f[43]-45.0*f[41]-45.0*f[40]-180.0*f[36]-180.0*f[35]-72.0*f[32]-72.0*f[31]))+2.23606797749979*(1.732050807568877*((405.0*f[78]+405.0*f[77]+405.0*f[65]+225.0*f[19])*vcut_lR4+(432.0*f[111]+432.0*f[108]+432.0*f[107]+648.0*f[86]+240.0*f[85]+240.0*f[62]+240.0*f[61]+360.0*f[30]+360.0*f[24]+360.0*f[23])*vcut_lR3+(216.0*f[80]-270.0*f[78]-270.0*f[77]+540.0*f[73]+540.0*f[72]+216.0*f[69]+216.0*f[68]-270.0*f[65]+540.0*f[58]+324.0*f[25]+120.0*f[20]-150.0*f[19]+300.0*f[18]+120.0*f[17]+120.0*f[16]+180.0*f[5]+180.0*f[2]+180.0*f[1])*vcut_lR2-432.0*f[111]-432.0*f[108]-432.0*f[107]-648.0*f[86]-240.0*f[85]-216.0*f[80]-135.0*f[78]-135.0*f[77]-540.0*f[73]-540.0*f[72]-216.0*f[69]-216.0*f[68]-135.0*f[65]-240.0*f[62]-240.0*f[61]-540.0*f[58]-360.0*f[30]-324.0*f[25]-360.0*f[24]-360.0*f[23]-120.0*f[20]-75.0*f[19]-300.0*f[18]-120.0*f[17]-120.0*f[16]-180.0*f[5]-180.0*f[2]-180.0*f[1])+(648.0*f[53]+360.0*f[15]+360.0*f[10]+360.0*f[9])*vcut_lR3+(972.0*f[52]+540.0*f[14]+540.0*f[8]+540.0*f[7])*vcut_lR2-648.0*f[53]-972.0*f[52]-360.0*f[15]-540.0*f[14]-360.0*f[10]-360.0*f[9]-540.0*f[8]-540.0*f[7])+(3645.0*f[110]+2025.0*f[79]+2025.0*f[67]+2025.0*f[66])*vcut_lR4+1.732050807568877*((1080.0*f[55]+1080.0*f[54]+1080.0*f[51]+600.0*f[11])*vcut_lR3+(540.0*f[13]+540.0*f[12]+540.0*f[6]+300.0*f[0])*vcut_lR2-1080.0*f[55]-1080.0*f[54]-1080.0*f[51]-540.0*f[13]-540.0*f[12]-600.0*f[11]-540.0*f[6]-300.0*f[0])+(3240.0*f[109]+720.0*f[84]+720.0*f[83]+1800.0*f[76]+720.0*f[75]+720.0*f[74]+1800.0*f[64]+1800.0*f[63]+720.0*f[60]+720.0*f[59]+1080.0*f[29]+1080.0*f[28]+1080.0*f[22]+600.0*f[4])*vcut_lR3+((-2430.0*f[110])+1080.0*f[82]+1080.0*f[81]-1350.0*f[79]+1080.0*f[71]+1080.0*f[70]-1350.0*f[67]-1350.0*f[66]+1080.0*f[57]+1080.0*f[56]+1620.0*f[27]+1620.0*f[26]+1620.0*f[21]+900.0*f[3])*vcut_lR2-1215.0*f[110]-3240.0*f[109]-720.0*f[84]-720.0*f[83]-1080.0*f[82]-1080.0*f[81]-675.0*f[79]-1800.0*f[76]-720.0*f[75]-720.0*f[74]-1080.0*f[71]-1080.0*f[70]-675.0*f[67]-675.0*f[66]-1800.0*f[64]-1800.0*f[63]-720.0*f[60]-720.0*f[59]-1080.0*f[57]-1080.0*f[56]-1080.0*f[29]-1080.0*f[28]-1620.0*f[27]-1620.0*f[26]-1080.0*f[22]-1620.0*f[21]-600.0*f[4]-900.0*f[3]); 
  fReflSurfXYMu[2][2] = -6.25e-4*(2.23606797749979*(1.732050807568877*((486.0*f[110]+270.0*f[79]+270.0*f[67]+270.0*f[66])*vcut_lR5+(405.0*f[109]+90.0*f[84]+90.0*f[83]+225.0*f[76]+90.0*f[75]+90.0*f[74]+225.0*f[64]+225.0*f[63]+90.0*f[60]+90.0*f[59]+135.0*f[29]+135.0*f[28]+135.0*f[22]+75.0*f[4])*vcut_lR4+((-540.0*f[110])+120.0*f[82]+120.0*f[81]-300.0*f[79]+120.0*f[71]+120.0*f[70]-300.0*f[67]-300.0*f[66]+120.0*f[57]+120.0*f[56]+180.0*f[27]+180.0*f[26]+180.0*f[21]+100.0*f[3])*vcut_lR3+((-270.0*f[109])-60.0*f[84]-60.0*f[83]-150.0*f[76]-60.0*f[75]-60.0*f[74]-150.0*f[64]-150.0*f[63]-60.0*f[60]-60.0*f[59]-90.0*f[29]-90.0*f[28]-90.0*f[22]-50.0*f[4])*vcut_lR2+(270.0*f[110]-120.0*f[82]-120.0*f[81]+150.0*f[79]-120.0*f[71]-120.0*f[70]+150.0*f[67]+150.0*f[66]-120.0*f[57]-120.0*f[56]-180.0*f[27]-180.0*f[26]-180.0*f[21]-100.0*f[3])*vcut_l-216.0*f[110]-135.0*f[109]-30.0*f[84]-30.0*f[83]-120.0*f[79]-75.0*f[76]-30.0*f[75]-30.0*f[74]-120.0*f[67]-120.0*f[66]-75.0*f[64]-75.0*f[63]-30.0*f[60]-30.0*f[59]-45.0*f[29]-45.0*f[28]-45.0*f[22]-25.0*f[4])+(405.0*f[55]+405.0*f[54]+405.0*f[51]+225.0*f[11])*vcut_lR4+(180.0*f[13]+180.0*f[12]+180.0*f[6]+100.0*f[0])*vcut_lR3+((-270.0*f[55])-270.0*f[54]-270.0*f[51]-150.0*f[11])*vcut_lR2+((-180.0*f[13])-180.0*f[12]-180.0*f[6]-100.0*f[0])*vcut_l-135.0*f[55]-135.0*f[54]-135.0*f[51]-75.0*f[11])+3.872983346207417*(2.23606797749979*((162.0*f[102]+162.0*f[101]+162.0*f[90]+90.0*f[42])*vcut_lR5+(54.0*f[104]+135.0*f[99]+135.0*f[98]+54.0*f[95]+54.0*f[94]+135.0*f[89]+30.0*f[50]+75.0*f[39]+30.0*f[38]+30.0*f[37])*vcut_lR4+(72.0*f[103]-180.0*f[102]-180.0*f[101]+72.0*f[92]+72.0*f[91]-180.0*f[90]+40.0*f[49]-100.0*f[42]+40.0*f[34]+40.0*f[33])*vcut_lR3+((-36.0*f[104])-90.0*f[99]-90.0*f[98]-36.0*f[95]-36.0*f[94]-90.0*f[89]-20.0*f[50]-50.0*f[39]-20.0*f[38]-20.0*f[37])*vcut_lR2+((-72.0*f[103])+90.0*f[102]+90.0*f[101]-72.0*f[92]-72.0*f[91]+90.0*f[90]-40.0*f[49]+50.0*f[42]-40.0*f[34]-40.0*f[33])*vcut_l-18.0*f[104]-72.0*f[102]-72.0*f[101]-45.0*f[99]-45.0*f[98]-18.0*f[95]-18.0*f[94]-72.0*f[90]-45.0*f[89]-10.0*f[50]-40.0*f[42]-25.0*f[39]-10.0*f[38]-10.0*f[37])+1.732050807568877*((162.0*f[100]+90.0*f[46]+90.0*f[41]+90.0*f[40])*vcut_lR5+(90.0*f[106]+90.0*f[105]+90.0*f[97]+90.0*f[96]+90.0*f[88]+90.0*f[87])*vcut_lR4+((-180.0*f[100])+180.0*f[93]+40.0*f[48]+40.0*f[47]-100.0*f[46]+100.0*f[45]+40.0*f[44]+40.0*f[43]-100.0*f[41]-100.0*f[40]+100.0*f[36]+100.0*f[35]+40.0*f[32]+40.0*f[31])*vcut_lR3+((-60.0*f[106])-60.0*f[105]-60.0*f[97]-60.0*f[96]-60.0*f[88]-60.0*f[87])*vcut_lR2+(90.0*f[100]-180.0*f[93]-40.0*f[48]-40.0*f[47]+50.0*f[46]-100.0*f[45]-40.0*f[44]-40.0*f[43]+50.0*f[41]+50.0*f[40]-100.0*f[36]-100.0*f[35]-40.0*f[32]-40.0*f[31])*vcut_l-30.0*f[106]-30.0*f[105]-72.0*f[100]-30.0*f[97]-30.0*f[96]-30.0*f[88]-30.0*f[87]-40.0*f[46]-40.0*f[41]-40.0*f[40]))+(810.0*f[78]+810.0*f[77]+810.0*f[65]+450.0*f[19])*vcut_lR5+1.732050807568877*((405.0*f[53]+225.0*f[15]+225.0*f[10]+225.0*f[9])*vcut_lR4+(540.0*f[52]+300.0*f[14]+300.0*f[8]+300.0*f[7])*vcut_lR3+((-270.0*f[53])-150.0*f[15]-150.0*f[10]-150.0*f[9])*vcut_lR2+((-540.0*f[52])-300.0*f[14]-300.0*f[8]-300.0*f[7])*vcut_l-135.0*f[53]-75.0*f[15]-75.0*f[10]-75.0*f[9])+(810.0*f[111]+810.0*f[108]+810.0*f[107]+1215.0*f[86]+450.0*f[85]+450.0*f[62]+450.0*f[61]+675.0*f[30]+675.0*f[24]+675.0*f[23])*vcut_lR4+(360.0*f[80]-900.0*f[78]-900.0*f[77]+900.0*f[73]+900.0*f[72]+360.0*f[69]+360.0*f[68]-900.0*f[65]+900.0*f[58]+540.0*f[25]+200.0*f[20]-500.0*f[19]+500.0*f[18]+200.0*f[17]+200.0*f[16]+300.0*f[5]+300.0*f[2]+300.0*f[1])*vcut_lR3+((-540.0*f[111])-540.0*f[108]-540.0*f[107]-810.0*f[86]-300.0*f[85]-300.0*f[62]-300.0*f[61]-450.0*f[30]-450.0*f[24]-450.0*f[23])*vcut_lR2+((-360.0*f[80])+450.0*f[78]+450.0*f[77]-900.0*f[73]-900.0*f[72]-360.0*f[69]-360.0*f[68]+450.0*f[65]-900.0*f[58]-540.0*f[25]-200.0*f[20]+250.0*f[19]-500.0*f[18]-200.0*f[17]-200.0*f[16]-300.0*f[5]-300.0*f[2]-300.0*f[1])*vcut_l-270.0*f[111]-270.0*f[108]-270.0*f[107]-405.0*f[86]-150.0*f[85]-360.0*f[78]-360.0*f[77]-360.0*f[65]-150.0*f[62]-150.0*f[61]-225.0*f[30]-225.0*f[24]-225.0*f[23]-200.0*f[19]); 

    }

  // If the cut distribution f(vpar), where vpar in [-1,vcut_l] or [vcut_l/1],
  // has a cell average < 0, set to 0. If it's >0 but not realizable, set to p=0.
  xBar = (0.5773502691896258*fReflSurfXYMu[2][1])/fReflSurfXYMu[2][0];
  xSqBar = (0.06666666666666667*(4.47213595499958*fReflSurfXYMu[2][2]+5.0*fReflSurfXYMu[2][0]))/fReflSurfXYMu[2][0];
  if (fReflSurfXYMu[2][0]<0.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  } else if (fabs(xBar)>=1. || fabs(xSqBar)>=1.) {
  fReflSurfXYMu[2][0] = 0.0; 
  fReflSurfXYMu[2][1] = 0.0; 
  fReflSurfXYMu[2][2] = 0.0; 
  }

  fReflSurfXY[8][0] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][0]+8.0*fReflSurfXYMu[1][0]+5.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][1] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][1]+8.0*fReflSurfXYMu[1][1]+5.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[8][2] = 0.5270462766947298*(fReflSurfXYMu[2][0]-1.0*fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][3] = 0.5270462766947298*(fReflSurfXYMu[2][1]-1.0*fReflSurfXYMu[0][1]); 
  fReflSurfXY[8][4] = 0.07856742013183861*(5.0*fReflSurfXYMu[2][2]+8.0*fReflSurfXYMu[1][2]+5.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[8][5] = 0.3513641844631533*(fReflSurfXYMu[2][0]-2.0*fReflSurfXYMu[1][0]+fReflSurfXYMu[0][0]); 
  fReflSurfXY[8][6] = 0.5270462766947299*(fReflSurfXYMu[2][2]-1.0*fReflSurfXYMu[0][2]); 
  fReflSurfXY[8][7] = 0.3513641844631534*(fReflSurfXYMu[2][1]-2.0*fReflSurfXYMu[1][1]+fReflSurfXYMu[0][1]); 

  }

  fRefl[0] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0])+8.0*(5.0*fReflSurfXY[5][0]+8.0*fReflSurfXY[4][0])+5.0*(8.0*fReflSurfXY[3][0]+5.0*fReflSurfXY[2][0]+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0])); 
  fRefl[1] = 0.05856069741052554*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0]-1.0*(5.0*fReflSurfXY[2][0]+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0])); 
  fRefl[2] = 0.05856069741052554*(5.0*(fReflSurfXY[8][0]-1.0*fReflSurfXY[6][0])+8.0*(fReflSurfXY[5][0]-1.0*fReflSurfXY[3][0])+5.0*(fReflSurfXY[2][0]-1.0*fReflSurfXY[0][0])); 
  fRefl[3] = 0.0; 
  fRefl[4] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1])+8.0*(5.0*fReflSurfXY[5][1]+8.0*fReflSurfXY[4][1])+5.0*(8.0*fReflSurfXY[3][1]+5.0*fReflSurfXY[2][1]+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1])); 
  fRefl[5] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2])+8.0*(5.0*fReflSurfXY[5][2]+8.0*fReflSurfXY[4][2])+5.0*(8.0*fReflSurfXY[3][2]+5.0*fReflSurfXY[2][2]+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2])); 
  fRefl[6] = 0.392837100659193*(fReflSurfXY[8][0]-1.0*(fReflSurfXY[6][0]+fReflSurfXY[2][0])+fReflSurfXY[0][0]); 
  fRefl[7] = 0.0; 
  fRefl[8] = 0.0; 
  fRefl[9] = 0.05856069741052554*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1]-1.0*(5.0*fReflSurfXY[2][1]+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1])); 
  fRefl[10] = 0.05856069741052554*(5.0*(fReflSurfXY[8][1]-1.0*fReflSurfXY[6][1])+8.0*(fReflSurfXY[5][1]-1.0*fReflSurfXY[3][1])+5.0*(fReflSurfXY[2][1]-1.0*fReflSurfXY[0][1])); 
  fRefl[11] = 0.0; 
  fRefl[12] = 0.05856069741052554*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2]-1.0*(5.0*fReflSurfXY[2][2]+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2])); 
  fRefl[13] = 0.05856069741052554*(5.0*(fReflSurfXY[8][2]-1.0*fReflSurfXY[6][2])+8.0*(fReflSurfXY[5][2]-1.0*fReflSurfXY[3][2])+5.0*(fReflSurfXY[2][2]-1.0*fReflSurfXY[0][2])); 
  fRefl[14] = 0.0; 
  fRefl[15] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3])+8.0*(5.0*fReflSurfXY[5][3]+8.0*fReflSurfXY[4][3])+5.0*(8.0*fReflSurfXY[3][3]+5.0*fReflSurfXY[2][3]+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3])); 
  fRefl[16] = 0.03904046494035036*(5.0*fReflSurfXY[8][0]+8.0*fReflSurfXY[7][0]+5.0*fReflSurfXY[6][0]-2.0*(5.0*fReflSurfXY[5][0]+8.0*fReflSurfXY[4][0])+5.0*(fReflSurfXY[2][0]-2.0*fReflSurfXY[3][0])+8.0*fReflSurfXY[1][0]+5.0*fReflSurfXY[0][0]); 
  fRefl[17] = 0.03904046494035036*(5.0*(fReflSurfXY[8][0]-2.0*fReflSurfXY[7][0]+fReflSurfXY[6][0])+8.0*(fReflSurfXY[5][0]-2.0*fReflSurfXY[4][0]+fReflSurfXY[3][0])+5.0*(fReflSurfXY[2][0]-2.0*fReflSurfXY[1][0]+fReflSurfXY[0][0])); 
  fRefl[18] = 0.0; 
  fRefl[19] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][4]+8.0*fReflSurfXY[7][4]+5.0*fReflSurfXY[6][4])+8.0*(5.0*fReflSurfXY[5][4]+8.0*fReflSurfXY[4][4])+5.0*(8.0*fReflSurfXY[3][4]+5.0*fReflSurfXY[2][4]+8.0*fReflSurfXY[1][4]+5.0*fReflSurfXY[0][4])); 
  fRefl[20] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][5]+8.0*fReflSurfXY[7][5]+5.0*fReflSurfXY[6][5])+8.0*(5.0*fReflSurfXY[5][5]+8.0*fReflSurfXY[4][5])+5.0*(8.0*fReflSurfXY[3][5]+5.0*fReflSurfXY[2][5]+8.0*fReflSurfXY[1][5]+5.0*fReflSurfXY[0][5])); 
  fRefl[21] = 0.0; 
  fRefl[22] = 0.392837100659193*(fReflSurfXY[8][1]-1.0*(fReflSurfXY[6][1]+fReflSurfXY[2][1])+fReflSurfXY[0][1]); 
  fRefl[23] = 0.0; 
  fRefl[24] = 0.0; 
  fRefl[25] = 0.392837100659193*(fReflSurfXY[8][2]-1.0*(fReflSurfXY[6][2]+fReflSurfXY[2][2])+fReflSurfXY[0][2]); 
  fRefl[26] = 0.0; 
  fRefl[27] = 0.0; 
  fRefl[28] = 0.05856069741052554*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3]-1.0*(5.0*fReflSurfXY[2][3]+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3])); 
  fRefl[29] = 0.05856069741052554*(5.0*(fReflSurfXY[8][3]-1.0*fReflSurfXY[6][3])+8.0*(fReflSurfXY[5][3]-1.0*fReflSurfXY[3][3])+5.0*(fReflSurfXY[2][3]-1.0*fReflSurfXY[0][3])); 
  fRefl[30] = 0.0; 
  fRefl[31] = 0.2618914004394622*(fReflSurfXY[8][0]-1.0*fReflSurfXY[6][0]+2.0*(fReflSurfXY[3][0]-1.0*fReflSurfXY[5][0])+fReflSurfXY[2][0]-1.0*fReflSurfXY[0][0]); 
  fRefl[32] = 0.2618914004394622*(fReflSurfXY[8][0]-2.0*fReflSurfXY[7][0]+fReflSurfXY[6][0]-1.0*fReflSurfXY[2][0]+2.0*fReflSurfXY[1][0]-1.0*fReflSurfXY[0][0]); 
  fRefl[33] = 0.0; 
  fRefl[34] = 0.0; 
  fRefl[35] = 0.0; 
  fRefl[36] = 0.0; 
  fRefl[37] = 0.03904046494035038*(5.0*fReflSurfXY[8][1]+8.0*fReflSurfXY[7][1]+5.0*fReflSurfXY[6][1]-2.0*(5.0*fReflSurfXY[5][1]+8.0*fReflSurfXY[4][1])+5.0*(fReflSurfXY[2][1]-2.0*fReflSurfXY[3][1])+8.0*fReflSurfXY[1][1]+5.0*fReflSurfXY[0][1]); 
  fRefl[38] = 0.03904046494035038*(5.0*(fReflSurfXY[8][1]-2.0*fReflSurfXY[7][1]+fReflSurfXY[6][1])+8.0*(fReflSurfXY[5][1]-2.0*fReflSurfXY[4][1]+fReflSurfXY[3][1])+5.0*(fReflSurfXY[2][1]-2.0*fReflSurfXY[1][1]+fReflSurfXY[0][1])); 
  fRefl[39] = 0.0; 
  fRefl[40] = 0.05856069741052556*(5.0*fReflSurfXY[8][4]+8.0*fReflSurfXY[7][4]+5.0*fReflSurfXY[6][4]-1.0*(5.0*fReflSurfXY[2][4]+8.0*fReflSurfXY[1][4]+5.0*fReflSurfXY[0][4])); 
  fRefl[41] = 0.05856069741052556*(5.0*(fReflSurfXY[8][4]-1.0*fReflSurfXY[6][4])+8.0*(fReflSurfXY[5][4]-1.0*fReflSurfXY[3][4])+5.0*(fReflSurfXY[2][4]-1.0*fReflSurfXY[0][4])); 
  fRefl[42] = 0.0; 
  fRefl[43] = 0.03904046494035038*(5.0*fReflSurfXY[8][2]+8.0*fReflSurfXY[7][2]+5.0*fReflSurfXY[6][2]-2.0*(5.0*fReflSurfXY[5][2]+8.0*fReflSurfXY[4][2])+5.0*(fReflSurfXY[2][2]-2.0*fReflSurfXY[3][2])+8.0*fReflSurfXY[1][2]+5.0*fReflSurfXY[0][2]); 
  fRefl[44] = 0.03904046494035038*(5.0*(fReflSurfXY[8][2]-2.0*fReflSurfXY[7][2]+fReflSurfXY[6][2])+8.0*(fReflSurfXY[5][2]-2.0*fReflSurfXY[4][2]+fReflSurfXY[3][2])+5.0*(fReflSurfXY[2][2]-2.0*fReflSurfXY[1][2]+fReflSurfXY[0][2])); 
  fRefl[45] = 0.0; 
  fRefl[46] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][6]+8.0*fReflSurfXY[7][6]+5.0*fReflSurfXY[6][6])+8.0*(5.0*fReflSurfXY[5][6]+8.0*fReflSurfXY[4][6])+5.0*(8.0*fReflSurfXY[3][6]+5.0*fReflSurfXY[2][6]+8.0*fReflSurfXY[1][6]+5.0*fReflSurfXY[0][6])); 
  fRefl[47] = 0.05856069741052556*(5.0*fReflSurfXY[8][5]+8.0*fReflSurfXY[7][5]+5.0*fReflSurfXY[6][5]-1.0*(5.0*fReflSurfXY[2][5]+8.0*fReflSurfXY[1][5]+5.0*fReflSurfXY[0][5])); 
  fRefl[48] = 0.05856069741052556*(5.0*(fReflSurfXY[8][5]-1.0*fReflSurfXY[6][5])+8.0*(fReflSurfXY[5][5]-1.0*fReflSurfXY[3][5])+5.0*(fReflSurfXY[2][5]-1.0*fReflSurfXY[0][5])); 
  fRefl[49] = 0.0; 
  fRefl[50] = 0.008729713347982067*(5.0*(5.0*fReflSurfXY[8][7]+8.0*fReflSurfXY[7][7]+5.0*fReflSurfXY[6][7])+8.0*(5.0*fReflSurfXY[5][7]+8.0*fReflSurfXY[4][7])+5.0*(8.0*fReflSurfXY[3][7]+5.0*fReflSurfXY[2][7]+8.0*fReflSurfXY[1][7]+5.0*fReflSurfXY[0][7])); 
  fRefl[51] = 0.0; 
  fRefl[52] = 0.0; 
  fRefl[53] = 0.392837100659193*(fReflSurfXY[8][3]-1.0*(fReflSurfXY[6][3]+fReflSurfXY[2][3])+fReflSurfXY[0][3]); 
  fRefl[54] = 0.0; 
  fRefl[55] = 0.0; 
  fRefl[56] = 0.0; 
  fRefl[57] = 0.0; 
  fRefl[58] = 0.0; 
  fRefl[59] = 0.2618914004394621*(fReflSurfXY[8][1]-1.0*fReflSurfXY[6][1]+2.0*(fReflSurfXY[3][1]-1.0*fReflSurfXY[5][1])+fReflSurfXY[2][1]-1.0*fReflSurfXY[0][1]); 
  fRefl[60] = 0.2618914004394621*(fReflSurfXY[8][1]-2.0*fReflSurfXY[7][1]+fReflSurfXY[6][1]-1.0*fReflSurfXY[2][1]+2.0*fReflSurfXY[1][1]-1.0*fReflSurfXY[0][1]); 
  fRefl[61] = 0.0; 
  fRefl[62] = 0.0; 
  fRefl[63] = 0.0; 
  fRefl[64] = 0.0; 
  fRefl[65] = 0.392837100659193*(fReflSurfXY[8][4]-1.0*(fReflSurfXY[6][4]+fReflSurfXY[2][4])+fReflSurfXY[0][4]); 
  fRefl[66] = 0.0; 
  fRefl[67] = 0.0; 
  fRefl[68] = 0.2618914004394621*(fReflSurfXY[8][2]-1.0*fReflSurfXY[6][2]+2.0*(fReflSurfXY[3][2]-1.0*fReflSurfXY[5][2])+fReflSurfXY[2][2]-1.0*fReflSurfXY[0][2]); 
  fRefl[69] = 0.2618914004394621*(fReflSurfXY[8][2]-2.0*fReflSurfXY[7][2]+fReflSurfXY[6][2]-1.0*fReflSurfXY[2][2]+2.0*fReflSurfXY[1][2]-1.0*fReflSurfXY[0][2]); 
  fRefl[70] = 0.0; 
  fRefl[71] = 0.0; 
  fRefl[72] = 0.0; 
  fRefl[73] = 0.0; 
  fRefl[74] = 0.03904046494035036*(5.0*fReflSurfXY[8][3]+8.0*fReflSurfXY[7][3]+5.0*fReflSurfXY[6][3]-2.0*(5.0*fReflSurfXY[5][3]+8.0*fReflSurfXY[4][3])+5.0*(fReflSurfXY[2][3]-2.0*fReflSurfXY[3][3])+8.0*fReflSurfXY[1][3]+5.0*fReflSurfXY[0][3]); 
  fRefl[75] = 0.03904046494035036*(5.0*(fReflSurfXY[8][3]-2.0*fReflSurfXY[7][3]+fReflSurfXY[6][3])+8.0*(fReflSurfXY[5][3]-2.0*fReflSurfXY[4][3]+fReflSurfXY[3][3])+5.0*(fReflSurfXY[2][3]-2.0*fReflSurfXY[1][3]+fReflSurfXY[0][3])); 
  fRefl[76] = 0.0; 
  fRefl[77] = 0.05856069741052556*(5.0*fReflSurfXY[8][6]+8.0*fReflSurfXY[7][6]+5.0*fReflSurfXY[6][6]-1.0*(5.0*fReflSurfXY[2][6]+8.0*fReflSurfXY[1][6]+5.0*fReflSurfXY[0][6])); 
  fRefl[78] = 0.05856069741052556*(5.0*(fReflSurfXY[8][6]-1.0*fReflSurfXY[6][6])+8.0*(fReflSurfXY[5][6]-1.0*fReflSurfXY[3][6])+5.0*(fReflSurfXY[2][6]-1.0*fReflSurfXY[0][6])); 
  fRefl[79] = 0.0; 
  fRefl[80] = 0.392837100659193*(fReflSurfXY[8][5]-1.0*(fReflSurfXY[6][5]+fReflSurfXY[2][5])+fReflSurfXY[0][5]); 
  fRefl[81] = 0.0; 
  fRefl[82] = 0.0; 
  fRefl[83] = 0.05856069741052556*(5.0*fReflSurfXY[8][7]+8.0*fReflSurfXY[7][7]+5.0*fReflSurfXY[6][7]-1.0*(5.0*fReflSurfXY[2][7]+8.0*fReflSurfXY[1][7]+5.0*fReflSurfXY[0][7])); 
  fRefl[84] = 0.05856069741052556*(5.0*(fReflSurfXY[8][7]-1.0*fReflSurfXY[6][7])+8.0*(fReflSurfXY[5][7]-1.0*fReflSurfXY[3][7])+5.0*(fReflSurfXY[2][7]-1.0*fReflSurfXY[0][7])); 
  fRefl[85] = 0.0; 
  fRefl[86] = 0.0; 
  fRefl[87] = 0.0; 
  fRefl[88] = 0.0; 
  fRefl[89] = 0.0; 
  fRefl[90] = 0.0; 
  fRefl[91] = 0.0; 
  fRefl[92] = 0.0; 
  fRefl[93] = 0.0; 
  fRefl[94] = 0.2618914004394622*(fReflSurfXY[8][3]-1.0*fReflSurfXY[6][3]+2.0*(fReflSurfXY[3][3]-1.0*fReflSurfXY[5][3])+fReflSurfXY[2][3]-1.0*fReflSurfXY[0][3]); 
  fRefl[95] = 0.2618914004394622*(fReflSurfXY[8][3]-2.0*fReflSurfXY[7][3]+fReflSurfXY[6][3]-1.0*fReflSurfXY[2][3]+2.0*fReflSurfXY[1][3]-1.0*fReflSurfXY[0][3]); 
  fRefl[96] = 0.0; 
  fRefl[97] = 0.0; 
  fRefl[98] = 0.0; 
  fRefl[99] = 0.0; 
  fRefl[100] = 0.392837100659193*(fReflSurfXY[8][6]-1.0*(fReflSurfXY[6][6]+fReflSurfXY[2][6])+fReflSurfXY[0][6]); 
  fRefl[101] = 0.0; 
  fRefl[102] = 0.0; 
  fRefl[103] = 0.0; 
  fRefl[104] = 0.392837100659193*(fReflSurfXY[8][7]-1.0*(fReflSurfXY[6][7]+fReflSurfXY[2][7])+fReflSurfXY[0][7]); 
  fRefl[105] = 0.0; 
  fRefl[106] = 0.0; 
  fRefl[107] = 0.0; 
  fRefl[108] = 0.0; 
  fRefl[109] = 0.0; 
  fRefl[110] = 0.0; 
  fRefl[111] = 0.0; 
}
